/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:39
*/
KISSY.add("date/format",["date/gregorian","i18n!date"],function(z,C){function r(b,a,e){e.push({field:b,count:a})}function q(b,a,e,d){d=d||[];e=e||D;if(0<=b){if(100>b&&1<=a&&2>=a)return 10>b&&2==a&&d.push(F),d.push(b),d.join("");if(1E3<=b&&1E4>b){if(4==a)return d.push(b),d.join("");if(2==a&&2==e)return q(b%100,2,2,d)}}d.push(b+"");return d.join("")}function u(b,a,e){this.locale=a||E;for(var a=b.length,d=!1,g=[],c=null,p=0,j=-1,f=0;f<a;f++){var i=b.charAt(f);if("'"==i){if(f+1<a&&(i=b.charAt(f+1),"'"==
i)){f++;0!=p&&(r(j,p,g),j=-1,p=0);d&&(c+=i);continue}d?(g.push({text:c}),d=!1):(0!=p&&(r(j,p,g),j=-1,p=0),c="",d=!0)}else if(d)c+=i;else if("a"<=i&&"z">=i||"A"<=i&&"Z">=i){if(-1==k.indexOf(i))throw Error("Illegal pattern character '"+i+"'");-1==j||j==i?(j=i,p++):(r(j,p,g),j=i,p=1)}else 0!=p&&(r(j,p,g),j=-1,p=0),g.push({text:i})}if(d)throw Error("Unterminated quote");0!=p&&r(j,p,g);this.pattern=g;this.timezoneOffset=e}function G(b,a,e,d){switch(b){case "G":b=0<d.getYear()?1:0;a=e.eras[b];break;case "y":b=
d.getYear();0>=b&&(b=1-b);a=q(b,2,2!=a?D:2);break;case "M":b=d.getMonth();a=4<=a?e.months[b]:3==a?e.shortMonths[b]:q(b+1,a);break;case "k":a=q(d.getHourOfDay()||24,a);break;case "E":b=d.getDayOfWeek();a=4<=a?e.weekdays[b]:e.shortWeekdays[b];break;case "a":a=e.ampms[12<=d.getHourOfDay()?1:0];break;case "h":a=q(d.getHourOfDay()%12||12,a);break;case "K":a=q(d.getHourOfDay()%12,a);break;case "Z":a=d.getTimezoneOffset();e=[0>a?"-":"+"];a=Math.abs(a);e.push(q(Math.floor(a/60)%100,2),q(a%60,2));a=e.join("");
break;default:b=d.get(A[b]),a=q(b,a)}return a}function y(b,a,e){var d=-1,g=-1,c,k=e.length;for(c=0;c<k;c++){var j=e[c],f=j.length,i;if(i=f>d)a:{i=b;for(var o=a,n=f,h=0;h<n;h++)if(i.charAt(o+h)!=j.charAt(h)){i=!1;break a}i=!0}i&&(d=f,g=c)}return 0<=g?{value:g,startIndex:a+d}:null}function t(b,a,e,d){var g=b;if(d){if(b.length<=a+e)return null;g=b.substring(a,e);if(!g.match(/^\d+$/))return null}else g=g.substring(a);b=parseInt(g,10);if(isNaN(b))a=null;else{for(var c=g.length,e=0;e<c&&!(d=g.charAt(e),
"0">d||"9"<d);e++);a={value:b,startIndex:a+e}}return a}var o=C("date/gregorian"),E=C("i18n!date"),D=Number.MAX_VALUE,v=v,B={FULL:0,LONG:1,MEDIUM:2,SHORT:3},k=Array(o.DAY_OF_WEEK_IN_MONTH+2).join("1"),A={},k=k.split("");k[0]="G";k[o.YEAR]="y";k[o.MONTH]="M";k[o.DAY_OF_MONTH]="d";k[o.HOUR_OF_DAY]="H";k[o.MINUTES]="m";k[o.SECONDS]="s";k[o.MILLISECONDS]="S";k[o.WEEK_OF_YEAR]="w";k[o.WEEK_OF_MONTH]="W";k[o.DAY_OF_YEAR]="D";k[o.DAY_OF_WEEK_IN_MONTH]="F";z.each(k,function(b,a){A[b]=a});var k=k.join("")+
"ahkKZE",F="0";u.prototype={format:function(b){var a=b.getTime(),b=new o(this.timezoneOffset,this.locale);b.setTime(a);for(var e=[],d=this.pattern,g=d.length,a=0;a<g;a++){var c=d[a];c.text?e.push(c.text):"field"in c&&e.push(G(c.field,c.count,this.locale,b))}return e.join("")},parse:function(b){var a=new o(this.timezoneOffset,this.locale),e,d,g={},c=!1,k=b.length,j=-1,f=0;d=0;var i=this.pattern,q=i.length;a:for(e=0;0>j&&e<q;e++){var n=i[e],h,l;d=f;if(h=n.text)if(l=h.length,l+f>k)j=f;else{for(d=0;d<
l;d++)if(h.charAt(d)!=b.charAt(d+f)){j=f;break a}f+=l}else if("field"in n){c=!1;if(h=i[e+1])"field"in h?c=!0:(h=h.text.charAt(0),"0"<=h&&"9">=h&&(c=!0));h=a;l=b;var s=n.field,n=n.count,r=this.locale,w=c,x=g,m=c=void 0,m=void 0;if(!(l.length<=f)){switch(s){case "G":if(c=y(l,f,r.eras))h.isSetYear()?0==c.value&&(m=h.getYear(),h.setYear(1-m)):x.era=c.value;break;case "y":if(c=t(l,f,n,w))m=c.value,"era"in x&&0===x.era&&(m=1-m),h.setYear(m);break;case "M":s=void 0;if(3<=n){if(c=y(l,f,r[3==n?"shortMonths":
"months"]))s=c.value}else if(c=t(l,f,n,w))s=c.value-1;c&&h.setMonth(s);break;case "k":(c=t(l,f,n,w))&&h.setHourOfDay(c.value%24);break;case "E":(c=y(l,f,r[3<n?"weekdays":"shortWeekdays"]))&&h.setDayOfWeek(c.value);break;case "a":if(c=y(l,f,r.ampms))h.isSetHourOfDay()?c.value&&(m=h.getHourOfDay(),12>m&&h.setHourOfDay((m+12)%24)):x.ampm=c.value;break;case "h":if(c=t(l,f,n,w))m=c.value%=12,x.ampm&&(m+=12),h.setHourOfDay(m);break;case "K":if(c=t(l,f,n,w))m=c.value,x.ampm&&(m+=12),h.setHourOfDay(m);break;
case "Z":if(l)var u=l.charAt(f);if("-"==u)f++;else if("+"==u)f++;else break;if(c=t(l,f,2,!0)){s=60*c.value;f=c.startIndex;if(c=t(l,f,2,!0))s+=c.value;h.setTimezoneOffset(s)}break;default:(c=t(l,f,n,w))&&h.set(A[s],c.value)}c&&(f=c.startIndex)}f==d&&(j=f)}}return 0<=j?("error when parsing date",b,b.substring(0,j)+"^",v):a}};z.mix(u,{Style:B,getInstance:function(b,a){return this.getDateTimeInstance(B.SHORT,B.SHORT,b,a)},getDateInstance:function(b,a,e){return this.getDateTimeInstance(b,v,a,e)},getDateTimeInstance:function(b,
a,e,d){var e=e||E,g="";b!==v&&(g=e.datePatterns[b]);b="";a!==v&&(b=e.timePatterns[a]);a=g;b&&(a=g?z.substitute(e.dateTimePattern,{date:g,time:b}):b);return new u(a,e,d)},getTimeInstance:function(b,a,e){return this.getDateTimeInstance(v,b,a,e)}});return u});
