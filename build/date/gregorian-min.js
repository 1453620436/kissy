/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 19 15:38
*/
KISSY.add("date/gregorian/const",[],function(){return{SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}});
KISSY.add("date/gregorian/utils",["./const"],function(p){var e=this.require("./const"),x=[0,31,59,90,120,151,181,212,243,273,304,334],t=[0,31,60,91,121,152,182,213,244,274,305,335],q={};p.mix(q,{isLeapYear:function(e){return 0!=(e&3)?!1:0!=e%100||0==e%400},mod:function(e,c){return e-c*l(e/c)},getFixedDate:function(e,c,g){var h=e-1;return 365*h+l(h/4)-l(h/100)+l(h/400)+(g+(m(e)?t[c]:x[c]))},getGregorianDateFromFixedDate:function(k){var c,g,h,i;g=k-1;c=l(g/146097);h=y(g,146097);g=l(h/36524);i=y(h,36524);
h=l(i/1461);i=y(i,1461);i=l(i/365);c=400*c+100*g+4*h+i;4==g||4==i||++c;h=q.getFixedDate(c,e.JANUARY,1);i=(g=m(c))?t:x;var p=k-h,u,n;for(n=0;n<i.length;n++)if(i[n]<=p)u=n;else break;h=k-h-i[u]+1;k=0<=k?k%7:y(k,7);return{year:c,month:u,dayOfMonth:h,dayOfWeek:k,isLeap:g}}});var l=Math.floor,m=q.isLeapYear,y=q.mod;return q});
KISSY.add("date/gregorian",["./gregorian/utils","i18n!date","./gregorian/const"],function(p){function e(a,b){var d=p.makeArray(arguments);p.isObject(a)?(b=a,a=b.timezoneOffset):3<=d.length&&(a=b=null);this.locale=b=b||y;this.fields=[];this.time=c;this.timezoneOffset=a||b.timezoneOffset;this.firstDayOfWeek=b.firstDayOfWeek;this.minimalDaysInFirstWeek=b.minimalDaysInFirstWeek;this.fieldsComputed=!1;3<=arguments.length&&this.set.apply(this,d)}function x(a){var b=a.fields,d=t(b[g],b[h]);b[i]>d&&a.set(i,
d)}function t(a,b){return A(a)?H[b]:I[b]}function q(a,b,d){var f=b+6-r(b+6-a.firstDayOfWeek,7);f-b>=a.minimalDaysInFirstWeek&&(f-=7);return E((d-f)/7)+1}var l=parseInt,m=this.require("./gregorian/utils"),y=this.require("i18n!date"),k=this.require("./gregorian/const"),c=c;p.mix(e,k);p.mix(e,{Utils:m,isLeapYear:m.isLeapYear,YEAR:1,MONTH:2,DAY_OF_MONTH:3,HOUR_OF_DAY:4,MINUTES:5,SECONDS:6,MILLISECONDS:7,WEEK_OF_YEAR:8,WEEK_OF_MONTH:9,DAY_OF_YEAR:10,DAY_OF_WEEK:11,DAY_OF_WEEK_IN_MONTH:12,AM:0,PM:1});var g=
e.YEAR,h=e.MONTH,i=e.DAY_OF_MONTH,z=e.HOUR_OF_DAY,u=e.MINUTES,n=e.SECONDS,B=e.MILLISECONDS,C=e.DAY_OF_WEEK_IN_MONTH,v=e.DAY_OF_YEAR,w=e.DAY_OF_WEEK,s=e.WEEK_OF_MONTH,o=e.WEEK_OF_YEAR,I=[31,28,31,30,31,30,31,31,30,31,30,31],H=[31,29,31,30,31,30,31,31,30,31,30,31],r=m.mod,A=m.isLeapYear,E=Math.floor,F=[c,1,e.JANUARY,1,0,0,0,0,1,c,1,e.SUNDAY,1],G=[c,292278994,e.DECEMBER,c,23,59,59,999,c,c,c,e.SATURDAY,c];e.prototype={constructor:e,isLeapYear:function(){return A(this.getYear())},getLocale:function(){return this.locale},
getActualMinimum:function(a){if(F[a]!==c)return F[a];var b=this.fields;if(a===s)return(new e(b[g],b[h],1)).get(s);throw Error("minimum value not defined!");},getActualMaximum:function(a){if(G[a]!==c)return G[a];var b,d=this.fields;switch(a){case i:b=t(d[g],d[h]);break;case o:b=(new e(d[g],e.DECEMBER,31)).get(o);1==b&&(b=52);break;case s:b=(new e(d[g],d[h],t(d[g],d[h]))).get(s);break;case v:b=A(d[g])?366:365;break;case C:b=l((t(d[g],d[h])-1)/7)+1}if(b===c)throw Error("maximum value not defined!");
return b},isSet:function(a){return this.fields[a]!==c},computeFields:function(){var a=this.time,b=6E4*this.timezoneOffset,d=l(b/864E5),b=b%864E5,d=d+l(a/864E5),b=b+a%864E5;if(864E5<=b)b-=864E5,d++;else for(;0>b;)b+=864E5,d--;var d=d+719163,f=m.getGregorianDateFromFixedDate(d),j=f.year,a=this.fields;a[g]=j;a[h]=f.month;a[i]=f.dayOfMonth;a[w]=f.dayOfWeek;0!=b?(a[z]=l(b/36E5),b%=36E5,a[u]=l(b/6E4),b%=6E4,a[n]=l(b/1E3),a[B]=b%1E3):a[z]=a[u]=a[n]=a[B]=0;var c=m.getFixedDate(j,e.JANUARY,1),b=d-f.dayOfMonth+
1;a[v]=d-c+1;a[C]=l((f.dayOfMonth-1)/7)+1;f=q(this,c,d);0==f?(f=c-1,j=c-(A(j-1)?366:365),f=q(this,j,f)):52<=f&&(j=c+(A(j)?366:365),c=j+6-r(j+6-this.firstDayOfWeek,7),c-j>=this.minimalDaysInFirstWeek&&d>=c-7&&(f=1));a[o]=f;a[s]=q(this,b,d);this.fieldsComputed=!0},computeTime:function(){if(!this.isSet(g))throw Error("year must be set for KISSY GregorianCalendar");var a=this.fields,b=a[g],d=0;this.isSet(z)&&(d+=a[z]);d=60*d+(a[u]||0);d=60*d+(a[n]||0);d=1E3*d+(a[B]||0);a[g]=b;a=0+this.getFixedDate();
this.time=d=864E5*(a-719163)+d-6E4*this.timezoneOffset;this.computeFields()},complete:function(){this.time===c&&this.computeTime();this.fieldsComputed||this.computeFields()},getFixedDate:function(){var a=this.fields,b=this.firstDayOfWeek,d=a[g],f=e.JANUARY;this.isSet(h)&&(f=a[h],f>e.DECEMBER?(d+=l(f/12),f%=12):f<e.JANUARY&&(d+=E(f/12),f=r(f,12)));var c=m.getFixedDate(d,f,1),k=this.firstDayOfWeek;this.isSet(w)&&(k=a[w]);this.isSet(h)?this.isSet(i)?c+=a[i]-1:this.isSet(s)?(d=c+6-r(c+6-b,7),d-c>=this.minimalDaysInFirstWeek&&
(d-=7),k!=b&&(d=d+6-r(d+6-k,7)),c=d+7*(a[s]-1)):(a=this.isSet(C)?a[C]:1,b=7*a,0>a&&(b=t(d,f)+7*(a+1)),c=c+b-1-r(c+b-1-k,7)):this.isSet(v)?c+=a[v]-1:(d=c+6-r(c+6-b,7),d-c>=this.minimalDaysInFirstWeek&&(d-=7),k!=b&&(d=d+6-r(d+6-k,7)),c=d+7*(a[o]-1));return c},getTime:function(){this.time===c&&this.computeTime();return this.time},setTime:function(a){this.time=a;this.fieldsComputed=!1;this.complete()},get:function(a){this.complete();return this.fields[a]},set:function(a,b){var d=arguments.length;if(2==
d)this.fields[a]=b;else if(d<B+1)for(var f=0;f<d;f++)this.fields[g+f]=arguments[f];else throw Error("illegal arguments for KISSY GregorianCalendar set");this.time=c},add:function(a,b){if(b){var d=this.fields,c=this.get(a);if(a===g)this.set(g,c+b),x(this);else if(a===h){var c=c+b,e=E(c/12),c=r(c,12);e&&this.set(g,d[g]+e);this.set(h,c);x(this)}else{switch(a){case z:b*=36E5;break;case u:b*=6E4;break;case n:b*=1E3;break;case B:break;case s:case o:case C:b*=6048E5;break;case w:case v:case i:b*=864E5;break;
default:throw Error("illegal field for add");}this.setTime(this.time+b)}}},getRolledValue:function(a,b,d,c){c=c-d+1;return d+(a-d+b%c+c)%c},roll:function(a,b){if(b){var d=this.get(a),c=this.getActualMinimum(a),e=this.getActualMaximum(a),d=this.getRolledValue(d,b,c,e);this.set(a,d);switch(a){case h:x(this);break;default:this.updateFieldsBySet(a)}}},updateFieldsBySet:function(a){var b=this.fields;switch(a){case s:b[i]=c;break;case v:b[h]=c;break;case w:b[i]=c;break;case o:b[v]=c,b[h]=c}},getTimezoneOffset:function(){return this.timezoneOffset},
setTimezoneOffset:function(a){this.timezoneOffset!=a&&(this.fieldsComputed=c,this.timezoneOffset=a)},setFirstDayOfWeek:function(a){this.firstDayOfWeek!=a&&(this.firstDayOfWeek=a,this.fieldsComputed=!1)},getFirstDayOfWeek:function(){return this.firstDayOfWeek},setMinimalDaysInFirstWeek:function(a){this.minimalDaysInFirstWeek!=a&&(this.minimalDaysInFirstWeek=a,this.fieldsComputed=!1)},getMinimalDaysInFirstWeek:function(){return this.minimalDaysInFirstWeek},getWeeksInWeekYear:function(){var a=this.getWeekYear();
if(a==this.get(g))return this.getActualMaximum(o);var b=this.clone();b.setWeekDate(a,2,this.get(w));return b.getActualMaximum(o)},getWeekYear:function(){var a=this.get(g),b=this.get(o),d=this.get(h);d==e.JANUARY?52<=b&&--a:d==e.DECEMBER&&1==b&&++a;return a},setWeekDate:function(a,b,d){if(d<e.SUNDAY||d>e.SATURDAY)throw Error("invalid dayOfWeek: "+d);var c=this.fields,j=this.clone();j.clear();j.setTimezoneOffset(0);j.set(g,a);j.set(o,1);j.set(w,this.getFirstDayOfWeek());a=d-this.getFirstDayOfWeek();
0>a&&(a+=7);a+=7*(b-1);0!=a?j.add(v,a):j.complete();c[g]=j.get(g);c[h]=j.get(h);c[i]=j.get(i);this.complete()},clone:function(){this.time===c&&this.computeTime();var a=new e(this.timezoneOffset,this.locale);a.setTime(this.time);return a},equals:function(a){return this.getTime()==a.getTime()&&this.firstDayOfWeek==a.firstDayOfWeek&&this.timezoneOffset==a.timezoneOffset&&this.minimalDaysInFirstWeek==a.minimalDaysInFirstWeek},clear:function(a){a===c?this.field=[]:this.fields[a]=c;this.time=c;this.fieldsComputed=
!1}};var D=e.prototype;p.each(",Year,Month,DayOfMonth,HourOfDay,Minutes,Seconds,Milliseconds,WeekOfYear,WeekOfMonth,DayOfYear,DayOfWeek,DayOfWeekInMonth".split(","),function(a,b){if(a){D["get"+a]=function(){return this.get(b)};D["isSet"+a]=function(){return this.isSet(b)};D["set"+a]=function(a){return this.set(b,a)};D["add"+a]=function(a){return this.add(b,a)};D["roll"+a]=function(a){return this.roll(b,a)}}});return e});
