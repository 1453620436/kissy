/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 27 21:59
*/
KISSY.add("menubutton/menubutton-xtpl",["component/extension/content-xtpl"],function(k,h,l,j){k=function(i,g,e,c,a){var b,d=this.nativeCommands,f=this.utils;if("1.50"!==g.version)throw Error("current xtemplate file("+this.name+")(v1.50) need to be recompiled using current kissy(v"+g.version+")!");"undefined"!==typeof j&&j.kissy&&(b=j);g=f.callCommand;d=d.include;e.write("");var f={},m=[];m.push("component/extension/content-xtpl");f.params=m;b&&(h("component/extension/content-xtpl"),f.params[0]=b.resolve(f.params[0]));
if((c=d.call(this,i,f,e,1,c))&&c.isBuffer)e=c,c=a;e.write(c,!1);e.write('\n<div class="');c={escape:1};b=[];b.push("dropdown");c.params=b;if((c=g(this,i,c,e,"getBaseCssClasses",2))&&c.isBuffer)e=c,c=a;e.write(c,!0);e.write('">\n    <div class="');c={escape:1};b=[];b.push("dropdown-inner");c.params=b;if((i=g(this,i,c,e,"getBaseCssClasses",3))&&i.isBuffer)e=i,i=a;e.write(i,!0);e.write('">\n    </div>\n</div>');return e};k.TPL_NAME=j.name;return k});
KISSY.add("menubutton/render",["button","./menubutton-xtpl","component/extension/content-render"],function(k,h){var l=h("button"),j=h("./menubutton-xtpl"),i=h("component/extension/content-render");return l.getDefaultRender().extend([i],{decorateDom:function(g){var e=this.control,c=e.get("prefixCls"),g=g.one("."+c+"popupmenu"),a=g[0].ownerDocument.body;a.insertBefore(g[0],a.firstChild);a=this.getComponentConstructorByNode(c,g);e.setInternal("menu",new a({srcNode:g,prefixCls:c}))},beforeCreateDom:function(g){k.mix(g.elAttrs,
{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(g){var e=this.$el,c=this.getBaseCssClass("open");e[g?"removeClass":"addClass"](c).attr("aria-expanded",!g)}},{ATTRS:{contentTpl:{value:j}}})});
KISSY.add("menubutton/control",["node","button","./render"],function(k,h){function l(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function j(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var i=h("node"),g=h("button"),e=h("./render"),c=i.KeyCode;return g.extend({isMenuButton:1,_onSetCollapsed:function(a){var b=this.get("menu");if(a)b.hide();else if(a=this.$el,!b.get("visible")){var d={node:a,points:["bl","tl"],overflow:{adjustX:1,
adjustY:1}};k.mix(b.get("align"),d,!1);this.get("matchElWidth")&&(b.render(),d=b.get("el"),d=(parseInt(d.css("borderLeftWidth"),10)||0)+(parseInt(d.css("borderRightWidth"),10)||0),b.set("width",b.get("align").node[0].offsetWidth-d));b.show();a.attr("aria-haspopup",b.get("el").attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",j,this);this.on("click",l,this)},handleKeyDownInternal:function(a){var b=a.keyCode,d=""+a.type,f=this.get("menu");if(b===c.SPACE){if(a.preventDefault(),"keyup"!==
d)return}else if("keydown"!==d)return;if(f.get("rendered")&&f.get("visible"))return a=f.handleKeyDownInternal(a),b===c.ESC?(this.set("collapsed",!0),!0):a;if(b===c.SPACE||b===c.DOWN||b===c.UP)return this.set("collapsed",!1),!0},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){this.callSuper(a);this.set("collapsed",!0)},addItem:function(a,b){this.get("menu").addChild(a,b)},removeItem:function(a,b){this.get("menu").removeChild(a,b)},removeItems:function(a){var b=
this.get("menu");b&&(b.removeChildren?b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=this.get("menu");return b.get("rendered")&&b.getChildAt(a)},_onSetDisabled:function(a){a||this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&
a.setInternal("parent",this)}},collapsed:{value:!1,view:1},xrender:{value:e}},xclass:"menu-button"})});
KISSY.add("menubutton/select",["node","./control"],function(k,h){function l(d){var f=d.get("menu"),f=f.children||f.get&&f.get("children")||[],d=d.get("value"),a,b;for(b=0;b<f.length;b++)if(a=f[b],j(a)===d)return a;return null}function j(d){var a;if(d)if(d.get){if(void 0===(a=d.get("value")))a=d.get("textContent")||d.get("content")}else if(void 0===(a=d.value))a=d.textContent||d.content;return a}function i(a){var f=a.get("menu"),b=a.get("value"),a=f&&f.get&&f.get("children");k.each(a,function(a){a&&
a.set&&a.set("selected",j(a)===b)})}function g(a){var f=l(this),b=this.get("menu");a.target===b&&((a=f||b.getChildAt(0))&&a.set("highlighted",!0),f&&f.set("selected",!0))}function e(a){var b=l(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function c(a){a=a.target;if(a.isMenuItem){var a=j(a),b=this.get("value");this.set("value",a);a!==b&&this.fire("change",{prevVal:b,newVal:a})}}var a=h("node"),b=h("./control").extend({bindUI:function(){this.on("click",
c,this);this.on("show",g,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){this.callSuper(a,b);a.get("value")===this.get("value")&&this.set("value",null)},_onSetValue:function(){i(this);e(this)},_onSetDefaultCaption:function(){e(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(d,c){d=k.one(d);c=c||{};c.elBefore=d;var e,g=[],h,i=null,j=d.val();d.all("option").each(function(a){var b={xclass:"option",
content:a.text(),elCls:a.attr("class"),value:a.val()};j===a.val()&&(i={content:b.content,value:b.value});g.push(b)});k.mix(c,{menu:k.mix({children:g},c.menuCfg)});delete c.menuCfg;h=(new b(k.mix(c,i))).render();if(e=d.attr("name")){var l=(new a('<input type="hidden" name="'+e+'" value="'+j+'">')).insertBefore(d,void 0);h.on("afterValueChange",function(a){l.val(a.newVal||"")})}d.remove();return h},xclass:"select"});return b});
KISSY.add("menubutton/option",["menu"],function(k,h){return h("menu").Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})});KISSY.add("menubutton",["menubutton/control","menubutton/select","menubutton/option"],function(k,h){var l=h("menubutton/control"),j=h("menubutton/select"),i=h("menubutton/option");l.Select=j;l.Option=i;return l});
