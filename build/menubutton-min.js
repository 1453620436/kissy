/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 10 18:48
*/
KISSY.add("menubutton/menubutton-xtpl",["component/extension/content-xtpl"],function(j,h,g,k){g=function(f,e,d,g){var a=this.nativeCommands,c=this.utils;if("5.0.0"!==j.version)throw Error("current xtemplate file("+this.name+")(v5.0.0) need to be recompiled using current kissy(v"+j.version+")!");c=c.callCommand;a=a.include;e.write("");var i={},b=[];b.push("component/extension/content-xtpl");i.params=b;h("component/extension/content-xtpl");i.params[0]=k.resolve(i.params[0]);if((d=a.call(this,f,i,e,
1,d))&&d.isBuffer)e=d,d=g;e.write(d,!1);e.write('\n<div class="');d={escape:1};a=[];a.push("dropdown");d.params=a;if((d=c(this,f,d,e,"getBaseCssClasses",2))&&d.isBuffer)e=d,d=g;e.write(d,!0);e.write('">\n    <div class="');d={escape:1};a=[];a.push("dropdown-inner");d.params=a;if((f=c(this,f,d,e,"getBaseCssClasses",3))&&f.isBuffer)e=f,f=g;e.write(f,!0);e.write('">\n    </div>\n</div>');return e};g.TPL_NAME=k.name;return g});
KISSY.add("menubutton/control",["node","button","component/extension/content-box","./menubutton-xtpl"],function(j,h){function g(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function k(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var f=h("node"),e=h("button"),d=h("component/extension/content-box"),l=f.KeyCode,f=h("./menubutton-xtpl");return e.extend([d],{isMenuButton:1,decorateDom:function(a){var c=this.get("prefixCls"),
a=a.one("."+c+"popupmenu"),i=a[0].ownerDocument.body;i.insertBefore(a[0],i.firstChild);this.setInternal("menu",new (this.getComponentConstructorByNode(c,a))({srcNode:a,prefixCls:c}))},beforeCreateDom:function(a){j.mix(a.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(a){var c=this.get("menu"),i=this.$el,b=this.getBaseCssClass("open");i[a?"removeClass":"addClass"](b).attr("aria-expanded",!a);a?c.hide():c.get("visible")||(a={node:i,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},
j.mix(c.get("align"),a,!1),this.get("matchElWidth")&&(c.render(),a=c.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),c.set("width",c.get("align").node[0].offsetWidth-a)),c.show(),i.attr("aria-haspopup",c.get("el").attr("id")))},bindUI:function(){this.on("afterHighlightedItemChange",k,this);this.on("click",g,this)},handleKeyDownInternal:function(a){var c=a.keyCode,i=""+a.type,b=this.get("menu");if(c===l.SPACE){if(a.preventDefault(),"keyup"!==i)return}else if("keydown"!==
i)return;if(b.get("rendered")&&b.get("visible"))return a=b.handleKeyDownInternal(a),c===l.ESC?(this.set("collapsed",!0),!0):a;if(c===l.SPACE||c===l.DOWN||c===l.UP)return this.set("collapsed",!1),!0},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){this.callSuper(a);this.set("collapsed",!0)},addItem:function(a,c){this.get("menu").addChild(a,c)},removeItem:function(a,c){this.get("menu").removeChild(a,c)},removeItems:function(a){var c=this.get("menu");
c&&(c.removeChildren?c.removeChildren(a):c.children&&(c.children=[]))},getItemAt:function(a){var c=this.get("menu");return c.get("rendered")&&c.getChildAt(a)},_onSetDisabled:function(a){this.callSuper(a);a||this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&
a.setInternal("parent",this)}},collapsed:{value:!0,render:1,sync:0},contentTpl:{value:f}},xclass:"menu-button"})});
KISSY.add("menubutton/select",["node","./control"],function(j,h){function g(a){var b=a.get("menu"),b=b.children||b.get&&b.get("children")||[],a=a.get("value"),c,d;for(d=0;d<b.length;d++)if(c=b[d],k(c)===a)return c;return null}function k(a){var b;if(a)if(a.get){if(void 0===(b=a.get("value")))b=a.get("textContent")||a.get("content")}else if(void 0===(b=a.value))b=a.textContent||a.content;return b}function f(a){var b=a.get("menu"),c=a.get("value"),a=b&&b.get&&b.get("children");j.each(a,function(a){a&&
a.set&&a.set("selected",k(a)===c)})}function e(a){var b=g(this),c=this.get("menu");a.target===c&&((a=b||c.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function d(a){var b=g(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function l(a){a=a.target;if(a.isMenuItem){var a=k(a),b=this.get("value");this.set("value",a);a!==b&&this.fire("change",{prevVal:b,newVal:a})}}var a=h("node"),c=h("./control").extend({bindUI:function(){this.on("click",
l,this);this.on("show",e,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){this.callSuper(a,b);a.get("value")===this.get("value")&&this.set("value",null)},_onSetValue:function(){f(this);d(this)},_onSetDefaultCaption:function(){d(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(d,b){d=j.one(d);b=b||{};b.elBefore=d;var e,g=[],f,h=null,k=d.val();d.all("option").each(function(a){var b={xclass:"option",
content:a.text(),elCls:a.attr("class"),value:a.val()};k===a.val()&&(h={content:b.content,value:b.value});g.push(b)});j.mix(b,{menu:j.mix({children:g},b.menuCfg)});delete b.menuCfg;f=(new c(j.mix(b,h))).render();if(e=d.attr("name")){var l=(new a('<input type="hidden" name="'+e+'" value="'+k+'">')).insertBefore(d,void 0);f.on("afterValueChange",function(a){l.val(a.newVal||"")})}d.remove();return f},xclass:"select"});return c});
KISSY.add("menubutton/option",["menu"],function(j,h){return h("menu").Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})});KISSY.add("menubutton",["menubutton/control","menubutton/select","menubutton/option"],function(j,h){var g=h("menubutton/control"),k=h("menubutton/select"),f=h("menubutton/option");g.Select=k;g.Option=f;return g});
