/*
Copyright 2013, KISSY v1.41
MIT Licensed
build time: Dec 2 15:23
*/
KISSY.add("menubutton/menubutton-xtpl",["component/extension/content-xtpl"],function(j,e,i,h){return function(f,d,k){var c,d=this.config.utils;"undefined"!==typeof h&&h.kissy&&(c=h);var a=d.getPropertyOrRunCommand,d="",b={},g=[];g.push("component/extension/content-xtpl");b.params=g;c&&(e("component/extension/content-xtpl"),b.params[0]=c.resolveByName(b.params[0]));c=a(this,f,b,"include",0,1,!1,k);d=d+c+'\n<div class="';c={};b=[];b.push("dropdown");c.params=b;c=a(this,f,c,"getBaseCssClasses",0,2,!0,
k);d=d+c+'">\n    <div class="';c={};b=[];b.push("dropdown-inner");c.params=b;f=a(this,f,c,"getBaseCssClasses",0,3,!0,k);return d+f+'">\n    </div>\n</div>'}});
KISSY.add("menubutton/render",["button","./menubutton-xtpl","component/extension/content-render"],function(j,e){var i=e("button"),h=e("./menubutton-xtpl"),f=e("component/extension/content-render");return i.getDefaultRender().extend([f],{decorateDom:function(d){var e=this.control,c=e.get("prefixCls"),d=d.one("."+c+"popupmenu"),a=d[0].ownerDocument.body;a.insertBefore(d[0],a.firstChild);a=this.getComponentConstructorByNode(c,d);e.setInternal("menu",new a({srcNode:d,prefixCls:c}))},beforeCreateDom:function(d){j.mix(d.elAttrs,
{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(d){var e=this.$el,c=this.getBaseCssClass("open");e[d?"removeClass":"addClass"](c).attr("aria-expanded",!d)}},{ATTRS:{contentTpl:{value:h}}})});
KISSY.add("menubutton/control",["node","button","./render"],function(j,e){function i(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function h(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var f=e("node"),d=e("button"),k=e("./render"),c=f.KeyCode;return d.extend({isMenuButton:1,_onSetCollapsed:function(a){var b=this.get("menu");if(a)b.hide();else if(a=this.$el,!b.get("visible")){var g={node:a,points:["bl","tl"],overflow:{adjustX:1,
adjustY:1}};j.mix(b.get("align"),g,!1);this.get("matchElWidth")&&(b.render(),g=b.get("el"),g=(parseInt(g.css("borderLeftWidth"))||0)+(parseInt(g.css("borderRightWidth"))||0),b.set("width",b.get("align").node[0].offsetWidth-g));b.show();a.attr("aria-haspopup",b.get("el").attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",h,this);this.on("click",i,this)},handleKeyDownInternal:function(a){var b=a.keyCode,g=""+a.type,l=this.get("menu");if(b===c.SPACE){if(a.preventDefault(),"keyup"!==
g)return}else if("keydown"!==g)return;if(l.get("rendered")&&l.get("visible"))return a=l.handleKeyDownInternal(a),b===c.ESC?(this.set("collapsed",!0),!0):a;if(b===c.SPACE||b===c.DOWN||b===c.UP)return this.set("collapsed",!1),!0},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){this.callSuper(a);this.set("collapsed",!0)},addItem:function(a,b){this.get("menu").addChild(a,b)},removeItem:function(a,b){this.get("menu").removeChild(a,b)},removeItems:function(a){var b=
this.get("menu");b&&(b.removeChildren?b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=this.get("menu");return b.get("rendered")&&b.getChildAt(a)},_onSetDisabled:function(a){a||this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&
a.setInternal("parent",this)}},collapsed:{value:!1,view:1},xrender:{value:k}},xclass:"menu-button"})});
KISSY.add("menubutton/select",["node","./control"],function(j,e){function i(g){var a=g.get("menu"),a=a.children||a.get&&a.get("children")||[],g=g.get("value"),b,c;for(c=0;c<a.length;c++)if(b=a[c],h(b)===g)return b;return null}function h(a){var b;if(a)if(a.get){if(void 0===(b=a.get("value")))b=a.get("textContent")||a.get("content")}else if(void 0===(b=a.value))b=a.textContent||a.content;return b}function f(a){var b=a.get("menu"),c=a.get("value"),a=b&&b.get&&b.get("children");j.each(a,function(a){a&&
a.set&&a.set("selected",h(a)===c)})}function d(a){var b=i(this),c=this.get("menu");a.target===c&&((a=b||c.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function k(a){var b=i(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function c(a){a=a.target;if(a.isMenuItem){var a=h(a),b=this.get("value");this.set("value",a);a!==b&&this.fire("change",{prevVal:b,newVal:a})}}var a=e("node"),b=e("./control").extend({bindUI:function(){this.on("click",
c,this);this.on("show",d,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){this.callSuper(a,b);a.get("value")===this.get("value")&&this.set("value",null)},_onSetValue:function(){f(this);k(this)},_onSetDefaultCaption:function(){k(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(c,d){c=j.one(c);d=d||{};d.elBefore=c;var e,h=[],f,i=null,k=c.val();c.all("option").each(function(a){var b={xclass:"option",
content:a.text(),elCls:a.attr("class"),value:a.val()};k===a.val()&&(i={content:b.content,value:b.value});h.push(b)});j.mix(d,{menu:j.mix({children:h},d.menuCfg)});delete d.menuCfg;f=(new b(j.mix(d,i))).render();if(e=c.attr("name")){var m=(new a('<input type="hidden" name="'+e+'" value="'+k+'">')).insertBefore(c,void 0);f.on("afterValueChange",function(a){m.val(a.newVal||"")})}c.remove();return f},xclass:"select"});return b});
KISSY.add("menubutton/option",["menu"],function(j,e){return e("menu").Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})});KISSY.add("menubutton",["menubutton/control","menubutton/select","menubutton/option"],function(j,e){var i=e("menubutton/control"),h=e("menubutton/select"),f=e("menubutton/option");i.Select=h;i.Option=f;return i});
