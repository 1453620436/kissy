/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 19 12:42
*/
KISSY.add("combobox/combobox-xtpl",[],function(){return function(e,b,h){var f=this,b=this.config.utils,j=b.runBlockCommand,g=b.getExpression,c=b.getPropertyOrRunCommand,b='<div id="ks-combobox-invalid-el-',a=c(f,e,{},"id",0,1,h,!1),b=b+g(a,!0),b=b+'"\n     class="',a={},i=[];i.push("invalid-el");a.params=i;a=c(f,e,a,"getBaseCssClasses",0,2,!0,h);b=b+a+'">\n    <div class="';a={};i=[];i.push("invalid-inner");a.params=i;var a=c(f,e,a,"getBaseCssClasses",0,3,!0,h),b=b+a+'"></div>\n</div>\n\n',a={},i=
[],d=c(f,e,{},"hasTrigger",0,6,h,!0);i.push(d);a.params=i;a.fn=function(a){var b;b='\n<div id="ks-combobox-trigger-';var d=c(f,a,{},"id",0,7,h,!1);b+=g(d,!0);b+='"\n     class="';var d={},e=[];e.push("trigger");d.params=e;d=c(f,a,d,"getBaseCssClasses",0,8,!0,h);b=b+d+'">\n    <div class="';d={};e=[];e.push("trigger-inner");d.params=e;a=c(f,a,d,"getBaseCssClasses",0,9,!0,h);return b+a+'">&#x25BC;</div>\n</div>\n'};b+=j(f,e,a,"if",6);b+='\n\n<div class="';a={};i=[];i.push("input-wrap");a.params=i;a=
c(f,e,a,"getBaseCssClasses",0,13,!0,h);b=b+a+'">\n\n    <input id="ks-combobox-input-';a=c(f,e,{},"id",0,15,h,!1);b+=g(a,!0);b+='"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ';a={};i=[];d=c(f,e,{},"disabled",0,22,h,!0);i.push(d);a.params=i;a.fn=function(){return"\n    disabled\n    "};b+=j(f,e,a,"if",22);b+='\n\n    autocomplete="off"\n    class="';a={};i=[];i.push("input");
a.params=i;a=c(f,e,a,"getBaseCssClasses",0,27,!0,h);b=b+a+'"\n\n    value="';a=c(f,e,{},"value",0,29,h,!1);b+=g(a,!0);b+='"\n    />\n\n\n    <label id="ks-combobox-placeholder-';a=c(f,e,{},"id",0,33,h,!1);b+=g(a,!0);b+='"\n           for="ks-combobox-input-';a=c(f,e,{},"id",0,34,h,!1);b+=g(a,!0);b+="\"\n            style='display:";a={};i=[];d=c(f,e,{},"value",0,35,h,!0);i.push(d);a.params=i;a.fn=function(){return"none"};a.inverse=function(){return"block"};b+=j(f,e,a,"if",35);b+=";'\n    class=\"";
j={};a=[];a.push("placeholder");j.params=a;j=c(f,e,j,"getBaseCssClasses",0,36,!0,h);b=b+j+'">\n    ';e=c(f,e,{},"placeholder",0,37,h,!1);b+=g(e,!0);return b+"\n    </label>\n</div>\n"}});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(e){var b=this.require("component/control"),h=this.require("./combobox-xtpl");this.exports=b.getDefaultRender().extend({beforeCreateDom:function(b,h){e.mix(h,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(b){this.control.get("input").attr("aria-expanded",
!b)},_onSetDisabled:function(b,e){this.callSuper(b,e);this.control.get("input").attr("disabled",b)}},{ATTRS:{contentTpl:{value:h}},HTML_PARSER:{value:function(b){return b.one("."+this.getBaseCssClass("input")).val()},input:function(b){return b.one("."+this.getBaseCssClass("input"))},trigger:function(b){return b.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(b){return b.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(b){return b.one("."+this.getBaseCssClass("placeholder"))}}});
return ComboboxRender});
KISSY.add("combobox/control",["node","component/control","./render"],function(e){function b(q){for(var a=0;a<q.length;a++)if(!q[a].get("disabled"))return q[a];return null}function h(){i(this)}function f(){var a=this;setTimeout(function(){d(a)},0)}function j(){this.focus();d(this)}function g(){this.setValueFromAutocomplete(this.getValueForAutocomplete(),{force:1})}function c(a){a=a.target;a.isMenuItem&&(a=a.get("textContent"),this.setValueFromAutocomplete(a),this._savedValue=a,this.set("collapsed",
!0))}function a(a,b){var c=a.$el,d=a.view.getBaseCssClasses("invalid"),e=a.get("invalidEl");b?(c.addClass(d),e.attr("title",b),e.show()):(c.removeClass(d),e.hide())}function i(a){a._focusoutDismissTimer||(a._focusoutDismissTimer=setTimeout(function(){a._focusoutDismissTimer&&a.set("collapsed",!0)},50))}function d(a){var b;if(b=a._focusoutDismissTimer)clearTimeout(b),a._focusoutDismissTimer=null}function l(a){this.set("value",a.newVal,{data:{causedByTimer:1}})}function o(a){var b,c=[],d,e,c=this.get("menu"),
a=this.normalizeData(a);c.removeChildren(!0);(e=c.get("highlightedItem"))&&e.set("highlighted",!1);if(a&&a.length){for(e=0;e<a.length;e++)b=a[e],c.addChild(b);c=c.get("children");a=this.getValueForAutocomplete();if(this.get("highlightMatchItem"))for(e=0;e<c.length;e++)if(c[e].get("textContent")==a){c[e].set("highlighted",!0);d=!0;break}if(!d&&this.get("autoHighlightFirst"))for(e=0;e<c.length;e++)if(!c[e].get("disabled")){c[e].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var m=this.require("node"),p=this.require("component/control"),r=this.require("./render"),n=n,k=m.KeyCode;return p.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getValueForAutocomplete(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=e.mix({content:c,textContent:c,value:c},b[d])}return b},bindUI:function(){var a=
this;a.get("input").on("valuechange",l,a);a.on("click",c,a);a.get("menu").onRendered(function(b){var c=a.get("input"),d=b.get("el"),b=b.get("contentEl");c.attr("aria-owns",d.attr("id"));d.on("focusout",h,a);d.on("focusin",f,a);b.on("mouseover",j,a);b.on("mousedown",g,a)})},destructor:function(){this.get("menu").destroy()},getValueForAutocomplete:function(){return this.get("value")},setValueFromAutocomplete:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c;b.causedByTimer?(c=this.getValueForAutocomplete(),
c===n?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},handleFocusInternal:function(){var b;this.get("invalidEl")&&a(this,!1);(b=this.get("placeholderEl"))&&b.hide()},handleBlurInternal:function(b){var c=this,d=c.get("placeholderEl");c.callSuper(b);i(c);c.get("invalidEl")&&c.validate(function(b,d){b?!c.get("focused")&&d==c.get("value")&&a(c,b):a(c,!1)});d&&!c.get("value")&&d.show()},handleMouseDownInternal:function(a){var b,c;this.callSuper(a);b=a.target;
if((c=this.get("trigger"))&&(c[0]==b||c.contains(b)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(a){var c,d=a.keyCode,f,i=this.get("menu");this.get("input");c=this.get("updateInputOnDownUp");if(i.get("visible")){f=i.get("highlightedItem");if(c&&f){var h=i.get("children");if(d==k.DOWN&&f==b(h.concat().reverse())||d==k.UP&&f==b(h))return this.setValueFromAutocomplete(this._savedValue),f.set("highlighted",!1),!0}a=
i.handleKeyDownInternal(a);f=i.get("highlightedItem");if(d==k.ESC)return this.set("collapsed",!0),c&&this.setValueFromAutocomplete(this._savedValue),!0;c&&e.inArray(d,[k.DOWN,k.UP])&&this.setValueFromAutocomplete(f.get("textContent"));return d==k.TAB&&f&&(f.handleClickInternal(),this.get("multiple"))?!0:a}if(d==k.DOWN||d==k.UP)if(c=this.getValueForAutocomplete(),c!==n)return this.sendRequest(c),!0;return n},validate:function(a){var c=this.get("validator"),b=this.getValueForAutocomplete();c?c(b,function(c){a(c,
b)}):a(!1,b)},sendRequest:function(a){this.get("dataSource").fetchData(a,o,this)},_onSetCollapsed:function(a){var c=this.$el,b=this.get("menu");a?b.hide():(d(this),b.get("visible")||(this.get("matchElWidth")&&(b.render(),a=b.get("el"),a=(parseInt(a.css("borderLeftWidth"))||0)+(parseInt(a.css("borderRightWidth"))||0),b.set("width",c[0].offsetWidth-a)),b.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},
hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var c={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};e.mix(a.get("align"),c,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},
xrender:{value:r}},xclass:"combobox"})});
KISSY.add("combobox/cursor",["node"],function(e){function b(c){var a=j;a||(a=h(f));"textarea"==""+c[0].type.toLowerCase()?a.css("width",c.css("width")):a.css("width",9999);e.each(g,function(b){a.css(b,c.css(b))});j||a.insertBefore(c[0].ownerDocument.body.firstChild);return j=a}var h=this.require("node").all,f="<div style='z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;'></div>",j,g="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(c){var a=h(c),c=a[0],f=c.ownerDocument,d=h(f),g=c.scrollTop,j=c.scrollLeft;if(f.selection)return c=f.selection.createRange(),{left:c.boundingLeft+j+d.scrollLeft(),top:c.boundingTop+g+c.boundingHeight+d.scrollTop()};d=a.offset();if("textarea"!=c.type)return d.top+=c.offsetHeight,d;f=b(a);a=c.selectionStart;f.html(e.escapeHtml(c.value.substring(0,a-1))+"<span>x</span>");f.offset(d);d=f.last();c=d.offset();c.top+=d.height();0<a&&(c.left+=d.width());c.top-=g;c.left-=j;return c}});
KISSY.add("combobox/multi-value-combobox",["./cursor","./control"],function(){function e(b,a){return a&&-1!=b.indexOf(a)}function b(b){b.newVal&&b.target==this.get("menu")&&this.alignWithCursor()}function h(b){var a=b.get("input"),h=b.get("value"),d=[],g=[],o=b.get("literal"),m=b.get("separator"),b=b.get("separatorType"),p=!1,r=b!=f,a=a.prop("selectionStart"),n,k,q=-1;for(n=0;n<h.length;n++)(k=h.charAt(n),o&&k==o&&(p=!p),p)?g.push(k):(n==a&&(q=d.length),r&&j.test(k))?(g.length&&d.push(g.join("")),
g=[],g.push(k)):e(m,k)?b==f?(g.push(k),g.length&&d.push(g.join("")),g=[]):(g.length&&d.push(g.join("")),g=[],g.push(k)):g.push(k);g.length&&d.push(g.join(""));d.length||d.push("");-1==q&&(b==f&&e(m,k)&&d.push(""),q=d.length-1);return{tokens:d,cursorPosition:a,tokenIndex:q}}var f="suffix",j=/\s|\xa0/,g=this.require("./cursor");return this.require("./control").extend({syncUI:function(){var c;this.get("alignWithCursor")&&(c=this.get("menu"),c.setInternal("align",null),c.on("beforeVisibleChange",b,this))},
getValueForAutocomplete:function(){var b=h(this),a=b.tokens,g=b.tokenIndex,b=this.get("separator"),d=this.get("separatorType"),a=a[g],g=a.length-1;if(d!=f)if(e(b,a.charAt(0)))a=a.slice(1);else return;else d==f&&e(b,a.charAt(g))&&(a=a.slice(0,g));return a},setValueFromAutocomplete:function(b,a){var g=this.get("input"),d=h(this),l=d.tokens,d=Math.max(0,d.tokenIndex),o=this.get("separator"),m;m=this.get("separatorType");var p=l[d+1]||"",r=l[d];if(m!=f){if(l[d]=r.charAt(0)+b,!p||!j.test(p.charAt(0)))b&&
(l[d]+=" ")}else l[d]=b,m=r.length-1,e(o,r.charAt(m))?l[d]+=r.charAt(m):1==o.length&&(l[d]+=o);d=l.slice(0,d+1).join("").length;this.set("value",l.join(""),a);g.prop("selectionStart",d);g.prop("selectionEnd",d)},alignWithCursor:function(){var b=this.get("menu"),a;a=this.get("input");a=g(a);b.move(a.left,a.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:f},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})});
KISSY.add("combobox/filter-select",["./control"],function(){this.exports=this.require("./control").extend({validate:function(e){var b=this;b.callSuper(function(h,f){h?e(h,f):b.get("dataSource").fetchData(f,function(h){a:{if(h=b.normalizeData(h))for(var g=0;g<h.length;g++)if(h[g].textContent==f){h=h[g];break a}h=!1}e(h?"":b.get("invalidMessage"),f,h)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}})});
KISSY.add("combobox/local-data-source",["attribute"],function(e){return this.require("attribute").extend({fetchData:function(b,e,f){var j=this.get("parse"),g=this.get("data"),g=j(b,g);e.call(f,g)}},{ATTRS:{data:{value:[]},parse:{value:function(b,h){var f=[],j=0;if(!b)return h;e.each(h,function(e){-1!=e.indexOf(b)&&f.push(e);j++});return f}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(){var e=e,b=this.require("io");return this.require("attribute").extend({fetchData:function(h,f,j){var g=this,c,a=g.get("paramName"),i=g.get("parse"),d=g.get("cache"),l=g.get("allowEmpty");g.caches=g.caches||{};g.io&&(g.io.abort(),g.io=null);if(!h&&!0!==l)return f.call(j,[]);if(d&&(c=g.caches[h]))return f.call(j,c);c=g.get("xhrCfg");c.data=c.data||{};c.data[a]=h;c.success=function(a){i&&(a=i(h,a));g.setInternal("data",a);d&&(g.caches[h]=
a);f.call(j,a)};g.io=b(c);return e}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
KISSY.add("combobox",["combobox/control","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"],function(){var e=this.require("combobox/control"),b=this.require("combobox/multi-value-combobox"),h=this.require("combobox/filter-select"),f=this.require("combobox/local-data-source"),j=this.require("combobox/remote-data-source");e.LocalDataSource=f;e.RemoteDataSource=j;e.FilterSelect=h;e.MultiValueComboBox=b;return e});
