/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 25 19:32
*/
KISSY.add("combobox/combobox-xtpl",[],function(){var j=function(e,a,k){var i=this,d=a.escapeHtml,g=i.utils.callCommand,f=i.nativeCommands["if"],a='<div id="ks-combobox-invalid-el-',b=e.resolve(["id"]),a=a+d(b),a=a+'"\n     class="',b={},c=[];c.push("invalid-el");b.params=c;b=g(i,e,b,"getBaseCssClasses",2);a+=d(b);a+='">\n    <div class="';b={};c=[];c.push("invalid-inner");b.params=c;var b=g(i,e,b,"getBaseCssClasses",3),a=a+d(b),a=a+'"></div>\n</div>\n\n',b={},c=[],n=e.resolve(["hasTrigger"]);c.push(n);
b.params=c;b.fn=function(b){var a;a='\n<div id="ks-combobox-trigger-';var c=b.resolve(["id"]);a+=d(c);a+='"\n     class="';var c={},f=[];f.push("trigger");c.params=f;c=g(i,b,c,"getBaseCssClasses",8);a+=d(c);a+='">\n    <div class="';c={};f=[];f.push("trigger-inner");c.params=f;b=g(i,b,c,"getBaseCssClasses",9);a+=d(b);return a+'">&#x25BC;</div>\n</div>\n'};a+=f.call(i,e,b,k);a+='\n\n<div class="';b={};c=[];c.push("input-wrap");b.params=c;b=g(i,e,b,"getBaseCssClasses",13);a+=d(b);a+='">\n\n    <input id="ks-combobox-input-';
b=e.resolve(["id"]);a+=d(b);a+='"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ';b={};c=[];n=e.resolve(["disabled"]);c.push(n);b.params=c;b.fn=function(){return"\n    disabled\n    "};a+=f.call(i,e,b,k);a+='\n\n    autocomplete="off"\n    class="';b={};c=[];c.push("input");b.params=c;b=g(i,e,b,"getBaseCssClasses",27);a+=d(b);a+='"\n\n    value="';b=e.resolve(["value"]);
a+=d(b);a+='"\n    />\n\n\n    <label id="ks-combobox-placeholder-';b=e.resolve(["id"]);a+=d(b);a+='"\n           for="ks-combobox-input-';b=e.resolve(["id"]);a+=d(b);a+="\"\n            style='display:";b={};c=[];n=e.resolve(["value"]);c.push(n);b.params=c;b.fn=function(){return"none"};b.inverse=function(){return"block"};a+=f.call(i,e,b,k);a+=";'\n    class=\"";k={};f=[];f.push("placeholder");k.params=f;k=g(i,e,k,"getBaseCssClasses",36);a+=d(k);a+='">\n    ';e=e.resolve(["placeholder"]);a+=d(e);
return a+"\n    </label>\n</div>\n"};j.TPL_NAME="combobox/src/combobox/combobox.xtpl.html";return j});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(j,e){var a=e("component/control"),k=e("./combobox-xtpl");return a.getDefaultRender().extend({beforeCreateDom:function(a,d){j.mix(d,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(a){this.control.get("input").attr("aria-expanded",
!a)},_onSetDisabled:function(a,d){this.callSuper(a,d);this.control.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:k}},HTML_PARSER:{value:function(a){return a.one("."+this.getBaseCssClass("input")).val()},input:function(a){return a.one("."+this.getBaseCssClass("input"))},trigger:function(a){return a.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(a){return a.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))}}})});
KISSY.add("combobox/control",["node","component/control","./render","menu"],function(j,e){function a(a){for(var b=0;b<a.length;b++)if(!a[b].get("disabled"))return a[b];return null}function k(){c(this)}function i(){var a=this;setTimeout(function(){n(a)},0)}function d(){this.focus();n(this)}function g(){this.setValueFromAutocomplete(this.getValueForAutocomplete(),{force:1})}function f(a){a=a.target;a.isMenuItem&&(a=a.get("textContent"),this.setValueFromAutocomplete(a),this._savedValue=a,this.set("collapsed",
!0))}function b(a,b){var c=a.$el,f=a.view.getBaseCssClasses("invalid"),d=a.get("invalidEl");b?(c.addClass(f),d.attr("title",b),d.show()):(c.removeClass(f),d.hide())}function c(a){a._focusoutDismissTimer||(a._focusoutDismissTimer=setTimeout(function(){a._focusoutDismissTimer&&a.set("collapsed",!0)},50))}function n(a){var b=a._focusoutDismissTimer;b&&(clearTimeout(b),a._focusoutDismissTimer=null)}function r(a){this.set("value",a.target.value,{data:{causedByInputEvent:1}})}function h(a){var b,c=[],f,
d,c=this.get("menu"),a=this.normalizeData(a);c.removeChildren(!0);(d=c.get("highlightedItem"))&&d.set("highlighted",!1);if(a&&a.length){for(d=0;d<a.length;d++)b=a[d],c.addChild(b);c=c.get("children");a=this.getValueForAutocomplete();if(this.get("highlightMatchItem"))for(d=0;d<c.length;d++)if(c[d].get("textContent")===a){c[d].set("highlighted",!0);f=!0;break}if(!f&&this.get("autoHighlightFirst"))for(d=0;d<c.length;d++)if(!c[d].get("disabled")){c[d].set("highlighted",!0);break}this.set("collapsed",
!1);this.fire("afterRenderData")}else this.set("collapsed",!0)}var s=e("node"),t=e("component/control"),q=e("./render");e("menu");var l=s.KeyCode;return t.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getValueForAutocomplete(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=j.mix({content:c,textContent:c,value:c},
b[d])}return b},bindUI:function(){var a=this;a.get("input").on("input",r,a);a.on("click",f,a);a.get("menu").onRendered(function(b){var c=a.get("input"),f=b.get("el"),b=b.get("contentEl");c.attr("aria-owns",f.attr("id"));f.on("focusout",k,a);f.on("focusin",i,a);b.on("mouseover",d,a);b.on("mousedown",g,a)})},destructor:function(){this.get("menu").destroy()},getValueForAutocomplete:function(){return this.get("value")},setValueFromAutocomplete:function(a,b){this.set("value",a,b)},_onSetValue:function(a,
b){var c;b.causedByInputEvent?(c=this.getValueForAutocomplete(),void 0===c?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},handleFocusInternal:function(){var a;this.get("invalidEl")&&b(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(a){var d=this,f=d.get("placeholderEl");d.callSuper(a);c(d);d.get("invalidEl")&&d.validate(function(a,c){a?!d.get("focused")&&c===d.get("value")&&b(d,a):b(d,!1)});f&&!d.get("value")&&f.show()},handleMouseDownInternal:function(a){var b,
c;this.callSuper(a);b=a.target;if((c=this.get("trigger"))&&(c[0]===b||c.contains(b)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(b){var c,d=b.keyCode,f,e,g=this.get("menu");this.get("input");c=this.get("updateInputOnDownUp");if(g.get("visible")){f=g.get("highlightedItem");if(c&&f&&(e=g.get("children"),d===l.DOWN&&f===a(e.concat().reverse())||d===l.UP&&f===a(e)))return this.setValueFromAutocomplete(this._savedValue),
f.set("highlighted",!1),!0;e=g.handleKeyDownInternal(b);f=g.get("highlightedItem");if(d===l.ESC)return this.set("collapsed",!0),c&&this.setValueFromAutocomplete(this._savedValue),!0;c&&j.inArray(d,[l.DOWN,l.UP])&&this.setValueFromAutocomplete(f.get("textContent"));return d===l.TAB&&f&&(f.handleClickInternal(b),this.get("multiple"))?!0:e}if(d===l.DOWN||d===l.UP)if(b=this.getValueForAutocomplete(),void 0!==b)return this.sendRequest(b),!0},validate:function(a){var b=this.get("validator"),c=this.getValueForAutocomplete();
b?b(c,function(b){a(b,c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,h,this)},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");a?c.hide():(n(this),c.get("visible")||(this.get("matchElWidth")&&(c.render(),a=c.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),c.set("width",b[0].offsetWidth-a)),c.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},
invalidEl:{},allowTextSelection:{value:!0},hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};j.mix(a.get("align"),b,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},
autoHighlightFirst:{},highlightMatchItem:{value:!0},xrender:{value:q}},xclass:"combobox"})});
KISSY.add("combobox/cursor",["node"],function(j,e){function a(a){var b=d;b||(b=k(i));"textarea"===""+a[0].type.toLowerCase()?b.css("width",a.css("width")):b.css("width",9999);j.each(g,function(c){b.css(c,a.css(c))});d||b.insertBefore(a[0].ownerDocument.body.firstChild);return d=b}var k=e("node").all,i='<div style="z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;"></div>',d,g="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(d){var b=k(d),d=b[0],c=d.ownerDocument,e=k(c),g=d.scrollTop,h=d.scrollLeft;if(c.selection)return d=c.selection.createRange(),{left:d.boundingLeft+h+e.scrollLeft(),top:d.boundingTop+g+d.boundingHeight+e.scrollTop()};e=b.offset();if("textarea"!==d.type)return e.top+=d.offsetHeight,e;c=a(b);b=d.selectionStart;c.html(j.escapeHtml(d.value.substring(0,b-1))+"<span>x</span>");c.offset(e);e=c.last();d=e.offset();d.top+=e.height();0<b&&(d.left+=e.width());d.top-=g;d.left-=h;return d}});
KISSY.add("combobox/multi-value-combobox",["./cursor","./control"],function(j,e){function a(a,c){return c&&-1!==a.indexOf(c)}function k(a){a.newVal&&a.target===this.get("menu")&&this.alignWithCursor()}function i(b){var c=b.get("input"),e=b.get("value"),f=[],h=[],k=b.get("literal"),i=b.get("separator"),b=b.get("separatorType"),j=!1,l=b!==d,c=c.prop("selectionStart"),o,m,p=-1;for(o=0;o<e.length;o++)(m=e.charAt(o),k&&m===k&&(j=!j),j)?h.push(m):(o===c&&(p=f.length),l&&g.test(m))?(h.length&&f.push(h.join("")),
h=[],h.push(m)):a(i,m)?b===d?(h.push(m),h.length&&f.push(h.join("")),h=[]):(h.length&&f.push(h.join("")),h=[],h.push(m)):h.push(m);h.length&&f.push(h.join(""));f.length||f.push("");-1===p&&(b===d&&a(i,m)&&f.push(""),p=f.length-1);return{tokens:f,cursorPosition:c,tokenIndex:p}}var d="suffix",g=/\s|\xa0/,f=e("./cursor");return e("./control").extend({syncUI:function(){var a;this.get("alignWithCursor")&&(a=this.get("menu"),a.setInternal("align",null),a.on("beforeVisibleChange",k,this))},getValueForAutocomplete:function(){var b=
i(this),c=b.tokens,e=b.tokenIndex,b=this.get("separator"),f=this.get("separatorType"),c=c[e],e=c.length-1;if(f!==d)if(a(b,c.charAt(0)))c=c.slice(1);else return;else f===d&&a(b,c.charAt(e))&&(c=c.slice(0,e));return c},setValueFromAutocomplete:function(b,c){var e=this.get("input"),f=i(this),h=f.tokens,f=Math.max(0,f.tokenIndex),k=this.get("separator"),j;j=this.get("separatorType");var q=h[f+1]||"",l=h[f];if(j!==d){if(h[f]=l.charAt(0)+b,b&&(!q||!g.test(q.charAt(0))))h[f]+=" "}else h[f]=b,j=l.length-
1,a(k,l.charAt(j))?h[f]+=l.charAt(j):1===k.length&&(h[f]+=k);f=h.slice(0,f+1).join("").length;this.set("value",h.join(""),c);e.prop("selectionStart",f);e.prop("selectionEnd",f)},alignWithCursor:function(){var a=this.get("menu"),c;c=this.get("input");c=f(c);a.move(c.left,c.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:d},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})});
KISSY.add("combobox/filter-select",["./control"],function(j,e,a,k){j=e("./control");k.exports=j.extend({validate:function(a){var d=this;d.callSuper(function(e,f){e?a(e,f):d.get("dataSource").fetchData(f,function(b){a:{if(b=d.normalizeData(b))for(var c=0;c<b.length;c++)if(b[c].textContent===f){b=b[c];break a}b=!1}a(b?"":d.get("invalidMessage"),f,b)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}})});
KISSY.add("combobox/local-data-source",["attribute"],function(j,e){return e("attribute").extend({fetchData:function(a,e,i){var d=this.get("parse"),g=this.get("data"),g=d(a,g);e.call(i,g)}},{ATTRS:{data:{value:[]},parse:{value:function(a,e){var i=[],d=0;if(!a)return e;j.each(e,function(e){-1!==e.indexOf(a)&&i.push(e);d++});return i}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(j,e){var a=e("io");return e("attribute").extend({fetchData:function(e,i,d){var g=this,f,b=g.get("paramName"),c=g.get("parse"),j=g.get("cache"),r=g.get("allowEmpty");g.caches=g.caches||{};g.io&&(g.io.abort(),g.io=null);if(!e&&!0!==r)return i.call(d,[]);if(j&&(f=g.caches[e]))return i.call(d,f);f=g.get("xhrCfg");f.data=f.data||{};f.data[b]=e;f.success=function(a){c&&(a=c(e,a));g.setInternal("data",a);j&&(g.caches[e]=a);i.call(d,a)};
g.io=a(f)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
KISSY.add("combobox",["combobox/control","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"],function(j,e){var a=e("combobox/control"),k=e("combobox/multi-value-combobox"),i=e("combobox/filter-select"),d=e("combobox/local-data-source"),g=e("combobox/remote-data-source");a.LocalDataSource=d;a.RemoteDataSource=g;a.FilterSelect=i;a.MultiValueComboBox=k;return a});
