/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 26 16:51
*/
KISSY.add("combobox/combobox-xtpl",[],function(k,f,j,d){k=function(c,l,b,g,d){var i=this,a=i.nativeCommands,e=i.utils;if("1.50"!==l.version)throw Error("current xtemplate file("+i.name+")(v1.50) need to be recompiled using current kissy(v"+l.version+")!");var f=e.callCommand,l=a["if"];b.write('<div id="ks-combobox-invalid-el-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n     class="');a={escape:1};e=[];e.push("invalid-el");a.params=e;if((a=f(i,c,a,b,"getBaseCssClasses",2))&&a.isBuffer)b=a,a=d;
b.write(a,!0);b.write('">\n    <div class="');a={escape:1};e=[];e.push("invalid-inner");a.params=e;if((a=f(i,c,a,b,"getBaseCssClasses",3))&&a.isBuffer)b=a,a=d;b.write(a,!0);b.write('"></div>\n</div>\n\n');var a={escape:1},e=[],j=c.resolve(["hasTrigger"]);e.push(j);a.params=e;a.fn=function(b,a){a.write('\n<div id="ks-combobox-trigger-');var c=b.resolve(["id"]);a.write(c,!0);a.write('"\n     class="');var c={escape:1},e=[];e.push("trigger");c.params=e;if((c=f(i,b,c,a,"getBaseCssClasses",8))&&c.isBuffer)a=
c,c=d;a.write(c,!0);a.write('">\n    <div class="');c={escape:1};e=[];e.push("trigger-inner");c.params=e;if((c=f(i,b,c,a,"getBaseCssClasses",9))&&c.isBuffer)a=c,c=d;a.write(c,!0);a.write('">&#x25BC;</div>\n</div>\n');return a};b=l.call(i,c,a,b,6,g);b.write('\n\n<div class="');a={escape:1};e=[];e.push("input-wrap");a.params=e;if((a=f(i,c,a,b,"getBaseCssClasses",13))&&a.isBuffer)b=a,a=d;b.write(a,!0);b.write('">\n\n    <input id="ks-combobox-input-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ');
a={escape:1};e=[];j=c.resolve(["disabled"]);e.push(j);a.params=e;a.fn=function(a,b){b.write("\n    disabled\n    ");return b};b=l.call(i,c,a,b,22,g);b.write('\n\n    autocomplete="off"\n    class="');a={escape:1};e=[];e.push("input");a.params=e;if((a=f(i,c,a,b,"getBaseCssClasses",27))&&a.isBuffer)b=a,a=d;b.write(a,!0);b.write('"\n\n    value="');a=c.resolve(["value"]);b.write(a,!0);b.write('"\n    />\n\n\n    <label id="ks-combobox-placeholder-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n           for="ks-combobox-input-');
a=c.resolve(["id"]);b.write(a,!0);b.write("\"\n            style='display:");a={escape:1};e=[];j=c.resolve(["value"]);e.push(j);a.params=e;a.fn=function(a,b){b.write("none");return b};a.inverse=function(b,a){a.write("block");return a};b=l.call(i,c,a,b,35,g);b.write(";'\n    class=\"");g={escape:1};l=[];l.push("placeholder");g.params=l;if((g=f(i,c,g,b,"getBaseCssClasses",36))&&g.isBuffer)b=g,g=d;b.write(g,!0);b.write('">\n    ');c=c.resolve(["placeholder"]);b.write(c,!0);b.write("\n    </label>\n</div>\n");
return b};k.TPL_NAME=d.name;return k});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(k,f){var j=f("component/control"),d=f("./combobox-xtpl");return j.getDefaultRender().extend({beforeCreateDom:function(c,d){k.mix(d,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(c){this.control.get("input").attr("aria-expanded",!c)},
_onSetDisabled:function(c,d){this.callSuper(c,d);this.control.get("input").attr("disabled",c)}},{ATTRS:{contentTpl:{value:d}},HTML_PARSER:{value:function(c){return c.one("."+this.getBaseCssClass("input")).val()},input:function(c){return c.one("."+this.getBaseCssClass("input"))},trigger:function(c){return c.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(c){return c.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(c){return c.one("."+this.getBaseCssClass("placeholder"))}}})});
KISSY.add("combobox/control",["node","component/control","./render","menu"],function(k,f){function j(h){for(var a=0;a<h.length;a++)if(!h[a].get("disabled"))return h[a];return null}function d(){a(this)}function c(){var h=this;setTimeout(function(){e(h)},0)}function l(){this.focus();e(this)}function b(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function g(h){var a;a=this.get("menu");if(!h||a===h.target){var h=this.get("input"),n=a.get("el");a=a.get("contentEl");h.attr("aria-owns",n.attr("id"));
n.on("focusout",d,this);n.on("focusin",c,this);a.on("mouseover",l,this);a.on("mousedown",b,this)}}function o(h){h=h.target;h.isMenuItem&&(h=h.get("textContent"),this.setCurrentValue(h),this._savedValue=h,this.set("collapsed",!0))}function i(h,a){var b=h.$el,c=h.view.getBaseCssClasses("invalid"),e=h.get("invalidEl");a?(b.addClass(c),e.attr("title",a),e.show()):(b.removeClass(c),e.hide())}function a(a){a._focusoutDismissTimer||(a._focusoutDismissTimer=setTimeout(function(){a._focusoutDismissTimer&&
a.set("collapsed",!0)},50))}function e(a){var b=a._focusoutDismissTimer;b&&(clearTimeout(b),a._focusoutDismissTimer=null)}function p(a){this.set("value",a.target.value,{data:{causedByInputEvent:1}})}function q(a){var b,c=[],e,d,c=this.get("menu"),a=this.normalizeData(a);c.removeChildren(!0);(d=c.get("highlightedItem"))&&d.set("highlighted",!1);if(a&&a.length){for(d=0;d<a.length;d++)b=a[d],c.addChild(b);c=c.get("children");a=this.getCurrentValue();if(this.get("highlightMatchItem"))for(d=0;d<c.length;d++)if(c[d].get("textContent")===
a){c[d].set("highlighted",!0);e=!0;break}if(!e&&this.get("autoHighlightFirst"))for(d=0;d<c.length;d++)if(!c[d].get("disabled")){c[d].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",!0)}var r=f("node"),s=f("component/control"),t=f("./render");f("menu");var m=r.KeyCode;return s.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));
b=this.get("format")?this.get("format").call(this,this.getCurrentValue(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=k.mix({content:c,textContent:c,value:c},b[d])}return b},bindUI:function(){this.get("input").on("input",p,this);this.on("click",o,this);var a=this.get("menu");if(a.get("rendered"))g.call(this);else a.on("afterRenderUI",g,this)},destructor:function(){this.get("menu").destroy()},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,
b){var c;b.causedByInputEvent?(c=this.getCurrentValue(),void 0===c?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},handleFocusInternal:function(){var a;this.get("invalidEl")&&i(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(b){var c=this,d=c.get("placeholderEl");c.callSuper(b);a(c);c.get("invalidEl")&&c.validate(function(a,b){a?!c.get("focused")&&b===c.get("value")&&i(c,a):i(c,!1)});d&&!c.get("value")&&d.show()},handleMouseDownInternal:function(a){var c,
b;this.callSuper(a);c=a.target;if((b=this.get("trigger"))&&(b[0]===c||b.contains(c)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(a){var c,b=a.keyCode,d,e,f=this.get("menu");this.get("input");c=this.get("updateInputOnDownUp");if(f.get("visible")){d=f.get("highlightedItem");if(c&&d&&(e=f.get("children"),b===m.DOWN&&d===j(e.concat().reverse())||b===m.UP&&d===j(e)))return this.setCurrentValue(this._savedValue),d.set("highlighted",
!1),!0;e=f.handleKeyDownInternal(a);d=f.get("highlightedItem");if(b===m.ESC)return this.set("collapsed",!0),c&&this.setCurrentValue(this._savedValue),!0;c&&k.inArray(b,[m.DOWN,m.UP])&&this.setCurrentValue(d.get("textContent"));return b===m.TAB&&d&&(d.handleClickInternal(a),this.get("multiple"))?!0:e}if(b===m.DOWN||b===m.UP)if(a=this.getCurrentValue(),void 0!==a)return this.sendRequest(a),!0},validate:function(a){var c=this.get("validator"),b=this.getCurrentValue();c?c(b,function(c){a(c,b)}):a(!1,
b)},sendRequest:function(a){this.get("dataSource").fetchData(a,q,this)},_onSetCollapsed:function(a){var c=this.$el,b=this.get("menu");a?b.hide():(e(this),b.get("visible")||(this.get("matchElWidth")&&(b.render(),a=b.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),b.set("width",c[0].offsetWidth-a)),b.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},
hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};k.mix(a.get("align"),b,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},
xrender:{value:t}},xclass:"combobox"})});KISSY.add("combobox/local-data-source",["attribute"],function(k,f){return f("attribute").extend({fetchData:function(f,d,c){var l=this.get("parse"),b=this.get("data"),b=l(f,b);d.call(c,b)}},{ATTRS:{data:{value:[]},parse:{value:function(f,d){var c=[],l=0;if(!f)return d;k.each(d,function(b){-1!==b.indexOf(f)&&c.push(b);l++});return c}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(k,f){var j=f("io");return f("attribute").extend({fetchData:function(d,c,f){var b=this,g,k=b.get("paramName"),i=b.get("parse"),a=b.get("cache"),e=b.get("allowEmpty");b.caches=b.caches||{};b.io&&(b.io.abort(),b.io=null);if(!d&&!0!==e)return c.call(f,[]);if(a&&(g=b.caches[d]))return c.call(f,g);g=b.get("xhrCfg");g.data=g.data||{};g.data[k]=d;g.success=function(e){i&&(e=i(d,e));b.setInternal("data",e);a&&(b.caches[d]=e);c.call(f,e)};
b.io=j(g)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(k,f){var j=f("combobox/control"),d=f("combobox/local-data-source"),c=f("combobox/remote-data-source");j.LocalDataSource=d;j.RemoteDataSource=c;return j});
