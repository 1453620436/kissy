/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 27 22:19
*/
KISSY.add("combobox/combobox-xtpl",[],function(j,g,m,f){j=function(c,k,b,h,f){var i=this,a=i.nativeCommands,d=i.utils;if("1.50"!==k.version)throw Error("current xtemplate file("+i.name+")(v1.50) need to be recompiled using current kissy(v"+k.version+")!");var l=d.callCommand,k=a["if"];b.write('<div id="ks-combobox-invalid-el-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n     class="');a={escape:1};d=[];d.push("invalid-el");a.params=d;if((a=l(i,c,a,b,"getBaseCssClasses",2))&&a.isBuffer)b=a,a=f;
b.write(a,!0);b.write('">\n    <div class="');a={escape:1};d=[];d.push("invalid-inner");a.params=d;if((a=l(i,c,a,b,"getBaseCssClasses",3))&&a.isBuffer)b=a,a=f;b.write(a,!0);b.write('"></div>\n</div>\n\n');var a={escape:1},d=[],g=c.resolve(["hasTrigger"]);d.push(g);a.params=d;a.fn=function(b,a){a.write('\n<div id="ks-combobox-trigger-');var c=b.resolve(["id"]);a.write(c,!0);a.write('"\n     class="');var c={escape:1},d=[];d.push("trigger");c.params=d;if((c=l(i,b,c,a,"getBaseCssClasses",8))&&c.isBuffer)a=
c,c=f;a.write(c,!0);a.write('">\n    <div class="');c={escape:1};d=[];d.push("trigger-inner");c.params=d;if((c=l(i,b,c,a,"getBaseCssClasses",9))&&c.isBuffer)a=c,c=f;a.write(c,!0);a.write('">&#x25BC;</div>\n</div>\n');return a};b=k.call(i,c,a,b,6,h);b.write('\n\n<div class="');a={escape:1};d=[];d.push("input-wrap");a.params=d;if((a=l(i,c,a,b,"getBaseCssClasses",13))&&a.isBuffer)b=a,a=f;b.write(a,!0);b.write('">\n\n    <input id="ks-combobox-input-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ');
a={escape:1};d=[];g=c.resolve(["disabled"]);d.push(g);a.params=d;a.fn=function(a,b){b.write("\n    disabled\n    ");return b};b=k.call(i,c,a,b,22,h);b.write('\n\n    autocomplete="off"\n    class="');a={escape:1};d=[];d.push("input");a.params=d;if((a=l(i,c,a,b,"getBaseCssClasses",27))&&a.isBuffer)b=a,a=f;b.write(a,!0);b.write('"\n\n    value="');a=c.resolve(["value"]);b.write(a,!0);b.write('"\n    />\n\n\n    <label id="ks-combobox-placeholder-');a=c.resolve(["id"]);b.write(a,!0);b.write('"\n           for="ks-combobox-input-');
a=c.resolve(["id"]);b.write(a,!0);b.write("\"\n            style='display:");a={escape:1};d=[];g=c.resolve(["value"]);d.push(g);a.params=d;a.fn=function(a,b){b.write("none");return b};a.inverse=function(a,b){b.write("block");return b};b=k.call(i,c,a,b,35,h);b.write(";'\n    class=\"");h={escape:1};k=[];k.push("placeholder");h.params=k;if((h=l(i,c,h,b,"getBaseCssClasses",36))&&h.isBuffer)b=h,h=f;b.write(h,!0);b.write('">\n    ');c=c.resolve(["placeholder"]);b.write(c,!0);b.write("\n    </label>\n</div>\n");
return b};j.TPL_NAME=f.name;return j});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(j,g){var m=g("component/control"),f=g("./combobox-xtpl");return m.getDefaultRender().extend({beforeCreateDom:function(c,f){j.mix(f,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(c){this.control.get("input").attr("aria-expanded",!c)},
_onSetDisabled:function(c,f){this.callSuper(c,f);this.control.get("input").attr("disabled",c)}},{ATTRS:{contentTpl:{value:f}},HTML_PARSER:{value:function(c){return c.one("."+this.getBaseCssClass("input")).val()},input:function(c){return c.one("."+this.getBaseCssClass("input"))},trigger:function(c){return c.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(c){return c.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(c){return c.one("."+this.getBaseCssClass("placeholder"))}}})});
KISSY.add("combobox/control",["node","component/control","./render","menu"],function(j,g){function m(e){for(var b=0;b<e.length;b++)if(!e[b].get("disabled"))return e[b];return null}function f(){d(this)}function c(){var e=this;setTimeout(function(){l(e)},0)}function k(){this.focus();l(this)}function b(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function h(e){var a;a=this.get("menu");if(!e||a===e.target){var e=this.get("input"),o=a.get("el");a=a.get("contentEl");e.attr("aria-owns",o.attr("id"));
o.on("focusout",f,this);o.on("focusin",c,this);a.on("mouseover",k,this);a.on("mousedown",b,this);if(this.get("matchElWidth"))o.getWindow().on("resize",p,this)}}function p(){var e=this.get("menu");if(e.get("visible")){var a=this.get("el"),b=e.get("el"),b=(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("borderRightWidth"),10)||0);e.set("width",a[0].offsetWidth-b)}}function i(e){e=e.target;e.isMenuItem&&(e=e.get("textContent"),this.setCurrentValue(e),this._savedValue=e,this.set("collapsed",
!0))}function a(e,b){var a=e.$el,c=e.view.getBaseCssClasses("invalid"),d=e.get("invalidEl");b?(a.addClass(c),d.attr("title",b),d.show()):(a.removeClass(c),d.hide())}function d(e){e._focusoutDismissTimer||(e._focusoutDismissTimer=setTimeout(function(){e._focusoutDismissTimer&&e.set("collapsed",!0)},50))}function l(e){var b=e._focusoutDismissTimer;b&&(clearTimeout(b),e._focusoutDismissTimer=null)}function q(e){this.set("value",e.target.value,{data:{causedByInputEvent:1}})}function r(e){var b,a=[],c,
d,a=this.get("menu"),e=this.normalizeData(e);a.removeChildren(!0);(d=a.get("highlightedItem"))&&d.set("highlighted",!1);if(e&&e.length){for(d=0;d<e.length;d++)b=e[d],a.addChild(b);a=a.get("children");e=this.getCurrentValue();if(this.get("highlightMatchItem"))for(d=0;d<a.length;d++)if(a[d].get("textContent")===e){a[d].set("highlighted",!0);c=!0;break}if(!c&&this.get("autoHighlightFirst"))for(d=0;d<a.length;d++)if(!a[d].get("disabled")){a[d].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var s=g("node"),t=g("component/control"),u=g("./render");g("menu");var n=s.KeyCode;return t.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getCurrentValue(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=j.mix({content:c,textContent:c,value:c},b[d])}return b},bindUI:function(){this.get("input").on("input",q,
this);this.on("click",i,this);var a=this.get("menu");if(a.get("rendered"))h.call(this);else a.on("afterRenderUI",h,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",p,this)},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c;b.causedByInputEvent?(c=this.getCurrentValue(),void 0===c?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},
handleFocusInternal:function(){var b;l(this);this.get("invalidEl")&&a(this,!1);(b=this.get("placeholderEl"))&&b.hide()},handleBlurInternal:function(b){var c=this,f=c.get("placeholderEl");c.callSuper(b);d(c);c.get("invalidEl")&&c.validate(function(b,e){b?!c.get("focused")&&e===c.get("value")&&a(c,b):a(c,!1)});f&&!c.get("value")&&f.show()},handleMouseDownInternal:function(a){var b,c;this.callSuper(a);b=a.target;if((c=this.get("trigger"))&&(c[0]===b||c.contains(b)))this.get("collapsed")?(this.focus(),
this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(a){var b,c=a.keyCode,d,f,g=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(g.get("visible")){d=g.get("highlightedItem");if(b&&d&&(f=g.get("children"),c===n.DOWN&&d===m(f.concat().reverse())||c===n.UP&&d===m(f)))return this.setCurrentValue(this._savedValue),d.set("highlighted",!1),!0;f=g.handleKeyDownInternal(a);d=g.get("highlightedItem");if(c===n.ESC)return this.set("collapsed",
!0),b&&this.setCurrentValue(this._savedValue),!0;b&&j.inArray(c,[n.DOWN,n.UP])&&this.setCurrentValue(d.get("textContent"));return c===n.TAB&&d&&(d.handleClickInternal(a),this.get("multiple"))?!0:f}if(c===n.DOWN||c===n.UP)if(a=this.getCurrentValue(),void 0!==a)return this.sendRequest(a),!0},validate:function(a){var b=this.get("validator"),c=this.getCurrentValue();b?b(c,function(b){a(b,c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,r,this)},_onSetCollapsed:function(a){var b=
this.$el,c=this.get("menu");a?c.hide():(l(this),c.get("visible")||(this.get("matchElWidth")&&(c.render(),a=c.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),c.set("width",b[0].offsetWidth-a)),c.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||
"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};j.mix(a.get("align"),b,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},xrender:{value:u}},xclass:"combobox"})});
KISSY.add("combobox/local-data-source",["attribute"],function(j,g){return g("attribute").extend({fetchData:function(g,f,c){var k=this.get("parse"),b=this.get("data"),b=k(g,b);f.call(c,b)}},{ATTRS:{data:{value:[]},parse:{value:function(g,f){var c=[],k=0;if(!g)return f;j.each(f,function(b){-1!==b.indexOf(g)&&c.push(b);k++});return c}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(j,g){var m=g("io");return g("attribute").extend({fetchData:function(f,c,g){var b=this,h,j=b.get("paramName"),i=b.get("parse"),a=b.get("cache"),d=b.get("allowEmpty");b.caches=b.caches||{};b.io&&(b.io.abort(),b.io=null);if(!f&&!0!==d)return c.call(g,[]);if(a&&(h=b.caches[f]))return c.call(g,h);h=b.get("xhrCfg");h.data=h.data||{};h.data[j]=f;h.success=function(d){i&&(d=i(f,d));b.setInternal("data",d);a&&(b.caches[f]=d);c.call(g,d)};
b.io=m(h)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(j,g){var m=g("combobox/control"),f=g("combobox/local-data-source"),c=g("combobox/remote-data-source");m.LocalDataSource=f;m.RemoteDataSource=c;return m});
