/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 24 02:46
*/
KISSY.add("combobox/combobox-xtpl",[],function(j,f,k,l){j=function(e,i,b,d,h){var g=this,a=g.nativeCommands,c=g.utils;if("1.50"!==i.version)throw Error("current xtemplate file("+g.name+")(v1.50) need to be recompiled using current kissy(v"+i.version+")!");var o=c.callCommand,i=a["if"];b.write('<div id="ks-combobox-invalid-el-');a=e.resolve(["id"]);b.write(a,!0);b.write('"\n     class="');a={escape:1};c=[];c.push("invalid-el");a.params=c;if((a=o(g,e,a,b,"getBaseCssClasses",2))&&a.isBuffer)b=a,a=h;
b.write(a,!0);b.write('">\n    <div class="');a={escape:1};c=[];c.push("invalid-inner");a.params=c;if((a=o(g,e,a,b,"getBaseCssClasses",3))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('"></div>\n</div>\n\n');var a={escape:1},c=[],k=e.resolve(["hasTrigger"]);c.push(k);a.params=c;a.fn=function(a,b){b.write('\n<div id="ks-combobox-trigger-');var c=a.resolve(["id"]);b.write(c,!0);b.write('"\n     class="');var c={escape:1},d=[];d.push("trigger");c.params=d;if((c=o(g,a,c,b,"getBaseCssClasses",8))&&c.isBuffer)b=
c,c=h;b.write(c,!0);b.write('">\n    <div class="');c={escape:1};d=[];d.push("trigger-inner");c.params=d;if((c=o(g,a,c,b,"getBaseCssClasses",9))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">&#x25BC;</div>\n</div>\n');return b};b=i.call(g,e,a,b,6,d);b.write('\n\n<div class="');a={escape:1};c=[];c.push("input-wrap");a.params=c;if((a=o(g,e,a,b,"getBaseCssClasses",13))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('">\n\n    <input id="ks-combobox-input-');a=e.resolve(["id"]);b.write(a,!0);b.write('"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ');
a={escape:1};c=[];k=e.resolve(["disabled"]);c.push(k);a.params=c;a.fn=function(b,a){a.write("\n    disabled\n    ");return a};b=i.call(g,e,a,b,22,d);b.write('\n\n    autocomplete="off"\n    class="');a={escape:1};c=[];c.push("input");a.params=c;if((a=o(g,e,a,b,"getBaseCssClasses",27))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('"\n\n    value="');a=e.resolve(["value"]);b.write(a,!0);b.write('"\n    />\n\n\n    <label id="ks-combobox-placeholder-');a=e.resolve(["id"]);b.write(a,!0);b.write('"\n           for="ks-combobox-input-');
a=e.resolve(["id"]);b.write(a,!0);b.write("\"\n            style='display:");a={escape:1};c=[];k=e.resolve(["value"]);c.push(k);a.params=c;a.fn=function(a,b){b.write("none");return b};a.inverse=function(b,a){a.write("block");return a};b=i.call(g,e,a,b,35,d);b.write(";'\n    class=\"");d={escape:1};i=[];i.push("placeholder");d.params=i;if((d=o(g,e,d,b,"getBaseCssClasses",36))&&d.isBuffer)b=d,d=h;b.write(d,!0);b.write('">\n    ');e=e.resolve(["placeholder"]);b.write(e,!0);b.write("\n    </label>\n</div>\n");
return b};j.TPL_NAME=l.name;return j});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(j,f){var k=f("component/control"),l=f("./combobox-xtpl");return k.getDefaultRender().extend({beforeCreateDom:function(e,i){j.mix(i,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(e){this.control.get("input").attr("aria-expanded",!e)},
_onSetDisabled:function(e,i){this.callSuper(e,i);this.control.get("input").attr("disabled",e)}},{ATTRS:{contentTpl:{value:l}},HTML_PARSER:{value:function(e){return e.one("."+this.getBaseCssClass("input")).val()},input:function(e){return e.one("."+this.getBaseCssClass("input"))},trigger:function(e){return e.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(e){return e.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(e){return e.one("."+this.getBaseCssClass("placeholder"))}}})});
KISSY.add("combobox/control",["node","component/control","./render","menu"],function(j,f){function k(m){for(var a=0;a<m.length;a++)if(!m[a].get("disabled"))return m[a];return null}function l(){a(this)}function e(){var m=this;setTimeout(function(){c(m)},0)}function i(){this.focus();c(this)}function b(){this.setValueFromAutocomplete(this.getValueForAutocomplete(),{force:1})}function d(m){var a;a=this.get("menu");if(!m||a===m.target){var m=this.get("input"),c=a.get("el");a=a.get("contentEl");m.attr("aria-owns",
c.attr("id"));c.on("focusout",l,this);c.on("focusin",e,this);a.on("mouseover",i,this);a.on("mousedown",b,this)}}function h(a){a=a.target;a.isMenuItem&&(a=a.get("textContent"),this.setValueFromAutocomplete(a),this._savedValue=a,this.set("collapsed",!0))}function g(a,b){var c=a.$el,h=a.view.getBaseCssClasses("invalid"),d=a.get("invalidEl");b?(c.addClass(h),d.attr("title",b),d.show()):(c.removeClass(h),d.hide())}function a(a){a._focusoutDismissTimer||(a._focusoutDismissTimer=setTimeout(function(){a._focusoutDismissTimer&&
a.set("collapsed",!0)},50))}function c(a){var b=a._focusoutDismissTimer;b&&(clearTimeout(b),a._focusoutDismissTimer=null)}function o(a){this.set("value",a.target.value,{data:{causedByInputEvent:1}})}function s(a){var b,c=[],h,d,c=this.get("menu"),a=this.normalizeData(a);c.removeChildren(!0);(d=c.get("highlightedItem"))&&d.set("highlighted",!1);if(a&&a.length){for(d=0;d<a.length;d++)b=a[d],c.addChild(b);c=c.get("children");a=this.getValueForAutocomplete();if(this.get("highlightMatchItem"))for(d=0;d<
c.length;d++)if(c[d].get("textContent")===a){c[d].set("highlighted",!0);h=!0;break}if(!h&&this.get("autoHighlightFirst"))for(d=0;d<c.length;d++)if(!c[d].get("disabled")){c[d].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",!0)}var t=f("node"),q=f("component/control"),p=f("./render");f("menu");var n=t.KeyCode;return q.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,
c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getValueForAutocomplete(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=j.mix({content:c,textContent:c,value:c},b[d])}return b},bindUI:function(){this.get("input").on("input",o,this);this.on("click",h,this);var a=this.get("menu");if(a.get("rendered"))d.call(this);else a.on("afterRenderUI",d,this)},destructor:function(){this.get("menu").destroy()},getValueForAutocomplete:function(){return this.get("value")},
setValueFromAutocomplete:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c;b.causedByInputEvent?(c=this.getValueForAutocomplete(),void 0===c?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},handleFocusInternal:function(){var a;this.get("invalidEl")&&g(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(b){var c=this,d=c.get("placeholderEl");c.callSuper(b);a(c);c.get("invalidEl")&&c.validate(function(a,b){a?!c.get("focused")&&
b===c.get("value")&&g(c,a):g(c,!1)});d&&!c.get("value")&&d.show()},handleMouseDownInternal:function(a){var c,b;this.callSuper(a);c=a.target;if((b=this.get("trigger"))&&(b[0]===c||b.contains(c)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(a){var c,b=a.keyCode,d,h,g=this.get("menu");this.get("input");c=this.get("updateInputOnDownUp");if(g.get("visible")){d=g.get("highlightedItem");if(c&&d&&(h=g.get("children"),
b===n.DOWN&&d===k(h.concat().reverse())||b===n.UP&&d===k(h)))return this.setValueFromAutocomplete(this._savedValue),d.set("highlighted",!1),!0;h=g.handleKeyDownInternal(a);d=g.get("highlightedItem");if(b===n.ESC)return this.set("collapsed",!0),c&&this.setValueFromAutocomplete(this._savedValue),!0;c&&j.inArray(b,[n.DOWN,n.UP])&&this.setValueFromAutocomplete(d.get("textContent"));return b===n.TAB&&d&&(d.handleClickInternal(a),this.get("multiple"))?!0:h}if(b===n.DOWN||b===n.UP)if(a=this.getValueForAutocomplete(),
void 0!==a)return this.sendRequest(a),!0},validate:function(a){var c=this.get("validator"),b=this.getValueForAutocomplete();c?c(b,function(c){a(c,b)}):a(!1,b)},sendRequest:function(a){this.get("dataSource").fetchData(a,s,this)},_onSetCollapsed:function(a){var b=this.$el,d=this.get("menu");a?d.hide():(c(this),d.get("visible")||(this.get("matchElWidth")&&(d.render(),a=d.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),d.set("width",b[0].offsetWidth-
a)),d.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var c={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};j.mix(a.get("align"),c,
!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},xrender:{value:p}},xclass:"combobox"})});
KISSY.add("combobox/cursor",["node"],function(j,f){function k(d){var h=i;h||(h=l(e));"textarea"===""+d[0].type.toLowerCase()?h.css("width",d.css("width")):h.css("width",9999);j.each(b,function(b){h.css(b,d.css(b))});i||h.insertBefore(d[0].ownerDocument.body.firstChild);return i=h}var l=f("node").all,e='<div style="z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;"></div>',i,b="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(b){var h=l(b),b=h[0],g=b.ownerDocument,a=l(g),c=b.scrollTop,e=b.scrollLeft;if(g.selection)return b=g.selection.createRange(),{left:b.boundingLeft+e+a.scrollLeft(),top:b.boundingTop+c+b.boundingHeight+a.scrollTop()};a=h.offset();if("textarea"!==b.type)return a.top+=b.offsetHeight,a;g=k(h);h=b.selectionStart;g.html(j.escapeHtml(b.value.substring(0,h-1))+"<span>x</span>");g.offset(a);a=g.last();b=a.offset();b.top+=a.height();0<h&&(b.left+=a.width());b.top-=c;b.left-=e;return b}});
KISSY.add("combobox/multi-value-combobox",["./cursor","./control"],function(j,f){function k(b,d){return d&&-1!==b.indexOf(d)}function l(b){b.newVal&&b.target===this.get("menu")&&this.alignWithCursor()}function e(d){var g=d.get("input"),a=d.get("value"),c=[],e=[],f=d.get("literal"),l=d.get("separator"),d=d.get("separatorType"),j=!1,p=d!==i,g=g.prop("selectionStart"),n,m,r=-1;for(n=0;n<a.length;n++)(m=a.charAt(n),f&&m===f&&(j=!j),j)?e.push(m):(n===g&&(r=c.length),p&&b.test(m))?(e.length&&c.push(e.join("")),
e=[],e.push(m)):k(l,m)?d===i?(e.push(m),e.length&&c.push(e.join("")),e=[]):(e.length&&c.push(e.join("")),e=[],e.push(m)):e.push(m);e.length&&c.push(e.join(""));c.length||c.push("");-1===r&&(d===i&&k(l,m)&&c.push(""),r=c.length-1);return{tokens:c,cursorPosition:g,tokenIndex:r}}var i="suffix",b=/\s|\xa0/,d=f("./cursor");return f("./control").extend({syncUI:function(){var b;this.get("alignWithCursor")&&(b=this.get("menu"),b.setInternal("align",null),b.on("beforeVisibleChange",l,this))},getValueForAutocomplete:function(){var b=
e(this),d=b.tokens,a=b.tokenIndex,b=this.get("separator"),c=this.get("separatorType"),d=d[a],a=d.length-1;if(c!==i)if(k(b,d.charAt(0)))d=d.slice(1);else return;else c===i&&k(b,d.charAt(a))&&(d=d.slice(0,a));return d},setValueFromAutocomplete:function(d,g){var a=this.get("input"),c=e(this),f=c.tokens,c=Math.max(0,c.tokenIndex),l=this.get("separator"),j;j=this.get("separatorType");var q=f[c+1]||"",p=f[c];if(j!==i){if(f[c]=p.charAt(0)+d,d&&(!q||!b.test(q.charAt(0))))f[c]+=" "}else f[c]=d,j=p.length-
1,k(l,p.charAt(j))?f[c]+=p.charAt(j):1===l.length&&(f[c]+=l);c=f.slice(0,c+1).join("").length;this.set("value",f.join(""),g);a.prop("selectionStart",c);a.prop("selectionEnd",c)},alignWithCursor:function(){var b=this.get("menu"),e;e=this.get("input");e=d(e);b.move(e.left,e.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:i},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})});
KISSY.add("combobox/filter-select",["./control"],function(j,f,k,l){j=f("./control");l.exports=j.extend({validate:function(e){var f=this;f.callSuper(function(b,d){b?e(b,d):f.get("dataSource").fetchData(d,function(b){a:{if(b=f.normalizeData(b))for(var g=0;g<b.length;g++)if(b[g].textContent===d){b=b[g];break a}b=!1}e(b?"":f.get("invalidMessage"),d,b)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}})});
KISSY.add("combobox/local-data-source",["attribute"],function(j,f){return f("attribute").extend({fetchData:function(f,l,e){var i=this.get("parse"),b=this.get("data"),b=i(f,b);l.call(e,b)}},{ATTRS:{data:{value:[]},parse:{value:function(f,l){var e=[],i=0;if(!f)return l;j.each(l,function(b){-1!==b.indexOf(f)&&e.push(b);i++});return e}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(j,f){var k=f("io");return f("attribute").extend({fetchData:function(f,e,i){var b=this,d,h=b.get("paramName"),g=b.get("parse"),a=b.get("cache"),c=b.get("allowEmpty");b.caches=b.caches||{};b.io&&(b.io.abort(),b.io=null);if(!f&&!0!==c)return e.call(i,[]);if(a&&(d=b.caches[f]))return e.call(i,d);d=b.get("xhrCfg");d.data=d.data||{};d.data[h]=f;d.success=function(c){g&&(c=g(f,c));b.setInternal("data",c);a&&(b.caches[f]=c);e.call(i,c)};
b.io=k(d)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
KISSY.add("combobox",["combobox/control","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"],function(j,f){var k=f("combobox/control"),l=f("combobox/multi-value-combobox"),e=f("combobox/filter-select"),i=f("combobox/local-data-source"),b=f("combobox/remote-data-source");k.LocalDataSource=i;k.RemoteDataSource=b;k.FilterSelect=e;k.MultiValueComboBox=l;return k});
