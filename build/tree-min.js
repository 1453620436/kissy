/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 31 19:32
*/
KISSY.add("tree/node-xtpl",["component/extension/content-xtpl"],function(i,h,f,k){i=function(c,a,b,o,l){var e=this,g,f=e.nativeCommands,d=e.utils;if("1.50"!==a.version)throw Error("current xtemplate file("+e.name+")(v1.50) need to be recompiled using current kissy(v"+a.version+")!");"undefined"!==typeof k&&k.kissy&&(g=k);var i=d.callCommand,a=f["if"],f=f.include;b.write('<div id="ks-tree-node-row-');d=c.resolve(["id"]);b.write(d,!0);b.write('"\n     class="');var d={escape:1},j=[];j.push("row");d.params=
j;if((d=i(e,c,d,b,"getBaseCssClasses",2))&&d.isBuffer)b=d,d=l;b.write(d,!0);b.write("\n     ");var d={escape:1},j=[],m=c.resolve(["selected"]);j.push(m);d.params=j;d.fn=function(n,a){a.write("\n        ");var b={escape:1},d=[];d.push("selected");b.params=d;if((b=i(e,n,b,a,"getBaseCssClasses",4))&&b.isBuffer)a=b,b=l;a.write(b,!0);a.write("\n     ");return a};b=a.call(e,c,d,b,3,o);b.write('\n     ">\n    <div id="ks-tree-node-expand-icon-');d=c.resolve(["id"]);b.write(d,!0);b.write('"\n         class="');
d={escape:1};j=[];j.push("expand-icon");d.params=j;if((d=i(e,c,d,b,"getBaseCssClasses",8))&&d.isBuffer)b=d,d=l;b.write(d,!0);b.write('">\n    </div>\n    ');d={escape:1};j=[];m=c.resolve(["checkable"]);j.push(m);d.params=j;d.fn=function(n,a){a.write('\n    <div id="ks-tree-node-checked-');var b=n.resolve(["id"]);a.write(b,!0);a.write('"\n         class="');var b={escape:1},d=[],c="checked",c="checked"+n.resolve(["checkState"]);d.push(c);b.params=d;if((b=i(e,n,b,a,"getBaseCssClasses",12))&&b.isBuffer)a=
b,b=l;a.write(b,!0);a.write('"></div>\n    ');return a};b=a.call(e,c,d,b,10,o);b.write('\n    <div id="ks-tree-node-icon-');d=c.resolve(["id"]);b.write(d,!0);b.write('"\n         class="');d={escape:1};j=[];j.push("icon");d.params=j;if((d=i(e,c,d,b,"getBaseCssClasses",15))&&d.isBuffer)b=d,d=l;b.write(d,!0);b.write('">\n\n    </div>\n    ');d={};j=[];j.push("component/extension/content-xtpl");d.params=j;g&&(h("component/extension/content-xtpl"),d.params[0]=g.resolve(d.params[0]));if((g=f.call(e,c,
d,b,18,o))&&g.isBuffer)b=g,g=l;b.write(g,!1);b.write('\n</div>\n<div id="ks-tree-node-children-');g=c.resolve(["id"]);b.write(g,!0);b.write('"\n     class="');g={escape:1};f=[];f.push("children");g.params=f;if((g=i(e,c,g,b,"getBaseCssClasses",21))&&g.isBuffer)b=g,g=l;b.write(g,!0);b.write('"\n');g={escape:1};f=[];d=c.resolve(["expanded"]);f.push(!d);g.params=f;g.fn=function(a,b){b.write('\nstyle="display:none"\n');return b};b=a.call(e,c,g,b,22,o);b.write("\n>\n</div>");return b};i.TPL_NAME=k.name;
return i});
KISSY.add("tree/node-render",["component/container","./node-xtpl","component/extension/content-render"],function(i,h){var f=h("component/container"),k=h("./node-xtpl"),c=h("component/extension/content-render");return f.getDefaultRender().extend([c],{beforeCreateDom:function(a,b){i.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});i.mix(b,{expandIconEl:"#ks-tree-node-expand-icon-{id}",rowEl:"#ks-tree-node-row-{id}",
iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",checkIconEl:"#ks-tree-node-checked-{id}"})},refreshCss:function(a,b){var c=this.control,f=c.get("iconEl"),e,g=c.get("expandIconEl"),h=c.get("childrenEl");b?(c="file-icon",e="expand-icon-{t}"):c.get("expanded")?(c="expanded-folder-icon",e="expand-icon-{t}minus"):(c="collapsed-folder-icon",e="expand-icon-{t}plus");f[0].className=this.getBaseCssClasses(c);g[0].className=this.getBaseCssClasses(i.substitute(e,{t:a?"l":"t"}));h[0].className=
this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.control.get("childrenEl")[a?"show":"hide"]();this.el.setAttribute("aria-expanded",a)},_onSetSelected:function(a){this.control.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a)},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},_onSetCheckState:function(a){a=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.control.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(a)},
getChildrenContainerEl:function(){return this.control.get("childrenEl")}},{ATTRS:{contentTpl:{value:k}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},expanded:function(a){return"none"!==a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+
this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=a.one("."+this.getBaseCssClass("checked")))for(var b="checked0 checked1 checked2".split(/\s+/),c=0;c<b.length;c++)if(a.hasClass(this.getBaseCssClass(b[c])))return c;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})});
KISSY.add("tree/node",["node","component/container","./node-render"],function(i,h){function f(a){if(a.target===this){var b=a.component,c=this.get("depth"),a=a.index,d=this.get("tree");d&&(e(d,b,c+1),g(this,a))}}function k(a){a.target===this&&(e(this.get("tree"),a.component),g(this,a.index))}function c(a){a.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(a){var b=a.get("parent"),b=(b=b&&b.get("children"))&&b[b.length-1];return!b||b===a}function b(a){var b=
a.get("isLeaf");return!(!1===b||void 0===b&&a.get("children").length)}function o(a){var b=a.get("children");return!a.get("expanded")||!b.length?a:o(b[b.length-1])}function l(n){n.get&&n.view&&n.view.refreshCss(a(n),b(n))}function e(a,b,c){void 0!==c&&b.set("depth",c);i.each(b.get("children"),function(b){"number"===typeof c?e(a,b,c+1):e(a,b)})}function g(a,b){l(a);for(var b=Math.max(0,b-1),c=a.get("children"),d,e=c.length;b<e;b++)d=c[b],l(d),d.el.setAttribute("aria-posinset",b+1)}var p=h("node"),d=
h("component/container"),q=h("./node-render"),j=p.all,m=p.KeyCode;return d.extend({bindUI:function(){this.on("afterAddChild",f);this.on("afterRemoveChild",k);this.on("afterAddChild afterRemoveChild",c)},syncUI:function(){l(this);c.call(this,{target:this})},handleKeyDownInternal:function(a){var b=!0,c=this.get("tree"),d=this.get("expanded"),e,f=this.get("isLeaf"),g=this.get("children");switch(a.keyCode){case m.ENTER:return this.handleClickInternal(a);case m.HOME:e=c;break;case m.END:e=o(c);break;case m.UP:e=
a=(a=this.prev())?o(a):this.get("parent");break;case m.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)e=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();e=a}break;case m.LEFT:d&&(g.length||!1===f)?this.set("expanded",!1):e=this.get("parent");break;case m.RIGHT:if(g.length||!1===f)d?e=g[0]:this.set("expanded",!0);break;default:b=!1}e&&e.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=i.indexOf(this,a);return b===
a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=i.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){a.stopPropagation();var b=j(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);
if(this===this.get("tree")){var a=this.get("tree");a&&(e(a,this,0),g(this,0))}},_onSetExpanded:function(a){l(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);i.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);i.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:q},
checkable:{value:!1,view:1},handleGestureEvents:{value:!1},isLeaf:{view:1},expandIconEl:{},iconEl:{},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})});
KISSY.add("tree/tree-manager",["node","component/extension/delegate-children","ua"],function(i,h){function f(){}var k=h("node"),c=h("component/extension/delegate-children"),a=h("ua").ieMode,b=k.Gesture,o=i.Feature.isTouchEventSupported();f.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};i.augment(f,c,{isTree:1,__bindUI:function(){var c=this.get("prefixCls")+"tree-node",e=b.tap;o||(e+=a&&9>a?" dblclick ":"");this.$el.delegate(e,"."+c,this.handleChildrenEvents,
this)},_onSetSelectedItem:function(a,b){a&&b.prevVal&&b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return f});
KISSY.add("tree/control",["./node","./tree-manager"],function(i,h){var f=h("./node"),k=h("./tree-manager");return f.extend([k],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c){this.callSuper(c);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})});
KISSY.add("tree/check-node",["node","./node"],function(i,h){var f=h("node"),k=h("./node"),c=f.all,f=k.extend({handleClickInternal:function(a){var b=this.get("expanded"),f=this.get("expandIconEl"),h=this.get("tree"),e=c(a.target);h.focus();this.callSuper(a);if(e.equals(f))this.set("expanded",!b);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),this.fire("click"),!0},_onSetCheckState:function(a){var b=this.get("parent"),c,f,e,g;(1===a||0===a)&&i.each(this.get("children"),function(b){b.set("checkState",
a)});if(b){c=0;g=b.get("children");for(f=0;f<g.length;f++){e=g[f];e=e.get("checkState");if(2===e){b.set("checkState",2);return}1===e&&c++}0===c?b.set("checkState",0):c===g.length?b.set("checkState",1):b.set("checkState",2)}}},{ATTRS:{checkIconEl:{},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});f.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return f});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(i,h){var f=h("./check-node"),k=h("./tree-manager");return f.extend([k],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c,a){this.callSuper(c,a);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})});
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(i,h){var f=h("tree/control"),k=h("tree/node"),c=h("tree/check-node"),a=h("tree/check-tree");f.Node=k;f.CheckNode=c;f.CheckTree=a;return f});
