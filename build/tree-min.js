/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Apr 4 12:26
*/
KISSY.add("tree/node-xtpl",["component/extension/content-xtpl"],function(l,g,f,m){f=function(d,a,f,i){var h=this,c=h.nativeCommands,n=h.utils;if("1.50"!==l.version)throw Error("current xtemplate file("+h.name+")(v1.50) need to be recompiled using current kissy(v"+l.version+")!");var o=n.callCommand,n=c["if"],c=c.include;a.write('<div id="ks-tree-node-row-');var b=d.resolve(["id"]);a.write(b,!0);a.write('"\n     class="');var b={escape:1},k=[];k.push("row");b.params=k;if((b=o(h,d,b,a,"getBaseCssClasses",
2))&&b.isBuffer)a=b,b=i;a.write(b,!0);a.write("\n     ");var b={escape:1},k=[],q=d.resolve(["selected"]);k.push(q);b.params=k;b.fn=function(a,j){j.write("\n        ");var e={escape:1},b=[];b.push("selected");e.params=b;if((e=o(h,a,e,j,"getBaseCssClasses",4))&&e.isBuffer)j=e,e=i;j.write(e,!0);j.write("\n     ");return j};a=n.call(h,d,b,a,3,f);a.write('\n     ">\n    <div id="ks-tree-node-expand-icon-');b=d.resolve(["id"]);a.write(b,!0);a.write('"\n         class="');b={escape:1};k=[];k.push("expand-icon");
b.params=k;if((b=o(h,d,b,a,"getBaseCssClasses",8))&&b.isBuffer)a=b,b=i;a.write(b,!0);a.write('">\n    </div>\n    ');b={escape:1};k=[];q=d.resolve(["checkable"]);k.push(q);b.params=k;b.fn=function(a,j){j.write('\n    <div id="ks-tree-node-checked-');var e=a.resolve(["id"]);j.write(e,!0);j.write('"\n         class="');var e={escape:1},b=[],c="checked",c="checked"+a.resolve(["checkState"]);b.push(c);e.params=b;if((e=o(h,a,e,j,"getBaseCssClasses",12))&&e.isBuffer)j=e,e=i;j.write(e,!0);j.write('"></div>\n    ');
return j};a=n.call(h,d,b,a,10,f);a.write('\n    <div id="ks-tree-node-icon-');b=d.resolve(["id"]);a.write(b,!0);a.write('"\n         class="');b={escape:1};k=[];k.push("icon");b.params=k;if((b=o(h,d,b,a,"getBaseCssClasses",15))&&b.isBuffer)a=b,b=i;a.write(b,!0);a.write('">\n\n    </div>\n    ');b={};k=[];k.push("component/extension/content-xtpl");b.params=k;g("component/extension/content-xtpl");b.params[0]=m.resolve(b.params[0]);if((c=c.call(h,d,b,a,18,f))&&c.isBuffer)a=c,c=i;a.write(c,!1);a.write('\n</div>\n<div id="ks-tree-node-children-');
c=d.resolve(["id"]);a.write(c,!0);a.write('"\n     class="');c={escape:1};b=[];b.push("children");c.params=b;if((c=o(h,d,c,a,"getBaseCssClasses",21))&&c.isBuffer)a=c,c=i;a.write(c,!0);a.write('"\n');c={escape:1};b=[];k=d.resolve(["expanded"]);b.push(!k);c.params=b;c.fn=function(a,j){j.write('\nstyle="display:none"\n');return j};a=n.call(h,d,c,a,22,f);a.write("\n>\n</div>");return a};f.TPL_NAME=m.name;return f});
KISSY.add("tree/node-render",["component/container","./node-xtpl","component/extension/content-render"],function(l,g){var f=g("component/container"),m=g("./node-xtpl"),d=g("component/extension/content-render");return f.getDefaultRender().extend([d],{beforeCreateDom:function(a,d){l.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});l.mix(d,{expandIconEl:"#ks-tree-node-expand-icon-{id}",
rowEl:"#ks-tree-node-row-{id}",iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",checkIconEl:"#ks-tree-node-checked-{id}"})},refreshCss:function(a,d){var i=this.control,h=i.get("iconEl"),c,f=i.get("expandIconEl"),g=i.get("childrenEl");d?(i="file-icon",c="expand-icon-{t}"):i.get("expanded")?(i="expanded-folder-icon",c="expand-icon-{t}minus"):(i="collapsed-folder-icon",c="expand-icon-{t}plus");h[0].className=this.getBaseCssClasses(i);f[0].className=this.getBaseCssClasses(l.substitute(c,
{t:a?"l":"t"}));g[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.control.get("childrenEl")[a?"show":"hide"]();this.el.setAttribute("aria-expanded",a)},_onSetSelected:function(a){this.control.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a)},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},_onSetCheckState:function(a){a=this.getBaseCssClasses("checked").split(/\s+/).join(a+
" ")+a;this.control.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(a)},getChildrenContainerEl:function(){return this.control.get("childrenEl")}},{ATTRS:{contentTpl:{value:m}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},
expanded:function(a){return"none"!==a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=a.one("."+this.getBaseCssClass("checked")))for(var d="checked0 checked1 checked2".split(/\s+/),i=0;i<d.length;i++)if(a.hasClass(this.getBaseCssClass(d[i])))return i;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})});
KISSY.add("tree/node",["node","component/container","./node-render"],function(l,g){function f(a){if(a.target===this){var e=a.component,b=this.get("depth"),a=a.index,d=this.get("tree");d&&(c(d,e,b+1),n(this,a))}}function m(a){a.target===this&&(c(this.get("tree"),a.component),n(this,a.index))}function d(a){a.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(a){var e=a.get("parent"),e=(e=e&&e.get("children"))&&e[e.length-1];return!e||e===a}function r(a){var e=
a.get("isLeaf");return!(!1===e||void 0===e&&a.get("children").length)}function i(a){var e=a.get("children");return!a.get("expanded")||!e.length?a:i(e[e.length-1])}function h(j){j.get&&j.view&&j.view.refreshCss(a(j),r(j))}function c(a,e,b){void 0!==b&&e.set("depth",b);l.each(e.get("children"),function(e){"number"===typeof b?c(a,e,b+1):c(a,e)})}function n(a,e){h(a);for(var e=Math.max(0,e-1),b=a.get("children"),c,d=b.length;e<d;e++)c=b[e],h(c),c.el.setAttribute("aria-posinset",e+1)}var o=g("node"),b=
g("component/container"),k=g("./node-render"),q=o.all,p=o.KeyCode;return b.extend({bindUI:function(){this.on("afterAddChild",f);this.on("afterRemoveChild",m);this.on("afterAddChild afterRemoveChild",d)},syncUI:function(){h(this);d.call(this,{target:this})},handleKeyDownInternal:function(a){var b=!0,c=this.get("tree"),d=this.get("expanded"),h,f=this.get("isLeaf"),g=this.get("children");switch(a.keyCode){case p.ENTER:return this.handleClickInternal(a);case p.HOME:h=c;break;case p.END:h=i(c);break;case p.UP:h=
a=(a=this.prev())?i(a):this.get("parent");break;case p.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)h=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();h=a}break;case p.LEFT:d&&(g.length||!1===f)?this.set("expanded",!1):h=this.get("parent");break;case p.RIGHT:if(g.length||!1===f)d?h=g[0]:this.set("expanded",!0);break;default:b=!1}h&&h.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=l.indexOf(this,a);return b===
a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=l.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){a.stopPropagation();var b=q(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);
if(this===this.get("tree")){var a=this.get("tree");a&&(c(a,this,0),n(this,0))}},_onSetExpanded:function(a){h(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);l.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);l.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:k},
checkable:{value:!1,view:1},handleGestureEvents:{value:!1},isLeaf:{view:1},expandIconEl:{},iconEl:{},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})});
KISSY.add("tree/tree-manager",["node","component/extension/delegate-children","ua"],function(l,g){function f(){}var m=g("node"),d=g("component/extension/delegate-children"),a=g("ua").ieMode,r=m.Gesture,i=l.Feature.isTouchEventSupported();f.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};l.augment(f,d,{isTree:1,__bindUI:function(){var d=this.get("prefixCls")+"tree-node",c=r.tap;i||(c+=a&&9>a?" dblclick ":"");this.$el.delegate(c,"."+d,this.handleChildrenEvents,
this)},_onSetSelectedItem:function(a,c){a&&c.prevVal&&c.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return f});
KISSY.add("tree/control",["./node","./tree-manager"],function(l,g){var f=g("./node"),m=g("./tree-manager");return f.extend([m],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d){this.callSuper(d);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})});
KISSY.add("tree/check-node",["node","./node"],function(l,g){var f=g("node"),m=g("./node"),d=f.all,f=m.extend({handleClickInternal:function(a){var f=this.get("expanded"),i=this.get("expandIconEl"),h=this.get("tree"),c=d(a.target);h.focus();this.callSuper(a);if(c.equals(i))this.set("expanded",!f);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),this.fire("click"),!0},_onSetCheckState:function(a){var d=this.get("parent"),f,h,c,g;(1===a||0===a)&&l.each(this.get("children"),function(c){c.set("checkState",
a)});if(d){f=0;g=d.get("children");for(h=0;h<g.length;h++){c=g[h];c=c.get("checkState");if(2===c){d.set("checkState",2);return}1===c&&f++}0===f?d.set("checkState",0):f===g.length?d.set("checkState",1):d.set("checkState",2)}}},{ATTRS:{checkIconEl:{},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});f.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return f});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(l,g){var f=g("./check-node"),m=g("./tree-manager");return f.extend([m],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d,a){this.callSuper(d,a);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})});
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(l,g){var f=g("tree/control"),m=g("tree/node"),d=g("tree/check-node"),a=g("tree/check-tree");f.Node=m;f.CheckNode=d;f.CheckTree=a;return f});
