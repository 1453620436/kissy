/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 26 20:55
*/
KISSY.add("tree/node-xtpl",["component/extension/content-xtpl"],function(k,h,g,n){return function(c,a,i){var b,f=this,d;b=this.config.utils;"undefined"!=typeof n&&n.kissy&&(d=n);var a=b.runBlockCommand,g=b.getExpression,m=b.getPropertyOrRunCommand;b='<div id="ks-tree-node-row-';var e=m(f,c,{},"id",0,1,i,!1);b+=g(e,!0);b+='"\n     class="';var e={},l=[];l.push("row");e.params=l;e=m(f,c,e,"getBaseCssClasses",0,2,!0,i);b=b+e+"\n     ";var e={},l=[],k=m(f,c,{},"selected",0,3,i,!0);l.push(k);e.params=
l;e.fn=function(a){var j;j="\n        ";var b={},d=[];d.push("selected");b.params=d;a=m(f,a,b,"getBaseCssClasses",0,4,!0,i);return j+a+"\n     "};b+=a(f,c,e,"if",3);b+='\n     ">\n    <div id="ks-tree-node-expand-icon-';e=m(f,c,{},"id",0,7,i,!1);b+=g(e,!0);b+='"\n         class="';e={};l=[];l.push("expand-icon");e.params=l;e=m(f,c,e,"getBaseCssClasses",0,8,!0,i);b=b+e+'">\n    </div>\n    ';e={};l=[];k=m(f,c,{},"checkable",0,10,i,!0);l.push(k);e.params=l;e.fn=function(a){var j;j='\n    <div id="ks-tree-node-checked-';
var b=m(f,a,{},"id",0,11,i,!1);j+=g(b,!0);j+='"\n         class="';var b={},d=[],e=m(f,a,{},"checkState",0,12,i,!0);d.push("checked"+e);b.params=d;a=m(f,a,b,"getBaseCssClasses",0,12,!0,i);return j+a+'"></div>\n    '};b+=a(f,c,e,"if",10);b+='\n    <div id="ks-tree-node-icon-';e=m(f,c,{},"id",0,14,i,!1);b+=g(e,!0);b+='"\n         class="';e={};l=[];l.push("icon");e.params=l;e=m(f,c,e,"getBaseCssClasses",0,15,!0,i);b=b+e+'">\n\n    </div>\n    ';e={};l=[];l.push("component/extension/content-xtpl");e.params=
l;d&&(h("component/extension/content-xtpl"),e.params[0]=d.resolveByName(e.params[0]));d=m(f,c,e,"include",0,18,!1,i);b=b+d+'\n</div>\n<div id="ks-tree-node-children-';d=m(f,c,{},"id",0,20,i,!1);b+=g(d,!0);b+='"\n     class="';d={};e=[];e.push("children");d.params=e;d=m(f,c,d,"getBaseCssClasses",0,21,!0,i);b=b+d+'"\n';d={};e=[];l=m(f,c,{},"expanded",0,22,i,!0);e.push(l);d.params=e;d.fn=function(){return'\nstyle="display:none"\n'};e=d.fn;d.fn=d.inverse;d.inverse=e;b+=a(f,c,d,"if",22);return b+"\n>\n</div>"}});
KISSY.add("tree/node-render",["component/container","./node-xtpl","component/extension/content-render"],function(k,h){var g=h("component/container"),n=h("./node-xtpl"),c=h("component/extension/content-render");return g.getDefaultRender().extend([c],{beforeCreateDom:function(a,c){k.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});k.mix(c,{expandIconEl:"#ks-tree-node-expand-icon-{id}",
rowEl:"#ks-tree-node-row-{id}",iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",checkIconEl:"#ks-tree-node-checked-{id}"})},refreshCss:function(a,c){var b=this.control,f=b.get("iconEl"),d,g=b.get("expandIconEl"),h=b.get("childrenEl");c?(b="file-icon",d="expand-icon-{t}"):b.get("expanded")?(b="expanded-folder-icon",d="expand-icon-{t}minus"):(b="collapsed-folder-icon",d="expand-icon-{t}plus");f[0].className=this.getBaseCssClasses(b);g[0].className=this.getBaseCssClasses(k.substitute(d,
{t:a?"l":"t"}));h[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.control.get("childrenEl")[a?"show":"hide"]();this.el.setAttribute("aria-expanded",a)},_onSetSelected:function(a){this.control.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a)},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},_onSetCheckState:function(a){a=this.getBaseCssClasses("checked").split(/\s+/).join(a+
" ")+a;this.control.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(a)},getChildrenContainerEl:function(){return this.control.get("childrenEl")}},{ATTRS:{contentTpl:{value:n}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},
expanded:function(a){return"none"!=a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=a.one("."+this.getBaseCssClass("checked")))for(var c="checked0 checked1 checked2".split(/\s+/),b=0;b<c.length;b++)if(a.hasClass(this.getBaseCssClass(c[b])))return b;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})});
KISSY.add("tree/node",["node","component/container","./node-render"],function(k,h){function g(j){if(j.target==this){var a=j.component,b=this.get("depth"),j=j.index,c=this.get("tree");c&&(d(c,a,b+1),p(this,j))}}function n(j){j.target==this&&(d(this.get("tree"),j.component),p(this,j.index))}function c(j){j.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(j){var a=j.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==j}function i(a){var b=a.get("isLeaf");
return!(!1===b||void 0===b&&a.get("children").length)}function b(a){var d=a.get("children");return!a.get("expanded")||!d.length?a:b(d[d.length-1])}function f(b){b.get&&b.view&&b.view.refreshCss(a(b),i(b))}function d(a,b,c){void 0!==c&&b.set("depth",c);k.each(b.get("children"),function(b){"number"==typeof c?d(a,b,c+1):d(a,b)})}function p(a,b){f(a);for(var b=Math.max(0,b-1),d=a.get("children"),c,e=d.length;b<e;b++)c=d[b],f(c),c.el.setAttribute("aria-posinset",b+1)}var m=h("node"),e=h("component/container"),
l=h("./node-render"),q=m.all,o=m.KeyCode;return e.extend({bindUI:function(){this.on("afterAddChild",g);this.on("afterRemoveChild",n);this.on("afterAddChild afterRemoveChild",c)},syncUI:function(){f(this);c.call(this,{target:this})},handleKeyDownInternal:function(a){var d=!0,c=this.get("tree"),e=this.get("expanded"),f,g=this.get("isLeaf"),i=this.get("children");switch(a.keyCode){case o.ENTER:return this.handleClickInternal(a);case o.HOME:f=c;break;case o.END:f=b(c);break;case o.UP:f=a=(a=this.prev())?
b(a):this.get("parent");break;case o.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)f=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();f=a}break;case o.LEFT:e&&(i.length||!1===g)?this.set("expanded",!1):f=this.get("parent");break;case o.RIGHT:if(i.length||!1===g)e?f=i[0]:this.set("expanded",!0);break;default:d=!1}f&&f.select();return d},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=k.indexOf(this,a);return b==a.length-1?null:
a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=k.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){var b=q(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var a=this.get("tree");
a&&(d(a,this,0),p(this,0))}},_onSetExpanded:function(a){f(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);k.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);k.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:l},checkable:{value:!1,view:1},handleMouseEvents:{value:!1},
isLeaf:{view:1},expandIconEl:{},iconEl:{},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})});
KISSY.add("tree/tree-manager",["node","component/extension/delegate-children"],function(k,h){function g(){}var n=h("node"),c=h("component/extension/delegate-children"),a=k.UA.ieMode,i=n.Gesture,b=k.Features.isTouchEventSupported();g.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0},handleMouseEvents:{value:!0}};k.augment(g,c,{isTree:1,__bindUI:function(){var c=this.get("prefixCls")+"tree-node",d=i.tap;b||(d+=a&&9>a?" dblclick ":"");this.$el.delegate(d,"."+c,this.handleChildrenEvents,
this)},_onSetSelectedItem:function(a,b){a&&b.prevVal&&b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return g});
KISSY.add("tree/control",["./node","./tree-manager"],function(k,h){var g=h("./node"),n=h("./tree-manager");return g.extend([n],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c){this.callSuper(c);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})});
KISSY.add("tree/check-node",["node","./node"],function(k,h){var g=h("node"),n=h("./node"),c=g.all,g=n.extend({handleClickInternal:function(a){var g=this.get("expanded"),b=this.get("expandIconEl"),f=this.get("tree"),d=c(a.target);f.focus();this.callSuper(a);if(d.equals(b))this.set("expanded",!g);else return a=this.get("checkState"),this.set("checkState",1==a?0:1),this.fire("click"),!0},_onSetCheckState:function(a){var c=this.get("parent"),b,f,d,g;(1==a||0==a)&&k.each(this.get("children"),function(b){b.set("checkState",
a)});if(c){b=0;g=c.get("children");for(f=0;f<g.length;f++){d=g[f];d=d.get("checkState");if(2==d){c.set("checkState",2);return}1==d&&b++}0===b?c.set("checkState",0):b==g.length?c.set("checkState",1):c.set("checkState",2)}}},{ATTRS:{checkIconEl:{},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});g.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return g});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(k,h){var g=h("./check-node"),n=h("./tree-manager");return g.extend([n],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c,a){this.callSuper(c,a);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})});
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(k,h){var g=h("tree/control"),n=h("tree/node"),c=h("tree/check-node"),a=h("tree/check-tree");g.Node=n;g.CheckNode=c;g.CheckTree=a;return g});
