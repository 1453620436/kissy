/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 26 16:08
*/
KISSY.add("filter-menu",["menu","./filter-menu/render-xtpl","component/extension/content-box","util"],function(j,h,k,i){var j=h("menu"),k=h("./filter-menu/render-xtpl"),d=h("component/extension/content-box"),a=h("util");i.exports=j.extend([d],{bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(c){this.callSuper(c);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var c;c=this.get("filterInput");var a=this.get("highlightedItem");
this.set("filterStr",c.val());c=c.val();this.get("allowMultiple")&&(c=c.replace(/^.+,/,""));if(!c&&a)a.set("highlighted",!1);else if(c&&(!a||!a.get("visible")))(a=this._getNextEnabledHighlighted(0,1))&&a.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},_onSetPlaceholder:function(a){this.get("placeholderEl").html(a)},getKeyEventTarget:function(){return this.get("filterInput")},filterItems:function(c){var f=this.get("prefixCls"),g=this.get("placeholderEl"),b=this.get("filterInput");
g[c?"hide":"show"]();if(this.get("allowMultiple")){var g=[],e;e=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var d=[];e&&(d=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(c)?(g=[],e&&(g=d,e=d[d.length-1],(d=(d=this.get("highlightedItem"))&&d.get("content"))&&-1<d.indexOf(e)&&e&&(g[g.length-1]=d),b.val(g.join(",")+",")),c=""):(e&&(c=e[2]||""),g=d);this.get("enteredItems").length!==g.length&&this.set("enteredItems",g)}var b=this.get("children"),h=c&&RegExp(a.escapeRegExp(c),"ig");a.each(b,function(a){var b=
a.get("content");c?-1<b.indexOf(c)?(a.set("visible",!0),a.get("el").html(b.replace(h,function(a){return'<span class="'+f+'menuitem-hit">'+a+"</span>"}))):a.set("visible",!1):(a.get("el").html(b),a.set("visible",!0))})},reset:function(){this.set("filterStr","");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{handleGestureEvents:{value:!0},focusable:{value:!0},allowTextSelection:{value:!0},contentTpl:{value:k},filterInput:{selector:function(){return"."+this.getBaseCssClass("input")}},
filterInputWrap:{selector:function(){return"."+this.getBaseCssClass("input-wrap")}},placeholder:{render:1,sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1}},xclass:"filter-menu"})});
KISSY.add("filter-menu/render-xtpl",[],function(j,h,k,i){i.exports=function(d,a,c){var f=this.pos={line:1,col:1},g=this.root.utils.callFn;a.append('<div class="');var b={escape:1},e=[];e.push("input-wrap");b.params=e;f.line=1;f.col=33;if((b=g(this,d,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=c;a.writeEscaped(b);a.append('">\r\n    <div class="');b={escape:1};e=[];e.push("placeholder");b.params=e;f.line=2;f.col=36;if((b=g(this,d,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=c;a.writeEscaped(b);
a.append('">\r\n        ');b=d.resolve(["placeholder"]);a.writeEscaped(b);a.append('\r\n    </div>\r\n    <input class="');b={escape:1};e=[];e.push("input");b.params=e;f.line=5;f.col=38;if((b=g(this,d,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=c;a.writeEscaped(b);a.append('"\r\n            autocomplete="off"/>\r\n</div>\r\n<div class="');b={escape:1};e=[];e.push("content");b.params=e;f.line=8;f.col=32;if((f=g(this,d,b,a,["getBaseCssClasses"]))&&f.isBuffer)a=f,f=c;a.writeEscaped(f);a.append('">');
d=d.resolve(["content"]);a.write(d);a.append("</div>");return a};i.exports.TPL_NAME=i.name});
