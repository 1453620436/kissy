/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 15 17:53
*/
KISSY.add("filter-menu/render-xtpl",["component/extension/content-xtpl"],function(h,i,j,k){j=function(d,a,l,e){var g=this.nativeCommands,c=this.utils;if("5.0.0"!==h.version)throw Error("current xtemplate file("+this.name+")(v5.0.0) need to be recompiled using current kissy(v"+h.version+")!");c=c.callCommand;g=g.include;a.write('<div class="');var b={escape:1},f=[];f.push("input-wrap");b.params=f;if((b=c(this,d,b,a,"getBaseCssClasses",1))&&b.isBuffer)a=b,b=e;a.write(b,!0);a.write('">\r\n    <div class="');
b={escape:1};f=[];f.push("placeholder");b.params=f;if((b=c(this,d,b,a,"getBaseCssClasses",2))&&b.isBuffer)a=b,b=e;a.write(b,!0);a.write('">\r\n        ');b=d.resolve(["placeholder"]);a.write(b,!0);a.write('\r\n    </div>\r\n    <input class="');b={escape:1};f=[];f.push("input");b.params=f;if((c=c(this,d,b,a,"getBaseCssClasses",5))&&c.isBuffer)a=c,c=e;a.write(c,!0);a.write('"\r\n            autocomplete="off"/>\r\n</div>\r\n');c={};b=[];b.push("component/extension/content-xtpl");c.params=b;i("component/extension/content-xtpl");
c.params[0]=k.resolve(c.params[0]);if((d=g.call(this,d,c,a,8,l))&&d.isBuffer)a=d,d=e;a.write(d,!1);return a};j.TPL_NAME=k.name;return j});
KISSY.add("filter-menu",["menu","./filter-menu/render-xtpl","component/extension/content-box"],function(h,i){var j=i("menu"),k=i("./filter-menu/render-xtpl"),d=i("component/extension/content-box");return j.extend([d],{bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(a){this.callSuper(a);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("filterInput");var d=this.get("highlightedItem");this.set("filterStr",
a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&d)d.set("highlighted",!1);else if(a&&(!d||!d.get("visible")))(d=this._getNextEnabledHighlighted(0,1))&&d.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},_onSetPlaceholder:function(a){this.get("placeholderEl").html(a)},getKeyEventTarget:function(){return this.get("filterInput")},filterItems:function(a){var d=this.get("prefixCls"),e=this.get("placeholderEl"),g=this.get("filterInput");e[a?"hide":"show"]();
if(this.get("allowMultiple")){var e=[],c;c=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var b=[];c&&(b=c[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(e=[],c&&(e=b,c=b[b.length-1],(b=(b=this.get("highlightedItem"))&&b.get("content"))&&-1<b.indexOf(c)&&c&&(e[e.length-1]=b),g.val(e.join(",")+",")),a=""):(c&&(a=c[2]||""),e=b);this.get("enteredItems").length!==e.length&&this.set("enteredItems",e)}var g=this.get("children"),f=a&&RegExp(h.escapeRegExp(a),"ig");h.each(g,function(b){var c=b.get("content");a?-1<
c.indexOf(a)?(b.set("visible",!0),b.get("el").html(c.replace(f,function(a){return'<span class="'+d+'menuitem-hit">'+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(c),b.set("visible",!0))})},reset:function(){this.set("filterStr","");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},filterInput:{selector:function(){return"."+this.getBaseCssClass("input")}},filterInputWrap:{selector:function(){return"."+this.getBaseCssClass("input-wrap")}},placeholder:{render:1,
sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},contentTpl:{value:k}},xclass:"filter-menu"})});
