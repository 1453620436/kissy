/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:39
*/
KISSY.add("dd/ddm",["node","base"],function(g,d){function l(f){var a,b;if(f.touches&&1<f.touches.length)o._end();else{if(a=this.__activeToDrag)a._move(f);else if(b=this.get("activeDrag"))b._move(f),this.__needDropCheck&&i(this,f,b);(a=a||b)&&a.get("preventDefaultOnMove")&&f.preventDefault()}}function i(f,a,b){var h=f.get("validDrops"),d=b.get("mode"),c=0,k=0,i=e(b.get("node")),j=m(i);g.each(h,function(f){if(f.get("disabled"))return n;var h;h=f.getNodeFromTarget(a,b.get("dragNode")[0],b.get("node")[0]);
if(!h)return n;if("point"==d)t(e(h),b.mousePos)&&(h=m(e(h)),c?h<k&&(c=f,k=h):(c=f,k=h));else if("intersect"==d)h=m(r(i,e(h))),h>k&&(k=h,c=f);else if("strict"==d&&(h=m(r(i,e(h))),h==j))return c=f,!1;return n});if((h=f.get("activeDrop"))&&h!=c)h._handleOut(a),b._handleOut(a);f.setInternal("activeDrop",c);c&&(h!=c?c._handleEnter(a):c._handleOver(a))}function c(f){f._shim=v('<div style="background-color:red;position:'+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+o.get("dragCursor")+
";z-index:"+C+';"></div>').prependTo(q.body||q.documentElement).css("opacity",0);c=j;if(w)D.on("resize scroll",x,f);j(f)}function j(f){var a=f.get("activeDrag").get("activeHandler"),b="auto";a&&(b=a.css("cursor"));"auto"==b&&(b=f.get("dragCursor"));f._shim.css({cursor:b,display:"block"});w&&x.call(f)}function b(f){var a=f.get("drops");f.setInternal("validDrops",[]);a.length&&g.each(a,function(f){f._active()})}function k(f){var a=f.get("drops");f.setInternal("validDrops",[]);a.length&&g.each(a,function(f){f._deActive()})}
function e(f){var a=f.offset();f.__dd_cached_width||("no cache in dd!",f[0]);return{left:a.left,right:a.left+(f.__dd_cached_width||f.outerWidth()),top:a.top,bottom:a.top+(f.__dd_cached_height||f.outerHeight())}}function t(f,a){return f.left<=a.left&&f.right>=a.left&&f.top<=a.top&&f.bottom>=a.top}function m(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function r(a,b){var h=Math.max(a.top,b.top),e=Math.min(a.right,b.right),c=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,
b.left),right:e,top:h,bottom:c}}function u(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var p=d("node"),a=d("base"),h=g.UA,n=n,v=p.all,y=g.Env.host,q=y.document,s=v(q),D=v(y),w=6===h.ie,C=999999,p=p.Gesture,z=p.move,A=p.end,a=a.extend({__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){var b=this.get("drops"),a=g.indexOf(a,b);-1!=a&&b.splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;s.on(A,this._end,this);s.on(z,B,this);
q.body.setCapture&&q.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;a&&(this.setInternal("activeDrag",a),this.__activeToDrag=0,a.get("shim")&&c(this),this.__needDropCheck=0,a.get("groups")&&(b(this),this.get("validDrops").length&&(u(a.get("node")),this.__needDropCheck=1)))},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(a){var b=this.__activeToDrag,h=this.get("activeDrag"),e=this.get("activeDrop");a&&(b&&b._move(a),h&&h._move(a));s.detach(z,
B,this);s.detach(A,this._end,this);q.body.releaseCapture&&q.body.releaseCapture();b&&(b._end(a),this.__activeToDrag=0);this._shim&&this._shim.hide();h&&(h._end(a),k(this),e&&e._end(a),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}},{ATTRS:{dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),B=h.ie?g.throttle(l,30):l,x=g.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&
this._shim.css({width:s.width(),height:s.height()})},30),o=new a;o.inRegion=t;o.region=e;o.area=m;o.cacheWH=u;o.PREFIX_CLS="ks-dd-";return o});
KISSY.add("dd/draggable",["node","./ddm","base"],function(g,d){function l(){return!1}var i=d("node"),c=d("./ddm"),j=d("base"),b=i.all,k=g.each,e=g.Features,t=g.UA.ie,m=c.PREFIX_CLS,r=g.Env.host.document,u,p=function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)};return j.extend({initializer:function(){this.addTarget(c);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(i.Gesture.start,
p,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(a){a=this;a.get("node").detach(i.Gesture.start,p,a).detach("dragstart",a._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](m+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,e=b.get("handlers"),c=0;k(e,function(e){if(e[0]==a||e.contains(a))return c=1,b.setInternal("activeHandler",e),!1});return c},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&
1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var b=this;t&&(u=r.body.onselectstart,r.body.onselectstart=l);b.get("halt")&&a.stopPropagation();e.isTouchEventSupported()||a.preventDefault();var n=a.pageX,k=a.pageY;b.setInternal("startMousePos",b.mousePos={left:n,top:k});if(b._allowMove){var d=b.get("node").offset();b.setInternal("startNodePos",d);b.setInternal("deltaPos",{left:n-d.left,top:k-d.top})}c._regToDrag(b);if(n=b.get("bufferTime"))b._bufferTimer=setTimeout(function(){b._start(a)},
1E3*n)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var b=a.pageX,e=a.pageY;if(!this.get("dragging")){var c=this.get("startMousePos"),d=0,k=this.get("clickPixelThresh");if(Math.abs(b-c.left)>=k||Math.abs(e-c.top)>=k)this._start(a),d=1;if(!d)return}this.mousePos={left:b,top:e};a={drag:this,left:b,top:e,pageX:b,pageY:e,domEvent:a};if(c=this._allowMove)d=this.get("deltaPos"),b-=d.left,e-=d.top,a.left=b,a.top=e,this.setInternal("actualPos",
{left:b,top:e}),this.fire("dragalign",a);e=1;!1===this.fire("drag",a)&&(e=0);e&&c&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){c._end()},_end:function(a){var a=a||{},b;this._clearBufferTimer();t&&(r.body.onselectstart=u);this.get("dragging")&&(this.get("node").removeClass(m+"drag-over"),(b=c.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},
_handleOut:function(){this.get("node").removeClass(m+"drag-over");this.fire("dragexit",{drag:this,drop:c.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(m+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});c._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();
this.detach()}},{name:"Draggable",ATTRS:{node:{setter:function(a){if(!(a instanceof i))return b(a)}},clickPixelThresh:{valueFn:function(){return c.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return c.get("bufferTime")}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(a){var e=this;a.length||(a[0]=e.get("node"));k(a,function(c,d){"function"===typeof c&&(c=c.call(e));"string"==typeof c&&(c=e.get("node").one(c));c.nodeType&&(c=b(c));a[d]=c});e.setInternal("handlers",a);return a}},
activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](m+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});
KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(g,d){var l=d("node"),i=d("./ddm"),c=d("./draggable"),j=i.PREFIX_CLS,b=l.all,k=function(e){var c,d;if(this._checkDragStartValid(e)){c=this.get("handlers");var k=b(e.target);(c=c.length?this._getHandler(k):k)&&(d=this._getNode(c));d&&(this.setInternal("activeHandler",c),this.setInternal("node",d),this.setInternal("dragNode",d),this._prepare(e))}};return c.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},
_onSetDisabledChange:function(b){this.get("container")[b?"addClass":"removeClass"](j+"-disabled")},bindDragEvent:function(){this.get("container").on(l.Gesture.start,k,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(l.Gesture.start,k,this).detach("dragstart",this._fixDragStart)},_getHandler:function(b){for(var c=void 0,d=this.get("container"),k=this.get("handlers");b&&b[0]!==d[0];){g.each(k,function(d){if(b.test(d))return c=b,!1});if(c)break;b=b.parent()}return c},
_getNode:function(b){return b.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(c){return b(c)}},selector:{},handlers:{value:[],getter:0}}})});
KISSY.add("dd/droppable",["node","./ddm","base"],function(g,d){var l=d("node"),i=d("./ddm"),c=d("base"),j=i.PREFIX_CLS;return c.extend({initializer:function(){this.addTarget(i);i._regDrop(this)},getNodeFromTarget:function(b,c,e){var b=this.get("node"),d=b[0];return d==c||d==e?null:b},_active:function(){var b=i.get("activeDrag"),c=this.get("node"),e=this.get("groups"),b=b.get("groups");a:if(!0===b)e=1;else{for(var d in e)if(b[d]){e=1;break a}e=0}e?(i._addValidDrop(this),c&&(c.addClass(j+"drop-active-valid"),
i.cacheWH(c))):c&&c.addClass(j+"drop-active-invalid")},_deActive:function(){var b=this.get("node");b&&b.removeClass(j+"drop-active-valid").removeClass(j+"drop-active-invalid")},__getCustomEvt:function(b){return g.mix({drag:i.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();this.get("node").removeClass(j+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(j+"drop-over");this.fire("dropenter",
b)},_handleOver:function(b){b=this.__getCustomEvt(b);b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(j+"drop-over");this.fire("drophit",b)},destructor:function(){i._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(b){if(b)return l.one(b)}},groups:{value:{}},disabled:{}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable"],function(g,d){function l(){var b=this.get("container"),d=[],e=this.get("selector");b.all(e).each(function(b){c.cacheWH(b);d.push(b)});this.__allNodes=d}var i=d("node"),c=d("./ddm"),j=d("./droppable").extend({initializer:function(){c.on("dragstart",l,this)},getNodeFromTarget:function(b,d,e){var i={left:b.pageX,top:b.pageY},b=this.__allNodes,j=0,l=Number.MAX_VALUE;b&&g.each(b,function(b){var g=b[0];g===e||g===d||(g=c.region(b),c.inRegion(g,
i)&&(g=c.area(g),g<l&&(l=g,j=b)))});j&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",j));return j},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(b){var c=this.get("node"),d=j.superclass._handleOut,g=this.callSuper,i=j.superclass._handleEnter,l=this.get("lastNode");l[0]!==c[0]?(this.setInternal("node",l),d.apply(this,arguments),this.setInternal("node",c),i.call(this,b)):g.call(this,b)},_end:function(b){this.callSuper(b);
this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(b){return i.one(b)}}}});return j});KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(g,d){var l=d("dd/ddm"),i=d("dd/draggable"),c=d("dd/draggable-delegate"),j=d("dd/droppable-delegate"),b=d("dd/droppable"),l={Draggable:i,DDM:l,Droppable:b,DroppableDelegate:j,DraggableDelegate:c};return KISSY.DD=l});
