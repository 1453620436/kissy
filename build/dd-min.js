/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 25 16:52
*/
KISSY.add("dd/ddm",["node","base","ua"],function(k,c){function l(i){var a=i.get("activeDrag").get("activeHandler"),j="auto";a&&(j=a.css("cursor"));"auto"===j&&(j=i.get("dragCursor"));i._shim.css({cursor:j,display:"block"});o&&s.call(i)}function g(i){var a=i.get("drops");i.setInternal("validDrops",[]);a.length&&k.each(a,function(j){j._active()})}function m(i){var a=i.get("drops");i.setInternal("validDrops",[]);a.length&&k.each(a,function(j){j._deActive()})}function h(i){var a=i.offset();return{left:a.left,
right:a.left+(i.__ddCachedWidth||i.outerWidth()),top:a.top,bottom:a.top+(i.__ddCachedHeight||i.outerHeight())}}function a(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&a.bottom>=b.top}function b(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function d(a,b){var j=Math.max(a.top,b.top),d=Math.min(a.right,b.right),n=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:d,top:j,bottom:n}}function p(a){a&&(a.__ddCachedWidth=a.outerWidth(),a.__ddCachedHeight=
a.outerHeight())}var f=c("node"),e=c("base"),t=c("ua"),u=f.all,f=k.Env.host,r=f.document,w=u(r),q=u(f),o=6===t.ie,e=e.extend({addDrop:function(a){this.get("drops").push(a)},removeDrop:function(a){var b=this.get("drops"),a=k.indexOf(a,b);-1!==a&&b.splice(a,1)},start:function(a,b){this.setInternal("activeDrag",b);b.get("shim")&&v(this);this.__needDropCheck=0;b.get("groups")&&(g(this),this.get("validDrops").length&&(p(b.get("node")),this.__needDropCheck=1))},addValidDrop:function(a){this.get("validDrops").push(a)},
_notifyDropsMove:function(i,c){var j=this.get("validDrops"),x=c.get("mode"),n=0,f=0,p=h(c.get("node")),g=b(p);k.each(j,function(j){if(!j.get("disabled")){var e;if(e=j.getNodeFromTarget(i,c.get("dragNode")[0],c.get("node")[0]))if("point"===x)a(h(e),c.mousePos)&&(e=b(h(e)),n?e<f&&(n=j,f=e):(n=j,f=e));else if("intersect"===x)e=b(d(p,h(e))),e>f&&(f=e,n=j);else if("strict"===x&&(e=b(d(p,h(e))),e===g))return n=j,!1}});if((j=this.get("activeDrop"))&&j!==n)j._handleOut(i),c._handleOut(i);this.setInternal("activeDrop",
n);n&&(j!==n?n._handleEnter(i):n._handleOver(i))},move:function(a,b){this.__needDropCheck&&this._notifyDropsMove(a,b)},end:function(a){var b=this.get("activeDrop");this._shim&&this._shim.hide();m(this);b&&b._end(a);this.setInternal("activeDrop",null);this.setInternal("activeDrag",null)}},{ATTRS:{dragCursor:{value:"move"},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),v=function(a){a._shim=u('<div style="background-color:red;position:'+(o?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+
a.get("dragCursor")+';z-index:999999;"></div>').prependTo(r.body||r.documentElement).css("opacity",0);v=l;if(o)q.on("resize scroll",s,a);l(a)},s=k.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:w.width(),height:w.height()})},30),e=new e;e.inRegion=a;e.region=h;e.area=b;e.cacheWH=p;e.PREFIX_CLS="ks-dd-";return e});
KISSY.add("dd/draggable",["node","./ddm","base","event/gesture/drag","ua"],function(k,c){function l(a){return function(){this._isValidDrag&&a.apply(this,arguments)}}function g(){o.body.onselectstart=y;o.body.releaseCapture&&o.body.releaseCapture()}function m(){return!1}function h(a){this._isValidDrag=0;this.onGestureStart(a)}var a=c("node"),b=a.Gesture,d=c("./ddm"),p=c("base"),f=c("event/gesture/drag"),e=c("ua"),t=a.all,u=t(document),r=k.each,w=e.ie,q=d.PREFIX_CLS,o=k.Env.host.document,v=l(function(a){this._start(a)}),
s=l(function(a){this._move(a)}),i=l(function(a){this._end(a)}),y;return p.extend({initializer:function(){this.addTarget(d);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a)},onGestureStart:function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)},getEventTargetEl:function(){return this.get("node")},start:function(){var a=this.getEventTargetEl();if(a)a.on(f.DRAG_START,v,this).on(f.DRAG,s,this).on(f.DRAG_END,i,this).on(b.start,
h,this).on("dragstart",this._fixDragStart)},stop:function(){var a=this.getEventTargetEl();a&&a.detach(f.DRAG_START,v,this).detach(f.DRAG,s,this).detach(f.DRAG_END,i,this).detach(b.start,h,this).detach("dragstart",this._fixDragStart)},_onSetDisabled:function(a){var b=this.get("dragNode");if(b)b[a?"addClass":"removeClass"](q+"-disabled");this[a?"stop":"start"]()},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,d=b.get("handlers"),c=0;r(d,function(d){if(d[0]===a||d.contains(a))return c=
1,b.setInternal("activeHandler",d),!1});return c},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!==a.which?0:1},_prepare:function(a){this._isValidDrag=1;w&&(y=o.body.onselectstart,o.body.onselectstart=m,o.body.setCapture&&o.body.setCapture(),u.on(b.end,{fn:g,once:!0}));this.get("halt")&&a.stopPropagation();"mouse"===a.gestureType&&a.preventDefault();this._allowMove&&this.setInternal("startNodePos",this.get("node").offset())},_start:function(a){this.mousePos={left:a.pageX,
top:a.pageY};d.start(a,this);this.fire("dragstart",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY});this.get("dragNode").addClass(q+"dragging")},_move:function(a){var b=a.pageX,c=a.pageY;"touch"===a.gestureType&&a.preventDefault();this.mousePos={left:b,top:c};b={drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY};if(c=this._allowMove){var e=this.get("startNodePos"),
f=e.left+a.deltaX,e=e.top+a.deltaY;b.left=f;b.top=e;this.setInternal("actualPos",{left:f,top:e});this.fire("dragalign",b)}f=1;!1===this.fire("drag",b)&&(f=0);d.move(a,this);this.get("preventDefaultOnMove")&&a.preventDefault();f&&c&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){this._isValidDrag&&this._end()},_end:function(a){var a=a||{},b;this._isValidDrag=0;this.get("node").removeClass(q+"drag-over");this.get("dragNode").removeClass(q+"dragging");(b=d.get("activeDrop"))?this.fire("dragdrophit",
{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this});d.end(a,this);this.fire("dragend",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY})},_handleOut:function(){this.get("node").removeClass(q+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(q+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},destructor:function(){this.stop()}},
{name:"Draggable",ATTRS:{node:{setter:function(b){if(!(b instanceof a))return t(b)}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));r(a,function(d,c){"function"===typeof d&&(d=d.call(b));"string"===typeof d&&(d=b.get("node").one(d));d.nodeType&&(d=t(d));a[c]=d});b.setInternal("handlers",a);return a}},activeHandler:{},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startNodePos:{},
actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});
KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(k,c){var l=c("node"),g=c("./ddm"),m=c("./draggable"),h=g.PREFIX_CLS,a=l.all;return m.extend({_onSetNode:k.noop,_onSetDisabled:function(a){var d=this.get("container");d&&(d[a?"addClass":"removeClass"](h+"-disabled"),this[a?"stop":"start"]())},getEventTargetEl:function(){return this.get("container")},onGestureStart:function(b){var d,c;if(this._checkDragStartValid(b)){d=this.get("handlers");var f=a(b.target);(d=d.length?this._getHandler(f):
f)&&(c=this._getNode(d));c&&(this.setInternal("activeHandler",d),this.setInternal("node",c),this.setInternal("dragNode",c),this._prepare(b))}},_getHandler:function(a){for(var d=this.get("container"),c=this.get("handlers");a&&a[0]!==d[0];){for(var f=0;f<c.length;f++)if(a.test(c[f]))return a;a=a.parent()}return null},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(b){return a(b)}},selector:{},handlers:{value:[],getter:0}}})});
KISSY.add("dd/droppable",["node","./ddm","base"],function(k,c){var l=c("node"),g=c("./ddm"),m=c("base"),h=g.PREFIX_CLS;return m.extend({initializer:function(){this.addTarget(g);g.addDrop(this)},getNodeFromTarget:function(a,b,d){var a=this.get("node"),c=a[0];return c===b||c===d?null:a},_active:function(){var a=g.get("activeDrag"),b=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===a)c=1;else{for(var p in c)if(a[p]){c=1;break a}c=0}c?(g.addValidDrop(this),b&&(b.addClass(h+"drop-active-valid"),
g.cacheWH(b))):b&&b.addClass(h+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(h+"drop-active-valid").removeClass(h+"drop-active-invalid")},__getCustomEvt:function(a){return k.mix({drag:g.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(h+"drop-over");this.fire("dropenter",
a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("drophit",a)},destructor:function(){g.removeDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(a){if(a)return l.one(a)}},groups:{value:{}},disabled:{}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable"],function(k,c){function l(){var a=this.get("container"),b=[],c=this.get("selector");a.all(c).each(function(a){m.cacheWH(a);b.push(a)});this.__allNodes=b}var g=c("node"),m=c("./ddm"),h=c("./droppable").extend({initializer:function(){m.on("dragstart",l,this)},getNodeFromTarget:function(a,b,c){var h={left:a.pageX,top:a.pageY},a=this.__allNodes,f=0,e=Number.MAX_VALUE;a&&k.each(a,function(a){var g=a[0];g===c||g===b||(g=m.region(a),m.inRegion(g,
h)&&(g=m.area(g),g<e&&(e=g,f=a)))});f&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",f));return f},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(a){var b=this.get("node"),c=h.superclass._handleOut,g=this.callSuper,f=h.superclass._handleEnter,e=this.get("lastNode");e[0]!==b[0]?(this.setInternal("node",e),c.apply(this,arguments),this.setInternal("node",b),f.call(this,a)):g.call(this,a)},_end:function(a){this.callSuper(a);
this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return g.one(a)}}}});return h});KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(k,c){var l=c("dd/ddm"),g=c("dd/draggable"),m=c("dd/draggable-delegate"),h=c("dd/droppable-delegate"),a=c("dd/droppable"),l={Draggable:g,DDM:l,Droppable:a,DroppableDelegate:h,DraggableDelegate:m};return KISSY.DD=l});
