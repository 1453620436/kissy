/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:18
*/
KISSY.add("editor/plugin/color/dialog",["editor","util","../dialog","dom"],function(x,e){function j(a){if(f.isArray(a))return a;var b=RegExp;if(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.test(a))return g([b.$1,b.$2,b.$3],function(a){return parseInt(a,16)});if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return g([b.$1,b.$2,b.$3],function(a){return parseInt(a+a,16)});if(/^rgb\((.*),(.*),(.*)\)$/i.test(a))return g([b.$1,b.$2,b.$3],function(a){return 0<a.indexOf("%")?2.55*parseFloat(a,10):a|0})}function m(a){var a=
"0"+a,b=a.length;return a.slice(b-2,b)}function n(a){a=j(a);return"#"+m(a[0].toString(16))+m(a[1].toString(16))+m(a[2].toString(16))}function p(a){this.editor=a;this._init()}var q=e("editor"),f=e("util"),r=e("../dialog"),g=f.map,s=e("dom"),t=Node.all,o=function(){function a(a,i,c){for(var d=[],a=b(a),i=b(i),h=(i[0]-a[0])/c,k=(i[1]-a[1])/c,f=(i[2]-a[2])/c,l=0,e=a[0],j=a[1],a=a[2];l<c;l++)d[l]=[e,j,a],e+=h,j+=k,a+=f;d[l]=i;return g(d,function(a){return g(a,function(a){return Math.min(Math.max(0,Math.floor(a)),
255)})})}function b(a){var b=j(a);if(void 0===b){c||(c=document.createElement("textarea"),c.style.display="none",s.prepend(c,document.body));try{c.style.color=a}catch(f){return[0,0,0]}document.defaultView?b=j(document.defaultView.getComputedStyle(c,null).color):(a=c.createTextRange().queryCommandValue("ForeColor"),b=[a&255,(a&65280)>>>8,(a&16711680)>>>16])}return b}var c;return function(b,c){var f=[],d=b.length;void 0===c&&(c=20);if(1===d)f=a(b[0],b[0],c);else if(1<d)for(var h=0,d=d-1;h<d;h++){var k=
a(b[h],b[h+1],c[h]||c);h<d-1&&k.pop();f=f.concat(k)}return f}}(),u='<div class="{prefixCls}editor-color-advanced-picker"><div class="ks-clear"><div class="{prefixCls}editor-color-advanced-picker-left">'+("<ul>"+g(o("red,orange,yellow,green,cyan,blue,purple".split(","),5),function(a){return g(o(["white","rgb("+a.join(",")+")","black"],5),function(a){return'<li><a style="background-color:'+n(a)+'" href="#"></a></li>'}).join("")}).join("</ul><ul>")+"</ul>")+'</div><div class="{prefixCls}editor-color-advanced-picker-right"></div></div><div style="padding:10px;"><label>\u989c\u8272\u503c\uff1a <input style="width:100px" class="{prefixCls}editor-color-advanced-value"/></label><span class="{prefixCls}editor-color-advanced-indicator"></span></div></div>',
v=q.Utils.addRes,w=q.Utils.destroyRes;f.augment(p,{_init:function(){var a=this,b=a.editor.get("prefixCls");a.dialog=(new r({mask:!0,headerContent:"\u989c\u8272\u62fe\u53d6\u5668",bodyContent:f.substitute(u,{prefixCls:b}),footerContent:f.substitute('<div style="padding:5px 20px 20px;"><a class="{prefixCls}editor-button {prefixCls}editor-color-advanced-ok ks-inline-block">\u786e\u5b9a</a>&nbsp;&nbsp;&nbsp;<a class="{prefixCls}editor-button  {prefixCls}editor-color-advanced-cancel ks-inline-block">\u53d6\u6d88</a></div>',{prefixCls:b}),width:"550px"})).render();
var c=a.dialog,e=c.get("body"),i=c.get("footer"),g=e.one("."+b+"editor-color-advanced-indicator"),d=e.one("."+b+"editor-color-advanced-value"),h=e.one("."+b+"editor-color-advanced-picker-left"),c=i.one("."+b+"editor-color-advanced-ok"),b=i.one("."+b+"editor-color-advanced-cancel");c.on("click",function(b){var c=f.trim(d.val()),e=a.colorButtonArrow;/^#([a-f0-9]{1,2}){3,3}$/i.test(c)?(a.hide(),e.fire("selectColor",{color:d.val()}),b.halt()):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});d.on("change",function(){var a=f.trim(d.val());
/^#([a-f0-9]{1,2}){3,3}$/i.test(a)?g.css("background-color",a):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u989c\u8272\u4ee3\u7801")});b.on("click",function(b){a.hide();b.halt()});e.on("click",function(b){b.halt();b=t(b.target);if("a"===b.nodeName()){var c=n(b.css("background-color"));h.contains(b)&&a._detailColor(c);d.val(c);g.css("background-color",c)}});v.call(a,c,d,b,e,a.dialog);a._detailColor("#FF9900");d.val("#FF9900");g.css("background-color","#FF9900")},_detailColor:function(a){var b=this.dialog.get("body"),c=this.editor.get("prefixCls");
b.one("."+c+"editor-color-advanced-picker-right").html(g(o(["#ffffff",a,"#000000"],40),function(a){return'<a style="background-color:'+n(a)+'"></a>'}).join(""))},show:function(a){this.colorButtonArrow=a;this.dialog.show()},hide:function(){this.dialog.hide()},destroy:function(){w.call(this)}});return p});
