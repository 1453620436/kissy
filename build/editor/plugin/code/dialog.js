/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 9 13:56
*/
KISSY.add("editor/plugin/code/dialog",["editor","menubutton","dom","../dialog"],function(c,d){function g(a){this.editor=a}var h=d("editor"),j=d("menubutton"),i=h.XHTML_DTD,k=d("dom").NodeType,l=h.Walker.whitespaces(!0),m=d("../dialog"),n='<div class="{prefixCls}code-wrap"><table class="{prefixCls}code-table"><tr><td class="{prefixCls}code-label"><label for="ks-editor-code-type">\u7c7b\u578b\uff1a</label></td><td class="{prefixCls}code-content"><select id="ks-editor-code-type"  class="{prefixCls}code-type">'+c.map([["ActionScript3",
"as3"],["Bash/Shell","bash"],["C/C++","cpp"],["Css","css"],["CodeFunction","cf"],["C#","c#"],["Delphi","delphi"],["Diff","diff"],["Erlang","erlang"],["Groovy","groovy"],["HTML","html"],["Java","java"],["JavaFx","jfx"],["Javascript","js"],["Perl","pl"],["Php","php"],["Plain Text","plain"],["PowerShell","ps"],["Python","python"],["Ruby","ruby"],["Scala","scala"],["Sql","sql"],["Vb","vb"],["Xml","xml"]],function(a){return'<option value="'+a[1]+'">'+a[0]+"</option>"})+'</select></td></tr><tr><td><label for="ks-editor-code-textarea">\u4ee3\u7801\uff1a</label></td><td><textarea id="ks-editor-code-textarea"  class="{prefixCls}code-textarea {prefixCls}input"></textarea></td></tr></table></div>';
c.augment(g,{initDialog:function(){var a=this.editor.get("prefixCls")+"editor-",b,f;f=this.dialog=(new m({width:500,mask:!0,headerContent:"\u63d2\u5165\u4ee3\u7801",bodyContent:c.substitute(n,{prefixCls:a}),footerContent:c.substitute('<div class="{prefixCls}code-table-action"><a href="javascript:void(\'\u63d2\u5165\')" class="{prefixCls}code-insert {prefixCls}button">\u63d2\u5165</a><a href="javascript:void(\'\u53d6\u6d88\')" class="{prefixCls}code-cancel {prefixCls}button">\u53d6\u6d88</a></td></div>',{prefixCls:a})})).render();b=f.get("el");this.insert=
b.one("."+a+"code-insert");this.cancel=b.one("."+a+"code-cancel");this.type=j.Select.decorate(b.one("."+a+"code-type"),{prefixCls:a+"big-",width:150,menuCfg:{prefixCls:a,height:320,render:f.get("contentEl")}});this.code=b.one("."+a+"code-textarea");this.insert.on("click",this._insert,this);this.cancel.on("click",this.hide,this)},hide:function(){this.dialog.hide()},_insert:function(){var a,b=this.editor;if(c.trim(a=this.code.val())){a=c.all(c.substitute('<pre class="prettyprint ks-editor-code brush:{type};toolbar:false;">{code}</pre>',
{type:this.type.get("value"),code:c.escapeHtml(a)}),b.get("document")[0]);this.dialog.hide();b.insertElement(a);var f=b.getSelection().getRanges()[0],e=a.next(l,1),d=e&&e[0].nodeType===k.ELEMENT_NODE&&e.nodeName();if(!d||!i.$block[d]||!i[d]["#text"])e=c.all("<p></p>",b.get("document")[0]),c.UA.ie||e._4eAppendBogus(),a.after(e);f.moveToElementEditablePosition(e);b.getSelection().selectRanges([f])}else alert("\u8bf7\u8f93\u5165\u4ee3\u7801!")},show:function(){this.dialog||this.initDialog();this.dialog.show()}});return g});
