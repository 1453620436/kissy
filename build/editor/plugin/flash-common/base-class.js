/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:19
*/
KISSY.add("editor/plugin/flash-common/base-class","./utils,base,editor,node,ua,util,../dialog-loader,../bubble,../contextmenu".split(","),function(o,a){var e=a("./utils"),f=a("base"),k=a("editor"),l=a("node"),m=a("ua"),i=a("util"),n=a("../dialog-loader");a("../bubble");a("../contextmenu");return f.extend({initializer:function(){var b=this,d=b.get("cls"),c=b.get("editor"),a=c.get("prefixCls"),j=[],e=b.get("bubbleId"),f=b.get("contextMenuId"),g=b.get("contextMenuHandlers");i.each(g,function(b,a){j.push({content:a})});
c.addContextMenu(f,"."+d,{width:"120px",children:j,listeners:{click:function(b){b=b.target.get("content");g[b]&&g[b].call(this)}}});c.addBubble(e,function(b){return b.hasClass(d,void 0)&&b},{listeners:{afterRenderUI:function(){var d=this,h=d.get("contentEl");h.html(i.substitute(' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u5220\u9664</span>',
{label:b.get("label"),prefixCls:a}));var e=h.one("."+a+"editor-bubble-url"),f=h.one("."+a+"editor-bubble-change"),g=h.one("."+a+"editor-bubble-remove");k.Utils.preventFocus(h);f.on("click",function(a){b.show(d.get("editorSelectedEl"));a.halt()});g.on("click",function(b){if(m.webkit){var a=c.getSelection().getRanges();if(a=a&&a[0]){a.collapse(true);a.select()}}d.get("editorSelectedEl").remove();d.hide();c.notifySelectionChange();b.halt()});d.on("show",function(){var a=d.get("editorSelectedEl");a&&
b._updateTip(e,a)})}}});c.docReady(function(){c.get("document").on("dblclick",b._dbClick,b)})},_getFlashUrl:function(b){return e.getUrl(b)},_updateTip:function(b,a){var c=this.get("editor").restoreRealElement(a);if(c){c=this._getFlashUrl(c);b.attr("href",c)}},_dbClick:function(b){var a=new l(b.target);if(a.nodeName()==="img"&&a.hasClass(this.get("cls"),void 0)){this.show(a);b.halt()}},show:function(a){var d=this.get("editor");n.useDialog(d,this.get("type"),this.get("pluginConfig"),a)}},{ATTRS:{cls:{},
type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}}})});
