/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:24
*/
KISSY.add("editor/plugin/xiami-music","editor,./flash-common/base-class,./flash-common/utils,./fake-objects,./button,util".split(","),function(o,a){function h(){h.superclass.constructor.apply(this,arguments)}function b(g){this.config=g||{}}var l=a("editor"),m=a("./flash-common/base-class"),j=a("./flash-common/utils"),n=a("./fake-objects");a("./button");a("util").extend(h,m,{_updateTip:function(g,a){var e=this.get("editor").restoreRealElement(a);if(e){g.html(a.attr("title"));g.attr("href",this._getFlashUrl(e))}}});
b.prototype={pluginRenderUI:function(a){function i(f){return/xiami\.com/i.test(f)}n.init(a);var e=a.htmlDataProcessor,b=e&&e.dataFilter;b&&b.addRules({tags:{object:function(f){var a=f.getAttribute("title"),c,d;c=f.getAttribute("classid");var b=f.childNodes;if(!c){for(c=0;c<b.length;c++){d=b[c];if(d.nodeName==="embed"){if(!j.isFlashEmbed(d))break;if(i(d.attributes.src))return e.createFakeParserElement(f,"ke_xiami","xiami-music",true,{title:a})}}return null}for(c=0;c<b.length;c++){d=b[c];if(d.nodeName===
"param"&&d.getAttribute("name").toLowerCase()==="movie"&&i(d.getAttribute("value")||d.getAttribute("VALUE")))return e.createFakeParserElement(f,"ke_xiami","xiami-music",true,{title:a})}},embed:function(a){if(j.isFlashEmbed(a)&&i(a.getAttribute("src")))return e.createFakeParserElement(a,"ke_xiami","xiami-music",true,{title:a.getAttribute("title")})}}},4);var k=new h({editor:a,cls:"ke_xiami",type:"xiami-music",bubbleId:"xiami",pluginConfig:this.config,contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=
this.get("editorSelectedEl");a&&k.show(a)}}});a.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){k.show()}},mode:l.Mode.WYSIWYG_MODE})}};return b});
