/*
Copyright 2013, KISSY v1.41
MIT Licensed
build time: Dec 2 17:30
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(j,k){var q=k("component/container"),r=k("component/extension/content-render"),o=j.Features.isTransform3dSupported()?"translate3d({translateX}px,{translateY}px,0)":"translate({translateX}px,{translateY}px)",p=j.Features,l,n={syncUI:function(){var d=this.control,e=d.el,f=d.contentEl,a=d.$contentEl,c=f.offsetHeight,f=f.offsetWidth,b=e.clientHeight,h=e.clientWidth;d.scrollHeight=c;d.scrollWidth=f;
d.clientHeight=b;d.clientWidth=h;e=d.allowScroll={};c>b&&(e.top=1);f>h&&(e.left=1);d.minScroll={left:0,top:0};var g,m;d.maxScroll={left:g=f-h,top:m=c-b};delete d.scrollStep;b=d.get("snap");c=d.get("scrollLeft");f=d.get("scrollTop");if(b){var s=a.offset(),a=d.pages="string"===typeof b?a.all(b):a.children(),b=d.get("pageIndex"),i=d.pagesOffset=[];a.each(function(a,b){var c=a.offset(),d=c.left-s.left,c=c.top-s.top;d<=g&&c<=m&&(i[b]={left:d,top:c,index:b})});if(b){d.scrollToPage(b);return}}d.scrollToWithBounds({left:c,
top:f})},_onSetScrollLeft:function(d){this.control.contentEl.style.left=-d+"px"},_onSetScrollTop:function(d){this.control.contentEl.style.top=-d+"px"}};p.isTransformSupported()&&(l=p.getTransformProperty(),n._onSetScrollLeft=function(d){var e=this.control;e.contentEl.style[l]=j.substitute(o,{translateX:-d,translateY:-e.get("scrollTop")})},n._onSetScrollTop=function(d){var e=this.control;e.contentEl.style[l]=j.substitute(o,{translateX:-e.get("scrollLeft"),translateY:-d})});return q.getDefaultRender().extend([r],
n,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(j,k){function q(){var a=this.el,c=a.scrollTop,b=a.scrollLeft;c&&this.set("scrollTop",c+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function r(a,c){a.scrollView.set(c.prop,c.val)}var o=k("node"),p=k("anim"),l=k("component/container"),n=k("./base/render"),d=j.all,e=j.Features.isTouchEventSupported(),f=o.KeyCode;return l.extend({initializer:function(){this.scrollAnims=[]},
bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",q,this)},handleKeyDownInternal:function(a){var c=d(a.target),b=c.nodeName();if(!("input"===b||"textarea"===b||"select"===b||c.hasAttr("contenteditable"))){var a=a.keyCode,c=this.getScrollStep(),h,b=this.allowScroll.left;if(this.allowScroll.top){var g=c.top,m=this.clientHeight,e=this.get("scrollTop");a===f.DOWN?(this.scrollToWithBounds({top:e+g}),h=!0):a===f.UP?(this.scrollToWithBounds({top:e-g}),h=!0):a===f.PAGE_DOWN?
(this.scrollToWithBounds({top:e+m}),h=!0):a===f.PAGE_UP&&(this.scrollToWithBounds({top:e-m}),h=!0)}b&&(c=c.left,b=this.get("scrollLeft"),a===f.RIGHT?(this.scrollToWithBounds({left:b+c}),h=!0):a===f.LEFT&&(this.scrollToWithBounds({left:b-c}),h=!0));return h}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=d(this.get("el")[0].ownerDocument),c=this.clientHeight,b=this.clientWidth;return this.scrollStep={top:Math.max(0.7*c*c/a.height(),20),left:Math.max(0.7*b*b/a.width(),20)}},
handleMouseWheel:function(a){if(!this.get("disabled")){var c,b,d=this.getScrollStep(),g,e=this.maxScroll,f=this.minScroll;if((g=a.deltaY)&&this.allowScroll.top){var i=this.get("scrollTop");c=e.top;b=f.top;i<=b&&0<g||i>=c&&0>g||(this.scrollToWithBounds({top:i-a.deltaY*d.top}),a.preventDefault())}if((g=a.deltaX)&&this.allowScroll.left)i=this.get("scrollLeft"),c=e.left,b=f.left,i<=b&&0<g||i>=c&&0>g||(this.scrollToWithBounds({left:i-a.deltaX*d.left}),a.preventDefault())}},isAxisEnabled:function(a){return this.allowScroll["x"===
a?"left":"top"]},stopAnimation:function(){this.scrollAnims.length&&(j.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,c,b){var d=this.pagesOffset.concat([]),e=c?"left":"top";d.sort(function(a,b){return a[e]-b[e]});if(0<b)for(c=0;c<d.length;c++){if(b=d[c],b[e]>=a)return b.index}else for(c=d.length-1;0<=c;c--)if(b=d[c],b[e]<=
a)return b.index},scrollToPage:function(a,c){var b;if((b=this.pagesOffset)&&b[a])this.set("pageIndex",a),this.scrollTo(b[a],c)},scrollToWithBounds:function(a,c){var b=this.maxScroll,d=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,d.left),b.left));a.top&&(a.top=Math.min(Math.max(a.top,d.top),b.top));this.scrollTo(a,c)},scrollTo:function(a,c){var b=a.left,d=a.top;if(c){var e={},f={};void 0!==b&&(f.scrollLeft=b,e.scrollLeft=this.get("scrollLeft"));void 0!==d&&(f.scrollTop=d,e.scrollTop=this.get("scrollTop"));
c.frame=r;c.node=e;c.to=f;this.scrollAnims.push(b=new p(c));b.scrollView=this;b.run()}else void 0!==b&&this.set("scrollLeft",b),void 0!==d&&this.set("scrollTop",d)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!e},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:n}},xclass:"scroll-view"})});
