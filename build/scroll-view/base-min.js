/*
Copyright 2014, KISSY v1.42
MIT Licensed
build time: Feb 27 14:34
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(i,j){var p=j("component/container"),q=j("component/extension/content-render"),f=i.Features,k=Math.floor,n,o=i.Features.isTransform3dSupported(),l={syncUI:function(){var d=this.control,a=d.el,b=d.contentEl,c=Math.max(b.offsetHeight,b.scrollHeight),b=Math.max(b.offsetWidth,b.scrollWidth);d.set({scrollHeight:c,scrollWidth:b,clientWidth:a.clientWidth,clientHeight:a.clientHeight})},_onSetScrollLeft:function(d){this.control.contentEl.style.left=
-d+"px"},_onSetScrollTop:function(d){this.control.contentEl.style.top=-d+"px"}};!1!==i.Features.getVendorCssPropPrefix("transform")&&(n=f.getVendorCssPropName("transform"),l._onSetScrollLeft=function(d){var a=this.control;a.contentEl.style[n]="translateX("+k(-d)+"px) translateY("+k(-a.get("scrollTop"))+"px)"+(o?" translateZ(0)":"")},l._onSetScrollTop=function(d){var a=this.control;a.contentEl.style[n]="translateX("+k(-a.get("scrollLeft"))+"px) translateY("+k(-d)+"px)"+(o?" translateZ(0)":"")});return p.getDefaultRender().extend([q],
l,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(i,j){function p(){var a=this.el,b=a.scrollTop,c=a.scrollLeft;b&&this.set("scrollTop",b+this.get("scrollTop"));c&&this.set("scrollLeft",c+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function q(a,b){a.scrollView.set(b.prop,b.val)}var f=j("node"),k=j("anim"),n=j("component/container"),o=j("./base/render"),l=i.all,d=f.KeyCode,f=i.buffer(function(){var a=this.$contentEl,b=this.get("scrollHeight"),c=this.get("scrollWidth"),
e=this.get("clientHeight"),m,d=this.get("clientWidth");this.scrollHeight=b;this.scrollWidth=c;this.clientHeight=e;this.clientWidth=d;m=this.allowScroll={};b>e&&(m.top=1);c>d&&(m.left=1);this.minScroll={left:0,top:0};var g,h;this.maxScroll={left:g=c-d,top:h=b-e};delete this.scrollStep;e=this.get("snap");b=this.get("scrollLeft");c=this.get("scrollTop");if(e){var f=a.offset(),a=this.pages="string"===typeof e?a.all(e):a.children(),e=this.get("pageIndex"),i=this.pagesOffset=[];a.each(function(a,b){var c=
a.offset(),e=c.left-f.left,c=c.top-f.top;e<=g&&c<=h&&(i[b]={left:e,top:c,index:b})});if(e){this.scrollToPage(e);return}}this.scrollToWithBounds({left:b,top:c});this.fire("reflow")});return n.extend({initializer:function(){this.scrollAnims=[]},bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",p,this)},_onSetClientHeight:f,_onSetClientWidth:f,_onSetScrollHeight:f,_onSetScrollWidth:f,handleKeyDownInternal:function(a){var b=l(a.target),c=b.nodeName();if(!("input"===c||
"textarea"===c||"select"===c||b.hasAttr("contenteditable"))){var a=a.keyCode,b=this.getScrollStep(),e,c=this.allowScroll.left;if(this.allowScroll.top){var m=b.top,f=this.clientHeight,g=this.get("scrollTop");a===d.DOWN?(this.scrollToWithBounds({top:g+m}),e=!0):a===d.UP?(this.scrollToWithBounds({top:g-m}),e=!0):a===d.PAGE_DOWN?(this.scrollToWithBounds({top:g+f}),e=!0):a===d.PAGE_UP&&(this.scrollToWithBounds({top:g-f}),e=!0)}c&&(b=b.left,c=this.get("scrollLeft"),a===d.RIGHT?(this.scrollToWithBounds({left:c+
b}),e=!0):a===d.LEFT&&(this.scrollToWithBounds({left:c-b}),e=!0));return e}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=l(this.get("el")[0].ownerDocument),b=this.clientHeight,c=this.clientWidth;return this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*c*c/a.width(),20)}},handleMouseWheel:function(a){if(!this.get("disabled")){var b,c,e=this.getScrollStep(),d,f=this.maxScroll,g=this.minScroll;if((d=a.deltaY)&&this.allowScroll.top){var h=this.get("scrollTop");
b=f.top;c=g.top;h<=c&&0<d||h>=b&&0>d||(this.scrollToWithBounds({top:h-a.deltaY*e.top}),a.preventDefault())}if((d=a.deltaX)&&this.allowScroll.left)h=this.get("scrollLeft"),b=f.left,c=g.left,h<=c&&0<d||h>=b&&0>d||(this.scrollToWithBounds({left:h-a.deltaX*e.left}),a.preventDefault())}},stopAnimation:function(){this.scrollAnims.length&&(i.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},
getPageIndexFromXY:function(a,b,c){var e=this.pagesOffset.concat([]),d=b?"left":"top";e.sort(function(a,b){return a[d]-b[d]});if(0<c)for(b=0;b<e.length;b++){if(c=e[b],c[d]>=a)return c.index}else for(b=e.length-1;0<=b;b--)if(c=e[b],c[d]<=a)return c.index},scrollToPage:function(a,b){var c;if((c=this.pagesOffset)&&c[a])this.set("pageIndex",a),this.scrollTo(c[a],b)},scrollToWithBounds:function(a,b){var c=this.maxScroll,e=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,e.left),c.left));a.top&&
(a.top=Math.min(Math.max(a.top,e.top),c.top));this.scrollTo(a,b)},scrollTo:function(a,b){var c=a.left,e=a.top;if(b){var d={},f={};void 0!==c&&(f.scrollLeft=c,d.scrollLeft=this.get("scrollLeft"));void 0!==e&&(f.scrollTop=e,d.scrollTop=this.get("scrollTop"));b.frame=q;b.node=d;b.to=f;this.scrollAnims.push(c=new k(b));c.scrollView=this;c.run()}else void 0!==c&&this.set("scrollLeft",c),void 0!==e&&this.set("scrollTop",e)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},scrollWidth:{},
scrollHeight:{},clientWidth:{},clientHeight:{},focusable:{value:!0},allowTextSelection:{value:!0},handleGestureEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:o}},xclass:"scroll-view"})});
