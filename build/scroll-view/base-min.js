/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Dec 2 15:24
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(k,i){var p=i("component/container"),q=i("component/extension/content-render"),o=k.Features,l,n={syncUI:function(){var a=this.control,f=a.el,e=a.contentEl,h=a.$contentEl,b=e.offsetHeight,e=e.offsetWidth,c=f.clientHeight,d=f.clientWidth;a.scrollHeight=b;a.scrollWidth=e;a.clientHeight=c;a.clientWidth=d;f=a.allowScroll={};b>c&&(f.top=1);e>d&&(f.left=1);a.minScroll={left:0,top:0};var r,g;a.maxScroll=
{left:r=e-d,top:g=b-c};delete a.scrollStep;c=a.get("snap");b=a.get("scrollLeft");e=a.get("scrollTop");if(c){var m=h.offset(),h=a.pages="string"===typeof c?h.all(c):h.children(),c=a.get("pageIndex"),j=a.pagesOffset=[];h.each(function(b,c){var d=b.offset(),a=d.left-m.left,d=d.top-m.top;a<=r&&d<=g&&(j[c]={left:a,top:d,index:c})});if(c){a.scrollToPage(c);return}}a.scrollToWithBounds({left:b,top:e})},_onSetScrollLeft:function(a){this.control.contentEl.style.left=-a+"px"},_onSetScrollTop:function(a){this.control.contentEl.style.top=
-a+"px"}};o.isTransformSupported()&&(l=o.getTransformProperty(),n._onSetScrollLeft=function(a){var f=this.control;f.contentEl.style[l]="translate3d("+-a+"px,"+-f.get("scrollTop")+"px,0)"},n._onSetScrollTop=function(a){var f=this.control;f.contentEl.style[l]="translate3d("+-f.get("scrollLeft")+"px,"+-a+"px,0)"});return p.getDefaultRender().extend([q],n,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(k,i){function p(){var b=this.el,c=b.scrollTop,d=b.scrollLeft;c&&this.set("scrollTop",c+this.get("scrollTop"));d&&this.set("scrollLeft",d+this.get("scrollLeft"));b.scrollTop=b.scrollLeft=0}function q(b,c){b.scrollView.set(c.prop,c.val)}var o=i("node"),l=i("anim"),n=i("component/container"),a=i("./base/render"),f=k.all,e=k.Features.isTouchEventSupported(),h=o.KeyCode;return n.extend({initializer:function(){this.scrollAnims=
[]},bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",p,this)},handleKeyDownInternal:function(b){var c=f(b.target),d=c.nodeName();if(!("input"===d||"textarea"===d||"select"===d||c.hasAttr("contenteditable"))){var b=b.keyCode,c=this.getScrollStep(),a,d=this.allowScroll.left;if(this.allowScroll.top){var g=c.top,m=this.clientHeight,j=this.get("scrollTop");b===h.DOWN?(this.scrollToWithBounds({top:j+g}),a=!0):b===h.UP?(this.scrollToWithBounds({top:j-g}),a=!0):b===h.PAGE_DOWN?
(this.scrollToWithBounds({top:j+m}),a=!0):b===h.PAGE_UP&&(this.scrollToWithBounds({top:j-m}),a=!0)}d&&(c=c.left,d=this.get("scrollLeft"),b===h.RIGHT?(this.scrollToWithBounds({left:d+c}),a=!0):b===h.LEFT&&(this.scrollToWithBounds({left:d-c}),a=!0));return a}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var b=f(this.get("el")[0].ownerDocument),c=this.clientHeight,d=this.clientWidth;return this.scrollStep={top:Math.max(0.7*c*c/b.height(),20),left:Math.max(0.7*d*d/b.width(),20)}},
handleMouseWheel:function(b){if(!this.get("disabled")){var c,d,a=this.getScrollStep(),g,f=this.maxScroll,h=this.minScroll;if((g=b.deltaY)&&this.allowScroll.top){var e=this.get("scrollTop");c=f.top;d=h.top;e<=d&&0<g||e>=c&&0>g||(this.scrollToWithBounds({top:e-b.deltaY*a.top}),b.preventDefault())}if((g=b.deltaX)&&this.allowScroll.left)e=this.get("scrollLeft"),c=f.left,d=h.left,e<=d&&0<g||e>=c&&0>g||(this.scrollToWithBounds({left:e-b.deltaX*a.left}),b.preventDefault())}},isAxisEnabled:function(b){return this.allowScroll["x"===
b?"left":"top"]},stopAnimation:function(){this.scrollAnims.length&&(k.each(this.scrollAnims,function(b){b.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(b){this.scrollToPage(b)},_getPageIndexFromXY:function(b,c,d){var a=this.pagesOffset.concat([]),g=c?"left":"top";a.sort(function(b,c){return b[g]-c[g]});if(0<d)for(c=0;c<a.length;c++){if(d=a[c],d[g]>=b)return d.index}else for(c=a.length-1;0<=c;c--)if(d=a[c],d[g]<=
b)return d.index},scrollToPage:function(b,c){var d;if((d=this.pagesOffset)&&d[b])this.set("pageIndex",b),this.scrollTo(d[b],c)},scrollToWithBounds:function(b,c){var d=this.maxScroll,a=this.minScroll;b.left&&(b.left=Math.min(Math.max(b.left,a.left),d.left));b.top&&(b.top=Math.min(Math.max(b.top,a.top),d.top));this.scrollTo(b,c)},scrollTo:function(b,c){var a=b.left,e=b.top;if(c){var g={},f={};void 0!==a&&(f.scrollLeft=a,g.scrollLeft=this.get("scrollLeft"));void 0!==e&&(f.scrollTop=e,g.scrollTop=this.get("scrollTop"));
c.frame=q;c.node=g;c.to=f;this.scrollAnims.push(a=new l(c));a.scrollView=this;a.run()}else void 0!==a&&this.set("scrollLeft",a),void 0!==e&&this.set("scrollTop",e)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!e},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:a}},xclass:"scroll-view"})});
