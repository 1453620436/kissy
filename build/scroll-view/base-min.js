/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 26 20:54
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(k,i){var p=i("component/container"),q=i("component/extension/content-render"),o=k.Features,l,n={syncUI:function(){var c=this.control,g=c.el,e=c.contentEl,h=c.$contentEl,a=e.offsetHeight,e=e.offsetWidth,b=g.clientHeight,d=g.clientWidth;c.scrollHeight=a;c.scrollWidth=e;c.clientHeight=b;c.clientWidth=d;g=c.allowScroll={};a>b&&(g.top=1);e>d&&(g.left=1);c.minScroll={left:0,top:0};var r,f;c.maxScroll=
{left:r=e-d,top:f=a-b};delete c.scrollStep;b=c.get("snap");a=c.get("scrollLeft");e=c.get("scrollTop");if(b){var m=h.offset(),h=c.pages="string"==typeof b?h.all(b):h.children(),b=c.get("pageIndex"),j=c.pagesOffset=[];h.each(function(a,b){var d=a.offset(),c=d.left-m.left,d=d.top-m.top;c<=r&&d<=f&&(j[b]={left:c,top:d,index:b})});if(b){c.scrollToPage(b);return}}c.scrollToWithBounds({left:a,top:e})},_onSetScrollLeft:function(c){this.control.contentEl.style.left=-c+"px"},_onSetScrollTop:function(c){this.control.contentEl.style.top=
-c+"px"}};o.isTransformSupported()&&(l=o.getTransformProperty(),n._onSetScrollLeft=function(c){var g=this.control;g.contentEl.style[l]="translate3d("+-c+"px,"+-g.get("scrollTop")+"px,0)"},n._onSetScrollTop=function(c){var g=this.control;g.contentEl.style[l]="translate3d("+-g.get("scrollLeft")+"px,"+-c+"px,0)"});return p.getDefaultRender().extend([q],n,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(k,i){function p(){var a=this.el,b=a.scrollTop,d=a.scrollLeft;b&&this.set("scrollTop",b+this.get("scrollTop"));d&&this.set("scrollLeft",d+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function q(a,b){a.scrollView.set(b.prop,b.val)}var o=i("node"),l=i("anim"),n=i("component/container"),c=i("./base/render"),g=k.all,e=k.Features.isTouchEventSupported(),h=o.KeyCode;return n.extend({initializer:function(){this.scrollAnims=
[]},bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",p,this)},handleKeyDownInternal:function(a){var b=g(a.target),d=b.nodeName();if(!("input"==d||"textarea"==d||"select"==d||b.hasAttr("contenteditable"))){var a=a.keyCode,d=this.getScrollStep(),b=void 0,c=this.allowScroll.left;if(this.allowScroll.top){var f=d.top,m=this.clientHeight,j=this.get("scrollTop");a==h.DOWN?(this.scrollToWithBounds({top:j+f}),b=!0):a==h.UP?(this.scrollToWithBounds({top:j-f}),b=!0):a==h.PAGE_DOWN?
(this.scrollToWithBounds({top:j+m}),b=!0):a==h.PAGE_UP&&(this.scrollToWithBounds({top:j-m}),b=!0)}c&&(d=d.left,c=this.get("scrollLeft"),a==h.RIGHT?(this.scrollToWithBounds({left:c+d}),b=!0):a==h.LEFT&&(this.scrollToWithBounds({left:c-d}),b=!0));return b}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=g(this.get("el")[0].ownerDocument),b=this.clientHeight,d=this.clientWidth;return this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*d*d/a.width(),20)}},
handleMouseWheel:function(a){if(!this.get("disabled")){var b,d,c=this.getScrollStep(),f,g=this.maxScroll,h=this.minScroll;if((f=a.deltaY)&&this.allowScroll.top){var e=this.get("scrollTop");b=g.top;d=h.top;e<=d&&0<f||e>=b&&0>f||(this.scrollToWithBounds({top:e-a.deltaY*c.top}),a.preventDefault())}if((f=a.deltaX)&&this.allowScroll.left)e=this.get("scrollLeft"),b=g.left,d=h.left,e<=d&&0<f||e>=b&&0>f||(this.scrollToWithBounds({left:e-a.deltaX*c.left}),a.preventDefault())}},isAxisEnabled:function(a){return this.allowScroll["x"==
a?"left":"top"]},stopAnimation:function(){this.scrollAnims.length&&(k.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,b,d){var c=this.pagesOffset.concat([]),f=b?"left":"top";c.sort(function(a,b){return a[f]-b[f]});if(0<d)for(b=0;b<c.length;b++){if(d=c[b],d[f]>=a)return d.index}else for(b=c.length-1;0<=b;b--)if(d=c[b],d[f]<=
a)return d.index},scrollToPage:function(a,b){var d;if((d=this.pagesOffset)&&d[a])this.set("pageIndex",a),this.scrollTo(d[a],b)},scrollToWithBounds:function(a,b){var d=this.maxScroll,c=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,c.left),d.left));a.top&&(a.top=Math.min(Math.max(a.top,c.top),d.top));this.scrollTo(a,b)},scrollTo:function(a,b){var d=a.left,c=a.top;if(b){var f={},e={};void 0!==d&&(e.scrollLeft=d,f.scrollLeft=this.get("scrollLeft"));void 0!==c&&(e.scrollTop=c,f.scrollTop=this.get("scrollTop"));
b.frame=q;b.node=f;b.to=e;this.scrollAnims.push(d=new l(b));d.scrollView=this;d.run()}else void 0!==d&&this.set("scrollLeft",d),void 0!==c&&this.set("scrollTop",c)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!e},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:c}},xclass:"scroll-view"})});
