/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 25 19:45
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(j,f){var o=f("component/container"),p=f("component/extension/content-render"),q=j.Feature,k=Math.floor,m,n=j.Feature.isTransform3dSupported(),l={syncUI:function(){var c=this.control,a=c.el,b=c.contentEl,d=c.$contentEl,g=Math.max(b.offsetHeight,b.scrollHeight),b=Math.max(b.offsetWidth,b.scrollWidth),e=a.clientHeight,i=a.clientWidth;c.scrollHeight=g;c.scrollWidth=b;c.clientHeight=e;c.clientWidth=
i;a=c.allowScroll={};g>e&&(a.top=1);b>i&&(a.left=1);c.minScroll={left:0,top:0};var h,r;c.maxScroll={left:h=b-i,top:r=g-e};delete c.scrollStep;e=c.get("snap");g=c.get("scrollLeft");b=c.get("scrollTop");if(e){var f=d.offset(),d=c.pages="string"===typeof e?d.all(e):d.children(),e=c.get("pageIndex"),j=c.pagesOffset=[];d.each(function(a,b){var d=a.offset(),c=d.left-f.left,d=d.top-f.top;c<=h&&d<=r&&(j[b]={left:c,top:d,index:b})});if(e){c.scrollToPage(e);return}}c.scrollToWithBounds({left:g,top:b})},_onSetScrollLeft:function(c){this.control.contentEl.style.left=
-c+"px"},_onSetScrollTop:function(c){this.control.contentEl.style.top=-c+"px"}};!1!==j.Feature.getVendorCssPropPrefix("transform")&&(m=q.getVendorCssPropName("transform"),l._onSetScrollLeft=function(c){var a=this.control;a.contentEl.style[m]="translateX("+k(-c)+"px) translateY("+k(-a.get("scrollTop"))+"px)"+(n?" translateZ(0)":"")},l._onSetScrollTop=function(c){var a=this.control;a.contentEl.style[m]="translateX("+k(-a.get("scrollLeft"))+"px) translateY("+k(-c)+"px)"+(n?" translateZ(0)":"")});return o.getDefaultRender().extend([p],
l,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(j,f){function o(){var a=this.el,b=a.scrollTop,d=a.scrollLeft;b&&this.set("scrollTop",b+this.get("scrollTop"));d&&this.set("scrollLeft",d+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function p(a,b){a.scrollView.set(b.prop,b.val)}var q=f("node"),k=f("anim"),m=f("component/container"),n=f("./base/render"),l=j.all,c=q.KeyCode;return m.extend({initializer:function(){this.scrollAnims=[]},bindUI:function(){this.$el.on("mousewheel",
this.handleMouseWheel,this).on("scroll",o,this)},handleKeyDownInternal:function(a){var b=l(a.target),d=b.nodeName();if(!("input"===d||"textarea"===d||"select"===d||b.hasAttr("contenteditable"))){var a=a.keyCode,b=this.getScrollStep(),g,d=this.allowScroll.left;if(this.allowScroll.top){var e=b.top,i=this.clientHeight,h=this.get("scrollTop");a===c.DOWN?(this.scrollToWithBounds({top:h+e}),g=!0):a===c.UP?(this.scrollToWithBounds({top:h-e}),g=!0):a===c.PAGE_DOWN?(this.scrollToWithBounds({top:h+i}),g=!0):
a===c.PAGE_UP&&(this.scrollToWithBounds({top:h-i}),g=!0)}d&&(b=b.left,d=this.get("scrollLeft"),a===c.RIGHT?(this.scrollToWithBounds({left:d+b}),g=!0):a===c.LEFT&&(this.scrollToWithBounds({left:d-b}),g=!0));return g}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=l(this.get("el")[0].ownerDocument),b=this.clientHeight,d=this.clientWidth;return this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*d*d/a.width(),20)}},handleMouseWheel:function(a){if(!this.get("disabled")){var b,
d,c=this.getScrollStep(),e,i=this.maxScroll,h=this.minScroll;if((e=a.deltaY)&&this.allowScroll.top){var f=this.get("scrollTop");b=i.top;d=h.top;f<=d&&0<e||f>=b&&0>e||(this.scrollToWithBounds({top:f-a.deltaY*c.top}),a.preventDefault())}if((e=a.deltaX)&&this.allowScroll.left)f=this.get("scrollLeft"),b=i.left,d=h.left,f<=d&&0<e||f>=b&&0>e||(this.scrollToWithBounds({left:f-a.deltaX*c.left}),a.preventDefault())}},isAxisEnabled:function(a){return this.allowScroll["x"===a?"left":"top"]},stopAnimation:function(){this.scrollAnims.length&&
(j.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,b,d){var c=this.pagesOffset.concat([]),e=b?"left":"top";c.sort(function(a,b){return a[e]-b[e]});if(0<d)for(b=0;b<c.length;b++){if(d=c[b],d[e]>=a)return d.index}else for(b=c.length-1;0<=b;b--)if(d=c[b],d[e]<=a)return d.index},scrollToPage:function(a,b){var d;if((d=this.pagesOffset)&&
d[a])this.set("pageIndex",a),this.scrollTo(d[a],b)},scrollToWithBounds:function(a,b){var d=this.maxScroll,c=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,c.left),d.left));a.top&&(a.top=Math.min(Math.max(a.top,c.top),d.top));this.scrollTo(a,b)},scrollTo:function(a,b){var d=a.left,c=a.top;if(b){var e={},f={};void 0!==d&&(f.scrollLeft=d,e.scrollLeft=this.get("scrollLeft"));void 0!==c&&(f.scrollTop=c,e.scrollTop=this.get("scrollTop"));b.frame=p;b.node=e;b.to=f;this.scrollAnims.push(d=new k(b));
d.scrollView=this;d.run()}else void 0!==d&&this.set("scrollLeft",d),void 0!==c&&this.set("scrollTop",c)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!0},allowTextSelection:{value:!0},handleGestureEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:n}},xclass:"scroll-view"})});
