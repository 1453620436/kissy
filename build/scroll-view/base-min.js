/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 13 12:29
*/
KISSY.add("scroll-view/base/render",["component/container","component/extension/content-render"],function(g,j){var p=j("component/container"),q=j("component/extension/content-render"),r=g.Feature,k=Math.floor,m,o=g.Feature.isTransform3dSupported(),l={syncUI:function(){var c=this.control,e=c.el,a=c.contentEl,d=c.$contentEl,b=a.offsetHeight,a=a.offsetWidth,f=e.clientHeight,s=e.clientWidth;c.scrollHeight=b;c.scrollWidth=a;c.clientHeight=f;c.clientWidth=s;e=c.allowScroll={};b>f&&(e.top=1);a>s&&(e.left=
1);c.minScroll={left:0,top:0};var n,h;c.maxScroll={left:n=a-s,top:h=b-f};delete c.scrollStep;f=c.get("snap");b=c.get("scrollLeft");a=c.get("scrollTop");if(f){var i=d.offset(),d=c.pages="string"===typeof f?d.all(f):d.children(),f=c.get("pageIndex"),g=c.pagesOffset=[];d.each(function(a,d){var b=a.offset(),f=b.left-i.left,b=b.top-i.top;f<=n&&b<=h&&(g[d]={left:f,top:b,index:d})});if(f){c.scrollToPage(f);return}}c.scrollToWithBounds({left:b,top:a})},_onSetScrollLeft:function(c){this.control.contentEl.style.left=
-c+"px"},_onSetScrollTop:function(c){this.control.contentEl.style.top=-c+"px"}};!1!==g.Feature.getVendorCssPropPrefix("transform")&&(m=r.getVendorCssPropName("transform"),l._onSetScrollLeft=function(c){var e=this.control;e.contentEl.style[m]="translateX("+k(-c)+"px) translateY("+k(-e.get("scrollTop"))+"px)"+(o?" translateZ(0)":"")},l._onSetScrollTop=function(c){var e=this.control;e.contentEl.style[m]="translateX("+k(-e.get("scrollLeft"))+"px) translateY("+k(-c)+"px)"+(o?" translateZ(0)":"")});return p.getDefaultRender().extend([q],
l,{name:"ScrollViewRender"})});
KISSY.add("scroll-view/base",["node","anim","component/container","./base/render"],function(g,j){function p(){var a=this.el,d=a.scrollTop,b=a.scrollLeft;d&&this.set("scrollTop",d+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0}function q(a,d){a.scrollView.set(d.prop,d.val)}var r=j("node"),k=j("anim"),m=j("component/container"),o=j("./base/render"),l=g.all,c=g.Feature.isTouchEventSupported(),e=r.KeyCode;return m.extend({initializer:function(){this.scrollAnims=[]},
bindUI:function(){this.$el.on("mousewheel",this.handleMouseWheel,this).on("scroll",p,this)},handleKeyDownInternal:function(a){var d=l(a.target),b=d.nodeName();if(!("input"===b||"textarea"===b||"select"===b||d.hasAttr("contenteditable"))){var a=a.keyCode,d=this.getScrollStep(),f,b=this.allowScroll.left;if(this.allowScroll.top){var c=d.top,n=this.clientHeight,h=this.get("scrollTop");a===e.DOWN?(this.scrollToWithBounds({top:h+c}),f=!0):a===e.UP?(this.scrollToWithBounds({top:h-c}),f=!0):a===e.PAGE_DOWN?
(this.scrollToWithBounds({top:h+n}),f=!0):a===e.PAGE_UP&&(this.scrollToWithBounds({top:h-n}),f=!0)}b&&(d=d.left,b=this.get("scrollLeft"),a===e.RIGHT?(this.scrollToWithBounds({left:b+d}),f=!0):a===e.LEFT&&(this.scrollToWithBounds({left:b-d}),f=!0));return f}},getScrollStep:function(){if(this.scrollStep)return this.scrollStep;var a=l(this.get("el")[0].ownerDocument),d=this.clientHeight,b=this.clientWidth;return this.scrollStep={top:Math.max(0.7*d*d/a.height(),20),left:Math.max(0.7*b*b/a.width(),20)}},
handleMouseWheel:function(a){if(!this.get("disabled")){var d,b,f=this.getScrollStep(),c,e=this.maxScroll,h=this.minScroll;if((c=a.deltaY)&&this.allowScroll.top){var i=this.get("scrollTop");d=e.top;b=h.top;i<=b&&0<c||i>=d&&0>c||(this.scrollToWithBounds({top:i-a.deltaY*f.top}),a.preventDefault())}if((c=a.deltaX)&&this.allowScroll.left)i=this.get("scrollLeft"),d=e.left,b=h.left,i<=b&&0<c||i>=d&&0>c||(this.scrollToWithBounds({left:i-a.deltaX*f.left}),a.preventDefault())}},isAxisEnabled:function(a){return this.allowScroll["x"===
a?"left":"top"]},stopAnimation:function(){this.scrollAnims.length&&(g.each(this.scrollAnims,function(a){a.stop()}),this.scrollAnims=[]);this.scrollToWithBounds({left:this.get("scrollLeft"),top:this.get("scrollTop")})},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,d,b){var c=this.pagesOffset.concat([]),e=d?"left":"top";c.sort(function(a,b){return a[e]-b[e]});if(0<b)for(d=0;d<c.length;d++){if(b=c[d],b[e]>=a)return b.index}else for(d=c.length-1;0<=d;d--)if(b=c[d],b[e]<=
a)return b.index},scrollToPage:function(a,d){var b;if((b=this.pagesOffset)&&b[a])this.set("pageIndex",a),this.scrollTo(b[a],d)},scrollToWithBounds:function(a,d){var b=this.maxScroll,c=this.minScroll;a.left&&(a.left=Math.min(Math.max(a.left,c.left),b.left));a.top&&(a.top=Math.min(Math.max(a.top,c.top),b.top));this.scrollTo(a,d)},scrollTo:function(a,d){var b=a.left,c=a.top;if(d){var e={},g={};void 0!==b&&(g.scrollLeft=b,e.scrollLeft=this.get("scrollLeft"));void 0!==c&&(g.scrollTop=c,e.scrollTop=this.get("scrollTop"));
d.frame=q;d.node=e;d.to=g;this.scrollAnims.push(b=new k(d));b.scrollView=this;b.run()}else void 0!==b&&this.set("scrollLeft",b),void 0!==c&&this.set("scrollTop",c)}},{ATTRS:{contentEl:{},scrollLeft:{view:1,value:0},scrollTop:{view:1,value:0},focusable:{value:!c},allowTextSelection:{value:!0},handleGestureEvents:{value:!1},snap:{value:!1},pageIndex:{value:0},xrender:{value:o}},xclass:"scroll-view"})});
