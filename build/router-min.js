/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 4 11:40
*/
KISSY.add("router/utils",["event/dom"],function(g,c){function a(b){return b.replace(/__ks-vid=.+$/,"")}function i(b){var a;return(a=b.match(/__ks-vid=(.+)$/))?parseInt(a[1],10):0}var o=c("event/dom");return{endWithSlash:function(b){return g.endsWith(b,"/")},startWithSlash:function(b){return g.startsWith(b,"/")},removeEndSlash:function(b){this.endWithSlash(b)&&(b=b.substring(0,b.length-1));return b},removeStartSlash:function(b){this.startWithSlash(b)&&(b=b.substring(1));return b},addEndSlash:function(b){return this.removeEndSlash(b)+
"/"},addStartSlash:function(b){return b?"/"+this.removeStartSlash(b):b},getFullPath:function(b,a){return location.protocol+"//"+location.host+this.removeEndSlash(a)+this.addStartSlash(b)},equalsIgnoreSlash:function(b,a){b=this.removeEndSlash(b);a=this.removeEndSlash(a);return b===a},getHash:function(b){return a(b.getFragment().replace(/^!/,"")).replace(o.REPLACE_HISTORY,"")},removeVid:a,hasVid:function(b){return-1!==b.indexOf("__ks-vid=")},addVid:function(b,a){return b+"__ks-vid="+a},getVidFromUrlWithHash:function(b){return i((new g.Uri(b)).getFragment())},
getVidFromHash:i}});
KISSY.add("router/route",[],function(g){function c(a){var b=[],a=g.escapeRegExp(a),a=a.replace(i,function(a,o,c,i,k){a={};c&&g.endsWith(c,"?")&&(a.optional=!0,c=c.slice(0,-1));a.name=c||k;b.push(a);if(c)return"([^/]+)";if(k)return"(.*)"});return{keys:b,regexp:RegExp("^"+a+"$")}}function a(a,b){this.path=a;this.callbacks=b;"string"===typeof a?g.mix(this,c(a)):this.regexp=a}var i=/(:([\w\d]+\??))|(\\\*([\w\d]+))/g;a.prototype={match:function(a){a=a.match(this.regexp);if(!a)return!1;for(var b=this.keys||
[],c=[],h=1,i=a.length;h<i;++h){var t=b[h-1],k="string"===typeof a[h]?g.urlDecode(a[h]):a[h];t?c[t.name]=k:c.push(k)}return c},removeCallback:function(a){for(var b=this.callbacks||[],c=b.length-1;0<=c;c++)b===a&&b.splice(c,1)}};return a});KISSY.add("router/request",[],function(g){function c(a){g.mix(this,a)}c.prototype={param:function(a){return a in this.params?this.params[a]:this.query[a]}};return c});
KISSY.add("router","./router/utils,./router/route,uri,./router/request,event/dom,event/custom".split(","),function(g,c,a){function i(d,a){var b=e.addVid("#!"+d+(A?"":a?u.REPLACE_HISTORY:""),m);a?location.replace(b):location.hash=b}function o(d){d=d||location.href;d=new B(d);if(!n&&j){var a=d.query;return d.getPath().substr(p.length)+(a.has()?"?"+a.toString():"")}return e.getHash(d)}function b(d,a,b){function c(){f++;if(f===h)b(d,a);else{var e=r[f];if(g.startsWith(d.path+"/",e[0]+"/")){var i=e[0].length;
d.url=d.url.slice(i);var j=d.path;d.path=d.path.slice(i);e[1](d,c);d.url=d.originalUrl;d.path=j}else c()}}var f=-1,h=r.length;c()}function z(d,a){function b(){c++;if(c!==g){var e=f[c];if(d.params=e.match(d.path)){var h=-1,i=e.callbacks,j=i.length,k=function(c){if(c==="route"){k=null;b()}else{h++;if(h!==j){d.route=e;i[h](d,a,k)}}};k("")}else b()}}var c=-1,g=f.length;b()}function h(d,c){var q=o(),e=new g.Uri(q),h=e.query.get();e.query.reset();q=new C({query:h,backward:d===true,replace:c===true,forward:d===
false&&c===false,path:e.toString()||"/",url:q,originalUrl:q});e={redirect:a.navigate};a.fire("dispatch",{request:q,response:e});b(q,e,z)}function x(d){var a=false,b=false;if(d===l[l.length-2]){a=true;l.pop()}else d!==l[l.length-1]?l.push(d):b=true;h(a,b)}function t(a){(a=a.originalEvent.state)&&x(a.vid)}function k(a){(a=y(a.newURL||location.href))&&x(a)}var r=[],f=[],e=c("./router/utils"),D=c("./router/route"),B=c("uri"),C=c("./router/request"),u=c("event/dom"),c=c("event/custom"),w=false,n,p,y=e.getVidFromUrlWithHash,
v=g.Env.host,s=v.history,A=g.Feature.isHashChangeSupported(),j=!(!s||!s.pushState),m=10,l=[m];g.mix(a,c.Target);a.use=function(a,b){if(typeof a!=="string"){b=a;a=""}r.push([a,b])};a.navigate=function(a,b){var b=b||{},c=b.replace||false;if(o()!==a){if(!c){m++;l.push(m)}if(!n&&j){s[c?"replaceState":"pushState"]({vid:m},"",e.getFullPath(a,p));h(false,c)}else if(j){s[c?"replaceState":"pushState"]({vid:m},"","#!"+a);h(false,c)}else i(a,c)}else b&&b.triggerRoute&&h(false,true)};a.get=function(a){var b=
g.makeArray(arguments).slice(1);f.push(new D(a,b))};a.matchRoute=function(a){for(var b=0,c=f.length;b<c;b++)if(f[b].match(a))return f[b];return false};a.removeRoute=function(a,b){for(var c=f.length-1;c>=0;c--){var e=f[c];if(e.path===a)if(b){e.removeCallback(b);e.callbacks.length||f.splice(c,1)}else f.splice(c,1)}};a.clearRoutes=function(){r=[];f=[]};a.hasRoute=function(a){for(var b=0,c=f.length;b<c;b++)if(f[b].path===a)return f[b];return false};a.start=function(b){b=b||{};if(w)return b.success&&b.success.call(a);
b.urlRoot=(b.urlRoot||"").replace(/\/$/,"");n=b.useHash;p=b.urlRoot;n===void 0&&(n=true);b.useHashChange&&(j=false);var c=location.pathname,f=location.href,l=o(),r=location.hash.match(/#!.+/);if(!n)if(j){if(r&&e.equalsIgnoreSlash(c,p)){s.replaceState({},"",e.getFullPath(l,p));b.triggerRoute=1}}else if(e.equalsIgnoreSlash(c,p))n=true;else{location.replace(e.addEndSlash(p)+"#!"+l);return}setTimeout(function(){var c=j;if(j)u.on(v,"popstate",t);else{u.on(v,"hashchange",k);b.triggerRoute=1}if(n)if(o())if(!j&&
y(f)!==m){i(e.getHash(new g.Uri(f)),true);b.triggerRoute=0}else j&&e.hasVid(f)&&location.replace(f=e.removeVid(f));else{a.navigate("/",{replace:1});b.triggerRoute=0;c=false}c&&s.replaceState({vid:m},"",f);b.triggerRoute&&h(false,true);b.success&&b.success()},100);w=true;return a};a.Utils=e;a.stop=function(){w=false;u.detach(v,"hashchange",k);u.detach(v,"popstate",t)}});
