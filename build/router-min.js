/*
Copyright 2013, KISSY v1.50
MIT Licensed
build time: Dec 24 17:53
*/
KISSY.add("router/utils",[],function(d){return{endWithSlash:function(a){return d.endsWith(a,"/")},startWithSlash:function(a){return d.startsWith(a,"/")},removeEndSlash:function(a){this.endWithSlash(a)&&(a=a.substring(0,a.length-1));return a},removeStartSlash:function(a){this.startWithSlash(a)&&(a=a.substring(1));return a},addEndSlash:function(a){return this.removeEndSlash(a)+"/"},addStartSlash:function(a){return a?"/"+this.removeStartSlash(a):a},getFullPath:function(a,b){return location.protocol+
"//"+location.host+this.removeEndSlash(b)+this.addStartSlash(a)},equalsIgnoreSlash:function(a,b){a=this.removeEndSlash(a);b=this.removeEndSlash(b);return a===b},getHash:function(a){return a.getFragment().replace(/^!/,"")}}});
KISSY.add("router/route",[],function(d){function a(a){var b=[],a=d.escapeRegExp(a),a=a.replace(g,function(a,r,c,f,l){a={};c&&d.endsWith(c,"?")&&(a.optional=!0,c=c.slice(0,-1));a.name=c||l;b.push(a);if(c)return"([^/]+)";if(l)return"(.*)"});return{keys:b,regexp:RegExp("^"+a+"$")}}function b(b,g){this.path=b;this.callbacks=g;"string"===typeof b?d.mix(this,a(b)):this.regexp=b}var g=/(:([\w\d]+\??))|(\\\*([\w\d]+))/g;b.prototype={match:function(a){a=a.match(this.regexp);if(!a)return!1;for(var b=this.keys||
[],h=[],i=1,c=a.length;i<c;++i){var f=b[i-1],g="string"===typeof a[i]?d.urlDecode(a[i]):a[i];f?h[f.name]=g:h.push(g)}return h}};return b});KISSY.add("router/request",[],function(d){function a(a){d.mix(this,a)}a.prototype={param:function(a){return a in this.params?this.params[a]:this.query[a]}};return a});
KISSY.add("router",["./router/utils","./router/route","uri","./router/request","event/dom"],function(d,a,b){function g(a){a=a||location.href;a=new t(a);if(k&&m){var e=a.query;return a.getPath().substr(j.length)+(e.has()?"?"+e.toString():"")}return f.getHash(a)}function r(a,e,b){function c(){g++;if(g===h)b(a,e);else{var f=i[g];if(d.startsWith(a.path+"/",f[0]+"/")){var j=f[0].length;a.url=a.url.slice(j);var k=a.path;a.path=a.path.slice(j);f[1](a,c);a.url=a.originalUrl;a.path=k}else c()}}var g=-1,h=
i.length;c()}function s(a,e){function b(){d++;if(d!==g){var f=c[d];if(a.params=f.match(a.path)){var h=-1,i=f.callbacks,j=i.length,k=function(c){if("route"===c)k=null,b();else if(h++,h!==j)i[h](a,e,k)};k("")}else b()}}var d=-1,g=c.length;b()}function h(){var a=g(),e=new d.Uri(a),c=e.query.get();e.query.reset();a=new u({query:c,path:e.toString()||"/",url:a,originalUrl:a});r(a,{redirect:b.navigate},s)}var i=[],c=[],f=a("./router/utils"),l=a("./router/route"),t=a("uri"),u=a("./router/request"),n=a("event/dom"),
q=!1,k,j,o=d.Env.host,p=o.history,v=d.Features.isHashChangeSupported(),m=!(!p||!p.pushState);b.use=function(a,e){"string"!==typeof a&&(e=a,a="");i.push([a,e])};b.navigate=function(a,e){var e=e||{},b=e.replaceHistory,c;g()!==a?k&&m?(p[b?"replaceState":"pushState"]({},"",f.getFullPath(a,j)),h()):(c="#!"+a,b?location.replace(c+(v?"":n.REPLACE_HISTORY)):location.hash=c):e&&e.triggerRoute&&h()};b.get=function(a){var b=d.makeArray(arguments).slice(1);c.push(new l(a,b))};b.matchRoute=function(a){for(var b=
0,d=c.length;b<d;b++)if(c[b].match(a))return c[b];return!1};b.removeRoute=function(a){for(var b=c.length-1;0<=b;b--)c[b].path===a&&c.splice(b,1)};b.clearRoutes=function(){i=[];c=[]};b.hasRoute=function(a){for(var b=0,d=c.length;b<d;b++)if(c[b].path===a)return c[b];return!1};b.start=function(a){a=a||{};if(q)return a.success&&a.success.call(b);a.urlRoot=(a.urlRoot||"").replace(/\/$/,"");k=a.useNativeHistory;j=a.urlRoot;var c=location.pathname,d=g(),i=location.hash.match(/#!.+/);if(k)if(m)i&&(f.equalsIgnoreSlash(c,
j)?(p.replaceState({},"",f.getFullPath(d,j)),a.triggerRoute=1):"router: location path must be same with urlRoot!");else if(!f.equalsIgnoreSlash(c,j)){location.replace(f.addEndSlash(j)+"#!"+d);return}setTimeout(function(){if(k&&m)n.on(o,"popstate",h);else n.on(o,"hashchange",h),a.triggerRoute=1;a.triggerRoute&&h();a.success&&a.success()},100);q=!0;return b};b.stop=function(){q=!1;n.detach(o,"popstate hashchange",h)}});
