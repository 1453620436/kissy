/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 12 14:44
*/
KISSY.add("html-parser/dtd",function(a){var a=a.merge,d={isindex:1,fieldset:1},e={input:1,button:1,select:1,textarea:1,label:1},m=a({a:1},e),b=a({iframe:1},m),c={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},o={ins:1,del:1,script:1,style:1},p=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},o),j=a({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},p),q=a({p:1},j),e=a({iframe:1},j,e),j={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},h=a({a:1},e),i={tr:1},k={"#text":1},f=a({param:1},j),g=a({form:1},d,b,c,q),n={li:1},l={base:1,link:1,meta:1,title:1},v=a(l,{style:1,script:1}),s={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},a={$nonBodyContent:a({html:1},s,l),$block:r,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:h,$body:a({script:1,style:1},
r),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:v,style:k,body:g,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:g,td:g,br:{},th:g,center:g,kbd:h,button:a(q,c),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:n,h1:h,h3:h,option:k,h2:h,form:a(d,b,c,q),select:{optgroup:1,option:1},font:h,ins:h,menu:n,abbr:h,label:h,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:h,script:k,tfoot:i,cite:h,
li:g,input:{},iframe:g,strong:h,textarea:k,noframes:g,big:h,small:h,span:h,hr:{},dt:h,sub:h,optgroup:{option:1},param:{},bdo:h,"var":h,div:g,object:f,sup:h,dd:g,strike:h,area:{},dir:n,map:a({area:1,form:1,p:1},d,o,c),applet:f,dl:{dt:1,dd:1},del:h,isindex:{},fieldset:a({legend:1},j),thead:i,ul:n,acronym:h,b:h,a:e,blockquote:g,caption:h,i:h,u:h,tbody:i,s:h,address:a(b,q),tt:h,legend:h,q:h,pre:a(p,m),p:h,em:h,dfn:h},m="article,figure,nav,aside,section,footer".split(","),t;for(t in a)for(var u in a[t])if("div"===
u)for(d=0;d<m.length;d++)a[t][m[d]]=a[t][u];for(d=0;d<m.length;d++)a[m[d]]=a.div;a.$empty["!doctype"]=1;return a});KISSY.add("html-parser/lexer/cursor",function(){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},clone:function(){var d=new a;d.position=this.position;return d},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("html-parser/lexer/index",function(){function a(){this.lineCursors=[]}function d(a,b){for(var c=0;c<a.length;c++)if(a[c].position===b.position)return c;return-1}function e(a,b){for(var c=0;c<a.length&&!(a[c].position>b.position);c++);return c}a.prototype={constructor:a,add:function(a){-1===d(this.lineCursors,a)&&this.lineCursors.splice(e(this.lineCursors,a),0,a)},remove:function(a){var b=this.lineCursors,a=d(this.lineCursors,a);-1!==a&&b.splice(a,1)},row:function(a){for(var b=this.lineCursors,
c=0;c<b.length;c++)if(b[c].position>a.position)return c-1;return c},col:function(a){var b=0,c;if(c=this.lineCursors[this.row(a)-1])b=c.position;return a.position-b}};return a});
KISSY.add("html-parser/lexer/page",function(a,d){function e(a){this.source=a;this.lineIndex=new d}e.prototype={constructor:e,getChar:function(a){var b=this.source,c=a.position;if(c>=b.length)return-1;var e=b.charAt(c);a.advance();"\r"===e&&(e="\n",c=a.position,"\n"===b.charAt(c)&&a.advance());"\n"===e&&this.lineIndex.add(a.clone());return e},ungetChar:function(a){var b=this.source;a.retreat();var c=a.position,e=b.charAt(c);"\n"===e&&0!==c&&(e=b.charAt(c-1),"\r"===e&&a.retreat())},getText:function(a,
b){return this.source.slice(a,b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return e},{requires:["./index"]});
KISSY.add("html-parser/nodes/node",function(){function a(a){var d=0;a.replace(/\n/g,function(){d++});return d}function d(a,d,b){this.parentNode=null;this.page=a;this.startPosition=d;this.endPosition=b;this.nextSibling=this.previousSibling=this.nodeName=null}d.prototype={constructor:d,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=a(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=a(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");a.push(this.toHtml());return a.join("")}};return d});
KISSY.add("html-parser/nodes/text",function(a,d){function e(a){"string"==typeof a?(this.nodeValue=a,e.superclass.constructor.apply(this,[null,-1,-1])):(e.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}a.extend(e,d,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onText(this)))c&&this!==c?c.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:e.superclass.toHtml.apply(this,arguments)}});return e},
{requires:["./node"]});KISSY.add("html-parser/nodes/cdata",function(a,d){function e(){e.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}a.extend(e,d,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onCData(this)))c&&this!==c?c.writeHtml(a,b):a.cdata(this.toHtml())}});return e},{requires:["./text"]});
KISSY.add("html-parser/utils",function(){return{isBooleanAttribute:function(a){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(a)},collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!==a&&"'"!==a&&">"!==a&&"<"!==a&&"/"!==a&&"="!==a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("html-parser/nodes/attribute",function(a){function d(a,d,b,c){this.nodeType=2;this.name=a;this.assignMent=d;this.value=b;this.quote=c}a.augment(d,{clone:function(){var e=new d;a.mix(e,this);return e},equals:function(a){return this.name==a.name&&this.value==a.value&&this.nodeType==a.nodeType}});d.prototype.clone=function(){var e=new d;a.mix(e,this);return e};return d});
KISSY.add("html-parser/nodes/tag",function(a,d,e,m){function b(j,b,h){j.nodeName=j.tagName=b.toLowerCase();j._updateSelfClosed();a.each(h,function(a,h){j.setAttribute(h,a)})}function c(j,q,h,i){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=i||[];this.nodeType=1;if("string"==typeof j)b.apply(null,[this].concat(a.makeArray(arguments)));else{c.superclass.constructor.apply(this,arguments);i=this.attributes;i[0]&&(this.nodeName=i[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),i.splice(0,1));var k=i[i.length-1];if(k=!(!k||!/\/$/.test(k.name)))i.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||k}this.closedEndPosition=this.closedStartPosition=-1}function o(a){var b=a.childNodes;a.firstChild=b[0];a.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=a);if(1<b.length){for(var h=0;h<b.length-1;h++)b[h].nextSibling=b[h+1],b[h+1].previousSibling=b[h],b[h+1].parentNode=a;b[b.length-1].nextSibling=
null}}function p(a,b){if(a&&a.length)for(var h=0;h<a.length;h++)if(a[h].name==b)return a[h];return null}a.extend(c,d,{_updateSelfClosed:function(){this.isSelfClosed=!!m.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new c,e=[];a.each(this.attributes,function(a){e.push(a.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,attributes:e,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,
isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!==a.nodeName||this.nodeType!==a.nodeType||this.attributes.length!==a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},
appendChild:function(a){this.childNodes.push(a);o(this)},replace:function(b){var c=b.parentNode.childNodes,h=a.indexOf(b,c);c[h]=this;o(b.parentNode)},replaceChild:function(b,c){var h=this.childNodes,i=a.indexOf(c,h);h[i]=b;o(this)},prepend:function(a){this.childNodes.unshift(a);o(this)},insertBefore:function(b){var c=b.parentNode.childNodes,h=a.indexOf(b,c);c.splice(h,0,this);o(b.parentNode)},insertAfter:function(b){var c=b.parentNode.childNodes,h=a.indexOf(b,c);h==c.length-1?b.parentNode.appendChild(this):
this.insertBefore(b.parentNode.childNodes[[h+1]])},empty:function(){this.childNodes=[];o(this)},removeChild:function(b){var c=b.parentNode.childNodes,h=a.indexOf(b,c);c.splice(h,1);o(b.parentNode)},getAttribute:function(a){return(a=p(this.attributes,a))&&a.value},setAttribute:function(a,b){var h=p(this.attributes,a);h?h.value=b:this.attributes.push(new e(a,"=",b,'"'))},removeAttribute:function(b){(b=p(this.attributes,b))&&this.attributes.splice(a.indexOf(b,this.attributes),1)},filterChildren:function(){var b=
this;if(!b.isChildrenFiltered){var c=new (a.require("html-parser/writer/basic"));b._writeChildrenHTML(c);c=(new (a.require("html-parser/parser"))(c.getHtml())).parse().childNodes;b.empty();a.each(c,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHtml:function(a,b){var h=this,i;i=h.tagName;if("!doctype"==i)a.append(this.toHtml()+"\n");else{h.__filter=b;h.isChildrenFiltered=0;if(b){if(!(i=b.onTagName(i)))return;h.tagName=i;i=b.onTag(h);if(!1===i)return;i&&(h=i);if(1!==h.nodeType){h.writeHtml(a,
b);return}if(!h.tagName){h._writeChildrenHTML(a);return}}a.openTag(h);for(var c=h.attributes,f=0;f<c.length;f++){var g=c[f];i=g.name;if(b){if(!(i=b.onAttributeName(i,h)))continue;g.name=i;if(!1===b.onAttribute(g,h))continue}a.attribute(g,h)}a.openTagClose(h);h.isSelfClosed||(h._writeChildrenHTML(a),a.closeTag(h))}},_writeChildrenHTML:function(b){var c=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHtml(b,c)})}});return c},{requires:["./node","./attribute","../dtd"]});
KISSY.add("html-parser/nodes/comment",function(a,d){function e(){e.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}a.extend(e,d,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onComment(this)))c&&this!==c?c.writeHtml(a,b):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=d.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return e},{requires:["./text"]});
KISSY.add("html-parser/lexer/lexer",function(a,d,e,m,b,c,o,p,j){function q(a,b){this.page=new e(a);this.cursor=new d;this.nodeFactory=this;this.cfg=b||{}}q.prototype={constructor:q,setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},nextNode:function(a){var b,k,f=this.cursor,g=this.page;b=f.position;k=g.getChar(f);switch(k){case -1:a=null;break;case "<":k=g.getChar(f);-1==k?a=this.makeString(b,f.position):"/"==k||c.isLetter(k)?(g.ungetChar(f),a=this.parseTag(b)):
"!"==k||"?"==k?(k=g.getChar(f),-1==k?a=this.makeString(b,f.position):">"==k?a=this.makeComment(b,f.position):(g.ungetChar(f),"-"==k?a=this.parseComment(b,a):(g.ungetChar(f),a=this.parseTag(b)))):(g.ungetChar(f),a=this.parseString(b,a));break;default:g.ungetChar(f),a=this.parseString(b,a)}return a},makeComment:function(a,b){var c;c=b-a;if(0!==c){if(2>c)return this.makeString(a,b);c=this.nodeFactory.createCommentNode(this.page,a,b)}else c=null;return c},makeString:function(a,b){var c=null;0<b-a&&(c=
this.nodeFactory.createStringNode(this.page,a,b));return c},makeCData:function(a,b){var c=null;0<b-a&&(c=this.nodeFactory.createCDataNode(this.page,a,b));return c},makeTag:function(a,b,c){var f;f=b-a;if(0!==f){if(2>f)return this.makeString(a,b);a=this.nodeFactory.createTagNode(this.page,a,b,c)}else a=null;return a},createTagNode:function(a,b,c,f){return new p(a,b,c,f)},createStringNode:function(a,b,c){return new m(a,b,c)},createCDataNode:function(a,c,k){return new b(a,c,k)},createCommentNode:function(a,
b,c){return new j(a,b,c)},parseTag:function(b){var i,k=[],f=[],g,n=this.cfg.strict,l=a.noop,j=this.page,e=0,d=this.cursor;n&&(l=function(){if(n&&-1===g&&f.length)throw Error(f[0].name+" syntax error at row "+(j.row(d)+1)+" , col "+(j.col(d)+1));});for(k[0]=d.position;!i;){k[e+1]=d.position;g=j.getChar(d);switch(e){case 0:if(-1==g||">"==g||"<"==g)"<"==g&&(j.ungetChar(d),k[e+1]=d.position),i=!0;else if("/"==g||c.isValidAttributeNameStartChar(g))e=1;break;case 1:-1==g||">"==g||"<"==g?("<"==g&&(j.ungetChar(d),
k[e+1]=d.getPosition),this.standalone(f,k),i=!0):c.isWhitespace(g)?(k[6]=k[2],e=6):"="==g&&(e=2);break;case 2:-1==g||">"==g?(this.standalone(f,k),i=!0):"'"==g?(e=4,k[4]=k[3]):'"'==g?(e=5,k[5]=k[3]):c.isWhitespace(g)||(e=3);break;case 3:-1==g||">"==g?(this.naked(f,k),i=!0):c.isWhitespace(g)&&(this.naked(f,k),k[0]=k[4],e=0);break;case 4:-1==g?(this.single_quote(f,k),i=!0):"'"==g&&(this.single_quote(f,k),k[0]=k[5]+1,e=0);break;case 5:-1==g?(this.double_quote(f,k),i=!0):'"'==g&&(this.double_quote(f,k),
k[0]=k[6]+1,e=0);break;case 6:-1==g?(this.standalone(f,k),k[0]=k[6],j.ungetChar(d),e=0):c.isWhitespace(g)||("="==g?(k[2]=k[6],k[3]=k[7],e=2):(this.standalone(f,k),k[0]=k[6],j.ungetChar(d),e=0));break;default:throw Error("how ** did we get in state "+e);}l()}return this.makeTag(b,d.position,f)},parseComment:function(a,b){var j,f,g=this.page,n=this.cursor,l;j=!1;for(l=0;!j;)if(f=g.getChar(n),-1==f)j=!0;else switch(l){case 0:">"==f&&(j=!0);if("-"==f)l=1;else return this.parseString(a,b);break;case 1:if("-"==
f)f=g.getChar(n),-1==f?j=!0:">"==f?j=!0:(g.ungetChar(n),l=2);else return this.parseString(a,b);break;case 2:if("-"==f)l=3;else if(-1==f)return this.parseString(a,b);break;case 3:l="-"==f?4:2;break;case 4:">"==f?j=!0:c.isWhitespace(f)||(l=2);break;default:throw Error("how ** did we get in state "+l);}return this.makeComment(a,n.position)},parseString:function(a,b){for(var j=0,f,g=this.page,n=this.cursor,l=0;!j;)if(f=g.getChar(n),-1==f)j=1;else if(b&&0==l&&("'"==f||'"'==f))l=f;else if(b&&0!==l&&"\\"===
f)f=g.getChar(n),-1!==f&&"\\"!==f&&f!==l&&g.ungetChar(n);else if(b&&f==l)l=0;else if(b&&0==l&&"/"==f)if(f=g.getChar(n),-1==f)j=1;else if("/"==f){do f=g.getChar(n);while(-1!==f&&"\n"!==f)}else if("*"==f){do{do f=g.getChar(n);while(-1!==f&&"*"!==f);f=g.getChar(n);"*"==f&&g.ungetChar(n)}while(-1!==f&&"/"!==f)}else g.ungetChar(n);else if(0==l&&"<"==f)if(f=g.getChar(n),-1==f)j=1;else{if("/"==f||c.isLetter(f)||"!"==f||"?"==f)j=1,g.ungetChar(n);g.ungetChar(n)}return this.makeString(a,n.position)},parseCDATA:function(a,
b){var j,f,g,n,l,e,d=this.cursor,o=this.page;j=d.position;f=0;g=!1;n="";for(e=!1;!g;)switch(l=o.getChar(d),f){case 0:switch(l){case -1:g=!0;break;case "'":a&&!e&&(""==n?n="'":"'"==n&&(n=""));break;case '"':a&&!e&&(""==n?n='"':'"'==n&&(n=""));break;case "\\":a&&""!==n&&(l=o.getChar(d),-1==l?g=!0:"\\"!==l&&l!==n&&o.ungetChar(d));break;case "/":if(a&&""==n)if(l=o.getChar(d),-1==l)g=!0;else if("/"==l)e=!0;else if("*"==l){do{do l=o.getChar(d);while(-1!==l&&"*"!==l);l=o.getChar(d);"*"==l&&o.ungetChar(d)}while(-1!==
l&&"/"!==l)}else o.ungetChar(d);break;case "\n":e=!1;break;case "<":a?""==n&&(f=1):f=1}break;case 1:switch(l){case -1:g=!0;break;case "/":f=!b||o.getText(d.position,d.position+b.length)===b&&!o.getText(d.position+b.length,d.position+b.length+1).match(/\w/)?2:0;break;case "!":l=o.getChar(d);-1==l?g=!0:"-"==l?(l=o.getChar(d),-1==l?g=!0:f="-"==l?3:0):f=0;break;default:f=0}break;case 2:e=!1;-1==l?g=!0:c.isLetter(l)?(g=!0,o.ungetChar(d),o.ungetChar(d),o.ungetChar(d)):f=0;break;case 3:e=!1;-1==l?g=!0:"-"==
l&&(l=o.getChar(d),-1==l?g=!0:"-"==l?(l=o.getChar(d),-1==l?g=!0:">"==l?f=0:(o.ungetChar(d),o.ungetChar(d))):o.ungetChar(d));break;default:throw Error("unexpected "+f);}return this.makeCData(j,d.position)},single_quote:function(a,b){var c=this.page;a.push(new o(c.getText(b[1],b[2]),"=",c.getText(b[4]+1,b[5]),"'"))},double_quote:function(a,b){var c=this.page;a.push(new o(c.getText(b[1],b[2]),"=",c.getText(b[5]+1,b[6]),'"'))},standalone:function(a,b){a.push(new o(this.page.getText(b[1],b[2])))},naked:function(a,
b){var c=this.page;a.push(new o(c.getText(b[1],b[2]),"=",c.getText(b[3],b[4])))}};return q},{requires:"./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(",")});KISSY.add("html-parser/nodes/fragment",function(a,d){function e(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}a.extend(e,d,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});return e},{requires:["./tag"]});
KISSY.add("html-parser/nodes/document",function(a,d){function e(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}a.extend(e,d,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});return e},{requires:["./tag"]});KISSY.add("html-parser/scanners/special-scanners",function(){return{}});
KISSY.add("html-parser/scanners/tag-scanner",function(a,d,e,m){function b(j,p){function h(){f.childNodes.length&&(f.insertAfter(g),g=f,f=j.clone())}j.closed=1;if(!p.fixByDtd)return 0;var i=1,k=[].concat(j.childNodes);a.each(k,function(a){if(!c(j,a))return i=0,!1});if(i)return 0;for(var f=j.clone(),g=j,n=[],l=0;l<k.length;l++){var m=k[l];if(c(f,m))f.appendChild(m);else if(1===m.nodeType){var s=m.tagName;if(d.$listItem[s]){h();var m=o[m.tagName],r=new e;for(r.nodeName=r.tagName=m;l<k.length;){if(k[l].tagName==
s)r.appendChild(k[l]);else if((3!=k[l].nodeType||a.trim(k[l].toHtml()))&&3==k[l].nodeType)break;l++}r.insertAfter(g);g=r;l--}else h(),m.equals(f)?(m.insertAfter(g),g=m):c(m,f)?(f=j.clone(),a.each(m.childNodes,function(a){f.appendChild(a)}),m.empty(),m.insertAfter(g),g=m,m.appendChild(f),n.push(f),f=j.clone()):(m.insertAfter(g),g=m)}}f.childNodes.length&&f.insertAfter(g);j.parentNode.removeChild(j);a.each(n,function(a){b(a,p)});return 1}function c(a,b){if(9==a.nodeType)return 1;d[a.tagName]||"dtd["+
a.tagName+"] === undefined!";return 8==b.nodeType?1:!!d[a.tagName][b.tagName||b.nodeName]}var o={li:"ul",dt:"dl",dd:"dl"},p={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,c,d){function e(f,c){for(g=f;g>c;g--){var l=n[g];n[g-1].appendChild(l);b(l,d)}a=n[c];n.length=c}function o(a){var b=0,f;if(f=p[a.tagName]){for(var c=n.length-1,g=n[c];g&&!(g.tagName in f);){if(g.tagName==a.tagName){b=1;break}c--;g=n[c]}b&&e(n.length-1,c-1)}return b}var f,g,n;n=d.stack=
d.stack||[];do{if(f=c.nextNode())if(1===f.nodeType)if(f.isEndTag()&&f.tagName==a.tagName)f=null;else if(f.isEndTag()){if(f.isEndTag()){var l=-1;for(g=n.length-1;0<=g;g--)if(n[g].tagName===f.tagName){l=g;break}-1!==l&&(n[n.length-1].appendChild(a),b(a,d),e(n.length-1,l),f=null)}}else m[f.tagName]?(m[f.tagName].scan(f,c,d),a.appendChild(f)):f.isSelfClosed?a.appendChild(f):(n.push(a),o(f)&&n.push(a),a=f);else a.appendChild(f);null==f&&0<n.length&&(f=n[n.length-1],m[f.tagName]?f=null:(n.length-=1,f.appendChild(a),
b(a,d),a=f))}while(f);b(a,d)}}},{requires:["../dtd","../nodes/tag","./special-scanners"]});KISSY.add("html-parser/scanners/cdata-scanner",function(){return{scan:function(a,d,e){var e=d.parseCDATA(e.quoteSmart,a.nodeName),m=d.getPosition(),b=d.nextNode();b&&(1!==b.nodeType||!(b.isEndTag()&&b.tagName==a.tagName))&&d.setPosition(m);a.closed=!0;e&&a.appendChild(e)}}});
KISSY.add("html-parser/scanners/quote-cdata-scanner",function(a,d,e,m){var a={scan:function(a,b,e){e=e||{};e.quoteSmart=1;d.scan(a,b,e);e.quoteSmart=0}},b;for(b in e.$cdata)m[b]=a;return a},{requires:["./cdata-scanner","../dtd","./special-scanners"]});KISSY.add("html-parser/scanners/textarea-scanner",function(a,d,e){return e.textarea={scan:function(a,b,c){c=c||{};d.scan(a,b,c)}}},{requires:["./cdata-scanner","./special-scanners"]});
KISSY.add("html-parser/scanner",function(a,d,e){return{getScanner:function(a){return e[a]||d}}},{requires:["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"]});
KISSY.add("html-parser/parser",function(a,d,e,m,b,c,o,p){function j(b,g){this.originalHTML=b=a.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new c(b);this.opts=g||{}}function q(b){var c=i(b,"body",3);if(c){var b=c.parentNode,d=b.childNodes,e=a.indexOf(c,d);if(e!==d.length-1){d=d.slice(e+1,d.length);for(e=0;e<d.length;e++)b.removeChild(d[e]),"body"===d[e].tagName?a.each(d[e].childNodes,function(a){c.appendChild(a)}):c.appendChild(d[e])}}return c}
function h(a){var b=a.childNodes,c,h,j=d.p,o=0;for(h=0;h<b.length;h++)if(c=b[h],3==c.nodeType||1==c.nodeType&&j[c.nodeName]){o=1;break}if(o){var o=[],i=new e;i.nodeName=i.tagName="p";for(h=0;h<b.length;h++)c=b[h],3==c.nodeType||1==c.nodeType&&j[c.nodeName]?i.appendChild(c):(i.childNodes.length&&(o.push(i),i=i.clone()),o.push(c));i.childNodes.length&&o.push(i);a.empty();for(h=0;h<o.length;h++)a.appendChild(o[h])}}function i(a,b,c){if(0===c)return 0;"number"===typeof c&&c--;var d=a.childNodes;if(d)for(var e=
0;e<d.length;e++){if(d[e].tagName===b)return d[e];if(a=i(d[e],b,c))return a}return 0}function k(b){for(var c=[].concat(b.childNodes),d=0;d<c.length;d++)if("html"==c[d].nodeName){for(var e=c[d],h=0;h<d;h++)3==c[h].nodeType&&!a.trim(c[h].toHtml())&&b.removeChild(c[h]);for(;e.firstChild&&3==e.firstChild.nodeType&&!a.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}j.prototype={constructor:j,elements:function(){var b,c,d=this.lexer,e=this.opts;c=b=d.nextNode();"document"!==b.tagName&&(c=
new o,c.appendChild(b));c.nodeType=9;p.getScanner("div").scan(b,d,e);(b=q(c))&&e.autoParagraph&&h(b);k(c);var e=this.originalHTML,j=new m;c=/^(<!doctype|<html|<body)/i.test(e)?c.childNodes:b.childNodes;a.each(c,function(a){j.appendChild(a)});return j},parse:function(){return this.elements()}};return j},{requires:"./dtd,./nodes/tag,./nodes/fragment,./lexer/cursor,./lexer/lexer,./nodes/document,./scanner".split(",")});
KISSY.add("html-parser/writer/basic",function(a,d){function e(){this.output=[]}var m=d.isBooleanAttribute;e.prototype={constructor:e,append:function(){for(var a=this.output,c=arguments,d,e=0;e<c.length;e++)if(d=c[e],1<d.length)for(var j=0;j<d.length;j++)a.push(d.charAt(j));else a.push(d);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,">")},attribute:function(a){var c=
a.value||"",a=a.name;m(a)&&!c&&(c=a);this.append(" ",a,'="',(""+c).replace(/"/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return e},{requires:["../utils"]});
KISSY.add("html-parser/writer/beautify",function(a,d,e,m){function b(){b.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var c in a.merge(e.$nonBodyContent,e.$block,e.$listItem,e.$tableContent,{select:1,script:1,style:1}))this.setRules(c,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}a.extend(b,d,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(b,d){this.rules[b]||(this.rules[b]=
{});a.mix(this.rules[b],d)},openTag:function(a){var d=this.rules[a.tagName]||{};this.allowIndent?this.indentation():d.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,d=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),d.allowIndent&&this.indentLevel++);d.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var d=a.tagName,e=this.rules[d]||{};e.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():e.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===d&&(this.inPre=0);e.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=m.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return b},{requires:["./basic",
"../dtd","../utils"]});
KISSY.add("html-parser/writer/minify",function(a,d,e){function m(){m.superclass.constructor.apply(this,arguments);this.inPre=0}var b=a.trim,c=e.isBooleanAttribute,o=e.collapseWhitespace,p=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(m,d,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),m.superclass.comment.call(this,a))},
openTag:function(a){"pre"==a.tagName&&(this.inPre=1);m.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);m.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=b(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");m.superclass.cdata.call(this,a)},attribute:function(a,d){var e=a.name,i,k=a.value||"";i=a.name;if(!(i=
!b(a.value||"")?"input"===d&&"value"===i||p.test(i):0)){i=d.nodeName;var f=a.name,g=a.value||"",g=b(g.toLowerCase());i="script"===i&&"language"===f&&"javascript"===g||"form"===i&&"method"===f&&"get"===g||"input"===i&&"type"===f&&"text"===g||"script"===i&&"type"===f&&"text/javascript"===g||"style"===i&&"type"===f&&"text/css"===g||"area"===i&&"shape"===f&&"rect"===g}if(!i)if(c(e))this.append(" ",e);else{i=d.nodeName;f=a.name;g=a.value||"";/^on[a-z]+/.test(f)?g=b(g).replace(/^javascript:[\s\xa0]*/i,
"").replace(/[\s\xa0]*;$/,""):"class"===f?g=o(b(g)):/^(?:a|area|link|base)$/.test(i)&&"href"===f||"img"===i&&/^(?:src|longdesc|usemap)$/.test(f)||"object"===i&&/^(?:classid|codebase|data|usemap)$/.test(f)||"q"===i&&"cite"===f||"blockquote"===i&&"cite"===f||("ins"===i||"del"===i)&&"cite"===f||"form"===i&&"action"===f||"input"===i&&("src"===f||"usemap"===f)||"head"===i&&"profile"===f||"script"===i&&("src"===f||"for"===f)||/^(?:a|area|object|button)$/.test(i)&&"tabindex"===f||"input"===i&&("maxlength"===
f||"tabindex"===f)||"select"===i&&("size"===f||"tabindex"===f)||"textarea"===i&&/^(?:rows|cols|tabindex)$/.test(f)||"colgroup"===i&&"span"===f||"col"===i&&"span"===f||("th"===i||"td"==i)&&("rowspan"===f||"colspan"===f)?g=b(g):"style"===f&&(g=b(g).replace(/[\s\xa0]*;[\s\xa0]*$/,""));i=(""+g).replace(/"/g,"&quote;");if(!k||/[ "'=<>`]/.test(k))i='"'+i+'"';this.append(" ",e,"=",i)}},text:function(a){this.inPre||(a=o(a));this.append(a)}});return m},{requires:["./basic","../utils"]});
KISSY.add("html-parser/writer/filter",function(a){function d(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function e(b,c){for(var d=0;b&&d<b.length;d++)a.each(b[d].value,function(a){c=c.replace(a[0],a[1])});return c}function m(a,c,d){var e,j;for(j=0;a&&j<a.length;j++){e=a[j].value;if(!1===(e=e.apply(null,c)))return!1;if(d&&e&&e!==d){if("string"==typeof e){if(d.toHtml()===e)break;d.nodeValue=e;e=d}return this.onNode(e)}}return d}
d.prototype={constructor:d,addRules:function(a,c){var c=c||10,d;for(d in a){var e=this[d];if(e){var j;a:{for(j=0;e&&j<e.length;j++)if(e[j].priority>c)break a;j=e.length}e.splice(j,0,{value:a[d],priority:c})}}},onTagName:function(a){return e(this.tagNames,a)},onAttributeName:function(a){return e(this.attributeNames,a)},onText:function(a){return m.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return m.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,c){var d;a:{d=this.attributes;
for(var e=0;d&&e<d.length;e++){var j=d[e].value,m,h=a.name;if(j[h]&&!1===(m=j[h].call(null,a.value,c))){d=m;break a}"string"==typeof m&&(a.value=m)}d=a}return d},onComment:function(a){return m.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var c=a.nodeType;if(1===c)return this.onTag(a);if(3===c)return this.onText(a);if(8===c)return this.onComment(a)},onFragment:function(a){return m.call(this,this.root,[a],a)},onTag:function(a){for(var c=["^",a.tagName,"$"],d=this.tags,e,j=0;j<c.length;j++)for(var m=
c[j],h=0;h<d.length;h++)if(e=d[h].value,e[m]){if(!1===(e=e[m](a)))return!1;if(e&&e!==a)return this.onNode(e);if(!a.tagName)return a}return a}};return d});KISSY.add("html-parser",function(a,d,e,m,b,c,o,p,j,q,h,i,k){return{CData:j,Comment:q,Node:h,Tag:i,Text:k,Lexer:e,Parser:m,BasicWriter:b,BeautifyWriter:c,MinifyWriter:o,Filter:p,DTD:d,serialize:function(a,c){var d=new b;a.writeHtml(d,c);return d.getHtml()},parse:function(a){return(new m(a)).parse()}}},{requires:"html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(",")});
