/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Apr 4 12:23
*/
KISSY.add("html-parser/dtd",[],function(a,c,d,g){var a=a.merge,c={isindex:1,fieldset:1},b={input:1,button:1,select:1,textarea:1,label:1},d=a({a:1},b),j=a({iframe:1},d),e={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},o={ins:1,del:1,script:1,style:1},m=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},o),l=a({sub:1,img:1,
object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},m),q=a({p:1},l),b=a({iframe:1},l,b),l={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,
i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},k=a({a:1},b),n={tr:1},i={"#text":1},f=a({param:1},l),h=a({form:1},c,j,e,q),s={li:1},v={base:1,link:1,meta:1,title:1},p=a(v,{style:1,script:1}),t={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},g=g.exports={$nonBodyContent:a({html:1},t,v),$block:r,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:k,$body:a({script:1,
style:1},r),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,
object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:p,style:i,body:h,base:{},link:{},meta:{},title:i,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:h,td:h,br:{},th:h,center:h,kbd:k,button:a(q,e),basefont:{},h5:k,h4:k,samp:k,h6:k,ol:s,h1:k,h3:k,option:i,h2:k,form:a(c,j,e,q),select:{optgroup:1,option:1},font:k,ins:k,menu:s,abbr:k,label:k,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:k,script:i,tfoot:n,
cite:k,li:h,input:{},iframe:h,strong:k,textarea:i,noframes:h,big:k,small:k,span:k,hr:{},dt:k,sub:k,optgroup:{option:1},param:{},bdo:k,"var":k,div:h,object:f,sup:k,dd:h,strike:k,area:{},dir:s,map:a({area:1,form:1,p:1},c,o,e),applet:f,dl:{dt:1,dd:1},del:k,isindex:{},fieldset:a({legend:1},l),thead:n,ul:s,acronym:k,b:k,a:b,blockquote:h,caption:k,i:k,u:k,tbody:n,s:k,address:a(j,q),tt:k,legend:k,q:k,pre:a(m,d),p:k,em:k,dfn:k},c="article,figure,nav,aside,section,footer".split(","),u;for(u in g)for(var w in g[u])if("div"===
w)for(a=0;a<c.length;a++)g[u][c[a]]=g[u][w];for(a=0;a<c.length;a++)g[c[a]]=g.div});KISSY.add("html-parser/lexer/cursor",[],function(){function a(a){this.position=a||0}a.prototype={constructor:a,advance:function(){this.position++},clone:function(){var c=new a;c.position=this.position;return c},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("html-parser/lexer/index",[],function(){function a(){this.lineCursors=[]}a.prototype={constructor:a,add:function(a){var d;a:{d=this.lineCursors;for(var g=a.position,b=0;b<d.length;b++){var j=d[b].position;if(j===g){d=-1;break a}if(j>g)break}d=b}-1!==d&&this.lineCursors.splice(d,0,a.clone())},remove:function(a){var d=this.lineCursors,g;a:{g=this.lineCursors;for(var a=a.position,b=0;b<g.length;b++){var j=g[b].position;if(j===a){g=b;break a}if(j<a)break}g=-1}-1!==g&&d.splice(g,1)},row:function(a){for(var d=
this.lineCursors,g=0;g<d.length;g++)if(d[g].position>a.position)return g-1;return g},col:function(a){var d=0,g=this.lineCursors[this.row(a)-1];g&&(d=g.position);return a.position-d}};return a});
KISSY.add("html-parser/lexer/page",["./index"],function(a,c){function d(b){this.source=b;this.lineIndex=new g}var g=c("./index");d.prototype={constructor:d,getChar:function(b){var a=this.source,e=b.position;if(e>=a.length)return-1;var d=a.charAt(e);b.advance();"\r"===d&&(d="\n",e=b.position,"\n"===a.charAt(e)&&b.advance());"\n"===d&&this.lineIndex.add(b);return d},ungetChar:function(b){var a=this.source;b.retreat();var e=b.position,d=a.charAt(e);"\n"===d&&0!==e&&(d=a.charAt(e-1),"\r"===d&&b.retreat())},
getText:function(b,a){return this.source.slice(b,a)},row:function(b){return this.lineIndex.row(b)},col:function(b){return this.lineIndex.col(b)}};return d});
KISSY.add("html-parser/nodes/node",[],function(){function a(a){var c=0;a.replace(/\n/g,function(){c++});return c}function c(a,c,b){this.parentNode=null;this.page=a;this.startPosition=c;this.endPosition=b;this.nextSibling=this.previousSibling=this.nodeName=null}c.prototype={constructor:c,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=a(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=a(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");a.push(this.toHtml());return a.join("")}};return c});
KISSY.add("html-parser/nodes/text",["./node"],function(a,c){function d(b){"string"===typeof b?(this.nodeValue=b,d.superclass.constructor.apply(this,[null,-1,-1])):(d.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}var g=c("./node");a.extend(d,g,{writeHtml:function(b,a){var e;if(!a||!1!==(e=a.onText(this)))e&&this!==e?e.writeHtml(b,a):b.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:d.superclass.toHtml.apply(this,
arguments)}});return d});KISSY.add("html-parser/nodes/cdata",["./text"],function(a,c){function d(){d.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}var g=c("./text");a.extend(d,g,{writeHtml:function(a,d){var e;if(!d||!1!==(e=d.onCData(this)))e&&this!==e?e.writeHtml(a,d):a.cdata(this.toHtml())}});return d});
KISSY.add("html-parser/utils",[],function(){return{isBooleanAttribute:function(a){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(a)},collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!==a&&"'"!==a&&">"!==a&&a!==""<""&&"/"!==a&&"="!==a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("html-parser/nodes/attribute",[],function(a){function c(a,c,b,j){this.nodeType=2;this.name=a;this.assignment=c;this.value=b;this.quote=j}a.augment(c,{clone:function(){var d=new c;a.mix(d,this);return d},equals:function(a){return this.name===a.name&&this.value===a.value&&this.nodeType===a.nodeType}});c.prototype.clone=function(){var d=new c;a.mix(d,this);return d};return c});
KISSY.add("html-parser/nodes/tag",["./node","./attribute","../dtd"],function(a,c){function d(l,b,k){l.nodeName=l.tagName=b.toLowerCase();l._updateSelfClosed();a.each(k,function(k,a){l.setAttribute(a,k)})}function g(l,b,k,n){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=n||[];this.nodeType=1;if("string"===typeof l)d.apply(null,[this].concat(a.makeArray(arguments)));else{g.superclass.constructor.apply(this,arguments);n=this.attributes;n[0]&&(this.nodeName=n[0].name.toLowerCase(),
this.tagName=this.nodeName.replace(/\//,""),this._updateSelfClosed(),n.splice(0,1));var i=n[n.length-1];if(i=!(!i||!/\/$/.test(i.name)))n.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||i}this.closedEndPosition=this.closedStartPosition=-1}function b(a){var b=a.childNodes;a.firstChild=b[0];a.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=a);if(1<b.length){for(var k=0;k<b.length-1;k++)b[k].nextSibling=b[k+1],b[k+1].previousSibling=b[k],b[k+1].parentNode=
a;b[b.length-1].nextSibling=null}}function j(a,b){if(a&&a.length)for(var k=0;k<a.length;k++)if(a[k].name===b)return a[k];return null}var e=c("./node"),o=c("./attribute"),m=c("../dtd");a.extend(g,e,{_updateSelfClosed:function(){this.isSelfClosed=!!m.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new g,e=[];a.each(this.attributes,function(a){e.push(a.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,
attributes:e,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!==a.nodeName||this.nodeType!==a.nodeType||this.attributes.length!==a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;
return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(a){this.childNodes.push(a);b(this)},replace:function(l){var e=l.parentNode.childNodes,k=a.indexOf(l,e);e[k]=this;b(l.parentNode)},replaceChild:function(l,e){var k=this.childNodes,n=a.indexOf(e,k);k[n]=l;b(this)},prepend:function(a){this.childNodes.unshift(a);b(this)},insertBefore:function(l){var e=l.parentNode.childNodes,k=a.indexOf(l,e);e.splice(k,0,this);b(l.parentNode)},insertAfter:function(b){var e=b.parentNode.childNodes,
k=a.indexOf(b,e);k===e.length-1?b.parentNode.appendChild(this):this.insertBefore(b.parentNode.childNodes[[k+1]])},empty:function(){this.childNodes=[];b(this)},removeChild:function(l){var e=l.parentNode.childNodes,k=a.indexOf(l,e);e.splice(k,1);b(l.parentNode)},getAttribute:function(a){return(a=j(this.attributes,a))&&a.value},setAttribute:function(a,b){var k=j(this.attributes,a);k?k.value=b:this.attributes.push(new o(a,"=",b,'"'))},removeAttribute:function(b){(b=j(this.attributes,b))&&this.attributes.splice(a.indexOf(b,
this.attributes),1)},filterChildren:function(){var b=this;if(!b.isChildrenFiltered){var e=new (a.require("html-parser/writer/basic"));b._writeChildrenHTML(e);e=(new (a.require("html-parser/parser"))(e.getHtml())).parse().childNodes;b.empty();a.each(e,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHtml:function(a,b){var k=this,n;n=k.tagName;if("!doctype"===n)a.append(this.toHtml()+"\n");else{k.__filter=b;k.isChildrenFiltered=0;if(b){if(!(n=b.onTagName(n)))return;k.tagName=n;n=b.onTag(k);
if(!1===n)return;n&&(k=n);if(1!==k.nodeType){k.writeHtml(a,b);return}if(!k.tagName){k._writeChildrenHTML(a);return}}a.openTag(k);for(var i=k.attributes,f=0;f<i.length;f++){var h=i[f];n=h.name;if(b){if(!(n=b.onAttributeName(n,k)))continue;h.name=n;if(!1===b.onAttribute(h,k))continue}a.attribute(h,k)}a.openTagClose(k);k.isSelfClosed||(k._writeChildrenHTML(a),a.closeTag(k))}},_writeChildrenHTML:function(b){var e=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHtml(b,
e)})},outerHtml:function(){var b=new (a.require("html-parser/writer/basic"));this.writeHtml(b);return b.getHtml()}});return g});
KISSY.add("html-parser/nodes/comment",["./text"],function(a,c){function d(){d.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}var g=c("./text");a.extend(d,g,{writeHtml:function(b,a){var e;if(!a||!1!==(e=a.onComment(this)))e&&this!==e?e.writeHtml(b,a):b.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=g.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return d});
KISSY.add("html-parser/lexer/lexer","./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(","),function(a,c){function d(a,n){this.page=new b(a);this.cursor=new g;this.nodeFactory=this;this.cfg=n||{}}var g=c("./cursor"),b=c("./page"),j=c("../nodes/text"),e=c("../nodes/cdata"),o=c("../utils"),m=c("../nodes/attribute"),l=c("../nodes/tag"),q=c("../nodes/comment");d.prototype={constructor:d,setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},
nextNode:function(a){var b,i,f=this.cursor,h=this.page;b=f.position;i=h.getChar(f);switch(i){case -1:a=null;break;case "<":i=h.getChar(f);if(i===-1)a=this.makeString(b,f.position);else if(i==="/"||o.isLetter(i)){h.ungetChar(f);a=this.parseTag(b)}else if("!"===i||"?"===i){i=h.getChar(f);if(i===-1)a=this.makeString(b,f.position);else if(">"===i)a=this.makeComment(b,f.position);else{h.ungetChar(f);if("-"===i)a=this.parseComment(b,a);else{h.ungetChar(f);a=this.parseTag(b)}}}else{h.ungetChar(f);a=this.parseString(b,
a)}break;default:h.ungetChar(f);a=this.parseString(b,a)}return a},makeComment:function(a,b){var i;i=b-a;if(0!==i){if(2>i)return this.makeString(a,b);i=this.nodeFactory.createCommentNode(this.page,a,b)}else i=null;return i},makeString:function(a,b){var i=null;b-a>0&&(i=this.nodeFactory.createStringNode(this.page,a,b));return i},makeCData:function(a,b){var i=null;b-a>0&&(i=this.nodeFactory.createCDataNode(this.page,a,b));return i},makeTag:function(a,b,i){var f;f=b-a;if(0!==f){if(2>f)return this.makeString(a,
b);a=this.nodeFactory.createTagNode(this.page,a,b,i)}else a=null;return a},createTagNode:function(a,b,i,f){return new l(a,b,i,f)},createStringNode:function(a,b,i){return new j(a,b,i)},createCDataNode:function(a,b,i){return new e(a,b,i)},createCommentNode:function(a,b,i){return new q(a,b,i)},parseTag:function(b){var e,i=[],f=[],h,d=this.cfg.strict,c=a.noop,l=this.page,g=0,j=this.cursor;d&&(c=function(){if(d&&h===-1&&f.length)throw Error(f[0].name+" syntax error at row "+(l.row(j)+1)+" , col "+(l.col(j)+
1));});for(i[0]=j.position;!e;){i[g+1]=j.position;h=l.getChar(j);switch(g){case 0:if(h===-1||">"===h||"<"===h){if("<"===h){l.ungetChar(j);i[g+1]=j.position}e=true}else if(h==="/"||o.isValidAttributeNameStartChar(h))g=1;break;case 1:if(-1===h||">"===h||"<"===h){if("<"===h){l.ungetChar(j);i[g+1]=j.getPosition}this.standalone(f,i);e=true}else if(o.isWhitespace(h)){i[6]=i[2];g=6}else"="===h&&(g=2);break;case 2:if(-1===h||">"===h){this.standalone(f,i);e=true}else if("'"===h){g=4;i[4]=i[3]}else if('"'===
h){g=5;i[5]=i[3]}else o.isWhitespace(h)||(g=3);break;case 3:if(-1===h||">"===h){this.naked(f,i);e=true}else if(o.isWhitespace(h)){this.naked(f,i);i[0]=i[4];g=0}break;case 4:if(-1===h){this.singleQuote(f,i);e=true}else if("'"===h){this.singleQuote(f,i);i[0]=i[5]+1;g=0}break;case 5:if(-1===h){this.doubleQuote(f,i);e=true}else if('"'===h){this.doubleQuote(f,i);i[0]=i[6]+1;g=0}break;case 6:if(-1===h){this.standalone(f,i);i[0]=i[6];l.ungetChar(j);g=0}else if("="===h){i[2]=i[6];i[3]=i[7];g=2}else if(!o.isWhitespace(h)){this.standalone(f,
i);i[0]=i[6];l.ungetChar(j);g=0}break;default:throw Error("how ** did we get in state "+g);}c()}return this.makeTag(b,j.position,f)},parseComment:function(a,b){var i,f,h=this.page,e=this.cursor,d;i=false;for(d=0;!i;){f=h.getChar(e);if(-1===f)i=true;else switch(d){case 0:if(">"===f)i=true;else if("-"===f)d=1;else return this.parseString(a,b);break;case 1:if("-"===f){f=h.getChar(e);if(-1===f)i=true;else if(">"===f)i=true;else{h.ungetChar(e);d=2}}else return this.parseString(a,b);break;case 2:if("-"===
f)d=3;else if(-1===f)return this.parseString(a,b);break;case 3:d="-"===f?4:2;break;case 4:">"===f?i=true:o.isWhitespace(f)||(d=2);break;default:throw Error("how ** did we get in state "+d);}}return this.makeComment(a,e.position)},parseString:function(a,b){for(var i=0,f,h=this.page,e=this.cursor,d=0;!i;){f=h.getChar(e);if(-1===f)i=1;else if(b&&0===d&&('"'===f||"'"===f))d=f;else if(b&&0!==d&&"\\"===f){f=h.getChar(e);-1!==f&&"\\"!==f&&f!==d&&h.ungetChar(e)}else if(b&&f===d)d=0;else if(b&&0===d&&f===
"/"){f=h.getChar(e);if(-1===f)i=1;else if("/"===f){do f=h.getChar(e);while(-1!==f&&"\n"!==f)}else if("*"===f){do{do f=h.getChar(e);while(-1!==f&&"*"!==f);f=h.getChar(e);f==="*"&&h.ungetChar(e)}while(-1!==f&&"/"!==f)}else h.ungetChar(e)}else if(0===d&&"<"===f){f=h.getChar(e);if(-1===f)i=1;else{if("/"===f||o.isLetter(f)||"!"===f||"?"===f){i=1;h.ungetChar(e)}h.ungetChar(e)}}}return this.makeString(a,e.position)},parseCDATA:function(a,b){var e,f,h,d,c,l,g=this.cursor,j=this.page;e=g.position;f=0;h=false;
d="";for(l=false;!h;){c=j.getChar(g);switch(f){case 0:switch(c){case -1:h=true;break;case "'":a&&!l&&(""===d?d="'":"'"===d&&(d=""));break;case '"':a&&!l&&(""===d?d='"':'"'===d&&(d=""));break;case "\\":if(a&&""!==d){c=j.getChar(g);-1===c?h=true:c!=="\\"&&c!==d&&j.ungetChar(g)}break;case "/":if(a&&""===d){c=j.getChar(g);if(-1===c)h=true;else if("/"===c)l=true;else if("*"===c){do{do c=j.getChar(g);while(-1!==c&&"*"!==c);c=j.getChar(g);c==="*"&&j.ungetChar(g)}while(-1!==c&&"/"!==c)}else j.ungetChar(g)}break;
case "\n":l=false;break;case "<":a?""===d&&(f=1):f=1}break;case 1:switch(c){case -1:h=true;break;case "/":f=!b||j.getText(g.position,g.position+b.length)===b&&!j.getText(g.position+b.length,g.position+b.length+1).match(/\w/)?2:0;break;case "!":c=j.getChar(g);if(-1===c)h=true;else if("-"===c){c=j.getChar(g);-1===c?h=true:f="-"===c?3:0}else f=0;break;default:f=0}break;case 2:l=false;if(-1===c)h=true;else if(o.isLetter(c)){h=true;j.ungetChar(g);j.ungetChar(g);j.ungetChar(g)}else f=0;break;case 3:l=false;
if(-1===c)h=true;else if("-"===c){c=j.getChar(g);if(-1===c)h=true;else if("-"===c){c=j.getChar(g);if(-1===c)h=true;else if(">"===c)f=0;else{j.ungetChar(g);j.ungetChar(g)}}else j.ungetChar(g)}break;default:throw Error("unexpected "+f);}}return this.makeCData(e,g.position)},singleQuote:function(a,b){var e=this.page;a.push(new m(e.getText(b[1],b[2]),"=",e.getText(b[4]+1,b[5]),"'"))},doubleQuote:function(a,b){var e=this.page;a.push(new m(e.getText(b[1],b[2]),"=",e.getText(b[5]+1,b[6]),'"'))},standalone:function(a,
b){a.push(new m(this.page.getText(b[1],b[2])))},naked:function(a,b){var e=this.page;a.push(new m(e.getText(b[1],b[2]),"=",e.getText(b[3],b[4])))}};return d});KISSY.add("html-parser/nodes/fragment",["./tag"],function(a,c){function d(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}var g=c("./tag");a.extend(d,g,{writeHtml:function(a,d){this.__filter=d;this.isChildrenFiltered=0;if(d)d.onFragment(this);this._writeChildrenHTML(a)}});return d});
KISSY.add("html-parser/nodes/document",["./tag"],function(a,c){function d(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}var g=c("./tag");a.extend(d,g,{writeHtml:function(a,d){this.__filter=d;this._writeChildrenHTML(a)}});return d});KISSY.add("html-parser/scanners/special-scanners",[],function(){return{}});
KISSY.add("html-parser/scanners/tag-scanner",["../dtd","../nodes/tag","./special-scanners"],function(a,c){function d(e,c){function k(){f.childNodes.length&&(f.insertAfter(h),h=f,f=e.clone())}e.closed=1;if(!c.fixByDtd)return 0;var n=1,i=[].concat(e.childNodes);a.each(i,function(a){if(!g(e,a))return n=0,!1});if(n)return 0;for(var f=e.clone(),h=e,s=[],m=0;m<i.length;m++){var p=i[m];if(g(f,p))f.appendChild(p);else if(1===p.nodeType){var t=p.tagName;if(b.$listItem[t]){k();var p=o[p.tagName],r=new j;for(r.nodeName=
r.tagName=p;m<i.length;){if(i[m].tagName===t)r.appendChild(i[m]);else if(3===i[m].nodeType&&a.trim(i[m].toHtml()))break;m++}r.insertAfter(h);h=r;m--}else k(),p.equals(f)?(p.insertAfter(h),h=p):g(p,f)?(f=e.clone(),a.each(p.childNodes,function(a){f.appendChild(a)}),p.empty(),p.insertAfter(h),h=p,p.appendChild(f),s.push(f),f=e.clone()):(p.insertAfter(h),h=p)}}f.childNodes.length&&f.insertAfter(h);e.parentNode.removeChild(e);a.each(s,function(a){d(a,c)});return 1}function g(a,e){return 9===a.nodeType||
8===e.nodeType?1:!!b[a.tagName][e.tagName||e.nodeName]}var b=c("../dtd"),j=c("../nodes/tag"),e=c("./special-scanners"),o={li:"ul",dt:"dl",dd:"dl"},m={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,b,c){function g(b,f){for(h=b;h>f;h--){var e=j[h];j[h-1].appendChild(e);d(e,c)}a=j[f];j.length=f}function i(a){var b=0,f;if(f=m[a.tagName]){for(var e=j.length-1,h=j[e];h&&!(h.tagName in f);){if(h.tagName===a.tagName){b=1;break}e--;h=j[e]}b&&g(j.length-1,e-
1)}return b}var f,h,j;j=c.stack=c.stack||[];do{if(f=b.nextNode())if(1===f.nodeType)if(f.isEndTag()&&f.tagName===a.tagName)f=null;else if(f.isEndTag()){if(f.isEndTag()){var o=-1;for(h=j.length-1;0<=h;h--)if(j[h].tagName===f.tagName){o=h;break}-1!==o&&(j[j.length-1].appendChild(a),d(a,c),g(j.length-1,o),f=null)}}else e[f.tagName]?(e[f.tagName].scan(f,b,c),a.appendChild(f)):f.isSelfClosed?a.appendChild(f):(j.push(a),i(f)&&j.push(a),a=f);else a.appendChild(f);null===f&&0<j.length&&(f=j[j.length-1],e[f.tagName]?
f=null:(j.length-=1,f.appendChild(a),d(a,c),a=f))}while(f);d(a,c)}}});KISSY.add("html-parser/scanners/cdata-scanner",[],function(){return{scan:function(a,c,d){var d=c.parseCDATA(d.quoteSmart,a.nodeName),g=c.getPosition(),b=c.nextNode();b&&(1!==b.nodeType||!(b.isEndTag()&&b.tagName===a.tagName))&&c.setPosition(g);a.closed=!0;d&&a.appendChild(d)}}});
KISSY.add("html-parser/scanners/quote-cdata-scanner",["./cdata-scanner","../dtd","./special-scanners"],function(a,c){var d=c("./cdata-scanner"),g=c("../dtd"),b=c("./special-scanners"),j={scan:function(a,b,e){e=e||{};e.quoteSmart=1;d.scan(a,b,e);e.quoteSmart=0}},e;for(e in g.$cdata)b[e]=j;return j});
KISSY.add("html-parser/scanners/textarea-scanner",["./cdata-scanner","./special-scanners"],function(a,c){var d=c("./cdata-scanner"),g=c("./special-scanners");g.textarea={scan:function(a,c,e){e=e||{};d.scan(a,c,e)}};return g.textarea});
KISSY.add("html-parser/scanner",["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"],function(a,c){var d=c("./scanners/tag-scanner"),g=c("./scanners/special-scanners");c("./scanners/quote-cdata-scanner");c("./scanners/textarea-scanner");return{getScanner:function(a){return g[a]||d}}});
KISSY.add("html-parser/parser","./dtd,./nodes/tag,./nodes/fragment,./lexer/lexer,./nodes/document,./scanner".split(","),function(a,c){function d(b,f){this.originalHTML=b=a.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new q(b);this.opts=f||{}}function g(b){var f=j(b,"body",3);if(f){var b=f.parentNode,e=b.childNodes,c=a.indexOf(f,e);if(c!==e.length-1){e=e.slice(c+1,e.length);for(c=0;c<e.length;c++){b.removeChild(e[c]);e[c].tagName==="body"?
a.each(e[c].childNodes,function(a){f.appendChild(a)}):f.appendChild(e[c])}}}return f}function b(a){var b=a.childNodes,e,c,d=o.p,g=0;for(c=0;c<b.length;c++){e=b[c];if(e.nodeType===3||e.nodeType===1&&d[e.nodeName]){g=1;break}}if(g){var g=[],j=new m;j.nodeName=j.tagName="p";for(c=0;c<b.length;c++){e=b[c];if(e.nodeType===3||e.nodeType===1&&d[e.nodeName])j.appendChild(e);else{if(j.childNodes.length){g.push(j);j=j.clone()}g.push(e)}}j.childNodes.length&&g.push(j);a.empty();for(c=0;c<g.length;c++)a.appendChild(g[c])}}
function j(a,b,e){if(e===0)return 0;typeof e==="number"&&e--;var c=a.childNodes;if(c)for(var d=0;d<c.length;d++){if(c[d].tagName===b)return c[d];if(a=j(c[d],b,e))return a}return 0}function e(b){for(var e=[].concat(b.childNodes),c=0;c<e.length;c++)if(e[c].nodeName==="html"){for(var d=e[c],g=0;g<c;g++)e[g].nodeType===3&&!a.trim(e[g].toHtml())&&b.removeChild(e[g]);for(;d.firstChild&&d.firstChild.nodeType===3&&!a.trim(d.firstChild.toHtml());)d.removeChild(d.firstChild);break}}var o=c("./dtd"),m=c("./nodes/tag"),
l=c("./nodes/fragment"),q=c("./lexer/lexer"),k=c("./nodes/document"),n=c("./scanner");d.prototype={constructor:d,elements:function(){var c,f,d=this.lexer,j=this.opts;f=c=d.nextNode();if(c.tagName!=="document"){f=new k;f.appendChild(c)}f.nodeType=9;n.getScanner("div").scan(c,d,j);(c=g(f))&&j.autoParagraph&&b(c);e(f);var j=this.originalHTML,o=new l;f=/^(<!doctype|<html|<body)/i.test(j)?f.childNodes:c.childNodes;a.each(f,function(a){o.appendChild(a)});return o},parse:function(){return this.elements()}};
return d});
KISSY.add("html-parser/writer/basic",["../utils"],function(a,c){function d(){this.output=[]}var g=c("../utils").isBooleanAttribute;d.prototype={constructor:d,append:function(){for(var a=this.output,c=arguments,e,d=0;d<c.length;d++)if(e=c[d],1<e.length)for(var g=0;g<e.length;g++)a.push(e.charAt(g));else a.push(e);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,
">")},attribute:function(a){var c=a.value||"",a=a.name;g(a)&&!c&&(c=a);this.append(" ",a,'="',(""+c).replace(/'/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return d});
KISSY.add("html-parser/writer/beautify",["./basic","../dtd","../utils"],function(a,c){function d(){var e=this;d.superclass.constructor.apply(e,arguments);e.inPre=0;e.indentChar="\t";e.indentLevel=0;e.allowIndent=0;e.rules={};var c=a.merge(b.$nonBodyContent,b.$block,b.$listItem,b.$tableContent,{select:1,script:1,style:1}),g;for(g in c)e.setRules(g,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});a.each("p,h1,h2,h3,h4,h5,h6".split(","),function(a){e.setRules(a,
{allowIndent:0,breakAfterOpen:0,breakBeforeClose:0})});e.setRules("option",{breakBeforeOpen:1});e.setRules("optiongroup",{breakBeforeOpen:1});e.setRules("br",{breakAfterOpen:1});e.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});e.setRules("pre",{breakAfterOpen:1,allowIndent:0})}var g=c("./basic"),b=c("../dtd"),j=c("../utils");a.extend(d,g,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=
this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(b,c){this.rules[b]||(this.rules[b]={});a.mix(this.rules[b],c)},openTag:function(a){var b=this.rules[a.tagName]||{};this.allowIndent?this.indentation():b.breakBeforeOpen&&(this.lineBreak(),this.indentation());d.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,c=this.rules[b]||{};a.isSelfClosed?this.append(" />"):
(this.append(">"),c.allowIndent&&this.indentLevel++);c.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var b=a.tagName,c=this.rules[b]||{};c.allowIndent&&this.indentLevel--;this.allowIndent?this.indentation():c.breakBeforeClose&&(this.lineBreak(),this.indentation());d.superclass.closeTag.apply(this,arguments);"pre"===b&&(this.inPre=0);c.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=j.collapseWhitespace(a));
this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return d});
KISSY.add("html-parser/writer/minify",["./basic","../utils"],function(a,c){function d(){d.superclass.constructor.apply(this,arguments);this.inPre=0}var g=c("./basic"),b=c("../utils"),j=a.trim,e=b.isBooleanAttribute,o=b.collapseWhitespace,m=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(d,g,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,
"$1"),d.superclass.comment.call(this,a))},openTag:function(a){"pre"===a.tagName&&(this.inPre=1);d.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"===a.tagName&&(this.inPre=0);d.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=j(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");d.superclass.cdata.call(this,a)},attribute:function(a,b){var c=
a.name,d,g=a.value||"";d=a.name;if(!(d=!j(a.value||"")?"input"===b&&"value"===d||m.test(d):0)){d=b.nodeName;var f=a.name,h=a.value||"",h=j(h.toLowerCase());d="script"===d&&"language"===f&&"javascript"===h||"form"===d&&"method"===f&&"get"===h||"input"===d&&"type"===f&&"text"===h||"script"===d&&"type"===f&&"text/javascript"===h||"style"===d&&"type"===f&&"text/css"===h||"area"===d&&"shape"===f&&"rect"===h}if(!d)if(e(c))this.append(" ",c);else{d=b.nodeName;f=a.name;h=a.value||"";/^on[a-z]+/.test(f)?h=
j(h).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===f?h=o(j(h)):/^(?:a|area|link|base)$/.test(d)&&"href"===f||"img"===d&&/^(?:src|longdesc|usemap)$/.test(f)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(f)||"q"===d&&"cite"===f||"blockquote"===d&&"cite"===f||("ins"===d||"del"===d)&&"cite"===f||"form"===d&&"action"===f||"input"===d&&("src"===f||"usemap"===f)||"head"===d&&"profile"===f||"script"===d&&("src"===f||"for"===f)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===
f||"input"===d&&("maxlength"===f||"tabindex"===f)||"select"===d&&("size"===f||"tabindex"===f)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(f)||"colgroup"===d&&"span"===f||"col"===d&&"span"===f||("th"===d||"td"===d)&&("rowspan"===f||"colspan"===f)?h=j(h):"style"===f&&(h=j(h).replace(/[\s\xa0]*;[\s\xa0]*$/,""));d=(""+h).replace(/"/g,"&quote;");if(!g||/[ "'=<>`]/.test(g))d='"'+d+'"';this.append(" ",c,"=",d)}},text:function(a){this.inPre||(a=o(a));this.append(a)}});return d});
KISSY.add("html-parser/writer/filter",[],function(a){function c(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function d(b,c){for(var e=0;b&&e<b.length;e++)a.each(b[e].value,function(a){c=c.replace(a[0],a[1])});return c}function g(a,c,e){var d,g;for(g=0;a&&g<a.length;g++){d=a[g].value;if(!1===(d=d.apply(null,c)))return!1;if(e&&d&&d!==e){if("string"===typeof d){if(e.toHtml()===d)break;e.nodeValue=d;d=e}return this.onNode(d)}}return e}
c.prototype={constructor:c,addRules:function(a,c){var c=c||10,d;for(d in a){var g=this[d];if(g){var m;a:{for(m=0;g&&m<g.length;m++)if(g[m].priority>c)break a;m=g.length}g.splice(m,0,{value:a[d],priority:c})}}},onTagName:function(a){return d(this.tagNames,a)},onAttributeName:function(a){return d(this.attributeNames,a)},onText:function(a){return g.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return g.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,c){var d;a:{d=this.attributes;
for(var g=0;d&&g<d.length;g++){var m=d[g].value,l,q=a.name;if(m[q]&&!1===(l=m[q].call(null,a.value,c))){d=l;break a}"string"===typeof l&&(a.value=l)}d=a}return d},onComment:function(a){return g.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var c=a.nodeType;if(1===c)return this.onTag(a);if(3===c)return this.onText(a);if(8===c)return this.onComment(a)},onFragment:function(a){return g.call(this,this.root,[a],a)},onTag:function(a){for(var c=["^",a.tagName,"$"],d=this.tags,g,m=0;m<c.length;m++)for(var l=
c[m],q=0;q<d.length;q++)if(g=d[q].value,g[l]){if(!1===(g=g[l](a)))return!1;if(g&&g!==a)return this.onNode(g);if(!a.tagName)return a}return a}};return c});
KISSY.add("html-parser","html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(","),function(a,c){var d=c("html-parser/dtd"),g=c("html-parser/lexer/lexer"),b=c("html-parser/parser"),j=c("html-parser/writer/basic"),e=c("html-parser/writer/beautify"),o=c("html-parser/writer/minify"),
m=c("html-parser/writer/filter"),l=c("html-parser/nodes/cdata"),q=c("html-parser/nodes/comment"),k=c("html-parser/nodes/node"),n=c("html-parser/nodes/tag"),i=c("html-parser/nodes/text");return{CData:l,Comment:q,Node:k,Tag:n,Text:i,Lexer:g,Parser:b,BasicWriter:j,BeautifyWriter:e,MinifyWriter:o,Filter:m,DTD:d,serialize:function(a,b){var c=new j;a.writeHtml(c,b);return c.getHtml()},parse:function(a){return(new b(a)).parse()}}});
