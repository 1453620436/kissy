/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 26 16:09
*/
KISSY.add("navigation-view/bar",["component/control","button","./bar/bar-xtpl"],function(q,m,r,p){function k(a){var b;b=a.clone(!0);b[0].id=a[0].id+"-proxy";a.parent().append(b);var e=a.offset();b.css("position","absolute");b.offset(e);b.css({width:a.css("width"),height:a.css("height")});return b}function d(a,b,e){a.animate(b,{duration:0.25,easing:"ease-in-out",complete:e})}function s(a,b,e,g){var c=a.get("el"),i=a.get("titleEl"),a=Math.min(c[0].offsetWidth/3,200),d=b[0].offsetWidth,b=c[0].offsetWidth,
c=i.offset().left-c.offset().left,i=i[0].offsetWidth,j=e.width,f;g?(e=-j,j=Math.min(c-j,a)):(j=-j,e=Math.min(c,a));a={element:{from:{transform:"translateX("+e+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+j+"px) translateZ(0)",opacity:0}}};d=-c+d;i>c&&(f=-c-i);g?(j=b-c-i,e=void 0!==f?f:d):(j=void 0!==f?f:d,e=Math.max(0,b-c-i));return{back:a,title:{element:{from:{transform:"translateX("+e+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+j+"px) translateZ(0)",opacity:0}}}}}function n(){this.fire("backward")}function h(){this.get("navigationView").pop()}function o(a){this.set("title",a.newView.get("title")||"")}function f(a){var b=a.newView,e=a.backward;if(a.oldView)this[e?"backward":"forward"](b.get("title")||"")}var q=m("component/control"),l=m("button"),m=m("./bar/bar-xtpl");p.exports=q.extend({initializer:function(){this._withTitle=this.get("withTitle");this._stack=[];this.publish("backward",
{defaultFn:h,defaultTargetOnly:!0})},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new l({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-backward",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},bindUI:function(){if(this._backBtn)this._backBtn.on("click",n,this);var a=this.get("navigationView");a.on("afterInnerViewChange",o,this);a.on("beforeInnerViewChange",f,this)},addButton:function(a,
b){var e=this.get("prefixCls");b.prefixCls=e+"navigation-bar-";!b.elBefore&&!b.render&&(e=b.align=b.align||"left","left"===e?b.elBefore=this.get("centerEl"):"right"===e&&(b.render=this.get("contentEl")),delete b.align);this._buttons[a]=(new l(b)).render();return this._buttons[a]},insertButtonBefore:function(a,b,e){b.elBefore=e.get("el");return this.addButton(a,b)},removeButton:function(a){this._buttons[a].destroy();delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this._stack.push(a);
this.go(a,!0)},go:function(a,b,e){var g=this,c=g._backBtn;if(!c||!g._withTitle){if(g._withTitle&&g.get("titleEl").html(a),c)c[b?"show":"hide"]()}else{var i=c.get("el");i.stop(!0);g.ghostBackEl&&g.ghostBackEl.stop(!0);var f={width:i[0].offsetWidth},j=k(i);g.ghostBackEl=j;i.css("opacity",0);c[b?"show":"hide"]();g.ghostBackEl&&g.ghostBackEl.stop(!0);b=s(g,i,f,e);i.css(b.back.element.from);c.get("visible")&&d(i,b.back.element.to);"none"!==j.css("display")?d(j,b.back.ghost.to,function(){j.remove();g.ghostBackEl=
null}):(j.remove(),g.ghostBackEl=null);c=g.get("titleEl");c.stop(!0);var h=k(c.parent());g.ghostTitleEl=h;c.css("opacity",0);g.set("title",a);c.css(b.title.element.from);d(c,b.title.element.to);d(h,b.title.ghost.to,function(){h.remove();g.ghostTitleEl=null})}},backward:function(a){this._stack.length&&(this._stack.pop(),this.go(a,this._stack.length,!0))},_onSetTitle:function(a){var b=this.get("titleEl");b&&b.html(a)},_onSetBackText:function(a){this._backBtn&&this._backBtn.set("content",a)}},{xclass:"navigation-bar",
ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:m},centerEl:{selector:function(){return"."+this.getBaseCssClass("center")}},contentEl:{selector:function(){return"."+this.getBaseCssClass("content")}},titleEl:{selector:function(){return"."+this.getBaseCssClass("title")}},title:{value:"",render:1,sync:0},withBackButton:{value:1},withTitle:{value:1,render:1,sync:0},backText:{value:"Back",render:1,sync:0}}})});
KISSY.add("navigation-view/bar/bar-xtpl",[],function(q,m,r,p){p.exports=function(k,d,m){var n=this,h=n.pos={line:1,col:1},o=n.root.utils.callFn,f=n.root.nativeCommands["if"];d.append("");var l={escape:1},a=[],b=k.resolve(["withTitle"]);a.push(b);l.params=a;l.fn=function(a,b){b.append('\r\n<div class="');var c={escape:1},d=[];d.push("title-wrap");c.params=d;h.line=2;h.col=32;if((c=o(n,a,c,b,["getBaseCssClasses"]))&&c.isBuffer)b=c,c=m;b.writeEscaped(c);b.append('">\r\n    <div class="');c={escape:1};
d=[];d.push("title");c.params=d;h.line=3;h.col=36;if((c=o(n,a,c,b,["getBaseCssClasses"]))&&c.isBuffer)b=c,c=m;b.writeEscaped(c);b.append('">');c=a.resolve(["title"]);b.writeEscaped(c);b.append("</div>\r\n</div>\r\n");return b};h.line=1;h.col=7;d=f.call(n,k,l,d);d.append('\r\n<div class="');f={escape:1};l=[];l.push("content");f.params=l;h.line=6;h.col=32;if((f=o(n,k,f,d,["getBaseCssClasses"]))&&f.isBuffer)d=f,f=m;d.writeEscaped(f);d.append('">\r\n    <div class="');f={escape:1};l=[];l.push("center");
f.params=l;h.line=7;h.col=36;if((k=o(n,k,f,d,["getBaseCssClasses"]))&&k.isBuffer)d=k,k=m;d.writeEscaped(k);d.append('"></div>\r\n</div>');return d};p.exports.TPL_NAME=p.name});
