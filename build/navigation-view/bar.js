/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 15 17:54
*/
KISSY.add("navigation-view/bar/bar-xtpl",function(o,h,p,j){h=function(k,d,e,h){var m=this,l=m.nativeCommands,n=m.utils;if("5.0.0"!==o.version)throw Error("current xtemplate file("+m.name+")(v5.0.0) need to be recompiled using current kissy(v"+o.version+")!");var j=n.callCommand,l=l["if"];d.write("");var n={escape:1},a=[],b=k.resolve(["withTitle"]);a.push(b);n.params=a;n.fn=function(a,b){b.write('\r\n<div class="');var c={escape:1},g=[];g.push("title-wrap");c.params=g;if((c=j(m,a,c,b,"getBaseCssClasses",
2))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">\r\n    <div class="');c={escape:1};g=[];g.push("title");c.params=g;if((c=j(m,a,c,b,"getBaseCssClasses",3))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">');c=a.resolve(["title"]);b.write(c,!0);b.write("</div>\r\n</div>\r\n");return b};d=l.call(m,k,n,d,1,e);d.write('\r\n<div class="');e={escape:1};l=[];l.push("content");e.params=l;if((e=j(m,k,e,d,"getBaseCssClasses",6))&&e.isBuffer)d=e,e=h;d.write(e,!0);d.write('">\r\n    <div class="');e={escape:1};
l=[];l.push("center");e.params=l;if((k=j(m,k,e,d,"getBaseCssClasses",7))&&k.isBuffer)d=k,k=h;d.write(k,!0);d.write('"></div>\r\n</div>');return d};h.TPL_NAME=j.name;return h});
KISSY.add("navigation-view/bar",["component/control","button","./bar/bar-xtpl"],function(o,h){function p(a){var b;b=a.clone(!0);b[0].id=a[0].id+"-proxy";a.parent().append(b);var f=a.offset();b.css("position","absolute");b.offset(f);b.css({width:a.css("width"),height:a.css("height")});return b}function j(a,b,f){a.animate(b,{duration:0.25,easing:"ease-in-out",complete:f})}function k(a,b,f,q){var c=a.get("el"),g=a.get("titleEl"),a=Math.min(c[0].offsetWidth/3,200),d=b[0].offsetWidth,b=c[0].offsetWidth,
c=g.offset().left-c.offset().left,g=g[0].offsetWidth,i=f.width,e;q?(f=-i,i=Math.min(c-i,a)):(i=-i,f=Math.min(c,a));a={element:{from:{transform:"translateX("+f+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}};d=-c+d;g>c&&(e=-c-g);q?(i=b-c-g,f=void 0!==e?e:d):(i=void 0!==e?e:d,f=Math.max(0,b-c-g));return{back:a,title:{element:{from:{transform:"translateX("+f+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}}}}function d(){this.fire("backward")}function e(){this.get("navigationView").pop()}function r(a){this.set("title",a.newView.get("title")||"")}function m(a){var b=a.newView,f=a.backward;if(a.oldView)this[f?"backward":"forward"](b.get("title")||"")}var l=h("component/control"),n=h("button"),s=h("./bar/bar-xtpl");return l.extend({initializer:function(){this._withTitle=this.get("withTitle");this._stack=[];this.publish("backward",
{defaultFn:e,defaultTargetOnly:!0})},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new n({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-backward",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},bindUI:function(){if(this._backBtn)this._backBtn.on("click",d,this);var a=this.get("navigationView");a.on("afterInnerViewChange",r,this);a.on("beforeInnerViewChange",m,this)},addButton:function(a,
b){var f=this.get("prefixCls");b.prefixCls=f+"navigation-bar-";!b.elBefore&&!b.render&&(f=b.align=b.align||"left","left"===f?b.elBefore=this.get("centerEl"):"right"===f&&(b.render=this.get("contentEl")),delete b.align);this._buttons[a]=(new n(b)).render();return this._buttons[a]},insertButtonBefore:function(a,b,f){b.elBefore=f.get("el");return this.addButton(a,b)},removeButton:function(a){this._buttons[a].destroy();delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this._stack.push(a);
this.go(a,!0)},go:function(a,b,f){var d=this,c=d._backBtn;if(!c||!d._withTitle){if(d._withTitle&&d.get("titleEl").html(a),c)c[b?"show":"hide"]()}else{var g=c.get("el");g.stop(!0);d.ghostBackEl&&d.ghostBackEl.stop(!0);var e={width:g[0].offsetWidth},i=p(g);d.ghostBackEl=i;g.css("opacity",0);c[b?"show":"hide"]();d.ghostBackEl&&d.ghostBackEl.stop(!0);b=k(d,g,e,f);g.css(b.back.element.from);c.get("visible")&&j(g,b.back.element.to);"none"!==i.css("display")?j(i,b.back.ghost.to,function(){i.remove();d.ghostBackEl=
null}):(i.remove(),d.ghostBackEl=null);c=d.get("titleEl");c.stop(!0);var h=p(c.parent());d.ghostTitleEl=h;c.css("opacity",0);d.set("title",a);c.css(b.title.element.from);j(c,b.title.element.to);j(h,b.title.ghost.to,function(){h.remove();d.ghostTitleEl=null})}},backward:function(a){this._stack.length&&(this._stack.pop(),this.go(a,this._stack.length,!0))},_onSetTitle:function(a){var b=this.get("titleEl");b&&b.html(a)},_onSetBackText:function(a){this._backBtn&&this._backBtn.set("content",a)}},{xclass:"navigation-bar",
ATTRS:{contentTpl:{value:s},handleGestureEvents:{value:!1},focusable:{value:!1},centerEl:{selector:function(){return"."+this.getBaseCssClass("center")}},contentEl:{selector:function(){return"."+this.getBaseCssClass("content")}},titleEl:{selector:function(){return"."+this.getBaseCssClass("title")}},title:{value:"",render:1,sync:0},withBackButton:{value:1},withTitle:{value:1,render:1,sync:0},backText:{value:"Back",render:1,sync:0}}})});
