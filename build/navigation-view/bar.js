/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 9 14:05
*/
KISSY.add("navigation-view/bar",["component/control","button","./bar/bar-xtpl"],function(m,o){function p(a){var b;b=a.clone(!0);b[0].id=a[0].id+"-proxy";a.parent().append(b);var e=a.offset();b.css("position","absolute");b.offset(e);b.css({width:a.css("width"),height:a.css("height")});return b}function j(a,b,e){a.animate(b,{duration:0.25,easing:"ease-in-out",complete:e})}function k(a,b,e,c){var f=a.get("el"),d=a.get("titleEl"),a=Math.min(f[0].offsetWidth/3,200),h=b[0].offsetWidth,b=f[0].offsetWidth,
f=d.offset().left-f.offset().left,d=d[0].offsetWidth,l=e.width,g;c?(e=-l,l=Math.min(f-l,a)):(l=-l,e=Math.min(f,a));a={element:{from:{transform:"translateX("+e+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+l+"px) translateZ(0)",opacity:0}}};h=-f+h;d>f&&(g=-f-d);c?(l=b-f-d,e=void 0!==g?g:h):(l=void 0!==g?g:h,e=Math.max(0,b-f-d));return{back:a,title:{element:{from:{transform:"translateX("+e+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+l+"px) translateZ(0)",opacity:0}}}}}function d(){this.fire("backward")}function q(){this.get("navigationView").pop()}function i(a){this.set("title",a.newView.get("title")||"")}function n(a){var b=a.newView,e=a.backward;if(a.oldView)this[e?"backward":"forward"](b.get("title")||"")}var h=o("component/control"),g=o("button"),r=o("./bar/bar-xtpl");return h.extend({initializer:function(){this._withTitle=this.get("withTitle");this._stack=[];this.publish("backward",
{defaultFn:q,defaultTargetOnly:!0})},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new g({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-backward",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},bindUI:function(){if(this._backBtn)this._backBtn.on("click",d,this);var a=this.get("navigationView");a.on("afterInnerViewChange",i,this);a.on("beforeInnerViewChange",n,this)},addButton:function(a,
b){var e=this.get("prefixCls");b.prefixCls=e+"navigation-bar-";!b.elBefore&&!b.render&&(e=b.align=b.align||"left","left"===e?b.elBefore=this.get("centerEl"):"right"===e&&(b.render=this.get("contentEl")),delete b.align);this._buttons[a]=(new g(b)).render();return this._buttons[a]},insertButtonBefore:function(a,b,e){b.elBefore=e.get("el");return this.addButton(a,b)},removeButton:function(a){this._buttons[a].destroy();delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this._stack.push(a);
this.go(a,!0)},go:function(a,b,e){var c=this,f=c._backBtn;if(!f||!c._withTitle){if(c._withTitle&&c.get("titleEl").html(a),f)f[b?"show":"hide"]()}else{var d=f.get("el");d.stop(!0);c.ghostBackEl&&c.ghostBackEl.stop(!0);var h={width:d[0].offsetWidth},g=p(d);c.ghostBackEl=g;d.css("opacity",0);f[b?"show":"hide"]();c.ghostBackEl&&c.ghostBackEl.stop(!0);b=k(c,d,h,e);d.css(b.back.element.from);f.get("visible")&&j(d,b.back.element.to);"none"!==g.css("display")?j(g,b.back.ghost.to,function(){g.remove();c.ghostBackEl=
null}):(g.remove(),c.ghostBackEl=null);f=c.get("titleEl");f.stop(!0);var i=p(f.parent());c.ghostTitleEl=i;f.css("opacity",0);c.set("title",a);f.css(b.title.element.from);j(f,b.title.element.to);j(i,b.title.ghost.to,function(){i.remove();c.ghostTitleEl=null})}},backward:function(a){this._stack.length&&(this._stack.pop(),this.go(a,this._stack.length,!0))},_onSetTitle:function(a){var b=this.get("titleEl");b&&b.html(a)},_onSetBackText:function(a){this._backBtn&&this._backBtn.set("content",a)}},{xclass:"navigation-bar",
ATTRS:{contentTpl:{value:r},handleGestureEvents:{value:!1},focusable:{value:!1},centerEl:{selector:function(){return"."+this.getBaseCssClass("center")}},contentEl:{selector:function(){return"."+this.getBaseCssClass("content")}},titleEl:{selector:function(){return"."+this.getBaseCssClass("title")}},title:{value:"",render:1,sync:0},withBackButton:{value:1},withTitle:{value:1,render:1,sync:0},backText:{value:"Back",render:1,sync:0}}})});
KISSY.add("navigation-view/bar/bar-xtpl",[],function(m,o,p,j){m=function(k,d,j){var i=this,n=i.root.utils.callFn,h=i.root.nativeCommands["if"];d.write("",0);var g={escape:1},m=[],a=k.resolve(["withTitle"],0);m.push(a);g.params=m;g.fn=function(a,e){e.write('\r\n<div class="',0);var c={escape:1},d=[];d.push("title-wrap");c.params=d;if((c=n(i,a,c,e,["getBaseCssClasses"],0,2))&&c.isBuffer)e=c,c=j;e.write(c,!0);e.write('">\r\n    <div class="',0);c={escape:1};d=[];d.push("title");c.params=d;if((c=n(i,
a,c,e,["getBaseCssClasses"],0,3))&&c.isBuffer)e=c,c=j;e.write(c,!0);e.write('">',0);c=a.resolve(["title"],0);e.write(c,!0);e.write("</div>\r\n</div>\r\n",0);return e};d=h.call(i,k,g,d,1);d.write('\r\n<div class="',0);h={escape:1};g=[];g.push("content");h.params=g;if((h=n(i,k,h,d,["getBaseCssClasses"],0,6))&&h.isBuffer)d=h,h=j;d.write(h,!0);d.write('">\r\n    <div class="',0);h={escape:1};g=[];g.push("center");h.params=g;if((k=n(i,k,h,d,["getBaseCssClasses"],0,7))&&k.isBuffer)d=k,k=j;d.write(k,!0);
d.write('"></div>\r\n</div>',0);return d};m.TPL_NAME=j.name;m.version="5.0.0";return m});
