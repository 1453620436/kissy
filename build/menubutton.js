/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 16 12:48
*/
KISSY.add("menubutton",["menubutton/control","menubutton/select","menubutton/option"],function(k,f){var i=f("menubutton/control"),j=f("menubutton/select"),g=f("menubutton/option");i.Select=j;i.Option=g;return i});
KISSY.add("menubutton/control",["node","button","component/extension/content-box","./menubutton-xtpl","util"],function(k,f){function i(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function j(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var g=f("node"),e=f("button"),l=f("component/extension/content-box"),h=g.KeyCode,g=f("./menubutton-xtpl"),d=f("util");return e.extend([l],{isMenuButton:1,decorateDom:function(a){var b=
this.get("prefixCls"),a=a.one("."+b+"popupmenu"),d=a[0].ownerDocument.body;d.insertBefore(a[0],d.firstChild);this.setInternal("menu",new (this.getComponentConstructorByNode(b,a))({srcNode:a,prefixCls:b}))},beforeCreateDom:function(a){d.mix(a.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(a){var b=this.get("menu"),e=this.$el,g=this.getBaseCssClass("open");e[a?"removeClass":"addClass"](g).attr("aria-expanded",!a);a?b.hide():b.get("visible")||(a={node:e,points:["bl","tl"],
overflow:{adjustX:1,adjustY:1}},d.mix(b.get("align"),a,!1),this.get("matchElWidth")&&(b.render(),a=b.get("el"),a=(parseInt(a.css("borderLeftWidth"),10)||0)+(parseInt(a.css("borderRightWidth"),10)||0),b.set("width",b.get("align").node[0].offsetWidth-a)),b.show(),e.attr("aria-haspopup",b.get("el").attr("id")))},bindUI:function(){this.on("afterHighlightedItemChange",j,this);this.on("click",i,this)},handleKeyDownInternal:function(a){var b=a.keyCode,d=""+a.type,e=this.get("menu");if(b===h.SPACE){if(a.preventDefault(),
"keyup"!==d)return}else if("keydown"!==d)return;if(e.get("rendered")&&e.get("visible"))return a=e.handleKeyDownInternal(a),b===h.ESC?(this.set("collapsed",!0),!0):a;if(b===h.SPACE||b===h.DOWN||b===h.UP)return this.set("collapsed",!1),!0},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){this.callSuper(a);this.set("collapsed",!0)},addItem:function(a,b){this.get("menu").addChild(a,b)},removeItem:function(a,b){this.get("menu").removeChild(a,b)},
removeItems:function(a){var b=this.get("menu");b&&(b.removeChildren?b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=this.get("menu");return b.get("rendered")&&b.getChildAt(a)},_onSetDisabled:function(a){this.callSuper(a);a||this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{contentTpl:{value:g},matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{getter:function(a){a=a||{};a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),
this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},collapsed:{value:!0,render:1,sync:0}},xclass:"menu-button"})});
KISSY.add("menubutton/menubutton-xtpl",[],function(k,f,i,j){k=function(g,e,f){var h=this.root.utils.callFn;e.write('<div class="',0);var d={escape:1},a=[];a.push("content");d.params=a;if((d=h(this,g,d,e,["getBaseCssClasses"],0,1))&&d.isBuffer)e=d,d=f;e.write(d,!0);e.write('">',0);d=g.resolve(["content"],0);e.write(d,!1);e.write('</div>\r\n<div class="',0);d={escape:1};a=[];a.push("dropdown");d.params=a;if((d=h(this,g,d,e,["getBaseCssClasses"],0,2))&&d.isBuffer)e=d,d=f;e.write(d,!0);e.write('">\r\n    <div class="',
0);d={escape:1};a=[];a.push("dropdown-inner");d.params=a;if((g=h(this,g,d,e,["getBaseCssClasses"],0,3))&&g.isBuffer)e=g,g=f;e.write(g,!0);e.write('">\r\n    </div>\r\n</div>',0);return e};k.TPL_NAME=j.name;k.version="5.0.0";return k});
KISSY.add("menubutton/select",["node","./control","util"],function(k,f){function i(a){var c=a.get("menu"),c=c.children||c.get&&c.get("children")||[],a=a.get("value"),b,d;for(d=0;d<c.length;d++)if(b=c[d],j(b)===a)return b;return null}function j(a){var c;if(a)if(a.get){if(void 0===(c=a.get("value")))c=a.get("textContent")||a.get("content")}else if(void 0===(c=a.value))c=a.textContent||a.content;return c}function g(a){var c=a.get("menu"),b=a.get("value"),a=c&&c.get&&c.get("children");m.each(a,function(a){a&&
a.set&&a.set("selected",j(a)===b)})}function e(a){var c=i(this),b=this.get("menu");a.target===b&&((a=c||b.getChildAt(0))&&a.set("highlighted",!0),c&&c.set("selected",!0))}function l(a){var c=i(a),b=c&&(c.textContent||c.get&&c.get("textContent")),c=c&&(c.content||c.get&&c.get("content"));a.set("content",b||c||a.get("defaultCaption"))}function h(a){a=a.target;if(a.isMenuItem){var a=j(a),b=this.get("value");this.set("value",a);a!==b&&this.fire("change",{prevVal:b,newVal:a})}}var d=f("node"),a=d.all,
b=f("./control"),m=f("util"),n=b.extend({bindUI:function(){this.on("click",h,this);this.on("show",e,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){this.callSuper(a,b);a.get("value")===this.get("value")&&this.set("value",null)},_onSetValue:function(){g(this);l(this)},_onSetDefaultCaption:function(){l(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(b,c){b=a(b);c=c||{};c.elBefore=b;var e,
f=[],g,h=null,i=b.val();b.all("option").each(function(a){var b={xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val()};i===a.val()&&(h={content:b.content,value:b.value});f.push(b)});m.mix(c,{menu:m.mix({children:f},c.menuCfg)});delete c.menuCfg;g=(new n(m.mix(c,h))).render();if(e=b.attr("name")){var j=(new d('<input type="hidden" name="'+e+'" value="'+i+'">')).insertBefore(b,void 0);g.on("afterValueChange",function(a){j.val(a.newVal||"")})}b.remove();return g},xclass:"select"});return n});
KISSY.add("menubutton/option",["menu"],function(k,f){return f("menu").RadioItem.extend({},{ATTRS:{textContent:{}},xclass:"option"})});
