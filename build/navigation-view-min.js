/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 17 13:06
*/
KISSY.add("navigation-view",["node","component/container","component/extension/content-xtpl","component/extension/content-render"],function(i,f){function p(a){var b=a.get("children").concat(),c=a.get("viewCacheSize");if(!(b.length<=c)){c=Math.floor(c/3);b.sort(function(a,b){return a.uuid-b.uuid});for(var d=0;d<c;d++)a.removeChild(b[d])}}function g(a,b,c){return a.view.getBaseCssClass("anim-"+b+"-"+(c?"enter":"leave"))}function j(a,b,c){var d=a[0].className,e=d,d=d.match(b.animateClassRegExp)?d.replace(b.animateClassRegExp,
c):d+(" "+c);c&&-1===d.indexOf(b.animatorClass)&&(d+=" "+b.animatorClass);d!==e&&(a[0].className=i.trim(d).replace(/\s+/," "))}function k(a,b){var c=a[0].className,d=c,c=c.replace(b.animateClassRegExp,"").replace(b.animatorClassRegExp,"");c!==d&&(a[0].className=i.trim(c).replace(/\s+/," "))}function l(a,b,c,d){var e=c.promise;a.set("activeView",c);p(a);e?e.then(function(){var e=a.get("activeView");e&&e.uuid===c.uuid&&(a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d}),k(a.loadingEl,a),
j(c.get("el"),a,a.animateNoneEnterClass))}):a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d})}function m(a,b,c,d,e,g,i){var f=a.loadingEl;c&&c.leave&&c.leave();var h=d.get("el");d.set(b);d.enter&&d.enter();a.fire("beforeInnerViewChange",{oldView:c,newView:d,backward:i});b=d.promise;c&&j(c.get("el"),a,g);b?(c?j(f,a,e):j(f,a,a.animateNoneEnterClass),k(h,a)):a.isLoading()||!c?(k(f,a),j(h,a,a.animateNoneEnterClass)):j(h,a,e)}var q=f("node").all,n=f("component/container"),r=f("component/extension/content-xtpl"),
h=f("component/extension/content-render"),o=0,h=n.getDefaultRender().extend([h],{renderUI:function(){var a=q(i.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(a);this.control.loadingEl=a}});return n.extend({isLoading:function(){return this.loadingEl.hasClass(this.animatorClass)},
renderUI:function(){this.animateClassRegExp=RegExp(this.view.getBaseCssClass()+"-anim-[^\\s]+");this.animatorClass=this.view.getBaseCssClass("animator");this.animateNoneEnterClass=g(this,"none",!0);this.animatorClassRegExp=RegExp(this.animatorClass);this.viewStack=[];var a=this.get("barEl"),b=this.get("bar"),c=this.get("el");a?c.prepend(a):b&&(b.set("elBefore",c[0].firstChild),b.set("navigationView",this),b.render())},createView:function(a){var b;a:{b=this.get("children");for(var c=a.viewId,d=0;d<
b.length;d++)if(b[d].constructor.xclass===a.xclass)if(c){if(b[d].get("viewId")===c){b=b[d];break a}}else{b=b[d];break a}b=null}b||(b=this.addChild(a));return b},push:function(a){var b,c,d,e;d=this.viewStack;e=this.get("activeView");a.animation=a.animation||this.get("animation");e||(a.animation={});b=this.createView(a);b.uuid=o++;d.push(a);c=b.get("animation");d=c.enter;c=c.leave;e&&(c=e.get("animation").leave||c);d=g(this,d,!0);c=g(this,c);m(this,a,e,b,d,c);l(this,e,b)},replace:function(a){var b=
this.viewStack;i.mix(b[b.length-1],a)},pop:function(){var a,b,c,d,e;b=this.viewStack;1<b.length&&(b.pop(),a=this.get("activeView"),b=b[b.length-1],c=this.createView(b),c.uuid=o++,d=g(this,c.get("animation").leave||a.get("animation").leave,!0),e=g(this,a.get("animation").enter),m(this,b,a,c,d,e,!0),l(this,a,c,!0))}},{xclass:"navigation-view",ATTRS:{bar:{},barEl:{},animation:{value:{enter:"slide-right",leave:"slide-left"}},handleMouseEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},allowTextSelection:{value:!0},
xrender:{value:h},contentTpl:{value:r},defaultChildCfg:{value:{handleMouseEvents:!1,allowTextSelection:!0}}}})});
