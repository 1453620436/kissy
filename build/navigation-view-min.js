/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 9 20:36
*/
KISSY.add("navigation-view/controller",["base","router","promise"],function(d,a){function f(a){var l=this.getSubView(),m=this.get("navigationView"),c=m.get("activeView");l||(l=new (this.get("SubView")),m.addChild(l),l.get("el").css("transform","translateX(-9999px) translateZ(0)"));l.controller=this;this.getSubView().reset("title");this.defer=new b.Defer;this.promise=this.defer.promise;this.enter();var l=a.route,h=this.get("routes");h[l.path]&&this[h[l.path]].apply(this,arguments);if(!a.replace||!c)c&&
c.controller.leave(),m.waitingView&&m.waitingView.controller.leave(),this.switchView(a,!this.promise.isResolved())}var j=a("base"),n=a("router"),b=a("promise");return j.extend({router:n,initializer:function(){var a;this.doRoute=d.bind(f,this);var b=this.get("routes");for(a in b)n.get(a,this.doRoute)},leave:function(){},enter:function(){},getSubView:function(){for(var a=this.get("navigationView"),b=this.get("SubView"),a=a.get("children"),m=a.length-1;0<=m;m--)if(a[m].constructor===b)return a[m]},navigate:function(a,
b){n.navigate(a,b)},switchView:function(a,b){this.get("navigationView")[a.backward?"pop":"push"](this.getSubView(),b)},isSubViewActive:function(){return this.get("navigationView").get("activeView")===this.getSubView()}},{ATTRS:{routes:{},SubView:{}}})});
KISSY.add("navigation-view/sub-view",["component/control"],function(d,a){return a("component/control").extend({isActiveView:function(){return this.get("parent").get("activeView")===this},_onSetTitle:function(a){this.isActiveView()&&this.get("parent").get("bar").set("title",a)}},{xclass:"navigation-sub-view",ATTRS:{handleMouseEvents:{value:!1},title:{value:"..."},focusable:{value:!1}}})});
KISSY.add("navigation-view/bar-xtpl",[],function(){return function(d){var a;a=this.config.utils;var f=a.renderOutput,j=a.runInlineCommand,n=a.getPropertyOrRunCommand;a='<div class="';var b={},i=[];i.push("title-wrap");b.params=i;b=j(this,d,b,"getBaseCssClasses",1);a+=f(b,!0);a+='">\r\n    <div class="';b={};i=[];i.push("title");b.params=i;b=j(this,d,b,"getBaseCssClasses",2);a+=f(b,!0);a+='" id="ks-navigation-bar-title-';b=n(this,d,{},"id",0,2);a+=f(b,!0);a+='">';b=n(this,d,{},"title",0,2);a+=f(b,
!0);a+='</div>\r\n</div>\r\n<div class="';b={};i=[];i.push("content");b.params=i;b=j(this,d,b,"getBaseCssClasses",4);a+=f(b,!0);a+='" id="ks-navigation-bar-content-';b=n(this,d,{},"id",0,4);a+=f(b,!0);a+='">\r\n    <div class="';b={};i=[];i.push("center");b.params=i;j=j(this,d,b,"getBaseCssClasses",5);a+=f(j,!0);a+='" id="ks-navigation-bar-center-';d=n(this,d,{},"id",0,5);a+=f(d,!0);return a+'"></div>\r\n</div>'}});
KISSY.add("navigation-view/bar-render",["./bar-xtpl","component/control"],function(d,a){var f=a("./bar-xtpl");return a("component/control").getDefaultRender().extend({createDom:function(){this.fillChildrenElsBySelectors({titleEl:"#ks-navigation-bar-title-{id}",centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"})},_onSetTitle:function(a){this.control.get("titleEl").html(a)},_onSetBackText:function(a){this.control.get("backButton").set("content",a)}},{ATTRS:{contentTpl:{value:f}}})});
KISSY.add("navigation-view/bar",["component/control","./bar-render","button"],function(d,a){function f(a){var c;c=a.clone(!0);c[0].id=a[0].id+"-proxy";a.parent().append(c);var h=a.offset();c.css("position","absolute");c.offset(h);c.css({width:a.css("width"),height:a.css("height")});return c}function j(a,c,h){a.animate(c,{duration:0.25,useTransition:!0,easing:"ease-in-out",complete:h})}function n(a,c,h,b){var e=a.get("el"),o=a.get("titleEl"),a=Math.min(e[0].offsetWidth/3,200),k=c[0].offsetWidth,c=
e[0].offsetWidth,e=o.offset().left-e.offset().left,o=o[0].offsetWidth,g=h.width,d;b?(h=-g,g=Math.min(e-g,a)):(g=-g,h=Math.min(e,a));a={element:{from:{transform:"translateX("+h+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+g+"px) translateZ(0)",opacity:0}}};k=-e+k;o>e&&(d=-e-o);b?(g=c-e-o,h=void 0!==d?d:k):(g=void 0!==d?d:k,h=Math.max(0,c-e-o));return{back:a,title:{element:{from:{transform:"translateX("+h+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+g+"px) translateZ(0)",opacity:0}}}}}var b=a("component/control"),i=a("./bar-render"),l=a("button");return b.extend({renderUI:function(){var a=this.get("prefixCls");this.set("backBtn",(new l({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-back",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render());this._buttons={}},addButton:function(a,c){var h=this.get("prefixCls");c.prefixCls=h+"navigation-bar-";!c.elBefore&&
!c.render&&(h=c.align=c.align||"left","left"===h?c.elBefore=this.get("centerEl"):"right"===h&&(c.render=this.get("contentEl")),delete c.align);this._buttons[a]=(new l(c)).render();return this._buttons[a]},insertButtonBefore:function(a,c,h){c.elBefore=h.get("el");return this.addButton(a,c)},removeButton:function(a){this._buttons[a].destroy();delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this.go(a,!0)},go:function(a,c,h){var b=this,e=this.get("backBtn").get("el");
e.stop(!0);b.ghostBackEl&&b.ghostBackEl.stop(!0);var d={width:e[0].offsetWidth},k=f(e);b.ghostBackEl=k;e.css("opacity",0);e[c?"show":"hide"]();c=this.get("titleEl");c.stop(!0);b.ghostBackEl&&b.ghostBackEl.stop(!0);var g=f(c.parent());b.ghostTitleEl=g;c.css("opacity",0);this.set("title",a);a=n(b,e,d,h);e.css(a.back.element.from);"none"!==e.css("display")&&j(e,a.back.element.to);c.css(a.title.element.from);j(c,a.title.element.to);"none"!==k.css("display")?j(k,a.back.ghost.to,function(){k.remove();b.ghostBackEl=
null}):(k.remove(),b.ghostBackEl=null);j(g,a.title.ghost.to,function(){g.remove();b.ghostTitleEl=null})},back:function(a,b){this.go(a,b,!0)}},{xclass:"navigation-bar",ATTRS:{handleMouseEvents:{value:!1},focusable:{value:!1},xrender:{value:i},centerEl:{},contentEl:{},titleEl:{},title:{value:"",view:1},backText:{value:"Back",view:1}}})});
KISSY.add("navigation-view","node,navigation-view/controller,component/container,navigation-view/sub-view,navigation-view/bar,component/extension/content-xtpl,component/extension/content-render".split(","),function(d,a){var f=a("node").all,j=a("navigation-view/controller"),n=a("component/container"),b=a("navigation-view/sub-view"),i=a("navigation-view/bar"),l=a("component/extension/content-xtpl"),m=a("component/extension/content-render"),c=0,m=n.getDefaultRender().extend([m],{renderUI:function(){var a=
f(d.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(a);this.control.setInternal("loadingEl",a)}});return n.extend({renderUI:function(){this.viewStack=[];var a;this.setInternal("bar",a=(new i({elBefore:this.get("el")[0].firstChild})).render());a.get("backBtn").on("click",this.onBack,
this)},onBack:function(){history.back()},push:function(a,b){var e=this,d=this.get("bar"),k=a.get("el");k.css("transform","translateX(-9999px) translateZ(0)");a.uuid=c++;var g,f=this.get("loadingEl");this.viewStack.push(a);if(g=this.get("activeView")){g=g.get("el");g.stop(true);g.animate({transform:"translateX(-"+g[0].offsetWidth+"px) translateZ(0)"},{useTransition:true,easing:"ease-in-out",duration:0.25});if(b){f.stop(true);f.css("left","100%");f.show();f.animate({left:"0"},{useTransition:true,easing:"ease-in-out",
duration:0.25});this.set("activeView",null)}else{k.stop(true);k.css("transform","translateX("+g[0].offsetWidth+"px) translateZ(0)");k.animate({transform:""},{useTransition:true,easing:"ease-in-out",duration:0.25});this.set("activeView",a);e.waitingView=null}d.forward(a.get("title"))}else{d.set("title",a.get("title"));if(!b){a.get("el").css("transform","");this.set("activeView",a);e.waitingView=null;f.hide()}}if(b){e.waitingView=a;a.controller.promise.then(function(){if(e.waitingView&&e.waitingView.uuid===
a.uuid){e.set("activeView",a);e.waitingView=null;d.set("title",a.get("title"));a.get("el").css("transform","");f.hide()}})}},pop:function(a,b){var e=this;if(this.viewStack.length>1){this.viewStack.pop();a.uuid=c++;var d,f=this.get("loadingEl"),g=this.get("bar");if(d=this.get("activeView")){var i=this.animEl=d.get("el");i.stop(true);i.animate({transform:"translateX("+d.get("el")[0].offsetWidth+"px) translateZ(0)"},{useTransition:true,easing:"ease-in-out",duration:0.25});if(b){this.set("activeView",
null);f.stop(true);f.css("left","-100%");f.show();f.animate({left:"0"},{useTransition:true,easing:"ease-in-out",duration:0.25})}else{d=a.get("el");d.stop(true);d.css("transform","translateX(-"+i[0].offsetWidth+"px) translateZ(0)");d.animate({transform:""},{useTransition:true,easing:"ease-in-out",duration:0.25});this.set("activeView",a)}}else if(!b){a.get("el").css("transform","");this.set("activeView",a);e.waitingView=null;f.hide()}g.back(a.get("title"),this.viewStack.length>1);if(b){e.waitingView=
a;a.controller.promise.then(function(){if(e.waitingView&&e.waitingView.uuid===a.uuid){e.waitingView=null;e.set("activeView",a);g.set("title",a.get("title"));a.get("el").css("transform","");f.hide()}})}}}},{SubView:b,Controller:j,xclass:"navigation-view",ATTRS:{activeView:{},loadingEl:{},handleMouseEvents:{value:false},focusable:{value:false},xrender:{value:m},contentTpl:{value:l},defaultChildCfg:{value:{xclass:"navigation-sub-view"}}}})});
