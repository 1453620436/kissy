/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 20 11:32
*/
KISSY.add("navigation-view",["node","component/container","component/extension/content-xtpl","component/extension/content-render"],function(f,i){function s(a){var b=a.get("children").concat(),c=a.get("viewCacheSize");if(!(b.length<=c)){c=Math.floor(c/3);b.sort(function(a,b){return a.uuid-b.uuid});for(var d=0;d<c;d++)a.removeChild(b[d])}}function g(a,b,c){return a.view.getBaseCssClass("anim-"+b+"-"+(c?"enter":"leave"))}function h(a,b,c){var d=a.className,e=d;d.match(b.animateClassRegExp)&&(d=d.replace(b.animateClassRegExp,
""));c&&(d+=" "+c);-1===d.indexOf(b.showViewClass)&&(d+=" "+b.showViewClass);d!==e&&(a.className=f.trim(d).replace(/\s+/," "))}function k(a,b){var c=a.className,d=c,c=c.replace(b.animateClassRegExp,"").replace(b.showViewClass,"");c!==d&&(a.className=f.trim(c).replace(/\s+/," "))}function l(a,b,c,d){var e=c.promise;a.set("activeView",c);s(a);e?e.then(function(){var e=a.get("activeView");e&&e.uuid===c.uuid&&(a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d}),k(a.loadingEl,a),h(c.el,a))}):
a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d})}function m(a,b,c,d,e,f,i){var g=a.loadingEl;c&&c.leave&&c.leave();var j=d.el;d.set(b);d.enter&&d.enter();a.fire("beforeInnerViewChange",{oldView:c,newView:d,backward:i});b=d.promise;c&&h(c.el,a,f);b?(c?h(g,a,e):h(g,a),k(j,a)):(a.$loadingEl.hasClass(a.showViewClass)&&c&&h(g,a,f),h(j,a,e))}function n(a){return function(){var b=a.className;b.match(this.animateEnterRegExp)?h(a,this):b.match(this.animateLeaveRegExp)&&k(a,this)}}var t=i("node").all,
o=i("component/container"),u=i("component/extension/content-xtpl"),j=i("component/extension/content-render"),p=f.Features.getVendorCssPropPrefix("animation"),q=p?p.toLowerCase()+"AnimationEnd":"animationend webkitAnimationEnd",r=0,j=o.getDefaultRender().extend([j],{createDom:function(){var a=this.control,b=t(f.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));
a.get("contentEl").append(b);a.$loadingEl=b;a.loadingEl=b[0];b.on(q,n(b[0]),a)}});return o.extend({createDom:function(){this.animateClassRegExp=RegExp(this.view.getBaseCssClass()+"-anim-[^\\s]+");this.animateEnterRegExp=/-enter(?:\s|$)/;this.animateLeaveRegExp=/-leave(?:\s|$)/;this.showViewClass=this.view.getBaseCssClass("show-view");this.viewStack=[]},createView:function(a){var b;a:{b=this.get("children");for(var c=a.viewId,d=0;d<b.length;d++)if(b[d].constructor.xclass===a.xclass)if(c){if(b[d].get("viewId")===
c){b=b[d];break a}}else{b=b[d];break a}b=null}b||(b=this.addChild(a),a=b.get("el"),a.on(q,n(a[0]),this));return b},push:function(a){var b,c,d,e;d=this.viewStack;e=this.get("activeView");a.animation=a.animation||this.get("animation");e||(a.animation={});b=this.createView(a);b.uuid=r++;d.push(a);c=b.get("animation");d=c.enter;c=c.leave;e&&(c=e.get("animation").leave||c);d=g(this,d,!0);c=g(this,c);m(this,a,e,b,d,c);l(this,e,b)},replace:function(a){var b=this.viewStack;f.mix(b[b.length-1],a)},pop:function(){var a,
b,c,d,e;b=this.viewStack;1<b.length&&(b.pop(),a=this.get("activeView"),b=b[b.length-1],c=this.createView(b),c.uuid=r++,d=g(this,c.get("animation").leave||a.get("animation").leave,!0),e=g(this,a.get("animation").enter),m(this,b,a,c,d,e,!0),l(this,a,c,!0))}},{xclass:"navigation-view",ATTRS:{animation:{value:{enter:"slide-right",leave:"slide-left"}},handleMouseEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},allowTextSelection:{value:!0},xrender:{value:j},contentTpl:{value:u},defaultChildCfg:{value:{handleMouseEvents:!1,
allowTextSelection:!0}}}})});
