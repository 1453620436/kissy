/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 7 12:01
*/
KISSY.add("navigation-view",["node","component/container","component/extension/content-xtpl","component/extension/content-render"],function(g,f){function t(a){var b=a.get("children").concat(),c=a.get("viewCacheSize");if(!(b.length<=c)){c=Math.floor(c/3);b.sort(function(a,b){return a.uuid-b.uuid});for(var d=0;d<c;d++)a.removeChild(b[d])}}function h(a,b,c){return a.view.getBaseCssClass("anim-"+b+"-"+(c?"enter":"leave"))}function i(a,b,c){var d=a.className,e=d;if(c)if(c.match(b.animateNoneEnterRegExp))c=
"";else if(c.match(b.animateNoneLeaveRegExp))return j(a,b);d.match(b.animateClassRegExp)&&(d=d.replace(b.animateClassRegExp,""));c&&(d=d+(" "+c)+(" "+b.animingClass));-1===d.indexOf(b.showViewClass)&&(d+=" "+b.showViewClass);d!==e&&(a.className=g.trim(d).replace(/\s+/," "))}function j(a,b){var c=a.className,d=c,c=c.replace(b.animateClassRegExp,"").replace(b.showViewClass,"");c!==d&&(a.className=g.trim(c).replace(/\s+/," "))}function m(a,b,c,d){var e=c.promise;t(a);e?e.then(function(){var e=a.get("activeView");
e&&e.uuid===c.uuid&&(a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d}),j(a.loadingEl,a),i(c.el,a))}):a.fire("afterInnerViewChange",{oldView:b,newView:c,backward:d})}function n(a,b,c,d,e,l,g){var f=a.loadingEl;c&&(c.leave&&c.leave(),c.fire("leave"));var h=d.el;d.set(b);a.set("activeView",d);d&&(d.enter&&d.enter(),d.fire("enter"));a.fire("beforeInnerViewChange",{oldView:c,newView:d,backward:g});b=d.promise;c&&i(c.el,a,l);b?(c?i(f,a,e):i(f,a),j(h,a)):(a.$loadingEl.hasClass(a.showViewClass)&&
c&&i(f,a,l),i(h,a,e))}function o(a){return function(){var b=a.className;b.match(this.animateEnterRegExp)?i(a,this):b.match(this.animateLeaveRegExp)&&j(a,this)}}var u=f("node").all,p=f("component/container"),v=f("component/extension/content-xtpl"),k=f("component/extension/content-render"),q=g.Feature.getVendorCssPropPrefix("animation"),r=q?q.toLowerCase()+"AnimationEnd":"animationend webkitAnimationEnd",s=0,k=p.getDefaultRender().extend([k],{createDom:function(){var a=this.control,b=u(g.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',
{prefixCls:this.control.get("prefixCls")}));a.get("contentEl").append(b);a.$loadingEl=b;a.loadingEl=b[0];b.on(r,o(b[0]),a)}});return p.extend({createDom:function(){this.animateClassRegExp=RegExp(this.view.getBaseCssClass()+"-anim-[^\\s]+","g");this.animateEnterRegExp=/-enter(?:\s|$)/;this.animateLeaveRegExp=/-leave(?:\s|$)/;this.animateNoneEnterRegExp=/none-enter(?:\s|$)/;this.animateNoneLeaveRegExp=/none-leave(?:\s|$)/;this.animingClass=this.view.getBaseCssClass()+"-anim-ing";this.showViewClass=
this.view.getBaseCssClass("show-view");this.viewStack=[]},createView:function(a){var b;a:{b=this.get("children");for(var c=a.viewId,d=0;d<b.length;d++)if(b[d].constructor.xclass===a.xclass)if(c){if(b[d].get("viewId")===c){b=b[d];break a}}else{b=b[d];break a}b=null}b||(b=this.addChild(a),a=b.get("el"),a.on(r,o(a[0]),this));return b},push:function(a){var b,c,d,e,f;d=this.viewStack;e=d[d.length-1];f=this.get("activeView");a.animation=f?a.animation||this.get("animation"):{};c=a.animation;b=this.createView(a);
b.uuid=s++;d.push(a);d=c.enter;c=c.leave;f&&(c=e.animation.leave||c);e=d&&h(this,d,!0)||"";c=h(this,c);n(this,a,f,b,e,c);m(this,f,b)},replace:function(a){var b=this.viewStack;g.mix(b[b.length-1],a)},pop:function(a){var b,c,d,e,a=this.viewStack;1<a.length&&(e=a[a.length-1],a.pop(),b=this.get("activeView"),a=a[a.length-1],c=this.createView(a),c.uuid=s++,d=h(this,a.animation.leave||e.animation.leave,!0),e=h(this,e.animation.enter),n(this,a,b,c,d,e,!0),m(this,b,c,!0))}},{xclass:"navigation-view",ATTRS:{animation:{value:{enter:"slide-right",
leave:"slide-left"}},handleGestureEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},allowTextSelection:{value:!0},xrender:{value:k},contentTpl:{value:v},defaultChildCfg:{value:{handleGestureEvents:!1,allowTextSelection:!0}}}})});
