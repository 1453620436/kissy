/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 14 17:33
*/
KISSY.add("navigation-view/bar-xtpl",[],function(){return function(l){var a,k=this;a=this.config.utils;var g=a.runBlockCommand,m=a.renderOutput,h=a.getProperty,o=a.runInlineCommand,p=a.getPropertyOrRunCommand;a="";var n={},q=[],h=h(k,l,"withTitle",0,1);q.push(h);n.params=q;n.fn=function(e){var d;d='\r\n<div class="';var b={},c=[];c.push("title-wrap");b.params=c;b=o(k,e,b,"getBaseCssClasses",2);d+=m(b,!0);d+='">\r\n    <div class="';b={};c=[];c.push("title");b.params=c;b=o(k,e,b,"getBaseCssClasses",
3);d+=m(b,!0);d+='" id="ks-navigation-bar-title-';b=p(k,e,{},"id",0,3);d+=m(b,!0);d+='">';e=p(k,e,{},"title",0,3);d+=m(e,!0);return d+"</div>\r\n</div>\r\n"};a+=g(k,l,n,"if",1);a+='\r\n<div class="';g={};h=[];h.push("content");g.params=h;g=o(k,l,g,"getBaseCssClasses",6);a+=m(g,!0);a+='" id="ks-navigation-bar-content-';g=p(k,l,{},"id",0,6);a+=m(g,!0);a+='">\r\n    <div class="';g={};h=[];h.push("center");g.params=h;g=o(k,l,g,"getBaseCssClasses",7);a+=m(g,!0);a+='" id="ks-navigation-bar-center-';l=
p(k,l,{},"id",0,7);a+=m(l,!0);return a+'"></div>\r\n</div>'}});
KISSY.add("navigation-view/bar-render",["./bar-xtpl","component/control"],function(l,a){var k=a("./bar-xtpl");return a("component/control").getDefaultRender().extend({createDom:function(){var a={centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"};this.control._withTitle&&(a.titleEl="#ks-navigation-bar-title-{id}");this.fillChildrenElsBySelectors(a)},_onSetTitle:function(a){this.control._withTitle&&this.control.get("titleEl").html(a)},_onSetBackText:function(a){this.control._backBtn&&
this.control._backBtn.set("content",a)}},{ATTRS:{contentTpl:{value:k}}})});
KISSY.add("navigation-view/bar",["component/control","./bar-render","button"],function(l,a){function k(a){var e;e=a.clone(!0);e[0].id=a[0].id+"-proxy";a.parent().append(e);var d=a.offset();e.css("position","absolute");e.offset(d);e.css({width:a.css("width"),height:a.css("height")});return e}function g(a,e,d){a.animate(e,{duration:0.25,useTransition:!0,easing:"ease-in-out",complete:d})}function m(a,e,d,b){var c=a.get("el"),f=a.get("titleEl"),a=Math.min(c[0].offsetWidth/3,200),g=e[0].offsetWidth,e=
c[0].offsetWidth,c=f.offset().left-c.offset().left,f=f[0].offsetWidth,j=d.width,i;b?(d=-j,j=Math.min(c-j,a)):(j=-j,d=Math.min(c,a));a={element:{from:{transform:"translateX("+d+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+j+"px) translateZ(0)",opacity:0}}};g=-c+g;f>c&&(i=-c-f);b?(j=e-c-f,d=void 0!==i?i:g):(j=void 0!==i?i:g,d=Math.max(0,e-c-f));return{back:a,title:{element:{from:{transform:"translateX("+d+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+j+"px) translateZ(0)",opacity:0}}}}}function h(){this.fire("back")}var o=a("component/control"),p=a("./bar-render"),n=a("button");return o.extend({initializer:function(){this._withTitle=this.get("withTitle")},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new n({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-back",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},
bindUI:function(){if(this._backBtn)this._backBtn.on("click",h,this)},addButton:function(a,e){var d=this.get("prefixCls");e.prefixCls=d+"navigation-bar-";!e.elBefore&&!e.render&&(d=e.align=e.align||"left","left"===d?e.elBefore=this.get("centerEl"):"right"===d&&(e.render=this.get("contentEl")),delete e.align);this._buttons[a]=(new n(e)).render();return this._buttons[a]},insertButtonBefore:function(a,e,d){e.elBefore=d.get("el");return this.addButton(a,e)},removeButton:function(a){this._buttons[a].destroy();
delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this.go(a,!0)},go:function(a,e,d){var b=this,c=b._backBtn;if(!c||!b._withTitle){if(b._withTitle&&b.get("titleEl").html(a),c)c[e?"show":"hide"]()}else{var f=c.get("el");f.stop(!0);b.ghostBackEl&&b.ghostBackEl.stop(!0);var h={width:f[0].offsetWidth},j=k(f);b.ghostBackEl=j;f.css("opacity",0);c[e?"show":"hide"]();b.ghostBackEl&&b.ghostBackEl.stop(!0);e=m(b,f,h,d);f.css(e.back.element.from);c.get("visible")&&g(f,
e.back.element.to);"none"!==j.css("display")?g(j,e.back.ghost.to,function(){j.remove();b.ghostBackEl=null}):(j.remove(),b.ghostBackEl=null);c=b.get("titleEl");c.stop(!0);var i=k(c.parent());b.ghostTitleEl=i;c.css("opacity",0);b.set("title",a);c.css(e.title.element.from);g(c,e.title.element.to);g(i,e.title.ghost.to,function(){i.remove();b.ghostTitleEl=null})}},back:function(a,e){this.go(a,e,!0)}},{xclass:"navigation-bar",ATTRS:{handleMouseEvents:{value:!1},focusable:{value:!1},xrender:{value:p},centerEl:{},
contentEl:{},titleEl:{},title:{value:"",view:1},withBackButton:{value:1},withTitle:{value:1,view:1},backText:{value:"Back",view:1}}})});
KISSY.add("navigation-view",["node","component/container","navigation-view/bar","component/extension/content-xtpl","component/extension/content-render"],function(l,a){function k(a){a.target===this.get("bar")&&this.pop()}function g(a){var d=a.get("children").concat(),b=a.get("viewCacheSize");if(!(d.length<=b)){b=Math.floor(b/3);d.sort(function(a,e){return a.uuid-e.uuid});for(var c=0;c<b;c++)a.removeChild(d[c])}}var m=a("node").all,h=a("component/container"),o=a("navigation-view/bar"),p=a("component/extension/content-xtpl"),
n=a("component/extension/content-render"),q=0,n=h.getDefaultRender().extend([n],{renderUI:function(){var a=m(l.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(a);this.control.loadingEl=a}});return h.extend({initializer:function(){this.publish("back",{defaultFn:k,defaultTargetOnly:!1})},
isLoading:function(){return"none"!==this.loadingEl.css("display")},renderUI:function(){this.viewStack=[];var a;a=this.get("barCfg");a.elBefore=this.get("el")[0].firstChild;this.setInternal("bar",a=(new o(a)).render());a.addTarget(this)},createView:function(a,d){var b;a:{b=this.get("children");for(var c=d&&d.viewId,f=0;f<b.length;f++)if(b[f].constructor===a)if(c){if(b[f].get("viewId")===c){b=b[f];break a}}else{b=b[f];break a}b=null}b||(this.addChild(b=new a(l.merge(d,{prefixCls:this.get("prefixCls")}))),
b.get("el").css("transform","translateX(-9999px) translateZ(0)"));return b},push:function(a,d){var b=this,c,f=b.viewStack,k=b.get("bar");c=b.createView(a,d);var j=c.get("el");c.uuid=q++;var i,h=this.loadingEl;f.push([a,d]);(i=b.get("activeView"))&&i.leave&&i.leave();d&&c.set(d);c.enter&&c.enter();f=c.promise;b.isLoading()?(k.set("title",c.get("title")),f||(g(b),c.get("el").css("transform",""),h.hide())):(i=i.get("el"),i.stop(!0),i.animate({transform:"translateX(-"+i[0].offsetWidth+"px) translateZ(0)"},
{useTransition:!0,easing:"ease-in-out",duration:0.25}),f?(h.stop(!0),h.css("left","100%"),h.show(),h.animate({left:"0"},{useTransition:!0,easing:"ease-in-out",duration:0.25}),b.set("activeView",null)):(g(b),j.stop(!0),j.css("transform","translateX("+i[0].offsetWidth+"px) translateZ(0)"),j.animate({transform:""},{useTransition:!0,easing:"ease-in-out",duration:0.25}),b.set("activeView",c)),k.forward(c.get("title")||""));b.set("activeView",c);f&&f.then(function(){var a=b.get("activeView");if(a&&a.uuid===
c.uuid){g(b);c.get("el").css("transform","");k.set("title",c.get("title")||"");h.hide()}})},replace:function(a){var d=this.viewStack;d[d.length-1][1]=a},pop:function(){var a=this,d=a.viewStack;if(1<d.length){d.pop();var b=d[d.length-1],c=a.createView(b[0],b[1]);c.uuid=q++;var f,h=a.loadingEl,j=a.get("bar");(f=a.get("activeView"))&&f.leave&&f.leave();b[1]&&c.set(b[1]);c.enter&&c.enter();b=c.promise;if(a.isLoading())b||(g(a),c.get("el").css("transform",""),h.hide());else{var i=f.get("el");i.stop(!0);
i.animate({transform:"translateX("+f.get("el")[0].offsetWidth+"px) translateZ(0)"},{useTransition:!0,easing:"ease-in-out",duration:0.25});b?(a.set("activeView",null),h.stop(!0),h.css("left","-100%"),h.show(),h.animate({left:"0"},{useTransition:!0,easing:"ease-in-out",duration:0.25})):(g(a),f=c.get("el"),f.stop(!0),f.css("transform","translateX(-"+i[0].offsetWidth+"px) translateZ(0)"),f.animate({transform:""},{useTransition:!0,easing:"ease-in-out",duration:0.25}),a.set("activeView",c))}a.set("activeView",
c);j.back(c.get("title")||"",1<d.length);b&&b.then(function(){var b=a.get("activeView");b&&b.uuid===c.uuid&&(g(a),c.get("el").css("transform",""),j.set("title",c.get("title")||""),h.hide())})}}},{xclass:"navigation-view",ATTRS:{barCfg:{value:{}},handleMouseEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},xrender:{value:n},contentTpl:{value:p}}})});
