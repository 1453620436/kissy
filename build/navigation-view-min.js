/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 10 12:28
*/
KISSY.add("navigation-view/controller",["base","router","promise"],function(g,a){function c(a){var b=this.getSubView(),c=this.get("navigationView"),i=c.get("activeView");b||(b=new (this.get("SubView")),c.addChild(b),b.get("el").css("transform","translateX(-9999px) translateZ(0)"));b.controller=this;this.defer=new k.Defer;this.promise=this.defer.promise;if(!a.replace||!i)i&&i.controller.leave(),c.waitingView&&c.waitingView.controller.leave();this.enter();var d=a.route,p=this.get("routes");p[d.path]&&
this[p[d.path]].apply(this,arguments);if(!a.replace||!i)(i=!this.promise.isResolved())&&b.reset("title"),c[a.backward?"pop":"push"](b,i)}var b=a("base"),e=a("router"),k=a("promise");return b.extend({router:e,initializer:function(){var a;this.doRoute=g.bind(c,this);var b=this.get("routes");for(a in b)e.get(a,this.doRoute)},leave:function(){},enter:function(){},getSubView:function(){for(var a=this.get("navigationView"),b=this.get("SubView"),a=a.get("children"),c=a.length-1;0<=c;c--)if(a[c].constructor===
b)return a[c]},navigate:function(a,b){e.navigate(a,b)},isSubViewActive:function(){return this.get("navigationView").get("activeView")===this.getSubView()}},{ATTRS:{routes:{},SubView:{}}})});
KISSY.add("navigation-view/sub-view",["component/control"],function(g,a){return a("component/control").extend({isActiveView:function(){return this.get("parent").get("activeView")===this},_onSetTitle:function(a){this.isActiveView()&&this.get("parent").get("bar").set("title",a)}},{xclass:"navigation-sub-view",ATTRS:{handleMouseEvents:{value:!1},title:{value:"..."},focusable:{value:!1}}})});
KISSY.add("navigation-view/bar-xtpl",[],function(){return function(g){var a,c=this;a=this.config.utils;var b=a.runBlockCommand,e=a.renderOutput,k=a.getProperty,m=a.runInlineCommand,n=a.getPropertyOrRunCommand;a="";var l={},i=[],k=k(c,g,"withTitle",0,1);i.push(k);l.params=i;l.fn=function(d){var a;a='\r\n<div class="';var i={},b=[];b.push("title-wrap");i.params=b;i=m(c,d,i,"getBaseCssClasses",2);a+=e(i,!0);a+='">\r\n    <div class="';i={};b=[];b.push("title");i.params=b;i=m(c,d,i,"getBaseCssClasses",
3);a+=e(i,!0);a+='" id="ks-navigation-bar-title-';i=n(c,d,{},"id",0,3);a+=e(i,!0);a+='">';d=n(c,d,{},"title",0,3);a+=e(d,!0);return a+"</div>\r\n</div>\r\n"};a+=b(c,g,l,"if",1);a+='\r\n<div class="';b={};k=[];k.push("content");b.params=k;b=m(c,g,b,"getBaseCssClasses",6);a+=e(b,!0);a+='" id="ks-navigation-bar-content-';b=n(c,g,{},"id",0,6);a+=e(b,!0);a+='">\r\n    <div class="';b={};k=[];k.push("center");b.params=k;b=m(c,g,b,"getBaseCssClasses",7);a+=e(b,!0);a+='" id="ks-navigation-bar-center-';g=
n(c,g,{},"id",0,7);a+=e(g,!0);return a+'"></div>\r\n</div>'}});
KISSY.add("navigation-view/bar-render",["./bar-xtpl","component/control"],function(g,a){var c=a("./bar-xtpl");return a("component/control").getDefaultRender().extend({createDom:function(){var a={centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"};this.control._withTitle&&(a.titleEl="#ks-navigation-bar-title-{id}");this.fillChildrenElsBySelectors(a)},_onSetTitle:function(a){this.control._withTitle&&this.control.get("titleEl").html(a)},_onSetBackText:function(a){this.control._backBtn&&
this.control._backBtn.set("content",a)}},{ATTRS:{contentTpl:{value:c}}})});
KISSY.add("navigation-view/bar",["component/control","./bar-render","button"],function(g,a){function c(a){var d;d=a.clone(!0);d[0].id=a[0].id+"-proxy";a.parent().append(d);var b=a.offset();d.css("position","absolute");d.offset(b);d.css({width:a.css("width"),height:a.css("height")});return d}function b(a,d,b){a.animate(d,{duration:0.25,useTransition:!0,easing:"ease-in-out",complete:b})}function e(a,d,b,j){var f=a.get("el"),c=a.get("titleEl"),a=Math.min(f[0].offsetWidth/3,200),e=d[0].offsetWidth,d=
f[0].offsetWidth,f=c.offset().left-f.offset().left,c=c[0].offsetWidth,h=b.width,g;j?(b=-h,h=Math.min(f-h,a)):(h=-h,b=Math.min(f,a));a={element:{from:{transform:"translateX("+b+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+h+"px) translateZ(0)",opacity:0}}};e=-f+e;c>f&&(g=-f-c);j?(h=d-f-c,b=void 0!==g?g:e):(h=void 0!==g?g:e,b=Math.max(0,d-f-c));return{back:a,title:{element:{from:{transform:"translateX("+b+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+h+"px) translateZ(0)",opacity:0}}}}}function k(){history.back()}var m=a("component/control"),n=a("./bar-render"),l=a("button");return m.extend({initializer:function(){this._withTitle=this.get("withTitle")},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new l({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-back",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},
bindUI:function(){if(this._backBtn)this._backBtn.on("click",k)},addButton:function(a,d){var b=this.get("prefixCls");d.prefixCls=b+"navigation-bar-";!d.elBefore&&!d.render&&(b=d.align=d.align||"left","left"===b?d.elBefore=this.get("centerEl"):"right"===b&&(d.render=this.get("contentEl")),delete d.align);this._buttons[a]=(new l(d)).render();return this._buttons[a]},insertButtonBefore:function(a,d,b){d.elBefore=b.get("el");return this.addButton(a,d)},removeButton:function(a){this._buttons[a].destroy();
delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this.go(a,!0)},go:function(a,d,g){var j=this,f=j._backBtn;if(!f||!j._withTitle){if(j._withTitle&&j.get("titleEl").html(a),f)f[d?"show":"hide"]()}else{var o=f.get("el");o.stop(!0);j.ghostBackEl&&j.ghostBackEl.stop(!0);var k={width:o[0].offsetWidth},h=c(o);j.ghostBackEl=h;o.css("opacity",0);f[d?"show":"hide"]();j.ghostBackEl&&j.ghostBackEl.stop(!0);d=e(j,o,k,g);o.css(d.back.element.from);f.get("visible")&&b(o,
d.back.element.to);"none"!==h.css("display")?b(h,d.back.ghost.to,function(){h.remove();j.ghostBackEl=null}):(h.remove(),j.ghostBackEl=null);f=j.get("titleEl");f.stop(!0);var l=c(f.parent());j.ghostTitleEl=l;f.css("opacity",0);j.set("title",a);f.css(d.title.element.from);b(f,d.title.element.to);b(l,d.title.ghost.to,function(){l.remove();j.ghostTitleEl=null})}},back:function(a,d){this.go(a,d,!0)}},{xclass:"navigation-bar",ATTRS:{handleMouseEvents:{value:!1},focusable:{value:!1},xrender:{value:n},centerEl:{},
contentEl:{},titleEl:{},title:{value:"",view:1},withBackButton:{value:1},withTitle:{value:1,view:1},backText:{value:"Back",view:1}}})});
KISSY.add("navigation-view","node,navigation-view/controller,component/container,navigation-view/sub-view,navigation-view/bar,component/extension/content-xtpl,component/extension/content-render".split(","),function(g,a){var c=a("node").all,b=a("navigation-view/controller"),e=a("component/container"),k=a("navigation-view/sub-view"),m=a("navigation-view/bar"),n=a("component/extension/content-xtpl"),l=a("component/extension/content-render"),i=0,l=e.getDefaultRender().extend([l],{renderUI:function(){var a=
c(g.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(a);this.control.setInternal("loadingEl",a)}});return e.extend({renderUI:function(){this.viewStack=[];var a=this.get("barCfg");a.elBefore=this.get("el")[0].firstChild;this.setInternal("bar",(new m(a)).render())},push:function(a,b){var c=
this,f=this.get("bar"),g=a.get("el");g.css("transform","translateX(-9999px) translateZ(0)");a.uuid=i++;var e,h=this.get("loadingEl");this.viewStack.push(a);if(e=this.get("activeView")){e=e.get("el");e.stop(true);e.animate({transform:"translateX(-"+e[0].offsetWidth+"px) translateZ(0)"},{useTransition:true,easing:"ease-in-out",duration:0.25});if(b){h.stop(true);h.css("left","100%");h.show();h.animate({left:"0"},{useTransition:true,easing:"ease-in-out",duration:0.25});this.set("activeView",null)}else{g.stop(true);
g.css("transform","translateX("+e[0].offsetWidth+"px) translateZ(0)");g.animate({transform:""},{useTransition:true,easing:"ease-in-out",duration:0.25});this.set("activeView",a);c.waitingView=null}f.forward(a.get("title"))}else{f.set("title",a.get("title"));if(!b){a.get("el").css("transform","");this.set("activeView",a);c.waitingView=null;h.hide()}}if(b){c.waitingView=a;a.controller.promise.then(function(){if(c.waitingView&&c.waitingView.uuid===a.uuid){c.set("activeView",a);c.waitingView=null;a.get("el").css("transform",
"");f.set("title",a.get("title"));h.hide()}})}},pop:function(a,b){var c=this;if(this.viewStack.length>1){this.viewStack.pop();a.uuid=i++;var f,e=this.get("loadingEl"),g=this.get("bar");if(f=this.get("activeView")){var h=this.animEl=f.get("el");h.stop(true);h.animate({transform:"translateX("+f.get("el")[0].offsetWidth+"px) translateZ(0)"},{useTransition:true,easing:"ease-in-out",duration:0.25});if(b){this.set("activeView",null);e.stop(true);e.css("left","-100%");e.show();e.animate({left:"0"},{useTransition:true,
easing:"ease-in-out",duration:0.25})}else{f=a.get("el");f.stop(true);f.css("transform","translateX(-"+h[0].offsetWidth+"px) translateZ(0)");f.animate({transform:""},{useTransition:true,easing:"ease-in-out",duration:0.25});this.set("activeView",a)}}else if(!b){a.get("el").css("transform","");this.set("activeView",a);c.waitingView=null;e.hide()}g.back(a.get("title"),this.viewStack.length>1);if(b){c.waitingView=a;a.controller.promise.then(function(){if(c.waitingView&&c.waitingView.uuid===a.uuid){c.waitingView=
null;c.set("activeView",a);a.get("el").css("transform","");g.set("title",a.get("title"));e.hide()}})}}}},{SubView:k,Controller:b,xclass:"navigation-view",ATTRS:{barCfg:{},activeView:{},loadingEl:{},handleMouseEvents:{value:false},focusable:{value:false},xrender:{value:l},contentTpl:{value:n},defaultChildCfg:{value:{xclass:"navigation-sub-view"}}}})});
