/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 14 20:26
*/
KISSY.add("navigation-view/bar-xtpl",[],function(){return function(l){var a,h=this;a=this.config.utils;var f=a.runBlockCommand,m=a.renderOutput,k=a.getProperty,o=a.runInlineCommand,p=a.getPropertyOrRunCommand;a="";var n={},q=[],k=k(h,l,"withTitle",0,1);q.push(k);n.params=q;n.fn=function(b){var d;d='\r\n<div class="';var c={},e=[];e.push("title-wrap");c.params=e;c=o(h,b,c,"getBaseCssClasses",2);d+=m(c,!0);d+='">\r\n    <div class="';c={};e=[];e.push("title");c.params=e;c=o(h,b,c,"getBaseCssClasses",
3);d+=m(c,!0);d+='" id="ks-navigation-bar-title-';c=p(h,b,{},"id",0,3);d+=m(c,!0);d+='">';b=p(h,b,{},"title",0,3);d+=m(b,!0);return d+"</div>\r\n</div>\r\n"};a+=f(h,l,n,"if",1);a+='\r\n<div class="';f={};k=[];k.push("content");f.params=k;f=o(h,l,f,"getBaseCssClasses",6);a+=m(f,!0);a+='" id="ks-navigation-bar-content-';f=p(h,l,{},"id",0,6);a+=m(f,!0);a+='">\r\n    <div class="';f={};k=[];k.push("center");f.params=k;f=o(h,l,f,"getBaseCssClasses",7);a+=m(f,!0);a+='" id="ks-navigation-bar-center-';l=
p(h,l,{},"id",0,7);a+=m(l,!0);return a+'"></div>\r\n</div>'}});
KISSY.add("navigation-view/bar-render",["./bar-xtpl","component/control"],function(l,a){var h=a("./bar-xtpl");return a("component/control").getDefaultRender().extend({createDom:function(){var a={centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"};this.control._withTitle&&(a.titleEl="#ks-navigation-bar-title-{id}");this.fillChildrenElsBySelectors(a)},_onSetTitle:function(a){this.control._withTitle&&this.control.get("titleEl").html(a)},_onSetBackText:function(a){this.control._backBtn&&
this.control._backBtn.set("content",a)}},{ATTRS:{contentTpl:{value:h}}})});
KISSY.add("navigation-view/bar",["component/control","./bar-render","button"],function(l,a){function h(a){var b;b=a.clone(!0);b[0].id=a[0].id+"-proxy";a.parent().append(b);var d=a.offset();b.css("position","absolute");b.offset(d);b.css({width:a.css("width"),height:a.css("height")});return b}function f(a,b,d){a.animate(b,{duration:0.25,useTransition:!0,easing:"ease-in-out",complete:d})}function m(a,b,d,c){var e=a.get("el"),g=a.get("titleEl"),a=Math.min(e[0].offsetWidth/3,200),f=b[0].offsetWidth,b=
e[0].offsetWidth,e=g.offset().left-e.offset().left,g=g[0].offsetWidth,i=d.width,j;c?(d=-i,i=Math.min(e-i,a)):(i=-i,d=Math.min(e,a));a={element:{from:{transform:"translateX("+d+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}};f=-e+f;g>e&&(j=-e-g);c?(i=b-e-g,d=void 0!==j?j:f):(i=void 0!==j?j:f,d=Math.max(0,b-e-g));return{back:a,title:{element:{from:{transform:"translateX("+d+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+i+"px) translateZ(0)",opacity:0}}}}}function k(){this.fire("back")}var o=a("component/control"),p=a("./bar-render"),n=a("button");return o.extend({initializer:function(){this._withTitle=this.get("withTitle")},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new n({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-back",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},
bindUI:function(){if(this._backBtn)this._backBtn.on("click",k,this)},addButton:function(a,b){var d=this.get("prefixCls");b.prefixCls=d+"navigation-bar-";!b.elBefore&&!b.render&&(d=b.align=b.align||"left","left"===d?b.elBefore=this.get("centerEl"):"right"===d&&(b.render=this.get("contentEl")),delete b.align);this._buttons[a]=(new n(b)).render();return this._buttons[a]},insertButtonBefore:function(a,b,d){b.elBefore=d.get("el");return this.addButton(a,b)},removeButton:function(a){this._buttons[a].destroy();
delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this.go(a,!0)},go:function(a,b,d){var c=this,e=c._backBtn;if(!e||!c._withTitle){if(c._withTitle&&c.get("titleEl").html(a),e)e[b?"show":"hide"]()}else{var g=e.get("el");g.stop(!0);c.ghostBackEl&&c.ghostBackEl.stop(!0);var k={width:g[0].offsetWidth},i=h(g);c.ghostBackEl=i;g.css("opacity",0);e[b?"show":"hide"]();c.ghostBackEl&&c.ghostBackEl.stop(!0);b=m(c,g,k,d);g.css(b.back.element.from);e.get("visible")&&f(g,
b.back.element.to);"none"!==i.css("display")?f(i,b.back.ghost.to,function(){i.remove();c.ghostBackEl=null}):(i.remove(),c.ghostBackEl=null);e=c.get("titleEl");e.stop(!0);var j=h(e.parent());c.ghostTitleEl=j;e.css("opacity",0);c.set("title",a);e.css(b.title.element.from);f(e,b.title.element.to);f(j,b.title.ghost.to,function(){j.remove();c.ghostTitleEl=null})}},back:function(a,b){this.go(a,b,!0)}},{xclass:"navigation-bar",ATTRS:{handleMouseEvents:{value:!1},focusable:{value:!1},xrender:{value:p},centerEl:{},
contentEl:{},titleEl:{},title:{value:"",view:1},withBackButton:{value:1},withTitle:{value:1,view:1},backText:{value:"Back",view:1}}})});
KISSY.add("navigation-view",["node","component/container","navigation-view/bar","component/extension/content-xtpl","component/extension/content-render"],function(l,a){function h(b){b.target===this.get("bar")&&this.pop()}function f(b){var a=b.get("children").concat(),c=b.get("viewCacheSize");if(!(a.length<=c)){c=Math.floor(c/3);a.sort(function(b,a){return b.uuid-a.uuid});for(var e=0;e<c;e++)b.removeChild(a[e])}}var m=a("node").all,k=a("component/container"),o=a("navigation-view/bar"),p=a("component/extension/content-xtpl"),
n=a("component/extension/content-render"),q=0,n=k.getDefaultRender().extend([n],{renderUI:function(){var b=m(l.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(b);this.control.loadingEl=b}});return k.extend({initializer:function(){this.publish("back",{defaultFn:h,defaultTargetOnly:!1})},
isLoading:function(){return"none"!==this.loadingEl.css("display")},renderUI:function(){this.viewStack=[];var b;b=this.get("barCfg");b.elBefore=this.get("el")[0].firstChild;this.setInternal("bar",b=(new o(b)).render());b.addTarget(this)},createView:function(b){var a;a:{a=this.get("children");for(var c=b.viewId,e=0;e<a.length;e++)if(a[e].constructor.xclass===b.xclass)if(c){if(a[e].get("viewId")===c){a=a[e];break a}}else{a=a[e];break a}a=null}a||(a=this.addChild(b),a.get("el").css("transform","translateX(-9999px) translateZ(0)"));
return a},push:function(a){var d=this,c,e=d.viewStack,g=d.get("bar");c=d.createView(a);var h=c.get("el");c.uuid=q++;var i=d.get("activeView"),j=this.loadingEl;e.push(a);i&&i.leave&&i.leave();a&&c.set(a);c.enter&&c.enter();a=c.promise;d.isLoading()?(g.set("title",c.get("title")),a||(f(d),c.get("el").css("transform",""),j.hide())):(i=i.get("el"),i.stop(!0),i.animate({transform:"translateX(-"+i[0].offsetWidth+"px) translateZ(0)"},{useTransition:!0,easing:"ease-in-out",duration:0.25}),a?(j.stop(!0),j.css("left",
"100%"),j.show(),j.animate({left:"0"},{useTransition:!0,easing:"ease-in-out",duration:0.25}),d.set("activeView",null)):(f(d),h.stop(!0),h.css("transform","translateX("+i[0].offsetWidth+"px) translateZ(0)"),h.animate({transform:""},{useTransition:!0,easing:"ease-in-out",duration:0.25}),d.set("activeView",c)),g.forward(c.get("title")||""));d.set("activeView",c);a&&a.then(function(){var a=d.get("activeView");if(a&&a.uuid===c.uuid){f(d);c.get("el").css("transform","");g.set("title",c.get("title")||"");
j.hide()}})},replace:function(a){var d=this.viewStack;l.mix(d[d.length-1],a)},pop:function(){var a=this,d=a.viewStack;if(1<d.length){d.pop();var c=d[d.length-1],e=a.createView(c);e.uuid=q++;var g=a.get("activeView"),h=a.loadingEl,i=a.get("bar");g&&g.leave&&g.leave();e.set(c);e.enter&&e.enter();c=e.promise;if(a.isLoading())c||(f(a),e.get("el").css("transform",""),h.hide());else{var j=g.get("el");j.stop(!0);j.animate({transform:"translateX("+g.get("el")[0].offsetWidth+"px) translateZ(0)"},{useTransition:!0,
easing:"ease-in-out",duration:0.25});c?(a.set("activeView",null),h.stop(!0),h.css("left","-100%"),h.show(),h.animate({left:"0"},{useTransition:!0,easing:"ease-in-out",duration:0.25})):(f(a),g=e.get("el"),g.stop(!0),g.css("transform","translateX(-"+j[0].offsetWidth+"px) translateZ(0)"),g.animate({transform:""},{useTransition:!0,easing:"ease-in-out",duration:0.25}),a.set("activeView",e))}a.set("activeView",e);i.back(e.get("title")||"",1<d.length);c&&c.then(function(){var c=a.get("activeView");c&&c.uuid===
e.uuid&&(f(a),e.get("el").css("transform",""),i.set("title",e.get("title")||""),h.hide())})}}},{xclass:"navigation-view",ATTRS:{barCfg:{value:{}},handleMouseEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},allowTextSelection:{value:!0},xrender:{value:n},contentTpl:{value:p},defaultChildCfg:{value:{handleMouseEvents:!1,allowTextSelection:!0}}}})});
