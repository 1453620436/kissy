/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 16 20:32
*/
KISSY.add("navigation-view/bar-xtpl",[],function(){return function(h){var a,i=this;a=this.config.utils;var c=a.runBlockCommand,k=a.renderOutput,j=a.getProperty,n=a.runInlineCommand,o=a.getPropertyOrRunCommand;a="";var p={},g=[],j=j(i,h,"withTitle",0,1);g.push(j);p.params=g;p.fn=function(b){var g;g='\r\n<div class="';var a={},d=[];d.push("title-wrap");a.params=d;a=n(i,b,a,"getBaseCssClasses",2);g+=k(a,!0);g+='">\r\n    <div class="';a={};d=[];d.push("title");a.params=d;a=n(i,b,a,"getBaseCssClasses",
3);g+=k(a,!0);g+='" id="ks-navigation-bar-title-';a=o(i,b,{},"id",0,3);g+=k(a,!0);g+='">';b=o(i,b,{},"title",0,3);g+=k(b,!0);return g+"</div>\r\n</div>\r\n"};a+=c(i,h,p,"if",1);a+='\r\n<div class="';c={};j=[];j.push("content");c.params=j;c=n(i,h,c,"getBaseCssClasses",6);a+=k(c,!0);a+='" id="ks-navigation-bar-content-';c=o(i,h,{},"id",0,6);a+=k(c,!0);a+='">\r\n    <div class="';c={};j=[];j.push("center");c.params=j;c=n(i,h,c,"getBaseCssClasses",7);a+=k(c,!0);a+='" id="ks-navigation-bar-center-';h=
o(i,h,{},"id",0,7);a+=k(h,!0);return a+'"></div>\r\n</div>'}});
KISSY.add("navigation-view/bar-render",["./bar-xtpl","component/control"],function(h,a){var i=a("./bar-xtpl");return a("component/control").getDefaultRender().extend({createDom:function(){var a={centerEl:"#ks-navigation-bar-center-{id}",contentEl:"#ks-navigation-bar-content-{id}"};this.control._withTitle&&(a.titleEl="#ks-navigation-bar-title-{id}");this.fillChildrenElsBySelectors(a)},_onSetTitle:function(a){this.control._withTitle&&this.control.get("titleEl").html(a)},_onSetBackText:function(a){this.control._backBtn&&
this.control._backBtn.set("content",a)}},{ATTRS:{contentTpl:{value:i}}})});
KISSY.add("navigation-view/bar",["component/control","./bar-render","button"],function(h,a){function i(a){var b;b=a.clone(!0);b[0].id=a[0].id+"-proxy";a.parent().append(b);var m=a.offset();b.css("position","absolute");b.offset(m);b.css({width:a.css("width"),height:a.css("height")});return b}function c(a,b,m){a.animate(b,{duration:0.25,useTransition:!0,easing:"ease-in-out",complete:m})}function k(a,b,m,e){var d=a.get("el"),c=a.get("titleEl"),a=Math.min(d[0].offsetWidth/3,200),q=b[0].offsetWidth,b=
d[0].offsetWidth,d=c.offset().left-d.offset().left,c=c[0].offsetWidth,f=m.width,l;e?(m=-f,f=Math.min(d-f,a)):(f=-f,m=Math.min(d,a));a={element:{from:{transform:"translateX("+m+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+f+"px) translateZ(0)",opacity:0}}};q=-d+q;c>d&&(l=-d-c);e?(f=b-d-c,m=void 0!==l?l:q):(f=void 0!==l?l:q,m=Math.max(0,b-d-c));return{back:a,title:{element:{from:{transform:"translateX("+m+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",
opacity:1}},ghost:{to:{transform:"translateX("+f+"px) translateZ(0)",opacity:0}}}}}function j(){this.fire("back")}var n=a("component/control"),o=a("./bar-render"),p=a("button");return n.extend({initializer:function(){this._withTitle=this.get("withTitle")},renderUI:function(){var a=this.get("prefixCls");this._buttons={};this.get("withBackButton")&&(this._backBtn=(new p({prefixCls:a+"navigation-bar-",elCls:a+"navigation-bar-back",elBefore:this.get("contentEl")[0].firstChild,visible:!1,content:this.get("backText")})).render())},
bindUI:function(){if(this._backBtn)this._backBtn.on("click",j,this)},addButton:function(a,b){var c=this.get("prefixCls");b.prefixCls=c+"navigation-bar-";!b.elBefore&&!b.render&&(c=b.align=b.align||"left","left"===c?b.elBefore=this.get("centerEl"):"right"===c&&(b.render=this.get("contentEl")),delete b.align);this._buttons[a]=(new p(b)).render();return this._buttons[a]},insertButtonBefore:function(a,b,c){b.elBefore=c.get("el");return this.addButton(a,b)},removeButton:function(a){this._buttons[a].destroy();
delete this._buttons[a]},getButton:function(a){return this._buttons[a]},forward:function(a){this.go(a,!0)},go:function(a,b,j){var e=this,d=e._backBtn;if(!d||!e._withTitle){if(e._withTitle&&e.get("titleEl").html(a),d)d[b?"show":"hide"]()}else{var h=d.get("el");h.stop(!0);e.ghostBackEl&&e.ghostBackEl.stop(!0);var q={width:h[0].offsetWidth},f=i(h);e.ghostBackEl=f;h.css("opacity",0);d[b?"show":"hide"]();e.ghostBackEl&&e.ghostBackEl.stop(!0);b=k(e,h,q,j);h.css(b.back.element.from);d.get("visible")&&c(h,
b.back.element.to);"none"!==f.css("display")?c(f,b.back.ghost.to,function(){f.remove();e.ghostBackEl=null}):(f.remove(),e.ghostBackEl=null);d=e.get("titleEl");d.stop(!0);var l=i(d.parent());e.ghostTitleEl=l;d.css("opacity",0);e.set("title",a);d.css(b.title.element.from);c(d,b.title.element.to);c(l,b.title.ghost.to,function(){l.remove();e.ghostTitleEl=null})}},back:function(a,b){this.go(a,b,!0)}},{xclass:"navigation-bar",ATTRS:{handleMouseEvents:{value:!1},focusable:{value:!1},xrender:{value:o},centerEl:{},
contentEl:{},titleEl:{},title:{value:"",view:1},withBackButton:{value:1},withTitle:{value:1,view:1},backText:{value:"Back",view:1}}})});
KISSY.add("navigation-view",["node","component/container","navigation-view/bar","component/extension/content-xtpl","component/extension/content-render"],function(h,a){function i(a){a.target===this.get("bar")&&this.pop()}function c(a){var f=a.get("children").concat(),l=a.get("viewCacheSize");if(!(f.length<=l)){l=Math.floor(l/3);f.sort(function(a,f){return a.uuid-f.uuid});for(var b=0;b<l;b++)a.removeChild(f[b])}}function k(a,f,b){return a.view.getBaseCssClass("anim-"+f+"-"+(b?"enter":"leave"))}function j(a,
f,b){var c=a[0].className,d=c,c=c.match(f.animateClassRegExp)?c.replace(f.animateClassRegExp,b):c+(" "+b);b&&-1===c.indexOf(f.animatorClass)&&(c+=" "+f.animatorClass);c!==d&&(a[0].className=h.trim(c).replace(/\s+/," "))}function n(a,f){var b=a[0].className,c=b,b=b.replace(f.animateClassRegExp,"").replace(f.animatorClassRegExp,"");b!==c&&(a[0].className=h.trim(b).replace(/\s+/," "))}function o(a,f){var b=f.promise;a.set("activeView",f);c(a);b&&b.then(function(){var b=a.get("activeView");b&&b.uuid===
f.uuid&&(a.get("bar").set("title",f.get("title")||""),n(a.loadingEl,a),j(f.get("el"),a,a.animateNoneEnterClass))})}function p(a,b,c,d,h){var g=a.loadingEl,e=a.get("activeView");e&&e.leave&&e.leave();var i=c.get("el");c.set(b);c.enter&&c.enter();b=c.promise;e&&j(e.get("el"),a,h);b?(e?j(g,a,d):j(g,a,a.animateNoneEnterClass),n(i,a)):a.isLoading()||!e?(n(g,a),j(i,a,a.animateNoneEnterClass)):j(i,a,d)}var g=a("node").all,b=a("component/container"),m=a("navigation-view/bar"),e=a("component/extension/content-xtpl"),
d=a("component/extension/content-render"),r=0,d=b.getDefaultRender().extend([d],{renderUI:function(){var a=g(h.substitute('<div class="{prefixCls}navigation-view-loading"><div class="{prefixCls}navigation-view-loading-outer"><div class="{prefixCls}navigation-view-loading-inner"></div></div></div>',{prefixCls:this.control.get("prefixCls")}));this.control.get("contentEl").append(a);this.control.loadingEl=a}});return b.extend({initializer:function(){this.publish("back",{defaultFn:i,defaultTargetOnly:!1})},
isLoading:function(){return this.loadingEl.hasClass(this.animatorClass)},renderUI:function(){this.animateClassRegExp=RegExp(this.view.getBaseCssClass()+"-anim-[^\\s]+");this.animatorClass=this.view.getBaseCssClass("animator");this.animateNoneEnterClass=k(this,"none",!0);this.animatorClassRegExp=RegExp(this.animatorClass);this.viewStack=[];var a;a=this.get("barCfg");a.elBefore=this.get("el")[0].firstChild;this.setInternal("bar",a=(new m(a)).render());a.addTarget(this)},createView:function(a){var b;
a:{b=this.get("children");for(var c=a.viewId,d=0;d<b.length;d++)if(b[d].constructor.xclass===a.xclass)if(c){if(b[d].get("viewId")===c){b=b[d];break a}}else{b=b[d];break a}b=null}b||(b=this.addChild(a));return b},push:function(a){var b,c,d,e,h,g;c=this.viewStack;g=this.get("activeView");h=this.get("bar");a.animation=a.animation||this.get("animation");g||(a.animation={});b=this.createView(a);b.uuid=r++;c.push(a);c=b.get("animation");d=c.enter;e=c.leave;g&&(e=g.get("animation").leave||e);c=b.promise;
d=k(this,d,!0);e=k(this,e);p(this,a,b,d,e);g?h.forward(b.get("title")||""):c||h.set("title",b.get("title")||"");o(this,b)},replace:function(a){var b=this.viewStack;h.mix(b[b.length-1],a)},pop:function(){var a,b,c,d,e=this.viewStack;1<e.length&&(e.pop(),a=this.get("activeView"),b=e[e.length-1],c=this.createView(b),c.uuid=r++,d=k(this,c.get("animation").leave||a.get("animation").leave,!0),a=k(this,a.get("animation").enter),p(this,b,c,d,a),this.get("bar").back(c.get("title")||"",1<e.length),o(this,c))}},
{xclass:"navigation-view",ATTRS:{barCfg:{value:{}},animation:{value:{enter:"slide-right",leave:"slide-left"}},handleMouseEvents:{value:!1},viewCacheSize:{value:20},focusable:{value:!1},allowTextSelection:{value:!0},xrender:{value:d},contentTpl:{value:e},defaultChildCfg:{value:{handleMouseEvents:!1,allowTextSelection:!0}}}})});
