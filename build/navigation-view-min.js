/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 10 18:48
*/
KISSY.add("navigation-view",["component/container","component/control","component/extension/content-xtpl","component/extension/content-box"],function(k,h){function l(a,c,b){return a+"navigation-view-"+("anim-"+c+"-"+(b?"enter":"leave"))+" "+a+"navigation-view-anim-ing"}function m(a,c,b){a=a.get("animation");return"string"===typeof a?a:b?c?a[1]:a[0]:c?a[0]:a[1]}function i(a,c,b){j(a);b=m(a,c,b);"none"===b?c?a.show():a.hide():(a.show(),a.$el.addClass(a._viewAnimCss=l(a.get("prefixCls"),b,c)))}function j(a){a._viewAnimCss&&
(a.$el.removeClass(a._viewAnimCss),a._viewAnimCss=null)}function n(a,c,b){var e=a.loadingView,d=c.view,c=c.fromCache,f=a.get("activeView");a.fire("beforeInnerViewChange",{oldView:f,newView:d,backward:b});f&&f.leave&&f.leave();a.set("activeView",d);d.enter&&d.enter({fromCache:c});(c=d.promise)?(f?(i(f,!1,b),e.transition(!0,b)):e.show(),c.then(function(){if(a.get("activeView")===d){e.hide();d.show();a.fire("afterInnerViewChange",{newView:d,oldView:f,backward:b})}})):(e.get("visible")?(e.transition(!1,
b),i(d,!0,b)):f?(i(f,!1,b),i(d,!0,b)):d.show(),a.fire("afterInnerViewChange",{newView:d,oldView:f,backward:b}));q(a)}function q(a){var c=a.get("children").concat(),b=a.get("viewCacheSize");if(!(c.length<=b)){b=Math.floor(b/3);c.sort(function(a,b){return a.timeStamp-b.timeStamp});for(var e=0;e<b;e++)a.removeChild(c[e])}}function r(){j(this);this.get("navigationView").get("activeView")===this?this.show():this.hide()}function o(a,c){var b;a:{b=a.get("children");for(var e=c.viewId,d=0;d<b.length;d++)if(b[d].constructor.xclass===
c.xclass)if(e){if(b[d].get("viewId")===e){b=b[d];break a}}else{b=b[d];break a}b=null}e=!!b;b?b.set(c):(b=a.addChild(c),b.$el.on(p,r,b));b.timeStamp=k.now();return{view:b,fromCache:e}}var g=k.Feature.getCssVendorInfo("animation"),p=(g=g&&g.propertyNamePrefix)?g.toLowerCase()+"AnimationEnd":"animationend webkitAnimationEnd",g=h("component/container"),s=h("component/control"),t=h("component/extension/content-xtpl"),u=h("component/extension/content-box"),v=s.extend({bindUI:function(){var a=this;a.$el.on(p,
function(){j(a);a.active||a.hide()})},transition:function(a,c){this.active=a;var b=this.navigationView.get("activeView");j(this);var e=m(b,a,c);"none"===e?a?this.show():this.hide():(this.show(),this.$el.addClass(this._viewAnimCss=l(b.get("prefixCls"),e,a)))}},{xclass:"navigation-view-loading",ATTRS:{handleGestureEvents:{value:!1},visible:{value:!1}}});return g.extend([u],{initializer:function(){this.viewStack=[]},createDom:function(){var a=this.get("loadingHtml");!1!==a&&(this.loadingView=(new v({content:a,
render:this.contentEl})).render(),this.loadingView.navigationView=this)},_onSetLoadingHtml:function(a){this.loadingView&&this.loadingView.set("content",a)},push:function(a){var c=this.viewStack;a.animation=a.animation||this.get("animation");a.navigationView=this;c.push(a);n(this,o(this,a))},replace:function(a){var c=this.viewStack;k.mix(c[c.length-1],a);this.get("activeView").set(a)},pop:function(a){a=this.viewStack;1<a.length&&(a.pop(),a=a[a.length-1],n(this,o(this,a),!0))}},{xclass:"navigation-view",
ATTRS:{animation:{value:["slide-right","slide-left"]},loadingHtml:{sync:0},handleGestureEvents:{value:!1},viewCacheSize:{value:10},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:t},defaultChildCfg:{value:{handleGestureEvents:!1,visible:!1,allowTextSelection:!0}}}})});
