/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 20 14:34
*/
KISSY.add("attribute",["event/custom"],function(h,g){function o(d,a){return"string"==typeof a?d[a]:a}function p(d){return d.__attrVals||(d.__attrVals={})}function q(d,a,c,b,e,f,j,g){j=j||c;return d.fire(a+h.ucfirst(c)+"Change",h.mix({attrName:j,subAttrName:f,prevVal:b,newVal:e},g))}function l(d,a,c){var b=d[a];!c&&!b&&(d[a]=b={});return b||{}}function t(d,a){for(var c=0,b=a.length;d!=g&&c<b;c++)d=d[a[c]];return d}function u(d){var a;-1!==d.indexOf(".")&&(a=d.split("."),d=a.shift());return{path:a,
name:d}}function v(d,a,c){var b=c;if(a){var d=b=d===g?{}:h.clone(d),e=a.length-1;if(0<=e){for(var f=0;f<e;f++)d=d[a[f]];d!=g&&(d[a[f]]=c)}}return b}function w(d,a,c,b,e){var f,j,k;f=u(a);var C=a,a=f.name;f=f.path;k=d.get(a);var m=a,n=l(d,"__defaultBeforeFns");n[m]||(n[m]=1,m="before"+h.ucfirst(m)+"Change",d.publish(m,{defaultFn:x}));f&&(j=t(k,f));if(!b.force&&(!f&&k===c||f&&j===c))return g;c=v(k,f,c);c=h.mix({attrName:a,subAttrName:C,prevVal:k,newVal:c,_opts:b,_attrs:e,target:d},b.data);if(b.silent){if(i===
x.call(d,c))return i}else if(i===d.fire("before"+h.ucfirst(a)+"Change",c))return i;return d}function x(d){if(d.target!==this)return g;var a=d.newVal,c=d.prevVal,b=d.attrName,e=d.subAttrName,f=d._attrs,d=d._opts,a=this.setInternal(b,a);if(a===i)return a;d.silent||(a=p(this)[b],q(this,"after",b,c,a,e,null,d.data),f?f.push({prevVal:c,newVal:a,attrName:b,subAttrName:e}):q(this,"","*",[c],[a],[e],[b],d.data));return g}function r(d){var a=this.constructor;for(this.userConfig=d;a;){var c=a.ATTRS;if(c){var b=
void 0;for(b in c)this.addAttr(b,c[b],!1)}a=a.superclass?a.superclass.constructor:null}if(d)for(var e in d)this.setInternal(e,d[e])}function y(d,a){var c=a.__hooks__||{},b;for(b in c)b in d&&(d[b]=c[b](d[b]));h.each(d,function(b,c){if("function"==typeof b){var h=0;if(b.__owner__){var g=b.__owner__;delete b.__owner__;delete b.__name__;var h=b.__wrapped__=1,i=z(b);i.__owner__=g;i.__name__=c;g.prototype[c]=i}else b.__wrapped__&&(h=1);h&&(d[c]=b=z(b));b.__owner__=a;b.__name__=c}})}function D(d){y(d,this);
h.mix(this.prototype,d)}function s(d,a){var c=d.getAttrs(),b=l(c,a,1),e=b.valueFn;if(e&&(e=o(d,e)))e=e.call(d),e!==g&&(b.value=e),delete b.valueFn,c[a]=b;return b.value}function A(d,a,c,b){var e,f;e=u(a);a=e.name;if(e=e.path)f=d.get(a),c=v(f,e,c);if((e=l(d.getAttrs(),a).validator)&&(e=o(d,e)))if(d=e.call(d,c,a,b),d!==g&&!0!==d)return d;return g}var E=this.require("event/custom");this.exports=r;var z=h.bind,B={},i=!1;r.extend=function a(c,b){var e,b=b||{},c=c||{},f=b.__hooks__;if(e=this.__hooks__)f=
b.__hooks__=b.__hooks__||{},h.mix(f,e,!1);e=c.hasOwnProperty("constructor")?c.constructor:function(){this.callSuper.apply(this,arguments)};c.constructor=e;e.__hooks__=f;y(c,e);var g=b.inheritedStatics;if(f=this.inheritedStatics)g=b.inheritedStatics=b.inheritedStatics||{},h.mix(g,f,!1);h.extend(e,this,c,b);g&&h.mix(e,g);e.extend=b.extend||a;e.addMembers=D;return e};h.augment(r,E.Target,{INVALID:B,callSuper:function(){var a,c,b=arguments;"function"==typeof this&&this.__name__?(a=this,c=b[0],b=Array.prototype.slice.call(b,
1)):(a=arguments.callee.caller,a.__wrapped__&&(a=a.caller),c=this);var e=a.__name__;if(!e)return g;a=a.__owner__.superclass[e];return!a?g:a.apply(c,b||[])},getAttrs:function(){return this.__attrs||(this.__attrs={})},getAttrVals:function(){var a={},c,b=this.getAttrs();for(c in b)a[c]=this.get(c);return a},addAttr:function(a,c,b){var e=this.getAttrs(),f,c=h.clone(c);(f=e[a])?h.mix(f,c,b):e[a]=c;return this},addAttrs:function(a,c){var b=this;h.each(a,function(a,c){b.addAttr(c,a)});c&&b.set(c);return b},
hasAttr:function(a){return this.getAttrs().hasOwnProperty(a)},removeAttr:function(a){var c=p(this),b=this.getAttrs();this.hasAttr(a)&&(delete b[a],delete c[a]);return this},set:function(a,c,b){if(h.isPlainObject(a)){var b=c||{},c=Object(a),e=[],f,j=[];for(a in c)(f=A(this,a,c[a],c))!==g&&j.push(f);if(j.length)return b.error&&b.error(j),i;for(a in c)w(this,a,c[a],b,e);var k=[],l=[],m=[],n=[];h.each(e,function(a){l.push(a.prevVal);m.push(a.newVal);k.push(a.attrName);n.push(a.subAttrName)});k.length&&
q(this,"","*",l,m,n,k,b.data);return this}b=b||{};f=A(this,a,c);return f!==g?(b.error&&b.error(f),i):w(this,a,c,b)},setInternal:function(a,c){var b=g,e=l(this.getAttrs(),a).setter;if(e&&(e=o(this,e)))b=e.call(this,c,a);if(b===B)return i;b!==g&&(c=b);p(this)[a]=c;return g},get:function(a){var c,b=p(this),e,f;-1!==a.indexOf(".")&&(c=a.split("."),a=c.shift());e=l(this.getAttrs(),a,1).getter;f=a in b?b[a]:s(this,a);if(e&&(e=o(this,e)))f=e.call(this,f,a);!(a in b)&&f!==g&&(b[a]=f);c&&(f=t(f,c));return f},
reset:function(a,c){if("string"==typeof a)return this.hasAttr(a)?this.set(a,s(this,a),c):this;var c=a,b=this.getAttrs(),e={};for(a in b)e[a]=s(this,a);this.set(e,c);return this}})});
