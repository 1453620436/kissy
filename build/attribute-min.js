/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 19 01:41
*/
KISSY.add("attribute",[],function(h,g){function i(a,b){return"string"==typeof b?a[b]:b}function n(a){return a.__attrVals||(a.__attrVals={})}function o(a,b,c,d,e,f,g,j){g=g||c;return a.fire(b+h.ucfirst(c)+"Change",h.mix({attrName:g,subAttrName:f,prevVal:d,newVal:e},j))}function k(a,b,c){var d=a[b];!c&&!d&&(a[b]=d={});return d||{}}function r(a,b){for(var c=0,d=b.length;a!=g&&c<d;c++)a=a[b[c]];return a}function s(a){var b;-1!==a.indexOf(".")&&(b=a.split("."),a=b.shift());return{path:b,name:a}}function t(a,
b,c){var d=c;if(b){var a=d=a===g?{}:h.clone(a),e=b.length-1;if(0<=e){for(var f=0;f<e;f++)a=a[b[f]];a!=g&&(a[b[f]]=c)}}return d}function u(a,b,c,d,e){var f,q,j;f=s(b);var i=b,b=f.name;f=f.path;j=a.get(b);var l=b,v=k(a,"__defaultBeforeFns");v[l]||(v[l]=1,l="before"+h.ucfirst(l)+"Change",a.publish(l,{defaultFn:w}));f&&(q=r(j,f));if(!d.force&&(!f&&j===c||f&&q===c))return g;c=t(j,f,c);c=h.mix({attrName:b,subAttrName:i,prevVal:j,newVal:c,_opts:d,_attrs:e,target:a},d.data);if(d.silent){if(m===w.call(a,c))return m}else if(m===
a.fire("before"+h.ucfirst(b)+"Change",c))return m;return a}function w(a){if(a.target!==this)return g;var b=a.newVal,c=a.prevVal,d=a.attrName,e=a.subAttrName,f=a._attrs,a=a._opts,b=this.setInternal(d,b);if(b===m)return b;a.silent||(b=n(this)[d],o(this,"after",d,c,b,e,null,a.data),f?f.push({prevVal:c,newVal:b,attrName:d,subAttrName:e}):o(this,"","*",[c],[b],[e],[d],a.data));return g}function p(a,b){var c=a.getAttrs(),d=k(c,b,1),e=d.valueFn;if(e&&(e=i(a,e)))e=e.call(a),e!==g&&(d.value=e),delete d.valueFn,
c[b]=d;return d.value}function x(a,b,c,d){var e,f;e=s(b);b=e.name;if(e=e.path)f=a.get(b),c=t(f,e,c);if((e=k(a.getAttrs(),b).validator)&&(e=i(a,e)))if(a=e.call(a,c,b,d),a!==g&&!0!==a)return a;return g}var y={},m=!1;return{INVALID:y,getAttrs:function(){return this.__attrs||(this.__attrs={})},getAttrVals:function(){var a={},b,c=this.getAttrs();for(b in c)a[b]=this.get(b);return a},addAttr:function(a,b,c){var d=this.getAttrs(),e,b=h.clone(b);(e=d[a])?h.mix(e,b,c):d[a]=b;return this},addAttrs:function(a,
b){var c=this;h.each(a,function(a,b){c.addAttr(b,a)});b&&c.set(b);return c},hasAttr:function(a){return this.getAttrs().hasOwnProperty(a)},removeAttr:function(a){var b=n(this),c=this.getAttrs();this.hasAttr(a)&&(delete c[a],delete b[a]);return this},set:function(a,b,c){if(h.isPlainObject(a)){var c=b||{},b=Object(a),d=[],e,f=[];for(a in b)(e=x(this,a,b[a],b))!==g&&f.push(e);if(f.length)return c.error&&c.error(f),m;for(a in b)u(this,a,b[a],c,d);var i=[],j=[],k=[],l=[];h.each(d,function(a){j.push(a.prevVal);
k.push(a.newVal);i.push(a.attrName);l.push(a.subAttrName)});i.length&&o(this,"","*",j,k,l,i,c.data);return this}c=c||{};e=x(this,a,b);return e!==g?(c.error&&c.error(e),m):u(this,a,b,c)},setInternal:function(a,b){var c=g,d=k(this.getAttrs(),a).setter;if(d&&(d=i(this,d)))c=d.call(this,b,a);if(c===y)return m;c!==g&&(b=c);n(this)[a]=b;return g},get:function(a){var b,c=n(this),d,e;-1!==a.indexOf(".")&&(b=a.split("."),a=b.shift());d=k(this.getAttrs(),a,1).getter;e=a in c?c[a]:p(this,a);if(d&&(d=i(this,
d)))e=d.call(this,e,a);!(a in c)&&e!==g&&(c[a]=e);b&&(e=r(e,b));return e},reset:function(a,b){if("string"==typeof a)return this.hasAttr(a)?this.set(a,p(this,a),b):this;var b=a,c=this.getAttrs(),d={};for(a in c)d[a]=p(this,a);this.set(d,b);return this}}});
