/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 15 17:44
*/
KISSY.add("dd/ddm",["node","base","ua"],function(d,b){function j(e){var a=e.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"===c&&(c=e.get("dragCursor"));e._shim.css({cursor:c,display:"block"});o&&s.call(e)}function h(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&d.each(a,function(e){e._active()})}function k(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&d.each(a,function(e){e._deActive()})}function i(e){var a=e.offset();return{left:a.left,
right:a.left+(e.__ddCachedWidth||e.outerWidth()),top:a.top,bottom:a.top+(e.__ddCachedHeight||e.outerHeight())}}function a(e,a){return e.left<=a.left&&e.right>=a.left&&e.top<=a.top&&e.bottom>=a.top}function c(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function l(a,c){var l=Math.max(a.top,c.top),n=Math.min(a.right,c.right),m=Math.min(a.bottom,c.bottom);return{left:Math.max(a.left,c.left),right:n,top:l,bottom:m}}function f(a){a&&(a.__ddCachedWidth=a.outerWidth(),a.__ddCachedHeight=
a.outerHeight())}var p=b("node"),g=b("base"),v=b("ua"),r=p.all,p=d.Env.host,t=p.document,u=r(t),w=r(p),o=6===v.ie,g=g.extend({addDrop:function(a){this.get("drops").push(a)},removeDrop:function(a){var c=this.get("drops"),a=d.indexOf(a,c);-1!==a&&c.splice(a,1)},start:function(a,c){this.setInternal("activeDrag",c);c.get("shim")&&q(this);this.__needDropCheck=0;c.get("groups")&&(h(this),this.get("validDrops").length&&(f(c.get("node")),this.__needDropCheck=1))},addValidDrop:function(a){this.get("validDrops").push(a)},
_notifyDropsMove:function(e,f){var b=this.get("validDrops"),n=f.get("mode"),m=0,g=0,p=i(f.get("node")),h=c(p);d.each(b,function(b){if(!b.get("disabled")){var d;if(d=b.getNodeFromTarget(e,f.get("dragNode")[0],f.get("node")[0]))if("point"===n)a(i(d),f.mousePos)&&(d=c(i(d)),m?d<g&&(m=b,g=d):(m=b,g=d));else if("intersect"===n)d=c(l(p,i(d))),d>g&&(g=d,m=b);else if("strict"===n&&(d=c(l(p,i(d))),d===h))return m=b,!1}});if((b=this.get("activeDrop"))&&b!==m)b._handleOut(e),f._handleOut(e);this.setInternal("activeDrop",
m);m&&(b!==m?m._handleEnter(e):m._handleOver(e))},move:function(a,c){this.__needDropCheck&&this._notifyDropsMove(a,c)},end:function(a){var c=this.get("activeDrop");this._shim&&this._shim.hide();k(this);c&&c._end(a);this.setInternal("activeDrop",null);this.setInternal("activeDrag",null)}},{ATTRS:{dragCursor:{value:"move"},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),q=function(a){a._shim=r('<div style="background-color:red;position:'+(o?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+
a.get("dragCursor")+';z-index:999999;"></div>').prependTo(t.body||t.documentElement).css("opacity",0);q=j;if(o)w.on("resize scroll",s,a);j(a)},s=d.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:u.width(),height:u.height()})},30),g=new g;g.inRegion=a;g.region=i;g.area=c;g.cacheWH=f;g.PREFIX_CLS="ks-dd-";return g});
KISSY.add("dd/draggable","node,event/gesture/base,./ddm,base,event/gesture/drag,ua".split(","),function(d,b){function j(a){return function(){this._isValidDrag&&a.apply(this,arguments)}}function h(){q.body.onselectstart=y;q.body.releaseCapture&&q.body.releaseCapture()}function k(a){a.preventDefault()}function i(){return false}function a(a){this._isValidDrag=0;this.onGestureStart(a)}var c=b("node"),l=b("event/gesture/base"),f=b("./ddm"),p=b("base"),g=b("event/gesture/drag"),v=b("ua"),r=c.all,t=r(document),
u=d.each,w=v.ie,o=f.PREFIX_CLS,q=d.Env.host.document,s=j(function(a){this._start(a)}),e=j(function(a){this._move(a)}),x=j(function(a){this._end(a)}),y;return p.extend({initializer:function(){this.addTarget(f);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a)},onGestureStart:function(a){var c=a.target;this._checkDragStartValid(a)&&this._checkHandler(c)&&this._prepare(a)},getEventTargetEl:function(){return this.get("node")},start:function(){var n=this.getEventTargetEl();
if(n)n.on(g.DRAG_START,s,this).on(g.DRAG,e,this).on(g.DRAG_END,x,this).on(l.START,a,this).on(["dragstart",g.DRAGGING],k)},stop:function(){var n=this.getEventTargetEl();n&&n.detach(g.DRAG_START,s,this).detach(g.DRAG,e,this).detach(g.DRAG_END,x,this).detach(l.START,a,this).detach(["dragstart",g.DRAGGING],k)},_onSetDisabled:function(a){var c=this.get("dragNode");if(c)c[a?"addClass":"removeClass"](o+"-disabled");this[a?"stop":"start"]()},_checkHandler:function(a){var c=this,b=c.get("handlers"),f=0;u(b,
function(b){if(b[0]===a||b.contains(a)){f=1;c.setInternal("activeHandler",b);return false}});return f},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&a.which!==1?0:1},_prepare:function(a){this._isValidDrag=1;if(w){y=q.body.onselectstart;q.body.onselectstart=i;q.body.setCapture&&q.body.setCapture();t.on(l.END,{fn:h,once:true})}this.get("halt")&&a.stopPropagation();a.gestureType==="mouse"&&a.preventDefault();this._allowMove&&this.setInternal("startNodePos",this.get("node").offset())},
_start:function(a){this.mousePos={left:a.pageX,top:a.pageY};f.start(a,this);this.fire("dragstart",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY});this.get("dragNode").addClass(o+"dragging")},_move:function(a){var c=a.pageX,b=a.pageY;a.gestureType==="touch"&&a.preventDefault();this.mousePos={left:c,top:b};c={drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY};if(b=
this._allowMove){var e=this.get("startNodePos"),l=e.left+a.deltaX,e=e.top+a.deltaY;c.left=l;c.top=e;this.setInternal("actualPos",{left:l,top:e});this.fire("dragalign",c)}l=1;this.fire("drag",c)===false&&(l=0);f.move(a,this);this.get("preventDefaultOnMove")&&a.preventDefault();l&&b&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){this._isValidDrag&&this._end()},_end:function(a){var a=a||{},c;this._isValidDrag=0;this.get("node").removeClass(o+"drag-over");this.get("dragNode").removeClass(o+
"dragging");(c=f.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:c}):this.fire("dragdropmiss",{drag:this});f.end(a,this);this.fire("dragend",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY})},_handleOut:function(){this.get("node").removeClass(o+"drag-over");this.fire("dragexit",{drag:this,drop:f.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(o+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",
a)},destructor:function(){this.stop()}},{name:"Draggable",ATTRS:{node:{setter:function(a){if(!(a instanceof c))return r(a)}},dragNode:{},shim:{value:false},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));u(a,function(b,e){typeof b==="function"&&(b=b.call(c));typeof b==="string"&&(b=c.get("node").one(b));b.nodeType&&(b=r(b));a[e]=b});c.setInternal("handlers",a);return a}},activeHandler:{},mode:{value:"point"},disabled:{value:false},move:{value:false},primaryButtonOnly:{value:true},
halt:{value:true},groups:{value:true},startNodePos:{},actualPos:{},preventDefaultOnMove:{value:true}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});
KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(d,b){var j=b("node"),h=b("./ddm"),k=b("./draggable"),i=h.PREFIX_CLS,a=j.all;return k.extend({_onSetNode:d.noop,_onSetDisabled:function(a){var b=this.get("container");b&&(b[a?"addClass":"removeClass"](i+"-disabled"),this[a?"stop":"start"]())},getEventTargetEl:function(){return this.get("container")},onGestureStart:function(c){var b,f;if(this._checkDragStartValid(c)){b=this.get("handlers");var d=a(c.target);(b=b.length?this._getHandler(d):
d)&&(f=this._getNode(b));f&&(this.setInternal("activeHandler",b),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(c))}},_getHandler:function(a){for(var b=this.get("container"),f=this.get("handlers");a&&a[0]!==b[0];){for(var d=0;d<f.length;d++)if(a.test(f[d]))return a;a=a.parent()}return null},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(c){return a(c)}},selector:{},handlers:{value:[],getter:0}}})});
KISSY.add("dd/droppable",["node","./ddm","base"],function(d,b){var j=b("node"),h=b("./ddm"),k=b("base"),i=h.PREFIX_CLS;return k.extend({initializer:function(){this.addTarget(h);h.addDrop(this)},getNodeFromTarget:function(a,c,b){var a=this.get("node"),f=a[0];return f===c||f===b?null:a},_active:function(){var a=h.get("activeDrag"),c=this.get("node"),b=this.get("groups"),a=a.get("groups");a:if(!0===a)b=1;else{for(var f in b)if(a[f]){b=1;break a}b=0}b?(h.addValidDrop(this),c&&(c.addClass(i+"drop-active-valid"),
h.cacheWH(c))):c&&c.addClass(i+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(i+"drop-active-valid").removeClass(i+"drop-active-invalid")},__getCustomEvt:function(a){return d.mix({drag:h.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(i+"drop-over");this.fire("dropenter",
a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i+"drop-over");this.fire("drophit",a)},destructor:function(){h.removeDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(a){if(a)return j.one(a)}},groups:{value:{}},disabled:{}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable"],function(d,b){function j(){var a=this.get("container"),b=[],d=this.get("selector");a.all(d).each(function(a){k.cacheWH(a);b.push(a)});this.__allNodes=b}var h=b("node"),k=b("./ddm"),i=b("./droppable").extend({initializer:function(){k.on("dragstart",j,this)},getNodeFromTarget:function(a,b,i){var f={left:a.pageX,top:a.pageY},a=this.__allNodes,h=0,g=Number.MAX_VALUE;a&&d.each(a,function(a){var d=a[0];d===i||d===b||(d=k.region(a),k.inRegion(d,
f)&&(d=k.area(d),d<g&&(g=d,h=a)))});h&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",h));return h},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(a){var b=this.get("node"),d=i.superclass._handleOut,f=this.callSuper,h=i.superclass._handleEnter,g=this.get("lastNode");g[0]!==b[0]?(this.setInternal("node",g),d.apply(this,arguments),this.setInternal("node",b),h.call(this,a)):f.call(this,a)},_end:function(a){this.callSuper(a);
this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return h.one(a)}}}});return i});KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(d,b){var j=b("dd/ddm"),h=b("dd/draggable"),k=b("dd/draggable-delegate"),i=b("dd/droppable-delegate"),a=b("dd/droppable"),j={Draggable:h,DDM:j,Droppable:a,DroppableDelegate:i,DraggableDelegate:k};return KISSY.DD=j});
