/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 19 20:31
*/
KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(q,c){var j=c("dd/ddm"),g=c("dd/draggable"),k=c("dd/draggable-delegate"),f=c("dd/droppable-delegate"),l=c("dd/droppable"),j={Draggable:g,DDM:j,Droppable:l,DroppableDelegate:f,DraggableDelegate:k};return KISSY.DD=j});
KISSY.add("dd/ddm",["util","node","base","ua"],function(q,c){function j(e){var a=e.get("activeDrag").get("activeHandler"),b="auto";a&&(b=a.css("cursor"));"auto"===b&&(b=e.get("dragCursor"));e._shim.css({cursor:b,display:"block"});o&&s.call(e)}function g(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&d.each(a,function(e){e._active()})}function k(e){var a=e.get("drops");e.setInternal("validDrops",[]);a.length&&d.each(a,function(e){e._deActive()})}function f(e){var a=e.offset();return{left:a.left,
right:a.left+(e.__ddCachedWidth||e.outerWidth()),top:a.top,bottom:a.top+(e.__ddCachedHeight||e.outerHeight())}}function l(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&a.bottom>=b.top}function a(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function b(a,b){var h=Math.max(a.top,b.top),t=Math.min(a.right,b.right),m=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:t,top:h,bottom:m}}function h(a){a&&(a.__ddCachedWidth=a.outerWidth(),a.__ddCachedHeight=
a.outerHeight())}var d=c("util"),n=c("node"),i=c("base"),x=c("ua"),r=n.all,n=q.Env.host,u=n.document,v=r(u),y=r(n),o=6===x.ie,i=i.extend({addDrop:function(a){this.get("drops").push(a)},removeDrop:function(a){var b=this.get("drops"),a=d.indexOf(a,b);-1!==a&&b.splice(a,1)},start:function(a,b){this.setInternal("activeDrag",b);b.get("shim")&&p(this);this.__needDropCheck=0;b.get("groups")&&(g(this),this.get("validDrops").length&&(h(b.get("node")),this.__needDropCheck=1))},addValidDrop:function(a){this.get("validDrops").push(a)},
_notifyDropsMove:function(e,h){var c=this.get("validDrops"),t=h.get("mode"),m=0,w=0,i=f(h.get("node")),g=a(i);d.each(c,function(c){if(!c.get("disabled")){var d;if(d=c.getNodeFromTarget(e,h.get("dragNode")[0],h.get("node")[0]))if("point"===t)l(f(d),h.mousePos)&&(d=a(f(d)),m?d<w&&(m=c,w=d):(m=c,w=d));else if("intersect"===t)d=a(b(i,f(d))),d>w&&(w=d,m=c);else if("strict"===t&&(d=a(b(i,f(d))),d===g))return m=c,!1}});if((c=this.get("activeDrop"))&&c!==m)c._handleOut(e),h._handleOut(e);this.setInternal("activeDrop",
m);m&&(c!==m?m._handleEnter(e):m._handleOver(e))},move:function(a,b){this.__needDropCheck&&this._notifyDropsMove(a,b)},end:function(a){var b=this.get("activeDrop");this._shim&&this._shim.hide();k(this);b&&b._end(a);this.setInternal("activeDrop",null);this.setInternal("activeDrag",null)}},{ATTRS:{dragCursor:{value:"move"},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),p=function(a){a._shim=r('<div style="background-color:red;position:'+(o?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+
a.get("dragCursor")+';z-index:999999;"></div>').prependTo(u.body||u.documentElement).css("opacity",0);p=j;if(o)y.on("resize scroll",s,a);j(a)},s=d.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:v.width(),height:v.height()})},30),i=new i;i.inRegion=l;i.region=f;i.area=a;i.cacheWH=h;i.PREFIX_CLS="ks-dd-";return i});
KISSY.add("dd/draggable","node,event/gesture/basic,./ddm,base,event/gesture/drag,util,ua".split(","),function(q,c){function j(a){return function(){this._isValidDrag&&a.apply(this,arguments)}}function g(){p.body.onselectstart=A;p.body.releaseCapture&&p.body.releaseCapture()}function k(a){a.preventDefault()}function f(){return false}function l(a){this._isValidDrag=0;this.onGestureStart(a)}var a=c("node"),b=c("event/gesture/basic"),h=c("./ddm"),d=c("base"),n=c("event/gesture/drag"),i=c("util"),x=c("ua"),
r=a.all,u=r(document),v=i.each,y=x.ie,o=h.PREFIX_CLS,p=q.Env.host.document,s=j(function(a){this._start(a)}),e=j(function(a){this._move(a)}),z=j(function(a){this._end(a)}),A;return d.extend({initializer:function(){this.addTarget(h);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a)},onGestureStart:function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)},getEventTargetEl:function(){return this.get("node")},start:function(){var a=
this.getEventTargetEl();if(a)a.on(n.DRAG_START,s,this).on(n.DRAG,e,this).on(n.DRAG_END,z,this).on(b.START,l,this).on("dragstart",k)},stop:function(){var a=this.getEventTargetEl();a&&a.detach(n.DRAG_START,s,this).detach(n.DRAG,e,this).detach(n.DRAG_END,z,this).detach(b.START,l,this).detach("dragstart",k)},_onSetDisabled:function(a){var b=this.get("dragNode");if(b)b[a?"addClass":"removeClass"](o+"-disabled");this[a?"stop":"start"]()},_checkHandler:function(a){var b=this,c=b.get("handlers"),h=0;v(c,
function(c){if(c[0]===a||c.contains(a)){h=1;b.setInternal("activeHandler",c);return false}});return h},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&a.which!==1?0:1},_prepare:function(a){this._isValidDrag=1;if(y){A=p.body.onselectstart;p.body.onselectstart=f;p.body.setCapture&&p.body.setCapture();u.on(b.END,{fn:g,once:true})}this.get("halt")&&a.stopPropagation();a.gestureType==="mouse"&&a.preventDefault();this._allowMove&&this.setInternal("startNodePos",this.get("node").offset())},
_start:function(a){a.gestureType==="touch"&&a.preventDefault();this.mousePos={left:a.pageX,top:a.pageY};h.start(a,this);this.fire("dragstart",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY});this.get("dragNode").addClass(o+"dragging")},_move:function(a){var b=a.pageX,c=a.pageY;a.gestureType==="touch"&&a.preventDefault();this.mousePos={left:b,top:c};b={drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,
pageX:a.pageX,pageY:a.pageY};if(c=this._allowMove){var d=this.get("startNodePos"),e=d.left+a.deltaX,d=d.top+a.deltaY;b.left=e;b.top=d;this.setInternal("actualPos",{left:e,top:d});this.fire("dragalign",b)}e=1;this.fire("drag",b)===false&&(e=0);h.move(a,this);this.get("preventDefaultOnMove")&&a.preventDefault();e&&c&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){this._isValidDrag&&this._end()},_end:function(a){var a=a||{},b;this._isValidDrag=0;this.get("node").removeClass(o+"drag-over");
this.get("dragNode").removeClass(o+"dragging");(b=h.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this});h.end(a,this);this.fire("dragend",{drag:this,gestureType:a.gestureType,startPos:a.startPos,deltaX:a.deltaX,deltaY:a.deltaY,pageX:a.pageX,pageY:a.pageY})},_handleOut:function(){this.get("node").removeClass(o+"drag-over");this.fire("dragexit",{drag:this,drop:h.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(o+"drag-over");this.fire("dragenter",
a)},_handleOver:function(a){this.fire("dragover",a)},destructor:function(){this.stop()}},{name:"Draggable",ATTRS:{node:{setter:function(b){if(!(b instanceof a))return r(b)}},dragNode:{},shim:{value:false},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));v(a,function(c,d){typeof c==="function"&&(c=c.call(b));typeof c==="string"&&(c=b.get("node").one(c));c.nodeType&&(c=r(c));a[d]=c});b.setInternal("handlers",a);return a}},activeHandler:{},mode:{value:"point"},disabled:{value:false},
move:{value:false},primaryButtonOnly:{value:true},halt:{value:true},groups:{value:true},startNodePos:{},actualPos:{},preventDefaultOnMove:{value:true}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});
KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(q,c){var j=c("node"),g=c("./ddm"),k=c("./draggable"),f=g.PREFIX_CLS,l=j.all;return k.extend({_onSetNode:function(){},_onSetDisabled:function(a){var b=this.get("container");b&&(b[a?"addClass":"removeClass"](f+"-disabled"),this[a?"stop":"start"]())},getEventTargetEl:function(){return this.get("container")},onGestureStart:function(a){var b,c;if(this._checkDragStartValid(a)){b=this.get("handlers");var d=l(a.target);(b=b.length?
this._getHandler(d):d)&&(c=this._getNode(b));c&&(this.setInternal("activeHandler",b),this.setInternal("node",c),this.setInternal("dragNode",c),this._prepare(a))}},_getHandler:function(a){for(var b=this.get("container"),c=this.get("handlers");a&&a[0]!==b[0];){for(var d=0;d<c.length;d++)if(a.test(c[d]))return a;a=a.parent()}return null},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(a){return l(a)}},selector:{},handlers:{value:[],
getter:0}}})});
KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable","util"],function(q,c){function j(){var a=this.get("container"),c=[],d=this.get("selector");a.all(d).each(function(a){k.cacheWH(a);c.push(a)});this.__allNodes=c}var g=c("node"),k=c("./ddm"),f=c("./droppable"),l=c("util"),a=f.extend({initializer:function(){k.on("dragstart",j,this)},getNodeFromTarget:function(a,c,d){var f={left:a.pageX,top:a.pageY},a=this.__allNodes,i=0,g=Number.MAX_VALUE;a&&l.each(a,function(a){var b=a[0];b===d||b===c||
(b=k.region(a),k.inRegion(b,f)&&(b=k.area(b),b<g&&(g=b,i=a)))});i&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",i));return i},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(b){var c=this.get("node"),d=a.superclass._handleOut,f=this.callSuper,g=a.superclass._handleEnter,j=this.get("lastNode");j[0]!==c[0]?(this.setInternal("node",j),d.apply(this,arguments),this.setInternal("node",c),g.call(this,b)):f.call(this,
b)},_end:function(a){this.callSuper(a);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return g.one(a)}}}});return a});
KISSY.add("dd/droppable",["node","./ddm","base","util"],function(q,c){var j=c("node"),g=c("./ddm"),k=c("base"),f=g.PREFIX_CLS,l=c("util");return k.extend({initializer:function(){this.addTarget(g);g.addDrop(this)},getNodeFromTarget:function(a,b,c){var a=this.get("node"),d=a[0];return d===b||d===c?null:a},_active:function(){var a=g.get("activeDrag"),b=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===a)c=1;else{for(var d in c)if(a[d]){c=1;break a}c=0}c?(g.addValidDrop(this),b&&(b.addClass(f+
"drop-active-valid"),g.cacheWH(b))):b&&b.addClass(f+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(f+"drop-active-valid").removeClass(f+"drop-active-invalid")},__getCustomEvt:function(a){return l.mix({drag:g.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(f+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(f+"drop-over");
this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(f+"drop-over");this.fire("drophit",a)},destructor:function(){g.removeDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(a){if(a)return j.one(a)}},groups:{value:{}},disabled:{}}})});
