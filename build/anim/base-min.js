/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:37
*/
KISSY.add("anim/base/queue",["dom"],function(b,k){function h(a,c,d){var c=c||g,e,b=j.data(a,f);!b&&!d&&j.data(a,f,b={});b&&(e=b[c],!e&&!d&&(e=b[c]=[]));return e}var j=k("dom"),f=b.guid("ks-queue-"+b.now()+"-"),g=b.guid("ks-queue-"+b.now()+"-"),i;return i={queueCollectionKey:f,queue:function(a,b,d){a=h(a,b);a.push(d);return a},remove:function(a,c,d){var e=h(a,c,1);e&&(d=b.indexOf(d,e),-1<d&&e.splice(d,1));e&&!e.length&&i.clearQueue(a,c);return e},clearQueues:function(a){j.removeData(a,f)},clearQueue:function(a,
c){var c=c||g,d=j.data(a,f);d&&delete d[c];b.isEmptyObject(d)&&j.removeData(a,f)},dequeue:function(a,b){var d=h(a,b,1);d&&(d.shift(),d.length||i.clearQueue(a,b));return d}}});
KISSY.add("anim/base/utils",["./queue","dom"],function(b,k){var h=h,j=k("./queue"),f=k("dom"),g=b.guid("ks-anim-unqueued-"+b.now()+"-"),i=b.guid("ks-anim-paused-"+b.now()+"-");return{saveRunningAnim:function(a){var c=a.node,d=f.data(c,g);d||f.data(c,g,d={});d[b.stamp(a)]=a},removeRunningAnim:function(a){var c=a.node,d=f.data(c,g);d&&(delete d[b.stamp(a)],b.isEmptyObject(d)&&f.removeData(c,g))},isAnimPaused:function(a){var c=f.data(a.node,i);return c?!!c[b.stamp(a)]:0},removePausedAnim:function(a){var c=
a.node,d=f.data(c,i);d&&(delete d[b.stamp(a)],b.isEmptyObject(d)&&f.removeData(c,i))},savePausedAnim:function(a){var c=a.node,d=f.data(c,i);d||f.data(c,i,d={});d[b.stamp(a)]=a},isAnimRunning:function(a){var c=f.data(a.node,g);return c?!!c[b.stamp(a)]:0},isElPaused:function(a){return(a=f.data(a,i))&&!b.isEmptyObject(a)},isElRunning:function(a){return(a=f.data(a,g))&&!b.isEmptyObject(a)},pauseOrResumeQueue:function(a,c,d){a=f.data(a,"resume"==d?i:g);a=b.merge(a);b.each(a,function(e){if(c===h||e.config.queue==
c)e[d]()})},stopEl:function(a,c,d,e){d&&(e===h?j.clearQueues(a):!1!==e&&j.clearQueue(a,e));a=f.data(a,g);a=b.merge(a);b.each(a,function(a){(e===h||a.config.queue==e)&&a.stop(c)})}}});
KISSY.add("anim/base",["dom","./base/utils","./base/queue","promise"],function(b,k){function h(e){h.superclass.constructor.call(this);i.Defer(this);this.config=e;var a=e.node;b.isPlainObject(a)||(a=j.get(e.node));this.node=this.el=a;this._backupProps={};this._propsData={}}var j=k("dom"),f=k("./base/utils"),g=k("./base/queue"),i=k("promise"),a=j.NodeType,c=b.noop,d={toggle:1,hide:1,show:1};b.extend(h,i,{on:function(a,b){"please use promise api of anim instead";"complete"==a?this.then(b):"end"==a?this.fin(b):
"step"==a?this.progress(b):"not supported event for anim: "+a;return this},prepareFx:c,runInternal:function(){var e=this,c=e.config,g=e.node,h,i=e._backupProps,k=e._propsData,l=c.to,p=c.delay||0,n=c.duration;f.saveRunningAnim(e);b.each(l,function(a,e){b.isPlainObject(a)||(a={value:a});k[e]=b.mix({delay:p,easing:c.easing,frame:c.frame,duration:n},a)});if(g.nodeType==a.ELEMENT_NODE){if(l.width||l.height)l=g.style,b.mix(i,{overflow:l.overflow,"overflow-x":l.overflowX,"overflow-y":l.overflowY}),l.overflow=
"hidden","inline"===j.css(g,"display")&&"none"===j.css(g,"float")&&(b.UA.ie?l.zoom=1:l.display="inline-block");var o,m;m="none"===j.css(g,"display");b.each(k,function(a,b){h=a.value;if(d[h]){if("hide"==h&&m||"show"==h&&!m)return e.stop(!0),o=!1;i[b]=j.style(g,b);"toggle"==h?h=m?"show":"hide":"hide"==h?(a.value=0,i.display="none"):(a.value=j.css(g,b),j.css(g,b,0),j.show(g))}});if(!1===o)return}e.startTime=b.now();b.isEmptyObject(k)?(e.__totalTime=1E3*n,e.__waitTimeout=setTimeout(function(){e.stop(!0)},
e.__totalTime)):(e.prepareFx(),e.doStart())},isRunning:function(){return f.isAnimRunning(this)},isPaused:function(){return f.isAnimPaused(this)},pause:function(){this.isRunning()&&(this._runTime=b.now()-this.startTime,this.__totalTime-=this._runTime,f.removeRunningAnim(this),f.savePausedAnim(this),this.__waitTimeout?clearTimeout(this.__waitTimeout):this.doStop());return this},doStop:c,doStart:c,resume:function(){var a=this;a.isPaused()&&(a.startTime=b.now()-a._runTime,f.removePausedAnim(a),f.saveRunningAnim(a),
a.__waitTimeout?a.__waitTimeout=setTimeout(function(){a.stop(!0)},a.__totalTime):(a.beforeResume(),a.doStart()));return a},beforeResume:c,run:function(){var a;a=this.config.queue;!1===a?this.runInternal():(a=g.queue(this.node,a,this),1==a.length&&this.runInternal());return this},stop:function(a){var c=this.node,d=this.config.queue;if(this.isResolved()||this.isRejected())return this;this.__waitTimeout&&(clearTimeout(this.__waitTimeout),this.__waitTimeout=0);if(!this.isRunning()&&!this.isPaused())return!1!==
d&&g.remove(c,d,this),this;this.doStop(a);f.removeRunningAnim(this);f.removePausedAnim(this);var h=this.defer;if(a){var i,k;b.isEmptyObject(i=this._backupProps)||j.css(this.node,i);(k=this.config.complete)&&k.call(this);h.resolve([this])}else h.reject([this]);!1!==d&&(a=g.dequeue(c,d))&&a[0]&&a[0].runInternal();return this}});h.Utils=f;h.Q=g;return h});
