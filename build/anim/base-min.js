/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 19 12:02
*/
KISSY.add("anim/base/queue",["dom"],function(d){function g(a,b,c){var b=b||f,d,l=i.data(a,e);!l&&!c&&i.data(a,e,l={});l&&(d=l[b],!d&&!c&&(d=l[b]=[]));return d}var i=this.require("dom"),e=d.guid("ks-queue-"+d.now()+"-"),f=d.guid("ks-queue-"+d.now()+"-"),h;return h={queueCollectionKey:e,queue:function(a,b,c){a=g(a,b);a.push(c);return a},remove:function(a,b,c){var e=g(a,b,1);e&&(c=d.indexOf(c,e),-1<c&&e.splice(c,1));e&&!e.length&&h.clearQueue(a,b);return e},clearQueues:function(a){i.removeData(a,e)},
clearQueue:function(a,b){var b=b||f,c=i.data(a,e);c&&delete c[b];d.isEmptyObject(c)&&i.removeData(a,e)},dequeue:function(a,b){var c=g(a,b,1);c&&(c.shift(),c.length||h.clearQueue(a,b));return c}}});
KISSY.add("anim/base/utils",["./queue","dom"],function(d){var g=g,i=this.require("./queue"),e=this.require("dom"),f=d.guid("ks-anim-unqueued-"+d.now()+"-"),h=d.guid("ks-anim-paused-"+d.now()+"-");return{saveRunningAnim:function(a){var b=a.node,c=e.data(b,f);c||e.data(b,f,c={});c[d.stamp(a)]=a},removeRunningAnim:function(a){var b=a.node,c=e.data(b,f);c&&(delete c[d.stamp(a)],d.isEmptyObject(c)&&e.removeData(b,f))},isAnimPaused:function(a){var b=e.data(a.node,h);return b?!!b[d.stamp(a)]:0},removePausedAnim:function(a){var b=
a.node,c=e.data(b,h);c&&(delete c[d.stamp(a)],d.isEmptyObject(c)&&e.removeData(b,h))},savePausedAnim:function(a){var b=a.node,c=e.data(b,h);c||e.data(b,h,c={});c[d.stamp(a)]=a},isAnimRunning:function(a){var b=e.data(a.node,f);return b?!!b[d.stamp(a)]:0},isElPaused:function(a){return(a=e.data(a,h))&&!d.isEmptyObject(a)},isElRunning:function(a){return(a=e.data(a,f))&&!d.isEmptyObject(a)},pauseOrResumeQueue:function(a,b,c){a=e.data(a,"resume"==c?h:f);a=d.merge(a);d.each(a,function(a){if(b===g||a.config.queue==
b)a[c]()})},stopEl:function(a,b,c,k){c&&(k===g?i.clearQueues(a):!1!==k&&i.clearQueue(a,k));a=e.data(a,f);a=d.merge(a);d.each(a,function(a){(k===g||a.config.queue==k)&&a.stop(b)})}}});
KISSY.add("anim/base",["dom","./base/utils","./base/queue","promise"],function(d){function g(a){g.superclass.constructor.call(this);h.Defer(this);this.config=a;var b=a.node;d.isPlainObject(b)||(b=i.get(a.node));this.node=this.el=b;this._backupProps={};this._propsData={}}var i=this.require("dom"),e=this.require("./base/utils"),f=this.require("./base/queue"),h=this.require("promise");d.extend(g,h,{on:function(a,b){"please use promise api of anim instead";"complete"==a?this.then(b):"end"==a?this.fin(b):
"step"==a?this.progress(b):"not supported event for anim: "+a;return this},prepareFx:noop,runInternal:function(){var a=this,b=a.config,c=a.node,f,g=a._backupProps,h=a._propsData,j=b.to,q=b.delay||0,o=b.duration;e.saveRunningAnim(a);d.each(j,function(a,c){d.isPlainObject(a)||(a={value:a});h[c]=d.mix({delay:q,easing:b.easing,frame:b.frame,duration:o},a)});if(c.nodeType==NodeType.ELEMENT_NODE){if(j.width||j.height)j=c.style,d.mix(g,{overflow:j.overflow,"overflow-x":j.overflowX,"overflow-y":j.overflowY}),
j.overflow="hidden","inline"===i.css(c,"display")&&"none"===i.css(c,"float")&&(d.UA.ie?j.zoom=1:j.display="inline-block");var p,m;m="none"===i.css(c,"display");d.each(h,function(b,d){f=b.value;if(specialVals[f]){if("hide"==f&&m||"show"==f&&!m)return a.stop(!0),p=!1;g[d]=i.style(c,d);"toggle"==f?f=m?"show":"hide":"hide"==f?(b.value=0,g.display="none"):(b.value=i.css(c,d),i.css(c,d,0),i.show(c))}});if(!1===p)return}a.startTime=d.now();d.isEmptyObject(h)?(a.__totalTime=1E3*o,a.__waitTimeout=setTimeout(function(){a.stop(!0)},
a.__totalTime)):(a.prepareFx(),a.doStart())},isRunning:function(){return e.isAnimRunning(this)},isPaused:function(){return e.isAnimPaused(this)},pause:function(){this.isRunning()&&(this._runTime=d.now()-this.startTime,this.__totalTime-=this._runTime,e.removeRunningAnim(this),e.savePausedAnim(this),this.__waitTimeout?clearTimeout(this.__waitTimeout):this.doStop());return this},doStop:noop,doStart:noop,resume:function(){var a=this;a.isPaused()&&(a.startTime=d.now()-a._runTime,e.removePausedAnim(a),
e.saveRunningAnim(a),a.__waitTimeout?a.__waitTimeout=setTimeout(function(){a.stop(!0)},a.__totalTime):(a.beforeResume(),a.doStart()));return a},beforeResume:noop,run:function(){var a;a=this.config.queue;!1===a?this.runInternal():(a=f.queue(this.node,a,this),1==a.length&&this.runInternal());return this},stop:function(a){var b=this.node,c=this.config.queue;if(this.isResolved()||this.isRejected())return this;this.__waitTimeout&&(clearTimeout(this.__waitTimeout),this.__waitTimeout=0);if(!this.isRunning()&&
!this.isPaused())return!1!==c&&f.remove(b,c,this),this;this.doStop(a);e.removeRunningAnim(this);e.removePausedAnim(this);var g=this.defer;if(a){var h,n;d.isEmptyObject(h=this._backupProps)||i.css(this.node,h);(n=this.config.complete)&&n.call(this);g.resolve([this])}else g.reject([this]);!1!==c&&(a=f.dequeue(b,c))&&a[0]&&a[0].runInternal();return this}});g.Utils=e;g.Q=f;return g});
