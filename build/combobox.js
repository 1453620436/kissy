/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 26 16:04
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(j,g,n,m){j=g("combobox/control");n=g("combobox/local-data-source");g=g("combobox/remote-data-source");j.LocalDataSource=n;j.RemoteDataSource=g;m.exports=j});
KISSY.add("combobox/control","util,logger-manager,node,component/control,./combobox-xtpl,menu".split(","),function(j,g,n,m){function f(e){for(var a=0;a<e.length;a++)if(!e[a].get("disabled"))return e[a];return null}function b(){l(this)}function t(){var e=this;setTimeout(function(){p(e)},0)}function h(){this.focus();p(this)}function c(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function i(e){var a;a=this.get("menu");if(!e||a===e.target){var e=this.get("input"),q=a.get("el");a=a.get("contentEl");
e.attr("aria-owns",q.attr("id"));q.on("focusout",b,this);q.on("focusin",t,this);a.on("mouseover",h,this);a.on("mousedown",c,this);if(this.get("matchElWidth"))q.getWindow().on("resize",s,this)}}function s(){var e=this.get("menu");if(e.get("visible")){var a=this.get("el"),b=e.get("el"),b=(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("borderRightWidth"),10)||0);e.set("width",a[0].offsetWidth-b)}}function a(e){e=e.target;if(e.isMenuItem){e=e.get("textContent");this.setCurrentValue(e);this._savedValue=
e;this.set("collapsed",true)}}function d(e,a){var b=e.$el,k=e.getBaseCssClasses("invalid"),c=e.get("invalidEl");if(a){b.addClass(k);c.attr("title",a);c.show()}else{b.removeClass(k);c.hide()}}function l(e){if(!e._focusoutDismissTimer)e._focusoutDismissTimer=setTimeout(function(){e._focusoutDismissTimer&&e.set("collapsed",true)},50)}function p(e){var a=e._focusoutDismissTimer;if(a){clearTimeout(a);e._focusoutDismissTimer=null}}function u(e){this.setCurrentValue(e.target.value,{data:{causedByInputEvent:1}})}
function v(e){var a=[],b,c,a=this.get("menu"),e=this.normalizeData(e);a.removeChildren(true);if(e&&e.length){r.now();a.addChildren(e);a=a.get("children");e=this.getCurrentValue();if(this.get("highlightMatchItem"))for(c=0;c<a.length;c++)if(a[c].get("textContent")===e){a[c].set("highlighted",true);b=true;break}if(!b&&this.get("autoHighlightFirst"))for(c=0;c<a.length;c++)if(!a[c].get("disabled")){a[c].set("highlighted",true);break}this.set("collapsed",false);this.fire("afterRenderData")}else this.set("collapsed",
true)}var r=g("util");g("logger-manager");var j=g("node"),n=g("component/control"),w=g("./combobox-xtpl");g("menu");var o=j.Event.KeyCode,g=n.extend({initializer:function(){this.publish("afterRenderData",{bubbles:false})},_savedValue:null,bindUI:function(){this.get("input").on("input",u,this);this.on("click",a,this);var e=this.get("menu");if(e.get("rendered"))i.call(this);else e.on("afterRenderUI",i,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",s,this)},
normalizeData:function(a){var b,c,k;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getCurrentValue(),a):[];for(k=0;k<a.length;k++){c=a[k];b[k]=r.mix({content:c,textContent:c,value:c},b[k])}}return b},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c=this.get("clearEl"),k;if(b.causedByInputEvent){k=this.getCurrentValue();if(k===void 0){this.set("collapsed",
true);return}this._savedValue=k;this.sendRequest(k)}else this.get("input").val(a);a&&c?c.show():!a&&c&&c.hide();(c=this.get("placeholderEl"))&&(a?c.hide():c.show())},handleFocusInternal:function(){p(this);this.get("invalidEl")&&d(this,false)},handleBlurInternal:function(a){var b=this;b.callSuper(a);l(b);b.get("invalidEl")&&b.validate(function(a,e){a?!b.get("focused")&&e===b.get("value")&&d(b,a):d(b,false)})},handleMouseDownInternal:function(a){var b,c,d;this.callSuper(a);b=a.target;d=this.get("trigger");
c=this.get("clearEl");if(d&&(d[0]===b||d.contains(b))){if(this.get("collapsed")){this.focus();this.sendRequest("")}else this.set("collapsed",true);a.preventDefault()}else if(c&&(c[0]===b||c.contains(b))){this.get("input").val("");this.setCurrentValue("",{data:{causedByInputEvent:1}});c.hide()}},handleKeyDownInternal:function(a){var b,c=a.keyCode,d,i,h=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(h.get("visible")){d=h.get("highlightedItem");if(b&&d){i=h.get("children");if(c===
o.DOWN&&d===f(i.concat().reverse())||c===o.UP&&d===f(i)){this.setCurrentValue(this._savedValue);d.set("highlighted",false);return true}}i=h.handleKeyDownInternal(a);d=h.get("highlightedItem");if(c===o.ESC){this.set("collapsed",true);b&&this.setCurrentValue(this._savedValue);return true}b&&r.inArray(c,[o.DOWN,o.UP])&&this.setCurrentValue(d.get("textContent"));if(c===o.TAB&&d){d.handleClickInternal(a);if(this.get("multiple"))return true}return i}if(c===o.DOWN||c===o.UP){a=this.getCurrentValue();if(a!==
void 0){this.sendRequest(a);return true}}},validate:function(a){var b=this.get("validator"),c=this.getCurrentValue();b?b(c,function(b){a(b,c)}):a(false,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,v,this)},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");if(a)c.hide();else{p(this);if(!c.get("visible")){if(this.get("matchElWidth")){c.render();var d=c.get("el"),d=(parseInt(d.css("borderLeftWidth"),10)||0)+(parseInt(d.css("borderRightWidth"),
10)||0);c.set("width",b[0].offsetWidth-d)}c.show()}}this.get("input").attr("aria-expanded",!a)},_onSetDisabled:function(a,b){this.callSuper(a,b);this.get("input").attr("disabled",a)}},{ATTRS:{handleGestureEvents:{value:true},focusable:{value:true},allowTextSelection:{value:true},contentTpl:{value:w},input:{selector:function(){return"."+this.getBaseCssClass("input")}},value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},
placeholder:{render:1,sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},clearEl:{selector:function(){return"."+this.getBaseCssClass("clear")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},hasTrigger:{value:true,sync:0,render:1},menu:{getter:function(a){a=a||{};if(!a.isControl){a.xclass=a.xclass||"popupmenu";a=this.createComponent(a);this.setInternal("menu",
a)}return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};r.mix(a.get("align"),b,false)}}},collapsed:{render:1,sync:0,value:true},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:true},format:{},updateInputOnDownUp:{value:true},autoHighlightFirst:{},highlightMatchItem:{value:true}},xclass:"combobox"});m.exports=g});
KISSY.add("combobox/combobox-xtpl",[],function(j,g,n,m){m.exports=function(f,b,g){var h=this,c=h.pos={line:1,col:1},i=h.root.utils.callFn,j=h.root.nativeCommands["if"];b.append('<div class="');var a={escape:1},d=[];d.push("invalid-el");a.params=d;c.line=1;c.col=33;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=a,a=g;b.writeEscaped(a);b.append('">\r\n    <div class="');a={escape:1};d=[];d.push("invalid-inner");a.params=d;c.line=2;c.col=36;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=
a,a=g;b.writeEscaped(a);b.append('"></div>\r\n</div>\r\n\r\n');var a={escape:1},d=[],l=f.resolve(["hasTrigger"]);d.push(l);a.params=d;a.fn=function(a,b){b.append('\r\n<div class="');var d={escape:1},f=[];f.push("trigger");d.params=f;c.line=6;c.col=32;if((d=i(h,a,d,b,["getBaseCssClasses"]))&&d.isBuffer)b=d,d=g;b.writeEscaped(d);b.append('">\r\n    <div class="');d={escape:1};f=[];f.push("trigger-inner");d.params=f;c.line=7;c.col=36;if((d=i(h,a,d,b,["getBaseCssClasses"]))&&d.isBuffer)b=d,d=g;b.writeEscaped(d);
b.append('">&#x25BC;</div>\r\n</div>\r\n');return b};c.line=5;c.col=6;b=j.call(h,f,a,b);b.append('\r\n\r\n<div class="');a={escape:1};d=[];d.push("input-wrap");a.params=d;c.line=11;c.col=32;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=a,a=g;b.writeEscaped(a);b.append('">\r\n\r\n    <input id="ks-combobox-input-');a=f.resolve(["id"]);b.writeEscaped(a);b.append('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ');
a={escape:1};d=[];l=f.resolve(["disabled"]);d.push(l);a.params=d;a.fn=function(a,b){b.append("\r\n    disabled\r\n    ");return b};c.line=20;c.col=10;b=j.call(h,f,a,b);b.append('\r\n\r\n    autocomplete="off"\r\n    class="');a={escape:1};d=[];d.push("input");a.params=d;c.line=25;c.col=31;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=a,a=g;b.writeEscaped(a);b.append('"\r\n\r\n    value="');a=f.resolve(["value"]);b.writeEscaped(a);b.append('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-');
a=f.resolve(["id"]);b.writeEscaped(a);b.append("\"\r\n            style='display:");a={escape:1};d=[];l=f.resolve(["value"]);d.push(l);a.params=d;a.fn=function(a,b){b.append("none");return b};a.inverse=function(a,b){b.append("block");return b};c.line=32;c.col=33;b=j.call(h,f,a,b);b.append(";'\r\n    class=\"");a={escape:1};d=[];d.push("placeholder");a.params=d;c.line=33;c.col=31;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=a,a=g;b.writeEscaped(a);b.append('">\r\n    ');a=f.resolve(["placeholder"]);
b.writeEscaped(a);b.append('\r\n    </label>\r\n\r\n    <div class="');a={escape:1};d=[];d.push("clear");a.params=d;c.line=37;c.col=36;if((a=i(h,f,a,b,["getBaseCssClasses"]))&&a.isBuffer)b=a,a=g;b.writeEscaped(a);b.append('"\r\n         unselectable="on"\r\n         ');a={escape:1};d=[];l=f.resolve(["value"]);d.push(!l);a.params=d;a.fn=function(a,b){b.append('\r\n         style="display:none"\r\n         ');return b};c.line=39;c.col=14;b=j.call(h,f,a,b);b.append('\r\n         onmousedown="return false;"><div\r\n            class="');
j={escape:1};a=[];a.push("clear-inner");j.params=a;c.line=43;c.col=39;if((f=i(h,f,j,b,["getBaseCssClasses"]))&&f.isBuffer)b=f,f=g;b.writeEscaped(f);b.append('">clear</div></div>\r\n</div>\r\n');return b};m.exports.TPL_NAME=m.name});
KISSY.add("combobox/local-data-source",["attribute","util"],function(j,g,n,m){var j=g("attribute"),f=g("util");m.exports=j.extend({fetchData:function(b,f,h){var c=this.get("parse"),i=this.get("data"),i=c(b,i);f.call(h,i)}},{ATTRS:{data:{value:[]},parse:{value:function(b,g){var h=[],c=0;if(!b)return g;f.each(g,function(f){-1!==f.indexOf(b)&&h.push(f);c++});return h}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(j,g,n,m){var f=g("io"),j=g("attribute");m.exports=j.extend({fetchData:function(b,g,h){var c=this,i,j=c.get("paramName"),a=c.get("parse"),d=c.get("cache"),l=c.get("allowEmpty");c.caches=c.caches||{};c.io&&(c.io.abort(),c.io=null);if(!b&&!0!==l)return g.call(h,[]);if(d&&(i=c.caches[b]))return g.call(h,i);i=c.get("xhrCfg");i.data=i.data||{};i.data[j]=b;i.success=function(f){a&&(f=a(b,f));c.setInternal("data",f);d&&(c.caches[b]=f);g.call(h,
f)};c.io=f(i)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{valueFn:function(){return{}}}}})});
