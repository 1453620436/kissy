/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 6 16:12
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(l,g){var k=g("combobox/control"),j=g("combobox/local-data-source"),c=g("combobox/remote-data-source");k.LocalDataSource=j;k.RemoteDataSource=c;return k});
KISSY.add("combobox/control",["node","component/control","./combobox-xtpl","menu"],function(l,g){function k(e){for(var a=0;a<e.length;a++)if(!e[a].get("disabled"))return e[a];return null}function j(){a(this)}function c(){var e=this;setTimeout(function(){d(e)},0)}function b(){this.focus();d(this)}function f(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function h(e){var a;a=this.get("menu");if(!e||a===e.target){var e=this.get("input"),m=a.get("el");a=a.get("contentEl");e.attr("aria-owns",
m.attr("id"));m.on("focusout",j,this);m.on("focusin",c,this);a.on("mouseover",b,this);a.on("mousedown",f,this);if(this.get("matchElWidth"))m.getWindow().on("resize",i,this)}}function i(){var e=this.get("menu");if(e.get("visible")){var a=this.get("el"),m=e.get("el"),m=(parseInt(m.css("borderLeftWidth"),10)||0)+(parseInt(m.css("borderRightWidth"),10)||0);e.set("width",a[0].offsetWidth-m)}}function q(e){e=e.target;e.isMenuItem&&(e=e.get("textContent"),this.setCurrentValue(e),this._savedValue=e,this.set("collapsed",
!0))}function p(e,a){var m=e.$el,b=e.getBaseCssClasses("invalid"),d=e.get("invalidEl");a?(m.addClass(b),d.attr("title",a),d.show()):(m.removeClass(b),d.hide())}function a(e){e._focusoutDismissTimer||(e._focusoutDismissTimer=setTimeout(function(){e._focusoutDismissTimer&&e.set("collapsed",!0)},50))}function d(e){var a=e._focusoutDismissTimer;a&&(clearTimeout(a),e._focusoutDismissTimer=null)}function r(e){this.setCurrentValue(e.target.value,{data:{causedByInputEvent:1}})}function s(e){var a,b=[],d,
c,b=this.get("menu"),e=this.normalizeData(e);b.removeChildren(!0);(c=b.get("highlightedItem"))&&c.set("highlighted",!1);if(e&&e.length){for(c=0;c<e.length;c++)a=e[c],b.addChild(a);b=b.get("children");e=this.getCurrentValue();if(this.get("highlightMatchItem"))for(c=0;c<b.length;c++)if(b[c].get("textContent")===e){b[c].set("highlighted",!0);d=!0;break}if(!d&&this.get("autoHighlightFirst"))for(c=0;c<b.length;c++)if(!b[c].get("disabled")){b[c].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var o=g("node"),t=g("component/control"),u=g("./combobox-xtpl");g("menu");var n=o.KeyCode;return t.extend({initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,bindUI:function(){this.get("input").on("input",r,this);this.on("click",q,this);var e=this.get("menu");if(e.get("rendered"))h.call(this);else e.on("afterRenderUI",h,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",i,this)},normalizeData:function(e){var a,b,c;if(e&&
e.length){e=e.slice(0,this.get("maxItemCount"));a=this.get("format")?this.get("format").call(this,this.getCurrentValue(),e):[];for(c=0;c<e.length;c++)b=e[c],a[c]=l.mix({content:b,textContent:b,value:b},a[c])}return a},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c=this.get("clearEl"),d;if(b.causedByInputEvent){d=this.getCurrentValue();if(void 0===d){this.set("collapsed",!0);return}this._savedValue=d;this.sendRequest(d)}else this.get("input").val(a);
a&&c?c.show():!a&&c&&c.hide()},handleFocusInternal:function(){var a;d(this);this.get("invalidEl")&&p(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(e){var b=this,c=b.get("placeholderEl");b.callSuper(e);a(b);b.get("invalidEl")&&b.validate(function(a,e){a?!b.get("focused")&&e===b.get("value")&&p(b,a):p(b,!1)});c&&!b.get("value")&&c.show()},handleMouseDownInternal:function(a){var b,c,d;this.callSuper(a);b=a.target;d=this.get("trigger");c=this.get("clearEl");if(d&&(d[0]===
b||d.contains(b)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault();else if(c&&(c[0]===b||c.contains(b)))this.get("input").val(""),this.setCurrentValue("",{data:{causedByInputEvent:1}}),c.hide()},handleKeyDownInternal:function(a){var b,c=a.keyCode,d,f,o=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(o.get("visible")){d=o.get("highlightedItem");if(b&&d&&(f=o.get("children"),c===n.DOWN&&d===k(f.concat().reverse())||c===n.UP&&
d===k(f)))return this.setCurrentValue(this._savedValue),d.set("highlighted",!1),!0;f=o.handleKeyDownInternal(a);d=o.get("highlightedItem");if(c===n.ESC)return this.set("collapsed",!0),b&&this.setCurrentValue(this._savedValue),!0;b&&l.inArray(c,[n.DOWN,n.UP])&&this.setCurrentValue(d.get("textContent"));return c===n.TAB&&d&&(d.handleClickInternal(a),this.get("multiple"))?!0:f}if(c===n.DOWN||c===n.UP)if(a=this.getCurrentValue(),void 0!==a)return this.sendRequest(a),!0},validate:function(a){var b=this.get("validator"),
c=this.getCurrentValue();b?b(c,function(b){a(b,c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,s,this)},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");if(a)c.hide();else if(d(this),!c.get("visible")){if(this.get("matchElWidth")){c.render();var f=c.get("el"),f=(parseInt(f.css("borderLeftWidth"),10)||0)+(parseInt(f.css("borderRightWidth"),10)||0);c.set("width",b[0].offsetWidth-f)}c.show()}this.get("input").attr("aria-expanded",
!a)},_onSetDisabled:function(a,b){this.callSuper(a,b);this.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:u},input:{selector:function(){return"."+this.getBaseCssClass("input")}},value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},placeholder:{render:1,sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},
clearEl:{selector:function(){return"."+this.getBaseCssClass("clear")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},allowTextSelection:{value:!0},hasTrigger:{value:!0,sync:0,render:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};
l.mix(a.get("align"),b,!1)}}},collapsed:{render:1,sync:0,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0}},xclass:"combobox"})});
KISSY.add("combobox/combobox-xtpl",[],function(l,g,k,j){g=function(c,b,f,h){var i=this,g=i.utils.callFn,j=i.nativeCommands["if"];if("5.0.0"!==l.version)throw Error("current xtemplate file("+i.name+")(v5.0.0) need to be recompiled using current kissy(v"+l.version+")!");b.write('<div class="',0);var a={escape:1},d=[];d.push("invalid-el");a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('">\r\n    <div class="',0);a={escape:1};d=[];d.push("invalid-inner");
a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,2))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('"></div>\r\n</div>\r\n\r\n',0);var a={escape:1},d=[],k=c.resolve(["hasTrigger"],0);d.push(k);a.params=d;a.fn=function(a,b){b.write('\r\n<div class="',0);var c={escape:1},d=[];d.push("trigger");c.params=d;if((c=g(i,a,c,b,["getBaseCssClasses"],0,6))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">\r\n    <div class="',0);c={escape:1};d=[];d.push("trigger-inner");c.params=d;if((c=g(i,a,c,b,["getBaseCssClasses"],
0,7))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">&#x25BC;</div>\r\n</div>\r\n',0);return b};b=j.call(i,c,a,b,5,f);b.write('\r\n\r\n<div class="',0);a={escape:1};d=[];d.push("input-wrap");a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,11))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('">\r\n\r\n    <input id="ks-combobox-input-',0);a=c.resolve(["id"],0);b.write(a,!0);b.write('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ',
0);a={escape:1};d=[];k=c.resolve(["disabled"],0);d.push(k);a.params=d;a.fn=function(a,b){b.write("\r\n    disabled\r\n    ",0);return b};b=j.call(i,c,a,b,20,f);b.write('\r\n\r\n    autocomplete="off"\r\n    class="',0);a={escape:1};d=[];d.push("input");a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,25))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('"\r\n\r\n    value="',0);a=c.resolve(["value"],0);b.write(a,!0);b.write('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-',0);a=c.resolve(["id"],
0);b.write(a,!0);b.write("\"\r\n            style='display:",0);a={escape:1};d=[];k=c.resolve(["value"],0);d.push(k);a.params=d;a.fn=function(a,b){b.write("none",0);return b};a.inverse=function(a,b){b.write("block",0);return b};b=j.call(i,c,a,b,32,f);b.write(";'\r\n    class=\"",0);a={escape:1};d=[];d.push("placeholder");a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,33))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('">\r\n    ',0);a=c.resolve(["placeholder"],0);b.write(a,!0);b.write('\r\n    </label>\r\n\r\n    <div class="',
0);a={escape:1};d=[];d.push("clear");a.params=d;if((a=g(i,c,a,b,["getBaseCssClasses"],0,37))&&a.isBuffer)b=a,a=h;b.write(a,!0);b.write('"\r\n         unselectable="on"\r\n         ',0);a={escape:1};d=[];k=c.resolve(["value"],0);d.push(!k);a.params=d;a.fn=function(a,b){b.write('\r\n         style="display:none"\r\n         ',0);return b};b=j.call(i,c,a,b,39,f);b.write('\r\n         onmousedown="return false;"><div\r\n            class="',0);f={escape:1};j=[];j.push("clear-inner");f.params=j;if((c=
g(i,c,f,b,["getBaseCssClasses"],0,43))&&c.isBuffer)b=c,c=h;b.write(c,!0);b.write('">clear</div></div>\r\n</div>\r\n',0);return b};g.TPL_NAME=j.name;return g});KISSY.add("combobox/local-data-source",["attribute"],function(l,g){return g("attribute").extend({fetchData:function(g,j,c){var b=this.get("parse"),f=this.get("data"),f=b(g,f);j.call(c,f)}},{ATTRS:{data:{value:[]},parse:{value:function(g,j){var c=[],b=0;if(!g)return j;l.each(j,function(f){-1!==f.indexOf(g)&&c.push(f);b++});return c}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(l,g){var k=g("io");return g("attribute").extend({fetchData:function(g,c,b){var f=this,h,i=f.get("paramName"),l=f.get("parse"),p=f.get("cache"),a=f.get("allowEmpty");f.caches=f.caches||{};f.io&&(f.io.abort(),f.io=null);if(!g&&!0!==a)return c.call(b,[]);if(p&&(h=f.caches[g]))return c.call(b,h);h=f.get("xhrCfg");h.data=h.data||{};h.data[i]=g;h.success=function(a){l&&(a=l(g,a));f.setInternal("data",a);p&&(f.caches[g]=a);c.call(b,a)};
f.io=k(h)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
