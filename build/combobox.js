/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 30 14:52
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(m,g){var n=g("combobox/control"),p=g("combobox/local-data-source"),c=g("combobox/remote-data-source");n.LocalDataSource=p;n.RemoteDataSource=c;return n});
KISSY.add("combobox/control",["util","node","component/control","./combobox-xtpl","menu"],function(m,g){function n(d){for(var a=0;a<d.length;a++)if(!d[a].get("disabled"))return d[a];return null}function p(){e(this)}function c(){var d=this;setTimeout(function(){l(d)},0)}function b(){this.focus();l(this)}function i(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function j(d){var a;a=this.get("menu");if(!d||a===d.target){var d=this.get("input"),h=a.get("el");a=a.get("contentEl");d.attr("aria-owns",
h.attr("id"));h.on("focusout",p,this);h.on("focusin",c,this);a.on("mouseover",b,this);a.on("mousedown",i,this);if(this.get("matchElWidth"))h.getWindow().on("resize",k,this)}}function k(){var d=this.get("menu");if(d.get("visible")){var a=this.get("el"),b=d.get("el"),b=(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("borderRightWidth"),10)||0);d.set("width",a[0].offsetWidth-b)}}function r(d){d=d.target;d.isMenuItem&&(d=d.get("textContent"),this.setCurrentValue(d),this._savedValue=d,this.set("collapsed",
!0))}function a(d,a){var b=d.$el,f=d.getBaseCssClasses("invalid"),c=d.get("invalidEl");a?(b.addClass(f),c.attr("title",a),c.show()):(b.removeClass(f),c.hide())}function e(d){d._focusoutDismissTimer||(d._focusoutDismissTimer=setTimeout(function(){d._focusoutDismissTimer&&d.set("collapsed",!0)},50))}function l(d){var a=d._focusoutDismissTimer;a&&(clearTimeout(a),d._focusoutDismissTimer=null)}function s(d){this.setCurrentValue(d.target.value,{data:{causedByInputEvent:1}})}function t(d){var a=[],b,f,
a=this.get("menu"),d=this.normalizeData(d);a.removeChildren(!0);if(d&&d.length){q.now();a.addChildren(d);a=a.get("children");d=this.getCurrentValue();if(this.get("highlightMatchItem"))for(f=0;f<a.length;f++)if(a[f].get("textContent")===d){a[f].set("highlighted",!0);b=!0;break}if(!b&&this.get("autoHighlightFirst"))for(f=0;f<a.length;f++)if(!a[f].get("disabled")){a[f].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",!0)}var q=g("util"),u=g("node"),
v=g("component/control"),w=g("./combobox-xtpl");g("menu");var o=u.KeyCode;return v.extend({initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,bindUI:function(){this.get("input").on("input",s,this);this.on("click",r,this);var a=this.get("menu");if(a.get("rendered"))j.call(this);else a.on("afterRenderUI",j,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",k,this)},normalizeData:function(a){var b,h,f;if(a&&a.length){a=a.slice(0,
this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getCurrentValue(),a):[];for(f=0;f<a.length;f++)h=a[f],b[f]=q.mix({content:h,textContent:h,value:h},b[f])}return b},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var h=this.get("clearEl"),f;if(b.causedByInputEvent){f=this.getCurrentValue();if(void 0===f){this.set("collapsed",!0);return}this._savedValue=f;this.sendRequest(f)}else this.get("input").val(a);
a&&h?h.show():!a&&h&&h.hide()},handleFocusInternal:function(){var d;l(this);this.get("invalidEl")&&a(this,!1);(d=this.get("placeholderEl"))&&d.hide()},handleBlurInternal:function(d){var b=this,h=b.get("placeholderEl");b.callSuper(d);e(b);b.get("invalidEl")&&b.validate(function(d,h){d?!b.get("focused")&&h===b.get("value")&&a(b,d):a(b,!1)});h&&!b.get("value")&&h.show()},handleMouseDownInternal:function(a){var b,h,f;this.callSuper(a);b=a.target;f=this.get("trigger");h=this.get("clearEl");if(f&&(f[0]===
b||f.contains(b)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault();else if(h&&(h[0]===b||h.contains(b)))this.get("input").val(""),this.setCurrentValue("",{data:{causedByInputEvent:1}}),h.hide()},handleKeyDownInternal:function(a){var b,h=a.keyCode,f,c,e=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(e.get("visible")){f=e.get("highlightedItem");if(b&&f&&(c=e.get("children"),h===o.DOWN&&f===n(c.concat().reverse())||h===o.UP&&
f===n(c)))return this.setCurrentValue(this._savedValue),f.set("highlighted",!1),!0;c=e.handleKeyDownInternal(a);f=e.get("highlightedItem");if(h===o.ESC)return this.set("collapsed",!0),b&&this.setCurrentValue(this._savedValue),!0;b&&q.inArray(h,[o.DOWN,o.UP])&&this.setCurrentValue(f.get("textContent"));return h===o.TAB&&f&&(f.handleClickInternal(a),this.get("multiple"))?!0:c}if(h===o.DOWN||h===o.UP)if(a=this.getCurrentValue(),void 0!==a)return this.sendRequest(a),!0},validate:function(a){var b=this.get("validator"),
c=this.getCurrentValue();b?b(c,function(b){a(b,c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,t,this)},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");if(a)c.hide();else if(l(this),!c.get("visible")){if(this.get("matchElWidth")){c.render();var f=c.get("el"),f=(parseInt(f.css("borderLeftWidth"),10)||0)+(parseInt(f.css("borderRightWidth"),10)||0);c.set("width",b[0].offsetWidth-f)}c.show()}this.get("input").attr("aria-expanded",
!a)},_onSetDisabled:function(a,b){this.callSuper(a,b);this.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:w},input:{selector:function(){return"."+this.getBaseCssClass("input")}},value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},placeholder:{render:1,sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},
clearEl:{selector:function(){return"."+this.getBaseCssClass("clear")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},allowTextSelection:{value:!0},hasTrigger:{value:!0,sync:0,render:1},menu:{getter:function(a){a=a||{};a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};
q.mix(a.get("align"),b,!1)}}},collapsed:{render:1,sync:0,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0}},xclass:"combobox"})});
KISSY.add("combobox/combobox-xtpl",[],function(m,g,n,p){m=function(c,b,i){var j=this,k=j.root.utils.callFn,g=j.root.nativeCommands["if"];b.write('<div class="',0);var a={escape:1},e=[];e.push("invalid-el");a.params=e;if((a=k(j,c,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('">\r\n    <div class="',0);a={escape:1};e=[];e.push("invalid-inner");a.params=e;if((a=k(j,c,a,b,["getBaseCssClasses"],0,2))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('"></div>\r\n</div>\r\n\r\n',0);
var a={escape:1},e=[],l=c.resolve(["hasTrigger"],0);e.push(l);a.params=e;a.fn=function(a,b){b.write('\r\n<div class="',0);var c={escape:1},e=[];e.push("trigger");c.params=e;if((c=k(j,a,c,b,["getBaseCssClasses"],0,6))&&c.isBuffer)b=c,c=i;b.write(c,!0);b.write('">\r\n    <div class="',0);c={escape:1};e=[];e.push("trigger-inner");c.params=e;if((c=k(j,a,c,b,["getBaseCssClasses"],0,7))&&c.isBuffer)b=c,c=i;b.write(c,!0);b.write('">&#x25BC;</div>\r\n</div>\r\n',0);return b};b=g.call(j,c,a,b,5);b.write('\r\n\r\n<div class="',
0);a={escape:1};e=[];e.push("input-wrap");a.params=e;if((a=k(j,c,a,b,["getBaseCssClasses"],0,11))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('">\r\n\r\n    <input id="ks-combobox-input-',0);a=c.resolve(["id"],0);b.write(a,!0);b.write('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ',0);a={escape:1};e=[];l=c.resolve(["disabled"],0);e.push(l);a.params=e;a.fn=
function(a,b){b.write("\r\n    disabled\r\n    ",0);return b};b=g.call(j,c,a,b,20);b.write('\r\n\r\n    autocomplete="off"\r\n    class="',0);a={escape:1};e=[];e.push("input");a.params=e;if((a=k(j,c,a,b,["getBaseCssClasses"],0,25))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('"\r\n\r\n    value="',0);a=c.resolve(["value"],0);b.write(a,!0);b.write('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-',0);a=c.resolve(["id"],0);b.write(a,!0);b.write("\"\r\n            style='display:",0);a={escape:1};
e=[];l=c.resolve(["value"],0);e.push(l);a.params=e;a.fn=function(a,b){b.write("none",0);return b};a.inverse=function(a,b){b.write("block",0);return b};b=g.call(j,c,a,b,32);b.write(";'\r\n    class=\"",0);a={escape:1};e=[];e.push("placeholder");a.params=e;if((a=k(j,c,a,b,["getBaseCssClasses"],0,33))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('">\r\n    ',0);a=c.resolve(["placeholder"],0);b.write(a,!0);b.write('\r\n    </label>\r\n\r\n    <div class="',0);a={escape:1};e=[];e.push("clear");a.params=e;
if((a=k(j,c,a,b,["getBaseCssClasses"],0,37))&&a.isBuffer)b=a,a=i;b.write(a,!0);b.write('"\r\n         unselectable="on"\r\n         ',0);a={escape:1};e=[];l=c.resolve(["value"],0);e.push(!l);a.params=e;a.fn=function(a,b){b.write('\r\n         style="display:none"\r\n         ',0);return b};b=g.call(j,c,a,b,39);b.write('\r\n         onmousedown="return false;"><div\r\n            class="',0);g={escape:1};a=[];a.push("clear-inner");g.params=a;if((c=k(j,c,g,b,["getBaseCssClasses"],0,43))&&c.isBuffer)b=
c,c=i;b.write(c,!0);b.write('">clear</div></div>\r\n</div>\r\n',0);return b};m.TPL_NAME=p.name;m.version="5.0.0";return m});KISSY.add("combobox/local-data-source",["attribute","util"],function(m,g){var n=g("attribute"),p=g("util");return n.extend({fetchData:function(c,b,i){var j=this.get("parse"),g=this.get("data"),g=j(c,g);b.call(i,g)}},{ATTRS:{data:{value:[]},parse:{value:function(c,b){var i=[],j=0;if(!c)return b;p.each(b,function(b){-1!==b.indexOf(c)&&i.push(b);j++});return i}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(m,g){var n=g("io");return g("attribute").extend({fetchData:function(g,c,b){var i=this,j,k=i.get("paramName"),m=i.get("parse"),a=i.get("cache"),e=i.get("allowEmpty");i.caches=i.caches||{};i.io&&(i.io.abort(),i.io=null);if(!g&&!0!==e)return c.call(b,[]);if(a&&(j=i.caches[g]))return c.call(b,j);j=i.get("xhrCfg");j.data=j.data||{};j.data[k]=g;j.success=function(e){m&&(e=m(g,e));i.setInternal("data",e);a&&(i.caches[g]=e);c.call(b,e)};
i.io=n(j)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{valueFn:function(){return{}}}}})});
