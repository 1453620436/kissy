/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 6 15:53
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(n,f){var o=f("combobox/control"),m=f("combobox/local-data-source"),e=f("combobox/remote-data-source");o.LocalDataSource=m;o.RemoteDataSource=e;return o});
KISSY.add("combobox/control",["node","component/control","./combobox-xtpl","menu"],function(n,f){function o(d){for(var i=0;i<d.length;i++)if(!d[i].get("disabled"))return d[i];return null}function m(){a(this)}function e(){var d=this;setTimeout(function(){g(d)},0)}function b(){this.focus();g(this)}function c(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function j(d){var i;i=this.get("menu");if(!d||i===d.target){var d=this.get("input"),h=i.get("el");i=i.get("contentEl");d.attr("aria-owns",
h.attr("id"));h.on("focusout",m,this);h.on("focusin",e,this);i.on("mouseover",b,this);i.on("mousedown",c,this);if(this.get("matchElWidth"))h.getWindow().on("resize",k,this)}}function k(){var d=this.get("menu");if(d.get("visible")){var i=this.get("el"),h=d.get("el"),h=(parseInt(h.css("borderLeftWidth"),10)||0)+(parseInt(h.css("borderRightWidth"),10)||0);d.set("width",i[0].offsetWidth-h)}}function q(d){d=d.target;d.isMenuItem&&(d=d.get("textContent"),this.setCurrentValue(d),this._savedValue=d,this.set("collapsed",
!0))}function l(d,i){var h=d.$el,b=d.getBaseCssClasses("invalid"),a=d.get("invalidEl");i?(h.addClass(b),a.attr("title",i),a.show()):(h.removeClass(b),a.hide())}function a(d){d._focusoutDismissTimer||(d._focusoutDismissTimer=setTimeout(function(){d._focusoutDismissTimer&&d.set("collapsed",!0)},50))}function g(d){var i=d._focusoutDismissTimer;i&&(clearTimeout(i),d._focusoutDismissTimer=null)}function r(d){this.setCurrentValue(d.target.value,{data:{causedByInputEvent:1}})}function s(d){var i,h=[],b,
a,h=this.get("menu"),d=this.normalizeData(d);h.removeChildren(!0);(a=h.get("highlightedItem"))&&a.set("highlighted",!1);if(d&&d.length){for(a=0;a<d.length;a++)i=d[a],h.addChild(i);h=h.get("children");d=this.getCurrentValue();if(this.get("highlightMatchItem"))for(a=0;a<h.length;a++)if(h[a].get("textContent")===d){h[a].set("highlighted",!0);b=!0;break}if(!b&&this.get("autoHighlightFirst"))for(a=0;a<h.length;a++)if(!h[a].get("disabled")){h[a].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var t=f("node"),u=f("component/control"),v=f("./combobox-xtpl");f("menu");var p=t.KeyCode;return u.extend({initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,bindUI:function(){this.get("input").on("input",r,this);this.on("click",q,this);var d=this.get("menu");if(d.get("rendered"))j.call(this);else d.on("afterRenderUI",j,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",k,this)},normalizeData:function(d){var a,b,c;if(d&&
d.length){d=d.slice(0,this.get("maxItemCount"));a=this.get("format")?this.get("format").call(this,this.getCurrentValue(),d):[];for(c=0;c<d.length;c++)b=d[c],a[c]=n.mix({content:b,textContent:b,value:b},a[c])}return a},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(d,a){this.set("value",d,a)},_onSetValue:function(d,a){var b;a.causedByInputEvent?(b=this.getCurrentValue(),void 0===b?this.set("collapsed",!0):(this._savedValue=b,this.sendRequest(b))):this.get("input").val(d)},
handleFocusInternal:function(){var d;g(this);this.get("invalidEl")&&l(this,!1);(d=this.get("placeholderEl"))&&d.hide()},handleBlurInternal:function(d){var b=this,c=b.get("placeholderEl");b.callSuper(d);a(b);b.get("invalidEl")&&b.validate(function(d,a){d?!b.get("focused")&&a===b.get("value")&&l(b,d):l(b,!1)});c&&!b.get("value")&&c.show()},handleMouseDownInternal:function(d){var a,b,c;this.callSuper(d);a=d.target;c=this.get("trigger");b=this.get("clearEl");if(c&&(c[0]===a||c.contains(a)))this.get("collapsed")?
(this.focus(),this.sendRequest("")):this.set("collapsed",!0),d.preventDefault();else if(b&&(b[0]===a||b.contains(a)))this.get("input").val(""),this.setCurrentValue("",{data:{causedByInputEvent:1}})},handleKeyDownInternal:function(d){var a,b=d.keyCode,c,e,g=this.get("menu");this.get("input");a=this.get("updateInputOnDownUp");if(g.get("visible")){c=g.get("highlightedItem");if(a&&c&&(e=g.get("children"),b===p.DOWN&&c===o(e.concat().reverse())||b===p.UP&&c===o(e)))return this.setCurrentValue(this._savedValue),
c.set("highlighted",!1),!0;e=g.handleKeyDownInternal(d);c=g.get("highlightedItem");if(b===p.ESC)return this.set("collapsed",!0),a&&this.setCurrentValue(this._savedValue),!0;a&&n.inArray(b,[p.DOWN,p.UP])&&this.setCurrentValue(c.get("textContent"));return b===p.TAB&&c&&(c.handleClickInternal(d),this.get("multiple"))?!0:e}if(b===p.DOWN||b===p.UP)if(d=this.getCurrentValue(),void 0!==d)return this.sendRequest(d),!0},validate:function(d){var a=this.get("validator"),b=this.getCurrentValue();a?a(b,function(a){d(a,
b)}):d(!1,b)},sendRequest:function(d){this.get("dataSource").fetchData(d,s,this)},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(d){var a=this.$el,b=this.get("menu");if(d)b.hide();else if(g(this),!b.get("visible")){if(this.get("matchElWidth")){b.render();var c=b.get("el"),c=(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("borderRightWidth"),10)||0);b.set("width",a[0].offsetWidth-c)}b.show()}this.get("input").attr("aria-expanded",!d)},_onSetDisabled:function(b,
a){this.callSuper(b,a);this.get("input").attr("disabled",b)}},{ATTRS:{contentTpl:{value:v},input:{selector:function(){return"."+this.getBaseCssClass("input")}},value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},placeholder:{render:1,sync:0,parse:function(){var b=this.get("placeholderEl");return b&&b.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},clearEl:{selector:function(){return"."+
this.getBaseCssClass("clear")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},allowTextSelection:{value:!0},hasTrigger:{value:!0,sync:0,render:1},menu:{value:{},getter:function(b){b.isControl||(b.xclass=b.xclass||"popupmenu",b=this.createComponent(b),this.setInternal("menu",b));return b},setter:function(b){if(b.isControl){b.setInternal("parent",this);var a={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};n.mix(b.get("align"),a,!1)}}},collapsed:{render:1,
sync:0,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0}},xclass:"combobox"})});
KISSY.add("combobox/combobox-xtpl",[],function(n,f,o,m){f=function(e,b,c,j){var k=this,f=k.utils.callFn,l=k.nativeCommands["if"];if("5.0.0"!==n.version)throw Error("current xtemplate file("+k.name+")(v5.0.0) need to be recompiled using current kissy(v"+n.version+")!");b.write('<div class="',0);var a={escape:1},g=[];g.push("invalid-el");a.params=g;if((a=f(k,e,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('">\r\n    <div class="',0);a={escape:1};g=[];g.push("invalid-inner");
a.params=g;if((a=f(k,e,a,b,["getBaseCssClasses"],0,2))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('"></div>\r\n</div>\r\n\r\n',0);var a={escape:1},g=[],m=e.resolve(["hasTrigger"],0);g.push(m);a.params=g;a.fn=function(b,a){a.write('\r\n<div class="',0);var c={escape:1},e=[];e.push("trigger");c.params=e;if((c=f(k,b,c,a,["getBaseCssClasses"],0,6))&&c.isBuffer)a=c,c=j;a.write(c,!0);a.write('">\r\n    <div class="',0);c={escape:1};e=[];e.push("trigger-inner");c.params=e;if((c=f(k,b,c,a,["getBaseCssClasses"],
0,7))&&c.isBuffer)a=c,c=j;a.write(c,!0);a.write('">&#x25BC;</div>\r\n</div>\r\n',0);return a};b=l.call(k,e,a,b,5,c);b.write('\r\n\r\n<div class="',0);a={escape:1};g=[];g.push("input-wrap");a.params=g;if((a=f(k,e,a,b,["getBaseCssClasses"],0,11))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('">\r\n\r\n    <input id="ks-combobox-input-',0);a=e.resolve(["id"],0);b.write(a,!0);b.write('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ',
0);a={escape:1};g=[];m=e.resolve(["disabled"],0);g.push(m);a.params=g;a.fn=function(b,a){a.write("\r\n    disabled\r\n    ",0);return a};b=l.call(k,e,a,b,20,c);b.write('\r\n\r\n    autocomplete="off"\r\n    class="',0);a={escape:1};g=[];g.push("input");a.params=g;if((a=f(k,e,a,b,["getBaseCssClasses"],0,25))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('"\r\n\r\n    value="',0);a=e.resolve(["value"],0);b.write(a,!0);b.write('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-',0);a=e.resolve(["id"],
0);b.write(a,!0);b.write("\"\r\n            style='display:",0);a={escape:1};g=[];m=e.resolve(["value"],0);g.push(m);a.params=g;a.fn=function(b,a){a.write("none",0);return a};a.inverse=function(b,a){a.write("block",0);return a};b=l.call(k,e,a,b,32,c);b.write(";'\r\n    class=\"",0);c={escape:1};l=[];l.push("placeholder");c.params=l;if((c=f(k,e,c,b,["getBaseCssClasses"],0,33))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write('">\r\n    ',0);c=e.resolve(["placeholder"],0);b.write(c,!0);b.write('\r\n    </label>\r\n\r\n    <div class="',
0);c={escape:1};l=[];l.push("clear");c.params=l;if((c=f(k,e,c,b,["getBaseCssClasses"],0,37))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write('"\r\n         unselectable="on"\r\n         onmousedown="return false;"><div\r\n            class="',0);c={escape:1};l=[];l.push("clear-inner");c.params=l;if((e=f(k,e,c,b,["getBaseCssClasses"],0,40))&&e.isBuffer)b=e,e=j;b.write(e,!0);b.write('">clear</div></div>\r\n</div>\r\n',0);return b};f.TPL_NAME=m.name;return f});
KISSY.add("combobox/local-data-source",["attribute"],function(n,f){return f("attribute").extend({fetchData:function(f,m,e){var b=this.get("parse"),c=this.get("data"),c=b(f,c);m.call(e,c)}},{ATTRS:{data:{value:[]},parse:{value:function(f,m){var e=[],b=0;if(!f)return m;n.each(m,function(c){-1!==c.indexOf(f)&&e.push(c);b++});return e}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(n,f){var o=f("io");return f("attribute").extend({fetchData:function(f,e,b){var c=this,j,k=c.get("paramName"),n=c.get("parse"),l=c.get("cache"),a=c.get("allowEmpty");c.caches=c.caches||{};c.io&&(c.io.abort(),c.io=null);if(!f&&!0!==a)return e.call(b,[]);if(l&&(j=c.caches[f]))return e.call(b,j);j=c.get("xhrCfg");j.data=j.data||{};j.data[k]=f;j.success=function(a){n&&(a=n(f,a));c.setInternal("data",a);l&&(c.caches[f]=a);e.call(b,a)};
c.io=o(j)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
