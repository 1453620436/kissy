/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 29 14:57
*/
KISSY.add("combobox",["combobox/control","combobox/local-data-source","combobox/remote-data-source"],function(n,f){var m=f("combobox/control"),l=f("combobox/local-data-source"),g=f("combobox/remote-data-source");m.LocalDataSource=l;m.RemoteDataSource=g;return m});
KISSY.add("combobox/control",["node","component/control","./combobox-xtpl","menu"],function(n,f){function m(c){for(var i=0;i<c.length;i++)if(!c[i].get("disabled"))return c[i];return null}function l(){b(this)}function g(){var c=this;setTimeout(function(){e(c)},0)}function a(){this.focus();e(this)}function d(){this.setCurrentValue(this.getCurrentValue(),{force:1})}function j(c){var i;i=this.get("menu");if(!c||i===c.target){var c=this.get("input"),h=i.get("el");i=i.get("contentEl");c.attr("aria-owns",
h.attr("id"));h.on("focusout",l,this);h.on("focusin",g,this);i.on("mouseover",a,this);i.on("mousedown",d,this);if(this.get("matchElWidth"))h.getWindow().on("resize",k,this)}}function k(){var c=this.get("menu");if(c.get("visible")){var i=this.get("el"),h=c.get("el"),h=(parseInt(h.css("borderLeftWidth"),10)||0)+(parseInt(h.css("borderRightWidth"),10)||0);c.set("width",i[0].offsetWidth-h)}}function q(c){c=c.target;c.isMenuItem&&(c=c.get("textContent"),this.setCurrentValue(c),this._savedValue=c,this.set("collapsed",
!0))}function p(c,i){var h=c.$el,b=c.getBaseCssClasses("invalid"),a=c.get("invalidEl");i?(h.addClass(b),a.attr("title",i),a.show()):(h.removeClass(b),a.hide())}function b(c){c._focusoutDismissTimer||(c._focusoutDismissTimer=setTimeout(function(){c._focusoutDismissTimer&&c.set("collapsed",!0)},50))}function e(c){var i=c._focusoutDismissTimer;i&&(clearTimeout(i),c._focusoutDismissTimer=null)}function r(c){this.set("value",c.target.value,{data:{causedByInputEvent:1}})}function s(c){var i,h=[],b,a,h=
this.get("menu"),c=this.normalizeData(c);h.removeChildren(!0);(a=h.get("highlightedItem"))&&a.set("highlighted",!1);if(c&&c.length){for(a=0;a<c.length;a++)i=c[a],h.addChild(i);h=h.get("children");c=this.getCurrentValue();if(this.get("highlightMatchItem"))for(a=0;a<h.length;a++)if(h[a].get("textContent")===c){h[a].set("highlighted",!0);b=!0;break}if(!b&&this.get("autoHighlightFirst"))for(a=0;a<h.length;a++)if(!h[a].get("disabled")){h[a].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var t=f("node"),u=f("component/control"),v=f("./combobox-xtpl");f("menu");var o=t.KeyCode;return u.extend({initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,bindUI:function(){this.get("input").on("input",r,this);this.on("click",q,this);var c=this.get("menu");if(c.get("rendered"))j.call(this);else c.on("afterRenderUI",j,this)},destructor:function(){this.get("menu").destroy();this.$el.getWindow().detach("resize",k,this)},normalizeData:function(c){var a,b,d;if(c&&
c.length){c=c.slice(0,this.get("maxItemCount"));a=this.get("format")?this.get("format").call(this,this.getCurrentValue(),c):[];for(d=0;d<c.length;d++)b=c[d],a[d]=n.mix({content:b,textContent:b,value:b},a[d])}return a},getCurrentValue:function(){return this.get("value")},setCurrentValue:function(c,a){this.set("value",c,a)},_onSetValue:function(c,a){var b;a.causedByInputEvent?(b=this.getCurrentValue(),void 0===b?this.set("collapsed",!0):(this._savedValue=b,this.sendRequest(b))):this.get("input").val(c)},
handleFocusInternal:function(){var c;e(this);this.get("invalidEl")&&p(this,!1);(c=this.get("placeholderEl"))&&c.hide()},handleBlurInternal:function(c){var a=this,h=a.get("placeholderEl");a.callSuper(c);b(a);a.get("invalidEl")&&a.validate(function(c,b){c?!a.get("focused")&&b===a.get("value")&&p(a,c):p(a,!1)});h&&!a.get("value")&&h.show()},handleMouseDownInternal:function(c){var a,b;this.callSuper(c);a=c.target;if((b=this.get("trigger"))&&(b[0]===a||b.contains(a)))this.get("collapsed")?(this.focus(),
this.sendRequest("")):this.set("collapsed",!0),c.preventDefault()},handleKeyDownInternal:function(c){var a,b=c.keyCode,d,e,g=this.get("menu");this.get("input");a=this.get("updateInputOnDownUp");if(g.get("visible")){d=g.get("highlightedItem");if(a&&d&&(e=g.get("children"),b===o.DOWN&&d===m(e.concat().reverse())||b===o.UP&&d===m(e)))return this.setCurrentValue(this._savedValue),d.set("highlighted",!1),!0;e=g.handleKeyDownInternal(c);d=g.get("highlightedItem");if(b===o.ESC)return this.set("collapsed",
!0),a&&this.setCurrentValue(this._savedValue),!0;a&&n.inArray(b,[o.DOWN,o.UP])&&this.setCurrentValue(d.get("textContent"));return b===o.TAB&&d&&(d.handleClickInternal(c),this.get("multiple"))?!0:e}if(b===o.DOWN||b===o.UP)if(c=this.getCurrentValue(),void 0!==c)return this.sendRequest(c),!0},validate:function(c){var a=this.get("validator"),b=this.getCurrentValue();a?a(b,function(a){c(a,b)}):c(!1,b)},sendRequest:function(c){this.get("dataSource").fetchData(c,s,this)},getKeyEventTarget:function(){return this.get("input")},
_onSetCollapsed:function(c){var a=this.$el,b=this.get("menu");if(c)b.hide();else if(e(this),!b.get("visible")){if(this.get("matchElWidth")){b.render();var d=b.get("el"),d=(parseInt(d.css("borderLeftWidth"),10)||0)+(parseInt(d.css("borderRightWidth"),10)||0);b.set("width",a[0].offsetWidth-d)}b.show()}this.get("input").attr("aria-expanded",!c)},_onSetDisabled:function(a,b){this.callSuper(a,b);this.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:v},input:{selector:function(){return"."+this.getBaseCssClass("input")}},
value:{value:"",sync:0,render:1,parse:function(){return this.get("input").val()}},trigger:{selector:function(){return"."+this.getBaseCssClass("trigger")}},placeholder:{render:1,sync:0,parse:function(){var a=this.get("placeholderEl");return a&&a.html()}},placeholderEl:{selector:function(){return"."+this.getBaseCssClass("placeholder")}},validator:{},invalidEl:{selector:function(){return"."+this.getBaseCssClass("invalid-el")}},allowTextSelection:{value:!0},hasTrigger:{value:!0,sync:0,render:1},menu:{value:{},
getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};n.mix(a.get("align"),b,!1)}}},collapsed:{render:1,sync:0,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0}},xclass:"combobox"})});
KISSY.add("combobox/combobox-xtpl",[],function(n,f,m,l){f=function(g,a,d,j){var k=this,f=k.utils.callFn,l=k.nativeCommands["if"];if("5.0.0"!==n.version)throw Error("current xtemplate file("+k.name+")(v5.0.0) need to be recompiled using current kissy(v"+n.version+")!");a.write('<div class="',0);var b={escape:1},e=[];e.push("invalid-el");b.params=e;if((b=f(k,g,b,a,["getBaseCssClasses"],0,1))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('">\r\n    <div class="',0);b={escape:1};e=[];e.push("invalid-inner");
b.params=e;if((b=f(k,g,b,a,["getBaseCssClasses"],0,2))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('"></div>\r\n</div>\r\n\r\n',0);var b={escape:1},e=[],m=g.resolve(["hasTrigger"],0);e.push(m);b.params=e;b.fn=function(a,b){b.write('\r\n<div class="',0);var d={escape:1},e=[];e.push("trigger");d.params=e;if((d=f(k,a,d,b,["getBaseCssClasses"],0,6))&&d.isBuffer)b=d,d=j;b.write(d,!0);b.write('">\r\n    <div class="',0);d={escape:1};e=[];e.push("trigger-inner");d.params=e;if((d=f(k,a,d,b,["getBaseCssClasses"],
0,7))&&d.isBuffer)b=d,d=j;b.write(d,!0);b.write('">&#x25BC;</div>\r\n</div>\r\n',0);return b};a=l.call(k,g,b,a,5,d);a.write('\r\n\r\n<div class="',0);b={escape:1};e=[];e.push("input-wrap");b.params=e;if((b=f(k,g,b,a,["getBaseCssClasses"],0,11))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('">\r\n\r\n    <input id="ks-combobox-input-',0);b=g.resolve(["id"],0);a.write(b,!0);a.write('"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ',
0);b={escape:1};e=[];m=g.resolve(["disabled"],0);e.push(m);b.params=e;b.fn=function(a,b){b.write("\r\n    disabled\r\n    ",0);return b};a=l.call(k,g,b,a,20,d);a.write('\r\n\r\n    autocomplete="off"\r\n    class="',0);b={escape:1};e=[];e.push("input");b.params=e;if((b=f(k,g,b,a,["getBaseCssClasses"],0,25))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('"\r\n\r\n    value="',0);b=g.resolve(["value"],0);a.write(b,!0);a.write('"\r\n    />\r\n\r\n\r\n    <label for="ks-combobox-input-',0);b=g.resolve(["id"],
0);a.write(b,!0);a.write("\"\r\n            style='display:",0);b={escape:1};e=[];m=g.resolve(["value"],0);e.push(m);b.params=e;b.fn=function(a,b){b.write("none",0);return b};b.inverse=function(a,b){b.write("block",0);return b};a=l.call(k,g,b,a,32,d);a.write(";'\r\n    class=\"",0);d={escape:1};l=[];l.push("placeholder");d.params=l;if((d=f(k,g,d,a,["getBaseCssClasses"],0,33))&&d.isBuffer)a=d,d=j;a.write(d,!0);a.write('">\r\n    ',0);g=g.resolve(["placeholder"],0);a.write(g,!0);a.write("\r\n    </label>\r\n</div>\r\n",
0);return a};f.TPL_NAME=l.name;return f});KISSY.add("combobox/local-data-source",["attribute"],function(n,f){return f("attribute").extend({fetchData:function(f,l,g){var a=this.get("parse"),d=this.get("data"),d=a(f,d);l.call(g,d)}},{ATTRS:{data:{value:[]},parse:{value:function(f,l){var g=[],a=0;if(!f)return l;n.each(l,function(d){-1!==d.indexOf(f)&&g.push(d);a++});return g}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(n,f){var m=f("io");return f("attribute").extend({fetchData:function(f,g,a){var d=this,j,k=d.get("paramName"),n=d.get("parse"),p=d.get("cache"),b=d.get("allowEmpty");d.caches=d.caches||{};d.io&&(d.io.abort(),d.io=null);if(!f&&!0!==b)return g.call(a,[]);if(p&&(j=d.caches[f]))return g.call(a,j);j=d.get("xhrCfg");j.data=j.data||{};j.data[k]=f;j.success=function(b){n&&(b=n(f,b));d.setInternal("data",b);p&&(d.caches[f]=b);g.call(a,b)};
d.io=m(j)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
