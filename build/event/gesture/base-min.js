/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Apr 4 12:22
*/
KISSY.add("event/gesture/base/add-event",["dom","ua","event/dom/base"],function(b,d){function g(a){return b.startsWith(a,"touch")}function l(a){return b.startsWith(a,"mouse")}function h(a){return b.startsWith(a,"MSPointer")||b.startsWith(a,"pointer")}function i(a){this.doc=a;this.eventHandles=[];this.init();this.touches=[];this.inTouch=0}function q(a){m(this,a)}function r(a){y(this,a)}function v(a){m(this,a);n[a].setup.apply(this,arguments)}function w(a){y(this,a);n[a].tearDown.apply(this,arguments)}
function m(a,c){var e=j.getDocument(a),f=j.data(e,o);f||j.data(e,o,f=new i(e));c&&f.addEventHandle(c)}function y(a,c){var e=j.getDocument(a),f=j.data(e,o);f&&(c&&f.removeEventHandle(c),f.eventHandles.length||(f.destroy(),j.removeData(e,o)))}var j=d("dom"),n={},z=d("ua"),k=d("event/dom/base"),A=k.Special,o=b.guid("touch-handle"),x=b.Feature,s,p,t;x.isTouchEventSupported()?z.ios?(t="touchend touchcancel",s="touchstart",p="touchmove"):(t="touchend touchcancel mouseup",s="touchstart mousedown",p="touchmove mousemove"):
x.isPointerSupported()?(s="pointerdown",p="pointermove",t="pointerup pointercancel"):x.isMsPointerSupported()?(s="MSPointerDown",p="MSPointerMove",t="MSPointerUp MSPointerCancel"):(s="mousedown",p="mousemove",t="mouseup");i.prototype={constructor:i,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;k.on(a,s,this.onTouchStart,this);if(!h(p))k.on(a,p,this.onTouchMove,this);k.on(a,t,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var c=
0,e=a.pointerId,f=this.touches,u=f.length;c<u;c++){a=f[c];if(a.pointerId===e){f.splice(c,1);break}}},updateTouch:function(a){for(var c=0,e,f=a.pointerId,u=this.touches,g=u.length;c<g;c++){e=u[c];e.pointerId===f&&(u[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];
if(this.isPrimaryTouch(a)){var e={x:a.clientX,y:a.clientY};c.push(e);setTimeout(function(){var a=c.indexOf(e);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=this.lastTouches,e=a.clientX,a=a.clientY,f=0,g=c.length,b;f<g&&(b=c[f]);f++){var m=Math.abs(e-b.x),d=Math.abs(a-b.y);if(m<=25&&d<=25)return true}return 0},normalize:function(a){var c=a.type,e,f;if(e=g(c)){f=c==="touchend"||c==="touchcancel"?a.changedTouches:a.touches;a.gestureType="touch"}else{if(h(c))a.gestureType=
a.originalEvent.pointerType;else if(l(c))a.gestureType="mouse";f=this.touches}if(f&&f.length===1){a.which=1;a.pageX=f[0].pageX;a.pageY=f[0].pageY}if(e)return a;c=!c.match(/(up|cancel)$/i);a.touches=c?f:[];a.targetTouches=c?f:[];a.changedTouches=f;return a},onTouchStart:function(a){var c,e=a.type,f=this.eventHandles;if(g(e)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(l(e)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a]}else if(h(e)){this.addTouch(a.originalEvent);
if(this.touches.length===1)k.on(this.doc,p,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(var e=0,b=f.length;e<b;e++){c=f[e];c=f[c].handle;c.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var c=a.type;if(l(c)){if(this.isEventSimulatedFromTouch(c))return;this.touches=[a]}else if(h(c))this.updateTouch(a.originalEvent);else if(!g(c))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var c=
this,e=a.type;if(!l(e)||!c.isEventSimulatedFromTouch(a)){c.callEventHandle("onTouchEnd",a);if(g(e)){c.dupMouse(a);b.makeArray(a.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else if(l(e))c.touches=[];else if(h(e)){c.removeTouch(a.originalEvent);c.touches.length||k.detach(c.doc,p,c.onTouchMove,c)}}},callEventHandle:function(a,c){var e=this.eventHandles,f=e.concat(),b,c=this.normalize(c),g=c.gestureType;if(c.changedTouches.length){for(var m=0,d=f.length;m<d;m++){b=f[m];if(e[b]){b=e[b].handle;
if(!(b.requiredGestureType&&g!==b.requiredGestureType)&&!b.processed){b.processed=1;if(b.isActive&&b[a]&&b[a](c)===false)b.isActive=0}}}m=0;for(d=f.length;m<d;m++){b=e[m];if(e[b]){b=e[b].handle;b.processed=0}}}},addEventHandle:function(a){var c=this.eventHandles,b=n[a].handle;if(c[a])c[a].count++;else{c.push(a);this.sortEventHandles();c[a]={count:1,handle:b}}},sortEventHandles:function(){this.eventHandles.sort(function(a,c){return n[a].order-n[c].order})},removeEventHandle:function(a){var c=this.eventHandles;
if(c[a]){c[a].count--;if(!c[a].count){c.splice(b.indexOf(a,c),1);delete c[a]}}},destroy:function(){var a=this.doc;k.detach(a,s,this.onTouchStart,this);k.detach(a,p,this.onTouchMove,this);k.detach(a,t,this.onTouchEnd,this)}};return function(a,c){typeof a==="string"&&(a=[a]);b.each(a,function(a){var b={};b.setup=c.setup?v:q;b.tearDown=c.tearDown?w:r;b.add=c.add;b.remove=c.remove;c.order=c.order||100;n[a]=c;A[a]=b})}});
KISSY.add("event/gesture/base/touch",[],function(b){function d(){}b=b.noop;d.prototype={constructor:d,requiredTouchCount:0,onTouchStart:function(b){var d=this.requiredTouchCount,h=b.touches.length;if(h===d)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=b.touches,this.startTime=b.timeStamp,this.start(b);if(h>d)this.onTouchEnd(b,!0)},onTouchMove:function(b){if(this.isTracking)return this.lastTouches=b.touches,this.move(b)},onTouchEnd:function(b,d){this.isTracking&&(this.isTracking=
!1,this.isStarted&&(this.isStarted=!1,this.end(b,d)))},start:b,move:b,end:b};return d});KISSY.add("event/gesture/base/single-touch",["./touch"],function(b,d){function g(){}var l=d("./touch");b.extend(g,l,{requiredTouchCount:1,start:function(){g.superclass.start.apply(this,arguments);var b=this.lastTouches;this.lastXY={pageX:b[0].pageX,pageY:b[0].pageY}}});return g});
KISSY.add("event/gesture/base/tap",["./add-event","event/dom/base","./single-touch","ua"],function(b,d){function g(b){b.preventDefault()}function l(b){b.singleTapTimer&&(clearTimeout(b.singleTapTimer),b.singleTapTimer=0);b.tapHoldTimer&&(clearTimeout(b.tapHoldTimer),b.tapHoldTimer=0)}function h(){h.superclass.constructor.apply(this,arguments)}var i=d("./add-event"),q=d("event/dom/base"),r=d("./single-touch"),v=d("ua"),w=q.Object;b.extend(h,r,{start:function(d){var g=this;h.superclass.start.call(g,
d);l(g);var j=g.lastTouches[0];g.tapHoldTimer=setTimeout(function(){var h=b.mix({touch:j,which:1,TAP_HOLD_DELAY:(b.now()-d.timeStamp)/1E3},g.lastXY);g.tapHoldTimer=0;g.lastXY=0;q.fire(j.target,"tapHold",h)},1E3);g.isStarted=!0},move:function(){var b;if(!(b=this.lastXY))return!1;var d=this.lastTouches[0];if(!d||5<Math.abs(d.pageX-b.pageX)||5<Math.abs(d.pageY-b.pageY))return l(this),!1},end:function(d,h){var j;l(this);if(!h&&(j=this.lastXY)){var n=this.lastTouches[0],i=n.target,k=new w(d.originalEvent);
b.mix(k,{type:"tap",which:1,pageX:j.pageX,pageY:j.pageY,target:i,currentTarget:i});k.touch=n;q.fire(i,"tap",k);if(k.isDefaultPrevented()&&v.mobile)if(v.ios)d.preventDefault();else q.on(i.ownerDocument||i,"click",{fn:g,once:1});var k=this.lastEndTime,r=d.timeStamp,o;this.lastEndTime=r;if(k&&(o=r-k,300>o)){this.lastEndTime=0;q.fire(i,"doubleTap",{touch:n,pageX:j.pageX,pageY:j.pageY,which:1,duration:o/1E3});return}o=r-this.startTime;300<o?q.fire(i,"singleTap",{touch:n,pageX:j.pageX,pageY:j.pageY,which:1,
duration:o/1E3}):this.singleTapTimer=setTimeout(function(){q.fire(i,"singleTap",{touch:n,pageX:j.pageX,pageY:j.pageY,which:1,duration:o/1E3})},300)}}});i(["tap","doubleTap","singleTap","tapHold"],{handle:new h});return{tap:"tap",TAP:"tap",singleTap:"singleTap",SINGLE_TAP:"singleTap",DOUBLE_TAP:"doubleTap",doubleTap:"doubleTap",TAP_HOLD:"tapHold"}});
KISSY.add("event/gesture/base",["event/dom/base","./base/add-event","./base/tap","./base/touch","./base/single-touch"],function(b,d){function g(b,d){var g={isActive:1};g[d]=function(d){l.fire(d.target,b,d)};h(b,{order:1,handle:g})}var l=d("event/dom/base"),h=d("./base/add-event"),i={start:"gestureStart",START:"gestureStart",move:"gestureMove",MOVE:"gestureMove",end:"gestureEnd",END:"gestureEnd"};g(i.START,"onTouchStart");g(i.MOVE,"onTouchMove");g(i.END,"onTouchEnd");b.mix(i,d("./base/tap"));return{Enumeration:i,
addEvent:h,Touch:d("./base/touch"),SingleTouch:d("./base/single-touch")}});
