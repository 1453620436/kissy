/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 26 21:39
*/
KISSY.add("event/gesture/util",["./util/add-event","./util/touch","./util/single-touch","./util/double-touch"],function(m,d){return{addEvent:d("./util/add-event"),Touch:d("./util/touch"),SingleTouch:d("./util/single-touch"),DoubleTouch:d("./util/double-touch")}});
KISSY.add("event/gesture/util/add-event",["util","dom","ua","event/dom/base","feature"],function(m,d){function c(a){return l.startsWith(a,"touch")}function g(a){return l.startsWith(a,"mouse")}function h(a){return l.startsWith(a,"MSPointer")||l.startsWith(a,"pointer")}function s(a){this.doc=a;this.eventHandles=[];this.init();this.touches=[];this.inTouch=0}function w(a){u(this,a)}function x(a){v(this,a)}function y(a){u(this,a);p[a].setup.apply(this,arguments)}function z(a){v(this,a);p[a].tearDown.apply(this,
arguments)}function u(a,b){var e=q.getDocument(a),f=q.data(e,r);f||q.data(e,r,f=new s(e));b&&f.addEventHandle(b)}function v(a,b){var e=q.getDocument(a),f=q.data(e,r);f&&(b&&f.removeEventHandle(b),f.eventHandles.length||(f.destroy(),q.removeData(e,r)))}var l=d("util"),q=d("dom"),p={},A=d("ua"),j=d("event/dom/base"),B=j.Special,r=l.guid("touch-handle"),t=d("feature"),n,i,o;t.isTouchEventSupported()?A.ios?(o="touchend touchcancel",n="touchstart",i="touchmove"):(o="touchend touchcancel mouseup",n="touchstart mousedown",
i="touchmove mousemove"):t.isPointerSupported()?(n="pointerdown",i="pointermove",o="pointerup pointercancel"):t.isMsPointerSupported()?(n="MSPointerDown",i="MSPointerMove",o="MSPointerUp MSPointerCancel"):(n="mousedown",i="mousemove",o="mouseup");s.prototype={constructor:s,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;j.on(a,n,this.onTouchStart,this);if(!h(i))j.on(a,i,this.onTouchMove,this);j.on(a,o,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},
removeTouch:function(a){for(var b=0,e=a.pointerId,f=this.touches,k=f.length;b<k;b++){a=f[b];if(a.pointerId===e){f.splice(b,1);break}}},updateTouch:function(a){for(var b=0,e,f=a.pointerId,k=this.touches,c=k.length;b<c;b++){e=k[b];e.pointerId===f&&(k[b]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=
this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var e={x:a.clientX,y:a.clientY};b.push(e);setTimeout(function(){var a=b.indexOf(e);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,e=a.clientX,a=a.clientY,f=0,k=b.length,c;f<k&&(c=b[f]);f++){var d=Math.abs(e-c.x),g=Math.abs(a-c.y);if(d<=25&&g<=25)return true}return 0},normalize:function(a){var b=a.type,e,f;if(e=c(b)){f=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;a.gestureType=
"touch"}else{if(h(b))a.gestureType=a.originalEvent.pointerType;else if(g(b))a.gestureType="mouse";f=this.touches}if(f&&f.length===1){a.which=1;a.pageX=f[0].pageX;a.pageY=f[0].pageY}if(e)return a;b=!b.match(/(up|cancel)$/i);a.touches=b?f:[];a.targetTouches=b?f:[];a.changedTouches=f;return a},onTouchStart:function(a){var b,e=a.type,f=this.eventHandles;if(c(e)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(g(e)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a]}else if(h(e)){this.addTouch(a.originalEvent);
if(this.touches.length===1)j.on(this.doc,i,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(var e=0,k=f.length;e<k;e++){b=f[e];b=f[b].handle;b.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(g(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[a]}else if(h(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=
this,e=a.type;if(!g(e)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(e)){b.dupMouse(a);l.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(g(e))b.touches=[];else if(h(e)){b.removeTouch(a.originalEvent);b.touches.length||j.detach(b.doc,i,b.onTouchMove,b)}}},callEventHandle:function(a,b){var e=this.eventHandles,f=e.concat(),c,b=this.normalize(b),d=b.gestureType;if(b.changedTouches.length){for(var g=0,h=f.length;g<h;g++){c=f[g];if(e[c]){c=e[c].handle;
if(!(c.requiredGestureType&&d!==c.requiredGestureType)&&!c.processed){c.processed=1;if(c.isActive&&c[a]&&c[a](b)===false)c.isActive=0}}}g=0;for(h=f.length;g<h;g++){c=e[g];if(e[c]){c=e[c].handle;c.processed=0}}}},addEventHandle:function(a){var b=this.eventHandles,c=p[a].handle;if(b[a])b[a].count++;else{b.push(a);this.sortEventHandles();b[a]={count:1,handle:c}}},sortEventHandles:function(){this.eventHandles.sort(function(a,b){return p[a].order-p[b].order})},removeEventHandle:function(a){var b=this.eventHandles;
if(b[a]){b[a].count--;if(!b[a].count){b.splice(l.indexOf(a,b),1);delete b[a]}}},destroy:function(){var a=this.doc;j.detach(a,n,this.onTouchStart,this);j.detach(a,i,this.onTouchMove,this);j.detach(a,o,this.onTouchEnd,this)}};return function(a,b){typeof a==="string"&&(a=[a]);l.each(a,function(a){var c={};c.setup=b.setup?y:w;c.tearDown=b.tearDown?z:x;c.add=b.add;c.remove=b.remove;b.order=b.order||100;p[a]=b;B[a]=c})}});
KISSY.add("event/gesture/util/touch",[],function(){function m(){}var d=function(){};m.prototype={constructor:m,requiredTouchCount:0,onTouchStart:function(c){var d=this.requiredTouchCount,h=c.touches.length;if(h===d)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=c.touches,this.startTime=c.timeStamp,this.start(c);if(h>d)this.onTouchEnd(c,!0)},onTouchMove:function(c){if(this.isTracking)return this.lastTouches=c.touches,this.move(c)},onTouchEnd:function(c,d){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.end(c,d)))},start:d,move:d,end:d};return m});KISSY.add("event/gesture/util/single-touch",["./touch","util"],function(m,d){function c(){}var g=d("./touch");d("util").extend(c,g,{requiredTouchCount:1,start:function(){c.superclass.start.apply(this,arguments);var d=this.lastTouches;this.lastXY={pageX:d[0].pageX,pageY:d[0].pageY}}});return c});
KISSY.add("event/gesture/util/double-touch",["dom","./touch","util"],function(m,d){function c(){}var g=d("dom"),h=d("./touch");d("util").extend(c,h,{requiredTouchCount:2,getCommonTarget:function(c){var d=c.touches,c=d[0].target,d=d[1].target;if(c===d||g.contains(c,d))return c;for(;;){if(g.contains(d,c))return d;d=d.parentNode}}});return c});
