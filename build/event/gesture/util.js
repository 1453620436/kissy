/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 29 15:09
*/
KISSY.add("event/gesture/util",["./util/add-event","./util/touch","./util/single-touch","./util/double-touch"],function(g,d){return{addEvent:d("./util/add-event"),Touch:d("./util/touch"),SingleTouch:d("./util/single-touch"),DoubleTouch:d("./util/double-touch")}});
KISSY.add("event/gesture/util/add-event",["dom","ua","event/dom/base"],function(g,d){function c(a){return g.startsWith(a,"touch")}function h(a){return g.startsWith(a,"mouse")}function l(a){return g.startsWith(a,"MSPointer")||g.startsWith(a,"pointer")}function r(a){this.doc=a;this.eventHandles=[];this.init();this.touches=[];this.inTouch=0}function v(a){t(this,a)}function w(a){u(this,a)}function x(a){t(this,a);o[a].setup.apply(this,arguments)}function y(a){u(this,a);o[a].tearDown.apply(this,arguments)}
function t(a,b){var e=p.getDocument(a),f=p.data(e,q);f||p.data(e,q,f=new r(e));b&&f.addEventHandle(b)}function u(a,b){var e=p.getDocument(a),f=p.data(e,q);f&&(b&&f.removeEventHandle(b),f.eventHandles.length||(f.destroy(),p.removeData(e,q)))}var p=d("dom"),o={},z=d("ua"),j=d("event/dom/base"),A=j.Special,q=g.guid("touch-handle"),s=g.Feature,m,i,n;s.isTouchEventSupported()?z.ios?(n="touchend touchcancel",m="touchstart",i="touchmove"):(n="touchend touchcancel mouseup",m="touchstart mousedown",i="touchmove mousemove"):
s.isPointerSupported()?(m="pointerdown",i="pointermove",n="pointerup pointercancel"):s.isMsPointerSupported()?(m="MSPointerDown",i="MSPointerMove",n="MSPointerUp MSPointerCancel"):(m="mousedown",i="mousemove",n="mouseup");r.prototype={constructor:r,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;j.on(a,m,this.onTouchStart,this);if(!l(i))j.on(a,i,this.onTouchMove,this);j.on(a,n,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var b=
0,e=a.pointerId,f=this.touches,k=f.length;b<k;b++){a=f[b];if(a.pointerId===e){f.splice(b,1);break}}},updateTouch:function(a){for(var b=0,e,f=a.pointerId,k=this.touches,c=k.length;b<c;b++){e=k[b];e.pointerId===f&&(k[b]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=this.lastTouches,a=a.changedTouches[0];
if(this.isPrimaryTouch(a)){var e={x:a.clientX,y:a.clientY};b.push(e);setTimeout(function(){var a=b.indexOf(e);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,e=a.clientX,a=a.clientY,f=0,k=b.length,c;f<k&&(c=b[f]);f++){var g=Math.abs(e-c.x),d=Math.abs(a-c.y);if(g<=25&&d<=25)return true}return 0},normalize:function(a){var b=a.type,e,f;if(e=c(b)){f=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;a.gestureType="touch"}else{if(l(b))a.gestureType=
a.originalEvent.pointerType;else if(h(b))a.gestureType="mouse";f=this.touches}if(f&&f.length===1){a.which=1;a.pageX=f[0].pageX;a.pageY=f[0].pageY}if(e)return a;b=!b.match(/(up|cancel)$/i);a.touches=b?f:[];a.targetTouches=b?f:[];a.changedTouches=f;return a},onTouchStart:function(a){var b,e=a.type,f=this.eventHandles;if(c(e)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(e)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a]}else if(l(e)){this.addTouch(a.originalEvent);
if(this.touches.length===1)j.on(this.doc,i,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(var e=0,k=f.length;e<k;e++){b=f[e];b=f[b].handle;b.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(h(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[a]}else if(l(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=
this,e=a.type;if(!h(e)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(e)){b.dupMouse(a);g.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(e))b.touches=[];else if(l(e)){b.removeTouch(a.originalEvent);b.touches.length||j.detach(b.doc,i,b.onTouchMove,b)}}},callEventHandle:function(a,b){var e=this.eventHandles,f=e.concat(),c,b=this.normalize(b),g=b.gestureType;if(b.changedTouches.length){for(var d=0,h=f.length;d<h;d++){c=f[d];if(e[c]){c=e[c].handle;
if(!(c.requiredGestureType&&g!==c.requiredGestureType)&&!c.processed){c.processed=1;if(c.isActive&&c[a]&&c[a](b)===false)c.isActive=0}}}d=0;for(h=f.length;d<h;d++){c=e[d];if(e[c]){c=e[c].handle;c.processed=0}}}},addEventHandle:function(a){var b=this.eventHandles,c=o[a].handle;if(b[a])b[a].count++;else{b.push(a);this.sortEventHandles();b[a]={count:1,handle:c}}},sortEventHandles:function(){this.eventHandles.sort(function(a,b){return o[a].order-o[b].order})},removeEventHandle:function(a){var b=this.eventHandles;
if(b[a]){b[a].count--;if(!b[a].count){b.splice(g.indexOf(a,b),1);delete b[a]}}},destroy:function(){var a=this.doc;j.detach(a,m,this.onTouchStart,this);j.detach(a,i,this.onTouchMove,this);j.detach(a,n,this.onTouchEnd,this)}};return function(a,b){typeof a==="string"&&(a=[a]);g.each(a,function(a){var c={};c.setup=b.setup?x:v;c.tearDown=b.tearDown?y:w;c.add=b.add;c.remove=b.remove;b.order=b.order||100;o[a]=b;A[a]=c})}});
KISSY.add("event/gesture/util/touch",[],function(g){function d(){}g=g.noop;d.prototype={constructor:d,requiredTouchCount:0,onTouchStart:function(c){var d=this.requiredTouchCount,g=c.touches.length;if(g===d)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=c.touches,this.startTime=c.timeStamp,this.start(c);if(g>d)this.onTouchEnd(c,!0)},onTouchMove:function(c){if(this.isTracking)return this.lastTouches=c.touches,this.move(c)},onTouchEnd:function(c,d){this.isTracking&&(this.isTracking=
!1,this.isStarted&&(this.isStarted=!1,this.end(c,d)))},start:g,move:g,end:g};return d});KISSY.add("event/gesture/util/single-touch",["./touch"],function(g,d){function c(){}var h=d("./touch");g.extend(c,h,{requiredTouchCount:1,start:function(){c.superclass.start.apply(this,arguments);var d=this.lastTouches;this.lastXY={pageX:d[0].pageX,pageY:d[0].pageY}}});return c});
KISSY.add("event/gesture/util/double-touch",["dom","./touch"],function(g,d){function c(){}var h=d("dom"),l=d("./touch");g.extend(c,l,{requiredTouchCount:2,getCommonTarget:function(c){var d=c.touches,c=d[0].target,d=d[1].target;if(c===d||h.contains(c,d))return c;for(;;){if(h.contains(d,c))return d;d=d.parentNode}}});return c});
