/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 5 22:11
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});
KISSY.add("event/dom/touch/touch",[],function(a){function b(){}a=a.noop;b.prototype={constructor:b,requiredTouchCount:0,onTouchStart:function(a){var b=this.requiredTouchCount,f=a.touches.length;if(f===b)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=a.touches,this.start(a);if(f>b)this.onTouchEnd(a)},onTouchMove:function(a){if(this.isTracking)return this.lastTouches=a.touches,this.move(a)},onTouchEnd:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&
(this.isStarted=!1,this.end(a)))},start:a,move:a,end:a};return b});KISSY.add("event/dom/touch/single-touch",["./touch"],function(a,b){function h(){}var i=b("./touch");a.extend(h,i,{requiredTouchCount:1,start:function(){h.superclass.start.apply(this,arguments);var a=this.lastTouches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}}});return h});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(a,b){function h(d){d.preventDefault()}function i(){i.superclass.constructor.apply(this,arguments)}var f=b("./handle-map"),j=b("event/dom/base"),l=b("./single-touch"),n=j.Object;a.extend(i,l,{start:function(d){var c=this;i.superclass.start.call(c,d);c.tapHoldTimer&&clearTimeout(c.tapHoldTimer);var e=c.lastTouches[0];c.tapHoldTimer=setTimeout(function(){var g=a.mix({touch:e,which:1,TAP_HOLD_DELAY:(a.now()-d.timeStamp)/
1E3},c.lastXY);c.tapHoldTimer=0;c.lastXY=0;j.fire(e.target,"tapHold",g)},1E3);c.startTime=d.timeStamp;c.singleTapTimer&&(clearTimeout(c.singleTapTimer),c.singleTapTimer=0)},move:function(){var d;if(!(d=this.lastXY))return!1;var c=this.lastTouches[0];if(!c||5<Math.abs(c.pageX-d.pageX)||5<Math.abs(c.pageY-d.pageY))return!1},end:function(d){var c;if(c=this.lastXY){var e=this.lastTouches[0],g=e.target;this.tapHoldTimer&&(clearTimeout(this.tapHoldTimer),this.tapHoldTimer=0);var b=new n(d.originalEvent);
a.mix(b,{type:"tap",which:1,pageX:c.pageX,pageY:c.pageY,target:g,currentTarget:g});b.touch=e;j.fire(g,"tap",b);if(b.isDefaultPrevented()&&a.UA.mobile)if(a.UA.ios)d.preventDefault();else j.on(g.ownerDocument||g,"click",{fn:h,once:1});var b=this.lastEndTime,d=d.timeStamp,m;this.lastEndTime=d;if(b&&(m=d-b,300>m)){this.lastEndTime=0;j.fire(g,"doubleTap",{touch:e,pageX:c.pageX,pageY:c.pageY,which:1,duration:m/1E3});return}m=d-this.startTime;300<m?j.fire(g,"singleTap",{touch:e,pageX:c.pageX,pageY:c.pageY,
which:1,duration:m/1E3}):this.singleTapTimer=setTimeout(function(){j.fire(g,"singleTap",{touch:e,pageX:c.pageX,pageY:c.pageY,which:1,duration:m/1E3})},300)}}});f.tap=f.doubleTap=f.singleTap=f.tapHold={handle:new i};return i});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(a,b){function h(e,g,a){var b=e.lastTouches[0],k=b.pageX-e.startX,p=b.pageY-e.startY,q=Math.abs(k),r=Math.abs(p);if(a){if(e.isVertical&&e.isHorizontal){if(5>Math.max(q,r))return;r>q?e.isHorizontal=0:e.isVertical=0}}else if(e.isVertical&&r<c&&(e.isVertical=0),e.isHorizontal&&q<c)e.isHorizontal=0;if(e.isHorizontal)k=0>k?"left":"right";else if(e.isVertical)k=0>p?"up":"down",q=r;else return!1;j.fire(b.target,
a?d:n,{originalEvent:g.originalEvent,pageX:b.pageX,pageY:b.pageY,which:1,touch:b,direction:k,distance:q,duration:(g.timeStamp-e.startTime)/1E3})}function i(){}var f=b("./handle-map"),j=b("event/dom/base"),l=b("./single-touch"),n="swipe",d="swiping",c=50;a.extend(i,l,{start:function(c){if(!c.isTouch)return!1;i.superclass.start.apply(this,arguments);this.isStarted=!0;var g=this.lastTouches[0];this.startTime=c.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=g.pageX;this.startY=g.pageY},move:function(c){var g=
c.timeStamp;i.superclass.move.apply(this,arguments);if(1E3<g-this.startTime)return!1;var a=this.lastTouches[0],g=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),g=Math.abs(g);this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<g&&(this.isHorizontal=0);return h(this,c,1)},end:function(c){return!1===this.move(c)?!1:h(this,c,0)}});f[n]=f[d]={handle:new i};return i});
KISSY.add("event/dom/touch/double-touch",["dom","./touch"],function(a,b){function h(){}var i=b("dom"),f=b("./touch");a.extend(h,f,{requiredTouchCount:2,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a===b||i.contains(a,b))return a;for(;;){if(i.contains(b,a))return b;b=b.parentNode}}});return h});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./double-touch"],function(a,b){function h(){}function i(a){2===a.targetTouches.length&&a.preventDefault()}var f=b("./handle-map"),j=b("event/dom/base"),l=b("./double-touch");a.extend(h,l,{move:function(b){h.superclass.move.apply(this,arguments);var d=this.lastTouches;if(0<d[0].pageX&&0<d[0].pageY&&0<d[1].pageX&&0<d[1].pageY){var c;c=d[0];var e=d[1],d=c.pageX-e.pageX;c=c.pageY-e.pageY;c=Math.sqrt(d*d+c*c);this.isStarted?j.fire(this.target,
"pinch",a.mix(b,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,d=this.target=this.getCommonTarget(b),j.fire(d,"pinchStart",a.mix(b,{distance:c,scale:1})))}},end:function(b){h.superclass.end.apply(this,arguments);j.fire(this.target,"pinchEnd",a.mix(b,{touches:this.lastTouches}))}});l=new h;f.pinchStart=f.pinchEnd={handle:l};f=f.pinch={handle:l};a.Feature.isTouchEventSupported()&&(f.setup=function(){this.addEventListener("touchmove",i,!1)},f.tearDown=function(){this.removeEventListener("touchmove",
i,!1)});return h});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./double-touch"],function(a,b){function h(){}function i(b){2===b.targetTouches.length&&b.preventDefault()}var f=b("./handle-map"),j=b("event/dom/base"),l=b("./double-touch"),n=180/Math.PI;a.extend(h,l,{move:function(b){h.superclass.move.apply(this,arguments);var c=this.lastTouches,e=c[0],g=c[1],c=this.lastAngle,e=Math.atan2(g.pageY-e.pageY,g.pageX-e.pageX)*n;if(void 0!==c){var g=Math.abs(e-c),f=(e+360)%360,m=(e-360)%360;Math.abs(f-
c)<g?e=f:Math.abs(m-c)<g&&(e=m)}this.lastAngle=e;this.isStarted?j.fire(this.target,"rotate",a.mix(b,{angle:e,rotation:e-this.startAngle})):(this.isStarted=!0,this.startAngle=e,this.target=this.getCommonTarget(b),j.fire(this.target,"rotateStart",a.mix(b,{angle:e,rotation:0})))},end:function(b){h.superclass.end.apply(this,arguments);this.lastAngle=void 0;j.fire(this.target,"rotateEnd",a.mix(b,{touches:this.lastTouches}))}});l=new h;f.rotateEnd=f.rotateStart={handle:l};f=f.rotate={handle:l};a.Feature.isTouchEventSupported()&&
(f.setup=function(){this.addEventListener("touchmove",i,!1)},f.tearDown=function(){this.removeEventListener("touchmove",i,!1)});return h});
KISSY.add("event/dom/touch/drag",["./handle-map","event/dom/base","./single-touch"],function(a,b){function h(c,b){var a=c.lastTouches[0],f=b.timeStamp;f-c.lastTime>d&&(c.lastPos={pageX:a.pageX,pageY:a.pageY},c.lastTime=f)}function i(c,b,a){var d=c.startPos,a=a||{},f=c.lastTouches[0];a.pageX=f.pageX;a.pageY=f.pageY;a.originalEvent=b.originalEvent;a.deltaX=f.pageX-d.pageX;a.deltaY=f.pageY-d.pageY;a.startTime=c.startTime;a.startPos=c.startPos;a.isTouch=b.isTouch;a.touch=f;return a}function f(){}var j=
b("./handle-map"),l=b("event/dom/base"),n=b("./single-touch"),d=300;a.extend(f,n,{start:function(c){f.superclass.start.apply(this,arguments);var a=this.lastTouches[0];this.startTime=this.lastTime=c.timeStamp;this.startPos=this.lastPos={pageX:a.pageX,pageY:a.pageY}},move:function(a){f.superclass.move.apply(this,arguments);if(this.isStarted)h(this,a),l.fire(this.lastTouches[0].target,"drag",i(this,a));else{var b=a,d=this.lastTouches[0],j=this.startPos,m=d.pageX-j.pageX,j=d.pageY-j.pageY;3<Math.sqrt(m*
m+j*j)&&(this.isStarted=!0,h(this,b),l.fire(d.target,"dragStart",i(this,b)))}},end:function(a){var b=this.lastTouches[0],d=a.timeStamp;l.fire(b.target,"dragEnd",i(this,a,{velocityX:(b.pageX-this.lastPos.pageX)/(d-this.lastTime),velocityY:(b.pageY-this.lastPos.pageY)/(d-this.lastTime)}))}});j.dragStart=j.drag=j.dragEnd={handle:new f};return f});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./pinch,./rotate,./drag".split(","),function(a,b){function h(k){return a.startsWith(k,"touch")}function i(k){return a.startsWith(k,"mouse")}function f(k){return a.startsWith(k,"MSPointer")||a.startsWith(k,"pointer")}function j(k){this.doc=k;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var l=b("dom"),n=b("./handle-map"),d=b("event/dom/base");b("./tap");b("./swipe");b("./pinch");b("./rotate");b("./drag");
var c=a.guid("touch-handle"),e=a.Feature,g,o,m;if(e.isTouchEventSupported())if(a.UA.ios){m="touchend touchcancel";g="touchstart";o="touchmove"}else{m="touchend touchcancel mouseup";g="touchstart mousedown";o="touchmove mousemove"}else if(e.isPointerSupported()){g="pointerdown";o="pointermove";m="pointerup pointercancel"}else if(e.isMsPointerSupported()){g="MSPointerDown";o="MSPointerMove";m="MSPointerUp MSPointerCancel"}else{g="mousedown";o="mousemove";m="mouseup"}j.prototype={constructor:j,lastTouches:[],
firstTouch:null,init:function(){var k=this.doc;d.on(k,g,this.onTouchStart,this);if(!f(o))d.on(k,o,this.onTouchMove,this);d.on(k,m,this.onTouchEnd,this)},addTouch:function(k){k.identifier=k.pointerId;this.touches.push(k)},removeTouch:function(k){for(var a=0,b=k.pointerId,c=this.touches,d=c.length;a<d;a++){k=c[a];if(k.pointerId===b){c.splice(a,1);break}}},updateTouch:function(k){for(var a=0,b,c=k.pointerId,d=this.touches,f=d.length;a<f;a++){b=d[a];b.pointerId===c&&(d[a]=k)}},isPrimaryTouch:function(a){return this.firstTouch===
a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var c={x:a.clientX,y:a.clientY};b.push(c);setTimeout(function(){var a=b.indexOf(c);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,c=a.clientX,a=a.clientY,d=0,f=b.length,e;d<f&&(e=b[d]);d++){var g=
Math.abs(c-e.x),h=Math.abs(a-e.y);if(g<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,c,d;if(c=h(b)){d=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;a.isTouch=1}else{if(f(b)&&a.originalEvent.pointerType==="touch")a.isTouch=1;d=this.touches}if(d&&d.length===1){a.which=1;a.pageX=d[0].pageX;a.pageY=d[0].pageY}if(c)return a;b=!b.match(/(up|cancel)$/i);a.touches=b?d:[];a.targetTouches=b?d:[];a.changedTouches=d;return a},onTouchStart:function(a){var b,c;c=a.type;var e=
this.eventHandle;if(h(c)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(i(c)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(f(c)){this.addTouch(a.originalEvent);if(this.touches.length===1)d.on(this.doc,o,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in e){c=e[b].handle;c.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(i(b)){if(this.isEventSimulatedFromTouch(b))return;
this.touches=[a.originalEvent]}else if(f(b))this.updateTouch(a.originalEvent);else if(!h(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(b){var c=this,e=b.type;if(!i(e)||!c.isEventSimulatedFromTouch(b)){c.callEventHandle("onTouchEnd",b);if(h(e)){c.dupMouse(b);a.makeArray(b.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else if(i(e))c.touches=[];else if(f(e)){c.removeTouch(b.originalEvent);c.touches.length||d.detach(c.doc,
o,c.onTouchMove,c)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=n[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=
this.doc;d.detach(a,g,this.onTouchStart,this);d.detach(a,o,this.onTouchMove,this);d.detach(a,m,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var d=l.getDocument(a),e=l.data(d,c);e||l.data(d,c,e=new j(d));b&&e.addEventHandle(b)},removeDocumentHandle:function(b,d){var e=l.getDocument(b),f=l.data(e,c);if(f){d&&f.removeEventHandle(d);if(a.isEmptyObject(f.eventHandle)){f.destroy();l.removeData(e,c)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(a,b){function h(a){d.addDocumentHandle(this,a);n[a].setup.apply(this,arguments)}function i(a){d.removeDocumentHandle(this,a);n[a].tearDown.apply(this,arguments)}function f(a){d.addDocumentHandle(this,a)}function j(a){d.removeDocumentHandle(this,a)}var l=b("event/dom/base"),n=b("./touch/handle-map"),d=b("./touch/handle"),c=l.Gesture,e=c.start="KSPointerDown",g=c.move="KSPointerMove",o=c.end="KSPointerUp";
c.tap="tap";c.singleTap="singleTap";c.doubleTap="doubleTap";n[e]={handle:{isActive:1,onTouchStart:function(a){l.fire(a.target,e,a)}}};n[g]={handle:{isActive:1,onTouchMove:function(a){l.fire(a.target,g,a)}}};n[o]={handle:{isActive:1,onTouchEnd:function(a){l.fire(a.target,o,a)}}};var c=l.Special,m,k,p;for(k in n)m={},p=n[k],m.setup=p.setup?h:f,m.tearDown=p.tearDown?i:j,p.add&&(m.add=p.add),p.remove&&(m.remove=p.remove),c[k]=m});
