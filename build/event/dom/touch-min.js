/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 4 12:05
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(a){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=a.touches},onTouchMove:a.noop,onTouchEnd:a.noop};return c});
KISSY.add("event/dom/touch/tap",function(a,c,e,b){function f(a){a.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var j=e.Object;a.extend(h,b,{onTouchMove:function(){return!1},onTouchEnd:function(b){var c=b.changedTouches[0],b=b.target,g=new j({type:"tap",target:b,currentTarget:b});a.mix(g,{pageX:c.pageX,pageY:c.pageY,which:1,touch:c});e.fire(b,"tap",g);if(g.isDefaultPrevented())e.on(b,"click",{fn:f,once:1})}});c.tap={handle:new h};return h},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(a,c,e,b){function f(g,b,a){var d=b.changedTouches[0],m=d.pageX-g.startX,k=d.pageY-g.startY,p=Math.abs(m),c=Math.abs(k);if(a){if(g.isVertical&&g.isHorizontal){if(5>Math.max(p,c))return;c>p?g.isHorizontal=0:g.isVertical=0}}else if(g.isVertical&&c<o&&(g.isVertical=0),g.isHorizontal&&p<o)g.isHorizontal=0;if(g.isHorizontal)m=0>m?"left":"right";else if(g.isVertical)m=0>k?"up":"down",p=c;else return!1;e.fire(b.target,a?l:j,{originalEvent:b.originalEvent,pageX:d.pageX,
pageY:d.pageY,which:1,touch:d,direction:m,distance:p,duration:(b.timeStamp-g.startTime)/1E3})}function h(){}var j="swipe",l="swiping",o=50;a.extend(h,b,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!=b.type.indexOf("mouse")&&b.preventDefault()},onTouchMove:function(b){var a=b.changedTouches[0],c=a.pageY-this.startY,a=Math.abs(a.pageX-
this.startX),c=Math.abs(c);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);return f(this,b,1)},onTouchEnd:function(b){return!1===this.onTouchMove(b)?!1:f(this,b,0)}});c[j]=c[l]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(a,c,e,b){function f(){}a.extend(f,b,{onTouchStart:function(b){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=b.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(b){var a=this.lastEndTime,c=b.timeStamp,f=b.target,g=b.changedTouches[0],i=c-this.startTime;this.lastEndTime=c;if(a&&(i=c-a,300>i)){this.lastEndTime=0;e.fire(f,"doubleTap",
{touch:g,duration:i/1E3});return}i=c-this.startTime;300<i?e.fire(f,"singleTap",{touch:g,pageX:g.pageX,which:1,pageY:g.pageY,duration:i/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(f,"singleTap",{touch:g,pageX:g.pageX,which:1,pageY:g.pageY,duration:i/1E3})},300)}});c.singleTap=c.doubleTap={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(a,c){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,c=b.touches.length;c===a?this.start():c>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:a.noop,getCommonTarget:function(b){var a=b.touches,b=a[0].target,a=a[1].target;if(b==a||c.contains(b,a))return b;for(;;){if(c.contains(a,b))return a;a=a.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(a,c,e,b){function f(){}function h(a){2==a.touches.length&&a.preventDefault()}a.extend(f,b,{onTouchMove:function(b){if(this.isTracking){var c=b.touches,f,g=c[0],i=c[1];f=g.pageX-i.pageX;g=g.pageY-i.pageY;f=Math.sqrt(f*f+g*g);this.lastTouches=c;this.isStarted?e.fire(this.target,"pinch",a.mix(b,{distance:f,scale:f/this.startDistance})):(this.isStarted=!0,this.startDistance=f,c=this.target=this.getCommonTarget(b),e.fire(c,"pinchStart",a.mix(b,{distance:f,scale:1})))}},
fireEnd:function(b){e.fire(this.target,"pinchEnd",a.mix(b,{touches:this.lastTouches}))}});b=new f;c.pinchStart=c.pinchEnd={handle:b};c.pinch={handle:b,add:function(){e.on(this,"touchmove",h)},remove:function(){e.detach(this,"touchmove",h)}};return f},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(a,c,e,b){function f(){}function h(a){1==a.touches.length&&a.preventDefault()}a.extend(f,e,{onTouchStart:function(c){if(!1===f.superclass.onTouchStart.call(this,c))return!1;this.timer=setTimeout(function(){var f=c.touches[0];b.fire(c.target,"tapHold",{touch:f,pageX:f.pageX,pageY:f.pageY,which:1,duration:(a.now()-c.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold=
{setup:function(){b.on(this,"touchstart",h)},tearDown:function(){b.detach(this,"touchstart",h)},handle:new f};return f},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(a,c,e,b,f){function h(){}function j(a){2==a.touches.length&&a.preventDefault()}var l=180/Math.PI;a.extend(h,e,{onTouchMove:function(c){if(this.isTracking){var g=c.touches,e=g[0],h=g[1],d=this.lastAngle,e=Math.atan2(h.pageY-e.pageY,h.pageX-e.pageX)*l;if(d!==f){var h=Math.abs(e-d),m=(e+360)%360,k=(e-360)%360;Math.abs(m-d)<h?e=m:Math.abs(k-d)<h&&(e=k)}this.lastTouches=g;this.lastAngle=e;this.isStarted?b.fire(this.target,"rotate",a.mix(c,{angle:e,rotation:e-
this.startAngle})):(this.isStarted=!0,this.startAngle=e,this.target=this.getCommonTarget(c),b.fire(this.target,"rotateStart",a.mix(c,{angle:e,rotation:0})))}},end:function(){this.lastAngle=f;h.superclass.end.apply(this,arguments)},fireEnd:function(c){b.fire(this.target,"rotateEnd",a.mix(c,{touches:this.lastTouches}))}});e=new h;c.rotateEnd=c.rotateStart={handle:e};c.rotate={handle:e,add:function(){b.on(this,"touchmove",j)},remove:function(){b.detach(this,"touchmove",j)}};return h},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(a,c,e,b){function f(d){return a.startsWith(d,"touch")}function h(d){return a.startsWith(d,"mouse")}function j(d){this.doc=d;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var l=a.guid("touch-handle"),o=a.Features,g,i,n;o.isTouchEventSupported()?(n="touchend touchcancel mouseup",g="touchstart mousedown",i="touchmove mousemove",a.UA.ios&&(n="touchend touchcancel",g="touchstart",i="touchmove")):o.isMsPointerSupported()?(g="MSPointerDown",i=
"MSPointerMove",n="MSPointerUp MSPointerCancel"):(g="mousedown",i="mousemove",n="mouseup");j.prototype={constructor:j,lastTouches:[],firstTouch:null,init:function(){var d=this.doc;b.on(d,g,this.onTouchStart,this);b.on(d,i,this.onTouchMove,this);b.on(d,n,this.onTouchEnd,this)},addTouch:function(d){d.identifier=d.pointerId;this.touches.push(d)},removeTouch:function(d){for(var a=0,b=d.pointerId,c=this.touches,e=c.length;a<e;a++){d=c[a];if(d.pointerId===b){c.splice(a,1);break}}},updateTouch:function(d){for(var a=
0,b,c=d.pointerId,e=this.touches,f=e.length;a<f;a++){b=e[a];b.pointerId===c&&(e[a]=d)}},isPrimaryTouch:function(d){return this.firstTouch===d.identifier},setPrimaryTouch:function(d){if(this.firstTouch===null)this.firstTouch=d.identifier},removePrimaryTouch:function(d){if(this.isPrimaryTouch(d))this.firstTouch=null},dupMouse:function(d){var a=this.lastTouches,d=d.changedTouches[0];if(this.isPrimaryTouch(d)){d={x:d.clientX,y:d.clientY};a.push(d);a=function(d,a){var b=d.indexOf(a);b>-1&&d.splice(b,1)}.bind(null,
a,d);setTimeout(a,2500)}},isEventSimulatedFromTouch:function(d){for(var a=this.lastTouches,b=d.clientX,d=d.clientY,c=0,e=a.length,f;c<e&&(f=a[c]);c++){var g=Math.abs(b-f.x),h=Math.abs(d-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(d){var a=d.type,b;if(f(a)){b=a=="touchend"||a=="touchcancel"?d.changedTouches:d.touches;if(b.length==1){d.which=1;d.pageX=b[0].pageX;d.pageY=b[0].pageY}return d}b=this.touches;a=!a.match(/(up|cancel)$/i);d.touches=a?b:[];d.targetTouches=a?b:[];d.changedTouches=
b;return d},onTouchStart:function(d){var b,c;c=d.type;var e=this.eventHandle;if(f(c)){this.setPrimaryTouch(d.changedTouches[0]);this.dupMouse(c)}else if(h(c)){if(this.isEventSimulatedFromTouch(d))return;this.touches=[d.originalEvent]}else if(a.startsWith(c,"MSPointer"))this.addTouch(d.originalEvent);else throw Error("unrecognized touch event: "+d.type);for(b in e){c=e[b].handle;c.isActive=1}this.callEventHandle("onTouchStart",d)},onTouchMove:function(d){var b=d.type;if(!f(b))if(h(b)){if(this.isEventSimulatedFromTouch(b))return;
this.touches=[d.originalEvent]}else if(a.startsWith(b,"MSPointer"))this.updateTouch(d.originalEvent);else throw Error("unrecognized touch event: "+d.type);this.callEventHandle("onTouchMove",d)},onTouchEnd:function(d){var b=this,c=d.type;if(!h(c)||!b.isEventSimulatedFromTouch(d)){b.callEventHandle("onTouchEnd",d);if(f(c)){b.dupMouse(d);a.makeArray(d.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else h(c)?b.touches=[]:a.startsWith(c,"MSPointer")&&b.removeTouch(d.originalEvent)}},callEventHandle:function(a,
b){var c=this.eventHandle,e,f,b=this.normalize(b);for(e in c){f=c[e].handle;if(!f.processed){f.processed=1;if(f.isActive&&f[a]&&f[a](b)===false)f.isActive=0}}for(e in c){f=c[e].handle;f.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=e[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;b.detach(a,g,this.onTouchStart,this);b.detach(a,i,this.onTouchMove,
this);b.detach(a,n,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var e=c.getDocument(a),f=c.data(e,l);f||c.data(e,l,f=new j(e));b&&f.addEventHandle(b)},removeDocumentHandle:function(b,e){var f=c.getDocument(b),g=c.data(f,l);if(g){e&&g.removeEventHandle(e);if(a.isEmptyObject(g.eventHandle)){g.destroy();c.removeData(f,l)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(a,c,e,b){function f(a){j.call(this,a);e[a].setup.apply(this,arguments)}function h(a){l.call(this,a);e[a].tearDown.apply(this,arguments)}function j(a){var c=this.style;o&&c&&(this.__ks_touch_action||(this.__ks_touch_action=c.msTouchAction,this.__ks_user_select=c.msUserSelect,c.msTouchAction=c.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);b.addDocumentHandle(this,a)}function l(a){var c=this.style;
o&&c&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(c.msUserSelect=this.__ks_user_select,c.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));b.removeDocumentHandle(this,a)}var o=a.Features.isMsPointerSupported(),a=c.Gesture,g=a.start="KSPointerDown",i=a.move="KSPointerMove",n=a.end="KSPointerUp";a.tap="tap";a.doubleTap="doubleTap";e[g]={handle:{isActive:1,onTouchStart:function(a){c.fire(a.target,g,a)}}};e[i]={setup:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count=
a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var b=a.target;(b.ownerDocument||b).__ks__pointer_events_count&&c.fire(b,i,a)}}};e[n]={handle:{isActive:1,onTouchEnd:function(a){c.fire(a.target,n,a)}}};var a=c.Special,d,m,k;for(m in e)d={},k=e[m],d.setup=k.setup?f:j,d.tearDown=k.tearDown?h:l,k.add&&(d.add=k.add),k.remove&&(d.remove=
k.remove),a[m]=d},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
