/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 18 14:39
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(f){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(f){if(f.touches.length!==this.requiredTouchCount)return!1;f=this.lastTouches=f.touches;this.lastXY={pageX:f[0].pageX,pageY:f[0].pageY}},onTouchMove:f.noop,onTouchEnd:f.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(f,a){function k(e){e.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var b=a("./handle-map"),l=a("event/dom/base"),i=a("./single-touch"),m=l.Object;f.extend(h,i,{onTouchStart:function(e){var c=this;if(!1===h.superclass.onTouchStart.call(c,e))return!1;c.tapHoldTimer&&clearTimeout(c.tapHoldTimer);c.tapHoldTimer=setTimeout(function(){var g=f.mix({touch:e.touches[0],which:1,TAP_HOLD_DELAY:(f.now()-
e.timeStamp)/1E3},c.lastXY);c.tapHoldTimer=0;c.lastXY=0;l.fire(e.target,"tapHold",g)},1E3);c.startTime=e.timeStamp;c.singleTapTimer&&(clearTimeout(c.singleTapTimer),c.singleTapTimer=0)},onTouchMove:function(e){var c;if(!(c=this.lastXY))return!1;e=e.changedTouches[0];if(!e||5<Math.abs(e.pageX-c.pageX)||5<Math.abs(e.pageY-c.pageY))return!1},onTouchEnd:function(e){var c;if(c=this.lastXY){var g=e.target,b=e.changedTouches[0];this.tapHoldTimer&&(clearTimeout(this.tapHoldTimer),this.tapHoldTimer=0);var a=
new m(e.originalEvent);f.mix(a,{type:"tap",which:1,pageX:c.pageX,pageY:c.pageY,target:g,currentTarget:g});a.touch=b;l.fire(g,"tap",a);if(a.isDefaultPrevented()&&f.UA.mobile)if(f.UA.ios)e.preventDefault();else l.on(g.ownerDocument||g,"click",{fn:k,once:1});var a=this.lastEndTime,e=e.timeStamp,j;this.lastEndTime=e;if(a&&(j=e-a,300>j)){this.lastEndTime=0;l.fire(g,"doubleTap",{touch:b,pageX:c.pageX,pageY:c.pageY,which:1,duration:j/1E3});return}j=e-this.startTime;300<j?l.fire(g,"singleTap",{touch:b,pageX:c.pageX,
pageY:c.pageY,which:1,duration:j/1E3}):this.singleTapTimer=setTimeout(function(){l.fire(g,"singleTap",{touch:b,pageX:c.pageX,pageY:c.pageY,which:1,duration:j/1E3})},300)}}});b.tap=b.doubleTap=b.singleTap=b.tapHold={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(f,a){function k(g,b,f){var a=b.changedTouches[0],d=a.pageX-g.startX,p=a.pageY-g.startY,q=Math.abs(d),r=Math.abs(p);if(f){if(g.isVertical&&g.isHorizontal){if(5>Math.max(q,r))return;r>q?g.isHorizontal=0:g.isVertical=0}}else if(g.isVertical&&r<c&&(g.isVertical=0),g.isHorizontal&&q<c)g.isHorizontal=0;if(g.isHorizontal)d=0>d?"left":"right";else if(g.isVertical)d=0>p?"up":"down",q=r;else return!1;l.fire(b.target,
f?e:m,{originalEvent:b.originalEvent,pageX:a.pageX,pageY:a.pageY,which:1,touch:a,direction:d,distance:q,duration:(b.timeStamp-g.startTime)/1E3})}function h(){}var b=a("./handle-map"),l=a("event/dom/base"),i=a("./single-touch"),m="swipe",e="swiping",c=50;f.extend(h,i,{onTouchStart:function(g){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var e=g.touches[0];this.startTime=g.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=e.pageX;this.startY=e.pageY;-1!==g.type.toLowerCase().indexOf("mouse")&&
g.preventDefault()},onTouchMove:function(e){var c=e.changedTouches[0],b=c.pageY-this.startY,c=Math.abs(c.pageX-this.startX),b=Math.abs(b);if(1E3<e.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return k(this,e,1)},onTouchEnd:function(e){return!1===this.onTouchMove(e)?!1:k(this,e,0)}});b[m]=b[e]={handle:new h};return h});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(f,a){function k(){}var h=a("dom");k.prototype={constructor:k,requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,f=b.touches.length;f===a?this.start():f>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(b){var a=b.touches,b=a[0].target,a=a[1].target;if(b===a||h.contains(b,a))return b;for(;;){if(h.contains(a,
b))return a;a=a.parentNode}},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return k});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function k(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var b=a("./handle-map"),l=a("event/dom/base"),i=a("./multi-touch");f.extend(k,i,{onTouchMove:function(a){if(this.isTracking){var e=a.touches;if(0<e[0].pageX&&0<e[0].pageY&&0<e[1].pageX&&0<e[1].pageY){var c,g=e[0],b=e[1];c=g.pageX-b.pageX;g=g.pageY-b.pageY;c=Math.sqrt(c*c+g*g);this.lastTouches=e;this.isStarted?l.fire(this.target,
"pinch",f.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,e=this.target=this.getCommonTarget(a),l.fire(e,"pinchStart",f.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){l.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});i=new k;b.pinchStart=b.pinchEnd={handle:i};b=b.pinch={handle:i};f.Feature.isTouchEventSupported()&&(b.setup=function(){this.addEventListener("touchmove",h,!1)},b.tearDown=function(){this.removeEventListener("touchmove",
h,!1)});return k});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function k(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var b=a("./handle-map"),l=a("event/dom/base"),i=a("./multi-touch"),m=180/Math.PI;f.extend(k,i,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],h=c[1],i=this.lastAngle,b=Math.atan2(h.pageY-b.pageY,h.pageX-b.pageX)*m;if(void 0!==i){var h=Math.abs(b-i),j=(b+360)%360,d=(b-360)%360;Math.abs(j-i)<h?b=j:Math.abs(d-
i)<h&&(b=d)}this.lastTouches=c;this.lastAngle=b;this.isStarted?l.fire(this.target,"rotate",f.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),l.fire(this.target,"rotateStart",f.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;k.superclass.end.apply(this,arguments)},fireEnd:function(a){l.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});i=new k;b.rotateEnd=b.rotateStart={handle:i};b=b.rotate=
{handle:i};f.Feature.isTouchEventSupported()&&(b.setup=function(){this.addEventListener("touchmove",h,!1)},b.tearDown=function(){this.removeEventListener("touchmove",h,!1)});return k});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./pinch,./rotate".split(","),function(f,a){function k(d){return f.startsWith(d,"touch")}function h(d){return f.startsWith(d,"mouse")}function b(d){return f.startsWith(d,"MSPointer")||f.startsWith(d,"pointer")}function l(d){this.doc=d;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var i=a("dom"),m=a("./handle-map"),e=a("event/dom/base");a("./tap");a("./swipe");a("./pinch");a("./rotate");var c=f.guid("touch-handle"),
g=f.Feature,o,n,j;if(g.isTouchEventSupported())if(f.UA.ios){j="touchend touchcancel";o="touchstart";n="touchmove"}else{j="touchend touchcancel mouseup";o="touchstart mousedown";n="touchmove mousemove"}else if(g.isPointerSupported()){o="pointerdown";n="pointermove";j="pointerup pointercancel"}else if(g.isMsPointerSupported()){o="MSPointerDown";n="MSPointerMove";j="MSPointerUp MSPointerCancel"}else{o="mousedown";n="mousemove";j="mouseup"}l.prototype={constructor:l,lastTouches:[],firstTouch:null,init:function(){var d=
this.doc;e.on(d,o,this.onTouchStart,this);if(!b(n))e.on(d,n,this.onTouchMove,this);e.on(d,j,this.onTouchEnd,this)},addTouch:function(d){d.identifier=d.pointerId;this.touches.push(d)},removeTouch:function(d){for(var a=0,b=d.pointerId,e=this.touches,c=e.length;a<c;a++){d=e[a];if(d.pointerId===b){e.splice(a,1);break}}},updateTouch:function(d){for(var a=0,b,e=d.pointerId,c=this.touches,f=c.length;a<f;a++){b=c[a];b.pointerId===e&&(c[a]=d)}},isPrimaryTouch:function(d){return this.firstTouch===d.identifier},
setPrimaryTouch:function(d){if(this.firstTouch===null)this.firstTouch=d.identifier},removePrimaryTouch:function(d){if(this.isPrimaryTouch(d))this.firstTouch=null},dupMouse:function(d){var a=this.lastTouches,d=d.changedTouches[0];if(this.isPrimaryTouch(d)){var b={x:d.clientX,y:d.clientY};a.push(b);setTimeout(function(){var d=a.indexOf(b);d>-1&&a.splice(d,1)},2500)}},isEventSimulatedFromTouch:function(d){for(var a=this.lastTouches,b=d.clientX,d=d.clientY,e=0,c=a.length,f;e<c&&(f=a[e]);e++){var g=Math.abs(b-
f.x),h=Math.abs(d-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(d){var a=d.type,b;if(k(a)){b=a==="touchend"||a==="touchcancel"?d.changedTouches:d.touches;if(b.length===1){d.which=1;d.pageX=b[0].pageX;d.pageY=b[0].pageY}return d}b=this.touches;a=!a.match(/(up|cancel)$/i);d.touches=a?b:[];d.targetTouches=a?b:[];d.changedTouches=b;return d},onTouchStart:function(d){var a,c;c=d.type;var f=this.eventHandle;if(k(c)){this.setPrimaryTouch(d.changedTouches[0]);this.dupMouse(d)}else if(h(c)){if(this.isEventSimulatedFromTouch(d))return;
this.touches=[d.originalEvent]}else if(b(c)){this.addTouch(d.originalEvent);if(this.touches.length===1)e.on(this.doc,n,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+d.type);for(a in f){c=f[a].handle;c.isActive=1}this.callEventHandle("onTouchStart",d)},onTouchMove:function(d){var a=d.type;if(h(a)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[d.originalEvent]}else if(b(a))this.updateTouch(d.originalEvent);else if(!k(a))throw Error("unrecognized touch event: "+d.type);
this.callEventHandle("onTouchMove",d)},onTouchEnd:function(a){var c=this,g=a.type;if(!h(g)||!c.isEventSimulatedFromTouch(a)){c.callEventHandle("onTouchEnd",a);if(k(g)){c.dupMouse(a);f.makeArray(a.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else if(h(g))c.touches=[];else if(b(g)){c.removeTouch(a.originalEvent);c.touches.length||e.detach(c.doc,n,c.onTouchMove,c)}}},callEventHandle:function(a,b){var c=this.eventHandle,e,f,b=this.normalize(b);if(b.changedTouches.length){for(e in c){f=
c[e].handle;if(!f.processed){f.processed=1;if(f.isActive&&f[a]&&f[a](b)===false)f.isActive=0}}for(e in c){f=c[e].handle;f.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=m[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;e.detach(a,o,this.onTouchStart,this);e.detach(a,n,this.onTouchMove,this);e.detach(a,j,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,
b){var e=i.getDocument(a),f=i.data(e,c);f||i.data(e,c,f=new l(e));b&&f.addEventHandle(b)},removeDocumentHandle:function(a,b){var e=i.getDocument(a),g=i.data(e,c);if(g){b&&g.removeEventHandle(b);if(f.isEmptyObject(g.eventHandle)){g.destroy();i.removeData(e,c)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(f,a){function k(a){e.addDocumentHandle(this,a);m[a].setup.apply(this,arguments)}function h(a){e.removeDocumentHandle(this,a);m[a].tearDown.apply(this,arguments)}function b(a){e.addDocumentHandle(this,a)}function l(a){e.removeDocumentHandle(this,a)}var i=a("event/dom/base"),m=a("./touch/handle-map"),e=a("./touch/handle"),c=i.Gesture,g=c.start="KSPointerDown",o=c.move="KSPointerMove",n=c.end="KSPointerUp";
c.tap="tap";c.singleTap="singleTap";c.doubleTap="doubleTap";m[g]={handle:{isActive:1,onTouchStart:function(a){i.fire(a.target,g,a)}}};m[o]={handle:{isActive:1,onTouchMove:function(a){i.fire(a.target,o,a)}}};m[n]={handle:{isActive:1,onTouchEnd:function(a){i.fire(a.target,n,a)}}};var c=i.Special,j,d,p;for(d in m)j={},p=m[d],j.setup=p.setup?k:b,j.tearDown=p.tearDown?h:l,p.add&&(j.add=p.add),p.remove&&(j.remove=p.remove),c[d]=j});
