/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 6 11:39
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});
KISSY.add("event/dom/touch/touch",[],function(b){function a(){}b=b.noop;a.prototype={constructor:a,requiredTouchCount:0,onTouchStart:function(h){var b=this.requiredTouchCount,e=h.touches.length;if(e===b)return this.isTracking||(this.isTracking=!0,this.isStarted=!1),this.lastTouches=h.touches,this.startTime=h.timeStamp,this.start(h);if(e>b)this.onTouchEnd(h,!0)},onTouchMove:function(b){if(this.isTracking)return this.lastTouches=b.touches,this.move(b)},onTouchEnd:function(b,a){this.isTracking&&(this.isTracking=
!1,this.isStarted&&(this.isStarted=!1,this.end(b,a)))},start:b,move:b,end:b};return a});KISSY.add("event/dom/touch/single-touch",["./touch"],function(b,a){function h(){}var j=a("./touch");b.extend(h,j,{requiredTouchCount:1,start:function(){h.superclass.start.apply(this,arguments);var b=this.lastTouches;this.lastXY={pageX:b[0].pageX,pageY:b[0].pageY}}});return h});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(b,a){function h(d){d.preventDefault()}function j(d){d.singleTapTimer&&(clearTimeout(d.singleTapTimer),d.singleTapTimer=0);d.tapHoldTimer&&(clearTimeout(d.tapHoldTimer),d.tapHoldTimer=0)}function e(){e.superclass.constructor.apply(this,arguments)}var k=a("./handle-map"),g=a("event/dom/base"),n=a("./single-touch"),m=g.Object;b.extend(e,n,{start:function(d){var f=this;e.superclass.start.call(f,d);j(f);var c=f.lastTouches[0];
f.tapHoldTimer=setTimeout(function(){var l=b.mix({touch:c,which:1,TAP_HOLD_DELAY:(b.now()-d.timeStamp)/1E3},f.lastXY);f.tapHoldTimer=0;f.lastXY=0;g.fire(c.target,"tapHold",l)},1E3);f.isStarted=!0},move:function(){var d;if(!(d=this.lastXY))return!1;var f=this.lastTouches[0];if(!f||5<Math.abs(f.pageX-d.pageX)||5<Math.abs(f.pageY-d.pageY))return j(this),!1},end:function(d,f){var c;j(this);if(!f&&(c=this.lastXY)){var l=this.lastTouches[0],a=l.target,i=new m(d.originalEvent);b.mix(i,{type:"tap",which:1,
pageX:c.pageX,pageY:c.pageY,target:a,currentTarget:a});i.touch=l;g.fire(a,"tap",i);if(i.isDefaultPrevented()&&b.UA.mobile)if(b.UA.ios)d.preventDefault();else g.on(a.ownerDocument||a,"click",{fn:h,once:1});var i=this.lastEndTime,p=d.timeStamp,q;this.lastEndTime=p;if(i&&(q=p-i,300>q)){this.lastEndTime=0;g.fire(a,"doubleTap",{touch:l,pageX:c.pageX,pageY:c.pageY,which:1,duration:q/1E3});return}q=p-this.startTime;300<q?g.fire(a,"singleTap",{touch:l,pageX:c.pageX,pageY:c.pageY,which:1,duration:q/1E3}):
this.singleTapTimer=setTimeout(function(){g.fire(a,"singleTap",{touch:l,pageX:c.pageX,pageY:c.pageY,which:1,duration:q/1E3})},300)}}});k.tap=k.doubleTap=k.singleTap=k.tapHold={handle:new e};return e});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(b,a){function h(f,c,b){var a=f.lastTouches[0],i=a.pageX-f.startX,p=a.pageY-f.startY,q=Math.abs(i),g=Math.abs(p);if(b){if(f.isVertical&&f.isHorizontal){if(5>Math.max(q,g))return;g>q?f.isHorizontal=0:f.isVertical=0}}else if(f.isVertical&&g<d&&(f.isVertical=0),f.isHorizontal&&q<d)f.isHorizontal=0;if(f.isHorizontal)i=0>i?"left":"right";else if(f.isVertical)i=0>p?"up":"down",q=g;else return!1;k.fire(a.target,
b?m:n,{originalEvent:c.originalEvent,pageX:a.pageX,pageY:a.pageY,which:1,touch:a,direction:i,distance:q,duration:(c.timeStamp-f.startTime)/1E3})}function j(){}var e=a("./handle-map"),k=a("event/dom/base"),g=a("./single-touch"),n="swipe",m="swiping",d=50;b.extend(j,g,{start:function(d){if(!d.isTouch)return!1;j.superclass.start.apply(this,arguments);this.isStarted=!0;var c=this.lastTouches[0];this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY},move:function(d){var c=d.timeStamp;
j.superclass.move.apply(this,arguments);if(1E3<c-this.startTime)return!1;var a=this.lastTouches[0],c=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),c=Math.abs(c);this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);return h(this,d,1)},end:function(d){return!1===this.move(d)?!1:h(this,d,0)}});e[n]=e[m]={handle:new j};return j});
KISSY.add("event/dom/touch/double-touch",["dom","./touch"],function(b,a){function h(){}var j=a("dom"),e=a("./touch");b.extend(h,e,{requiredTouchCount:2,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a===b||j.contains(a,b))return a;for(;;){if(j.contains(b,a))return b;b=b.parentNode}}});return h});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./double-touch"],function(b,a){function h(){}function j(a){2===a.targetTouches.length&&a.preventDefault()}var e=a("./handle-map"),k=a("event/dom/base"),g=a("./double-touch");b.extend(h,g,{move:function(a){h.superclass.move.apply(this,arguments);var e=this.lastTouches;if(0<e[0].pageX&&0<e[0].pageY&&0<e[1].pageX&&0<e[1].pageY){var d;d=e[0];var f=e[1],e=d.pageX-f.pageX;d=d.pageY-f.pageY;d=Math.sqrt(e*e+d*d);this.isStarted?k.fire(this.target,
"pinch",b.mix(a,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,e=this.target=this.getCommonTarget(a),k.fire(e,"pinchStart",b.mix(a,{distance:d,scale:1})))}},end:function(a){h.superclass.end.apply(this,arguments);k.fire(this.target,"pinchEnd",b.mix(a,{touches:this.lastTouches}))}});g=new h;e.pinchStart=e.pinchEnd={handle:g};e=e.pinch={handle:g};b.Feature.isTouchEventSupported()&&(e.setup=function(){this.addEventListener("touchmove",j,!1)},e.tearDown=function(){this.removeEventListener("touchmove",
j,!1)});return h});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./double-touch"],function(b,a){function h(){}function j(a){2===a.targetTouches.length&&a.preventDefault()}var e=a("./handle-map"),k=a("event/dom/base"),g=a("./double-touch"),n=180/Math.PI;b.extend(h,g,{move:function(a){h.superclass.move.apply(this,arguments);var d=this.lastTouches,f=d[0],c=d[1],d=this.lastAngle,f=Math.atan2(c.pageY-f.pageY,c.pageX-f.pageX)*n;if(void 0!==d){var c=Math.abs(f-d),e=(f+360)%360,g=(f-360)%360;Math.abs(e-
d)<c?f=e:Math.abs(g-d)<c&&(f=g)}this.lastAngle=f;this.isStarted?k.fire(this.target,"rotate",b.mix(a,{angle:f,rotation:f-this.startAngle})):(this.isStarted=!0,this.startAngle=f,this.target=this.getCommonTarget(a),k.fire(this.target,"rotateStart",b.mix(a,{angle:f,rotation:0})))},end:function(a){h.superclass.end.apply(this,arguments);this.lastAngle=void 0;k.fire(this.target,"rotateEnd",b.mix(a,{touches:this.lastTouches}))}});g=new h;e.rotateEnd=e.rotateStart={handle:g};e=e.rotate={handle:g};b.Feature.isTouchEventSupported()&&
(e.setup=function(){this.addEventListener("touchmove",j,!1)},e.tearDown=function(){this.removeEventListener("touchmove",j,!1)});return h});
KISSY.add("event/dom/touch/drag",["./handle-map","event/dom/base","./single-touch"],function(b,a){function h(a,b){var c=a.lastTouches[0],e=b.timeStamp;e-a.lastTime>m&&(a.lastPos={pageX:c.pageX,pageY:c.pageY},a.lastTime=e)}function j(a,b,c){var e=a.startPos,c=c||{},g=a.lastTouches[0];c.pageX=g.pageX;c.pageY=g.pageY;c.originalEvent=b.originalEvent;c.deltaX=g.pageX-e.pageX;c.deltaY=g.pageY-e.pageY;c.startTime=a.startTime;c.startPos=a.startPos;c.isTouch=b.isTouch;c.touch=g;return c}function e(){}var k=
a("./handle-map"),g=a("event/dom/base"),n=a("./single-touch"),m=300;b.extend(e,n,{start:function(){e.superclass.start.apply(this,arguments);var a=this.lastTouches[0];this.lastTime=this.startTime;this.startPos=this.lastPos={pageX:a.pageX,pageY:a.pageY}},move:function(a){e.superclass.move.apply(this,arguments);if(this.isStarted)h(this,a),g.fire(this.lastTouches[0].target,"drag",j(this,a));else{var b=a,c=this.lastTouches[0],l=this.startPos,k=c.pageX-l.pageX,l=c.pageY-l.pageY;3<Math.sqrt(k*k+l*l)&&(this.isStarted=
!0,h(this,b),g.fire(c.target,"dragStart",j(this,b)))}},end:function(a){var b=this.lastTouches[0],c=a.timeStamp;g.fire(b.target,"dragEnd",j(this,a,{velocityX:(b.pageX-this.lastPos.pageX)/(c-this.lastTime),velocityY:(b.pageY-this.lastPos.pageY)/(c-this.lastTime)}))}});k.dragStart=k.drag=k.dragEnd={handle:new e};return e});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./pinch,./rotate,./drag".split(","),function(b,a){function h(i){return b.startsWith(i,"touch")}function j(i){return b.startsWith(i,"mouse")}function e(i){return b.startsWith(i,"MSPointer")||b.startsWith(i,"pointer")}function k(i){this.doc=i;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var g=a("dom"),n=a("./handle-map"),m=a("event/dom/base");a("./tap");a("./swipe");a("./pinch");a("./rotate");a("./drag");
var d=b.guid("touch-handle"),f=b.Feature,c,l,o;if(f.isTouchEventSupported())if(b.UA.ios){o="touchend touchcancel";c="touchstart";l="touchmove"}else{o="touchend touchcancel mouseup";c="touchstart mousedown";l="touchmove mousemove"}else if(f.isPointerSupported()){c="pointerdown";l="pointermove";o="pointerup pointercancel"}else if(f.isMsPointerSupported()){c="MSPointerDown";l="MSPointerMove";o="MSPointerUp MSPointerCancel"}else{c="mousedown";l="mousemove";o="mouseup"}k.prototype={constructor:k,lastTouches:[],
firstTouch:null,init:function(){var i=this.doc;m.on(i,c,this.onTouchStart,this);if(!e(l))m.on(i,l,this.onTouchMove,this);m.on(i,o,this.onTouchEnd,this)},addTouch:function(i){i.identifier=i.pointerId;this.touches.push(i)},removeTouch:function(i){for(var a=0,b=i.pointerId,d=this.touches,c=d.length;a<c;a++){i=d[a];if(i.pointerId===b){d.splice(a,1);break}}},updateTouch:function(i){for(var a=0,b,d=i.pointerId,c=this.touches,e=c.length;a<e;a++){b=c[a];b.pointerId===d&&(c[a]=i)}},isPrimaryTouch:function(a){return this.firstTouch===
a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var d={x:a.clientX,y:a.clientY};b.push(d);setTimeout(function(){var a=b.indexOf(d);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,d=a.clientX,a=a.clientY,c=0,e=b.length,f;c<e&&(f=b[c]);c++){var g=
Math.abs(d-f.x),h=Math.abs(a-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,d,c;if(d=h(b)){c=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;a.isTouch=1}else{if(e(b)&&a.originalEvent.pointerType==="touch")a.isTouch=1;c=this.touches}if(c&&c.length===1){a.which=1;a.pageX=c[0].pageX;a.pageY=c[0].pageY}if(d)return a;b=!b.match(/(up|cancel)$/i);a.touches=b?c:[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchStart:function(a){var b,c;c=a.type;var d=
this.eventHandle;if(h(c)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(j(c)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(e(c)){this.addTouch(a.originalEvent);if(this.touches.length===1)m.on(this.doc,l,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in d){c=d[b].handle;c.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(j(b)){if(this.isEventSimulatedFromTouch(b))return;
this.touches=[a.originalEvent]}else if(e(b))this.updateTouch(a.originalEvent);else if(!h(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var c=this,d=a.type;if(!j(d)||!c.isEventSimulatedFromTouch(a)){c.callEventHandle("onTouchEnd",a);if(h(d)){c.dupMouse(a);b.makeArray(a.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else if(j(d))c.touches=[];else if(e(d)){c.removeTouch(a.originalEvent);c.touches.length||m.detach(c.doc,
l,c.onTouchMove,c)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=n[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=
this.doc;m.detach(a,c,this.onTouchStart,this);m.detach(a,l,this.onTouchMove,this);m.detach(a,o,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=g.getDocument(a),e=g.data(c,d);e||g.data(c,d,e=new k(c));b&&e.addEventHandle(b)},removeDocumentHandle:function(a,c){var e=g.getDocument(a),f=g.data(e,d);if(f){c&&f.removeEventHandle(c);if(b.isEmptyObject(f.eventHandle)){f.destroy();g.removeData(e,d)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(b,a){function h(a){m.addDocumentHandle(this,a);n[a].setup.apply(this,arguments)}function j(a){m.removeDocumentHandle(this,a);n[a].tearDown.apply(this,arguments)}function e(a){m.addDocumentHandle(this,a)}function k(a){m.removeDocumentHandle(this,a)}var g=a("event/dom/base"),n=a("./touch/handle-map"),m=a("./touch/handle"),d=g.Gesture,f=d.start="KSPointerDown",c=d.move="KSPointerMove",l=d.end="KSPointerUp";
d.tap="tap";d.singleTap="singleTap";d.doubleTap="doubleTap";n[f]={handle:{isActive:1,onTouchStart:function(a){g.fire(a.target,f,a)}}};n[c]={handle:{isActive:1,onTouchMove:function(a){g.fire(a.target,c,a)}}};n[l]={handle:{isActive:1,onTouchEnd:function(a){g.fire(a.target,l,a)}}};var d=g.Special,o,i,p;for(i in n)o={},p=n[i],o.setup=p.setup?h:e,o.tearDown=p.tearDown?j:k,p.add&&(o.add=p.add),p.remove&&(o.remove=p.remove),d[i]=o});
