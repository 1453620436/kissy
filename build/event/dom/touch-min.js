/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Aug 29 19:58
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(a){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=a.touches},onTouchMove:a.noop,onTouchEnd:a.noop};return b});
KISSY.add("event/dom/touch/tap",function(a,b,f,e){function c(a){a.preventDefault()}function g(){g.superclass.constructor.apply(this,arguments)}var j=f.Object;a.extend(g,e,{onTouchMove:function(){return!1},onTouchEnd:function(e){var i=e.changedTouches[0],e=e.target,d=new j({type:"tap",target:e,currentTarget:e});a.mix(d,{pageX:i.pageX,pageY:i.pageY,which:1,touch:i});f.fire(e,"tap",d);if(d.isDefaultPrevented())f.on(e,"click",{fn:c,once:1})}});b.tap={handle:new g};return g},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(a,b,f,e){function c(d,a,e){var h=a.changedTouches[0],m=h.pageX-d.startX,l=h.pageY-d.startY,p=Math.abs(m),c=Math.abs(l);if(e)d.isVertical&&d.isHorizontal&&(c>p?d.isHorizontal=0:d.isVertical=0);else if(d.isVertical&&c<i&&(d.isVertical=0),d.isHorizontal&&p<i)d.isHorizontal=0;if(d.isHorizontal)m=0>m?"left":"right";else if(d.isVertical)m=0>l?"up":"down",p=c;else return!1;f.fire(a.target,e?k:j,{originalEvent:a.originalEvent,pageX:h.pageX,pageY:h.pageY,which:1,
touch:h,direction:m,distance:p,duration:(a.timeStamp-d.startTime)/1E3})}function g(){}var j="swipe",k="swiping",i=50;a.extend(g,e,{onTouchStart:function(d){if(!1===g.superclass.onTouchStart.apply(this,arguments))return!1;var a=d.touches[0];this.startTime=d.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!=d.type.indexOf("mouse")&&d.preventDefault()},onTouchMove:function(d){var a=d.changedTouches[0],e=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),e=Math.abs(e);
if(1E3<d.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<e&&(this.isHorizontal=0);return c(this,d,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});b[j]=b[k]={handle:new g};return g},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(a,b,f,e){function c(){}a.extend(c,e,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var e=this.lastEndTime,c=a.timeStamp,i=a.target,d=a.changedTouches[0],b=c-this.startTime;this.lastEndTime=c;if(e&&(b=c-e,300>b)){this.lastEndTime=0;f.fire(i,"doubleTap",
{touch:d,duration:b/1E3});return}b=c-this.startTime;300<b?f.fire(i,"singleTap",{touch:d,pageX:d.pageX,which:1,pageY:d.pageY,duration:b/1E3}):this.singleTapTimer=setTimeout(function(){f.fire(i,"singleTap",{touch:d,pageX:d.pageX,which:1,pageY:d.pageY,duration:b/1E3})},300)}});b.singleTap=b.doubleTap={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(a,b){function f(){}f.prototype={constructor:f,requiredTouchCount:2,onTouchStart:function(a){var c=this.requiredTouchCount,b=a.touches.length;b===c?this.start():b>c&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:a.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a==c||b.contains(a,c))return a;for(;;){if(b.contains(c,a))return c;c=c.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return f},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(a,b,f,e){function c(){}function g(a){2==a.touches.length&&a.preventDefault()}a.extend(c,e,{onTouchMove:function(c){if(this.isTracking){var b=c.touches,e,d=b[0],g=b[1];e=d.pageX-g.pageX;d=d.pageY-g.pageY;e=Math.sqrt(e*e+d*d);this.lastTouches=b;this.isStarted?f.fire(this.target,"pinch",a.mix(c,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,b=this.target=this.getCommonTarget(c),f.fire(b,"pinchStart",a.mix(c,{distance:e,scale:1})))}},
fireEnd:function(b){f.fire(this.target,"pinchEnd",a.mix(b,{touches:this.lastTouches}))}});e=new c;b.pinchStart=b.pinchEnd={handle:e};b.pinch={handle:e,add:function(){f.on(this,"touchmove",g)},remove:function(){f.detach(this,"touchmove",g)}};return c},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(a,b,f,e){function c(){}function g(a){1==a.touches.length&&a.preventDefault()}a.extend(c,f,{onTouchStart:function(b){if(!1===c.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var c=b.touches[0];e.fire(b.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(a.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){e.on(this,"touchstart",g)},tearDown:function(){e.detach(this,"touchstart",g)},handle:new c};return c},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(a,b,f,e,c){function g(){}function j(a){2==a.touches.length&&a.preventDefault()}var k=180/Math.PI;a.extend(g,f,{onTouchMove:function(b){if(this.isTracking){var d=b.touches,f=d[0],g=d[1],h=this.lastAngle,f=Math.atan2(g.pageY-f.pageY,g.pageX-f.pageX)*k;if(h!==c){var g=Math.abs(f-h),m=(f+360)%360,l=(f-360)%360;Math.abs(m-h)<g?f=m:Math.abs(l-h)<g&&(f=l)}this.lastTouches=d;this.lastAngle=f;this.isStarted?e.fire(this.target,"rotate",a.mix(b,{angle:f,rotation:f-
this.startAngle})):(this.isStarted=!0,this.startAngle=f,this.target=this.getCommonTarget(b),e.fire(this.target,"rotateStart",a.mix(b,{angle:f,rotation:0})))}},end:function(){this.lastAngle=c;g.superclass.end.apply(this,arguments)},fireEnd:function(b){e.fire(this.target,"rotateEnd",a.mix(b,{touches:this.lastTouches}))}});f=new g;b.rotateEnd=b.rotateStart={handle:f};b.rotate={handle:f,add:function(){e.on(this,"touchmove",j)},remove:function(){e.detach(this,"touchmove",j)}};return g},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(a,b,f,e){function c(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var g=a.guid("touch-handle"),j=a.Features,k=a.UA,i=j.isMsPointerSupported(),d={},n,o;j.isTouchEventSupported()?(j="touchend",o="touchcancel",k.chrome&&!k.android?(k="touchstart mousedown",n="touchmove mousemove"):(k="touchstart",n="touchmove")):i?(k="MSPointerDown",n="MSPointerMove",j="MSPointerUp",o="MSPointerCancel"):(k="mousedown",n="mousemove",j="mouseup");
d[k]="onTouchStart";d[n]="onTouchMove";d[j]="onTouchEnd";o&&(d[o]="onTouchEnd");c.prototype={constructor:c,addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(h){var b=this.touches;a.each(b,function(a,c){if(a.pointerId==h.pointerId){b.splice(c,1);return false}})},updateTouch:function(h){var b=this.touches;a.each(b,function(a,c){if(a.pointerId==h.pointerId){b[c]=h;return false}})},init:function(){var a=this.doc,b,c;for(b in d){c=d[b];e.on(a,b,this[c],this)}},normalize:function(b){var c=
b.type,d;if(a.startsWith(c,"touch")){d=c=="touchend"||c=="touchcancel"?b.changedTouches:b.touches;if(d.length==1){b.which=1;b.pageX=d[0].pageX;b.pageY=d[0].pageY}return b}d=this.touches;c=!c.match(/(up|cancel)$/i);b.touches=c?d:[];b.targetTouches=c?d:[];b.changedTouches=d;return b},onTouchStart:function(b){var c,d,f=this.eventHandle;if("touches"in b)this.inTouch=b.touches.length;else{if(this.inTouch)return;if(!i)e.on(this.doc,"mouseup",{fn:this.onTouchEnd,context:this,once:true})}for(c in f){d=f[c].handle;
d.isActive=1}"touches"in b?this.touches=a.makeArray(b.touches):i?this.addTouch(b.originalEvent):this.touches=[b.originalEvent];this.callEventHandle("onTouchStart",b)},onTouchMove:function(a){if(!("touches"in a)){if(this.inTouch)return;i?this.updateTouch(a.originalEvent):this.touches=[a.originalEvent]}this.callEventHandle("onTouchMove",a)},onTouchEnd:function(b){var c="touches"in b;this.callEventHandle("onTouchEnd",b);if(c){this.touches=a.makeArray(b.touches);this.inTouch=this.touches.length}else i?
this.removeTouch(b.originalEvent):this.touches=[]},callEventHandle:function(a,b){var c=this.eventHandle,d,e;if(b=this.normalize(b)){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=f[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=
this.doc,b,c;for(b in d){c=d[b];e.detach(a,b,this[c],this)}}};return{addDocumentHandle:function(a,d){var e=b.getDocument(a),f=b.data(e,g);f||b.data(e,g,f=new c(e));d&&f.addEventHandle(d)},removeDocumentHandle:function(c,d){var e=b.getDocument(c),f=b.data(e,g);if(f){d&&f.removeEventHandle(d);if(a.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,g)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(a,b,f,e){function c(a){g.call(this,a);f[a].setup.apply(this,arguments)}function g(a){var b=this.style;i&&b&&(this.__ks_touch_action||(this.__ks_touch_action=b.msTouchAction,this.__ks_user_select=b.msUserSelect,b.msTouchAction=b.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);e.addDocumentHandle(this,a)}function j(a){k.call(this,a);f[a].tearDown.apply(this,arguments)}function k(a){var b=this.style;
i&&b&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(b.msUserSelect=this.__ks_user_select,b.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));e.removeDocumentHandle(this,a)}var i=a.Features.isMsPointerSupported(),a=b.Gesture,d=a.start="KSPointerDown",n=a.move="KSPointerMove",o=a.end="KSPointerUp";a.tap="tap";a.doubleTap="doubleTap";f[d]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,d,a)}}};f[n]={handle:{isActive:1,onTouchMove:function(a){b.fire(a.target,
n,a)}}};f[o]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,o,a)}}};var a=b.Special,h,m,l;for(m in f)h={},l=f[m],h.setup=l.setup?c:g,h.tearDown=l.tearDown?j:k,l.add&&(h.add=l.add),l.remove&&(h.remove=l.remove),a[m]=h},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
