/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Oct 25 11:43
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(c){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:c.noop,onTouchEnd:c.noop};return b});
KISSY.add("event/dom/touch/tap",function(c,b,d,a){function e(c){c.preventDefault()}function f(){f.superclass.constructor.apply(this,arguments)}var l=d.Object;c.extend(f,a,{onTouchMove:function(c){var a=this.lastTouches[0],c=c.changedTouches[0];if(5<Math.abs(c.pageX-a.pageX)||5<Math.abs(c.pageY-a.pageY))return!1},onTouchEnd:function(a){var b=a.changedTouches[0],a=a.target,h=new l({type:"tap",target:a,currentTarget:a});c.mix(h,{pageX:b.pageX,pageY:b.pageY,which:1,touch:b});d.fire(a,"tap",h);if(h.isDefaultPrevented())d.on(a,
"click",{fn:e,once:1})}});b.tap={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(c,b,d,a){function e(a,c,b){var g=c.changedTouches[0],k=g.pageX-a.startX,m=g.pageY-a.startY,e=Math.abs(k),f=Math.abs(m);if(b){if(a.isVertical&&a.isHorizontal){if(5>Math.max(e,f))return;f>e?a.isHorizontal=0:a.isVertical=0}}else if(a.isVertical&&f<o&&(a.isVertical=0),a.isHorizontal&&e<o)a.isHorizontal=0;if(a.isHorizontal)k=0>k?"left":"right";else if(a.isVertical)k=0>m?"up":"down",e=f;else return!1;d.fire(c.target,b?n:l,{originalEvent:c.originalEvent,pageX:g.pageX,
pageY:g.pageY,which:1,touch:g,direction:k,distance:e,duration:(c.timeStamp-a.startTime)/1E3})}function f(){}var l="swipe",n="swiping",o=50;c.extend(f,a,{onTouchStart:function(a){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;var c=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var c=a.changedTouches[0],b=c.pageY-this.startY,c=Math.abs(c.pageX-
this.startX),b=Math.abs(b);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return e(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:e(this,a,0)}});b[l]=b[n]={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(c,b,d,a){function e(){}c.extend(e,a,{onTouchStart:function(a){if(!1===e.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,e=a.target,h=a.changedTouches[0],i=b-this.startTime;this.lastEndTime=b;if(c&&(i=b-c,300>i)){this.lastEndTime=0;d.fire(e,"doubleTap",
{touch:h,duration:i/1E3});return}i=b-this.startTime;300<i?d.fire(e,"singleTap",{touch:h,pageX:h.pageX,which:1,pageY:h.pageY,duration:i/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(e,"singleTap",{touch:h,pageX:h.pageX,which:1,pageY:h.pageY,duration:i/1E3})},300)}});b.singleTap=b.doubleTap={handle:new e};return e},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(c,b){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var c=this.requiredTouchCount,b=a.touches.length;b===c?this.start():b>c&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:c.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a==c||b.contains(a,c))return a;for(;;){if(b.contains(c,a))return c;c=c.parentNode}"getCommonTarget error!"},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(c,b,d,a){function e(){}function f(a){2==a.touches.length&&a.preventDefault()}c.extend(e,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,e,f=b[0],i=b[1];e=f.pageX-i.pageX;f=f.pageY-i.pageY;e=Math.sqrt(e*e+f*f);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",c.mix(a,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",c.mix(a,{distance:e,scale:1})))}},
fireEnd:function(a){d.fire(this.target,"pinchEnd",c.mix(a,{touches:this.lastTouches}))}});a=new e;b.pinchStart=b.pinchEnd={handle:a};b.pinch={handle:a,add:function(){d.on(this,"touchmove",f)},remove:function(){d.detach(this,"touchmove",f)}};return e},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(c,b,d,a){function e(){}function f(a){1==a.touches.length&&a.preventDefault()}c.extend(e,d,{onTouchStart:function(b){if(!1===e.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var e=b.touches[0];a.fire(b.target,"tapHold",{touch:e,pageX:e.pageX,pageY:e.pageY,which:1,duration:(c.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){a.on(this,"touchstart",f)},tearDown:function(){a.detach(this,"touchstart",f)},handle:new e};return e},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(c,b,d,a,e){function f(){}function l(a){2==a.touches.length&&a.preventDefault()}var n=180/Math.PI;c.extend(f,d,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,d=f[0],j=f[1],g=this.lastAngle,d=Math.atan2(j.pageY-d.pageY,j.pageX-d.pageX)*n;if(g!==e){var j=Math.abs(d-g),k=(d+360)%360,m=(d-360)%360;Math.abs(k-g)<j?d=k:Math.abs(m-g)<j&&(d=m)}this.lastTouches=f;this.lastAngle=d;this.isStarted?a.fire(this.target,"rotate",c.mix(b,{angle:d,rotation:d-
this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",c.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=e;f.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",c.mix(b,{touches:this.lastTouches}))}});d=new f;b.rotateEnd=b.rotateStart={handle:d};b.rotate={handle:d,add:function(){a.on(this,"touchmove",l)},remove:function(){a.detach(this,"touchmove",l)}};return f},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(c,b,d,a){function e(g){return c.startsWith(g,"touch")}function f(g){return c.startsWith(g,"mouse")}function l(g){this.doc=g;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var n=c.guid("touch-handle"),o=c.Features,h,i,j;o.isTouchEventSupported()?(j="touchend touchcancel mouseup",h="touchstart mousedown",i="touchmove mousemove",c.UA.ios&&(j="touchend touchcancel",h="touchstart",i="touchmove")):o.isMsPointerSupported()?(h="MSPointerDown",i=
"MSPointerMove",j="MSPointerUp MSPointerCancel"):(h="mousedown",i="mousemove",j="mouseup");l.prototype={constructor:l,lastTouches:[],firstTouch:null,init:function(){var g=this.doc;a.on(g,h,this.onTouchStart,this);a.on(g,i,this.onTouchMove,this);a.on(g,j,this.onTouchEnd,this)},addTouch:function(g){g.identifier=g.pointerId;this.touches.push(g)},removeTouch:function(g){for(var a=0,c=g.pointerId,b=this.touches,e=b.length;a<e;a++){g=b[a];if(g.pointerId===c){b.splice(a,1);break}}},updateTouch:function(a){for(var c=
0,b,e=a.pointerId,d=this.touches,f=d.length;c<f;c++){b=d[c];b.pointerId===e&&(d[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};c.push(b);setTimeout(function(){var a=c.indexOf(b);a>-1&&c.splice(a,
1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=this.lastTouches,b=a.clientX,a=a.clientY,e=0,d=c.length,f;e<d&&(f=c[e]);e++){var h=Math.abs(b-f.x),i=Math.abs(a-f.y);if(h<=25&&i<=25)return true}return 0},normalize:function(a){var c=a.type,b;if(e(c)){b=c=="touchend"||c=="touchcancel"?a.changedTouches:a.touches;if(b.length==1){a.which=1;a.pageX=b[0].pageX;a.pageY=b[0].pageY}return a}b=this.touches;c=!c.match(/(up|cancel)$/i);a.touches=c?b:[];a.targetTouches=c?b:[];a.changedTouches=b;return a},
onTouchStart:function(a){var b,m;m=a.type;var d=this.eventHandle;if(e(m)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(f(m)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(c.startsWith(m,"MSPointer"))this.addTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);for(b in d){m=d[b].handle;m.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(!e(b))if(f(b)){if(this.isEventSimulatedFromTouch(b))return;
this.touches=[a.originalEvent]}else if(c.startsWith(b,"MSPointer"))this.updateTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,d=a.type;if(!f(d)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(e(d)){b.dupMouse(a);c.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else f(d)?b.touches=[]:c.startsWith(d,"MSPointer")&&b.removeTouch(a.originalEvent)}},callEventHandle:function(a,
b){var c=this.eventHandle,d,e,b=this.normalize(b);for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var b=this.doc;a.detach(b,h,this.onTouchStart,this);a.detach(b,i,this.onTouchMove,
this);a.detach(b,j,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,c){var d=b.getDocument(a),e=b.data(d,n);e||b.data(d,n,e=new l(d));c&&e.addEventHandle(c)},removeDocumentHandle:function(a,d){var e=b.getDocument(a),f=b.data(e,n);if(f){d&&f.removeEventHandle(d);if(c.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,n)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(c,b,d,a){function e(b){a.addDocumentHandle(this,b);d[b].setup.apply(this,arguments)}function f(b){a.removeDocumentHandle(this,b);d[b].tearDown.apply(this,arguments)}function l(b){a.addDocumentHandle(this,b)}function n(b){a.removeDocumentHandle(this,b)}var c=b.Gesture,o=c.start="KSPointerDown",h=c.move="KSPointerMove",i=c.end="KSPointerUp";c.tap="tap";c.doubleTap="doubleTap";d[o]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,o,a)}}};d[h]={setup:function(){var a=
this.ownerDocument||this;a.__ks__pointer_events_count=a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var c=a.target;(c.ownerDocument||c).__ks__pointer_events_count&&b.fire(c,h,a)}}};d[i]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,i,a)}}};var c=b.Special,j,g,k;for(g in d)j={},k=d[g],j.setup=k.setup?e:l,j.tearDown=
k.tearDown?f:n,k.add&&(j.add=k.add),k.remove&&(j.remove=k.remove),c[g]=j},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
