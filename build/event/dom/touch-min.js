/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 26 22:39
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(f){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:f.noop,onTouchEnd:f.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(f,a){function d(c){c.preventDefault()}function g(){g.superclass.constructor.apply(this,arguments)}var i=a("./handle-map"),e=a("event/dom/base"),b=a("./single-touch"),l=e.Object;f.extend(g,b,{onTouchMove:function(c){var a=this.lastXY,c=c.changedTouches[0];if(!c||5<Math.abs(c.pageX-a.pageX)||5<Math.abs(c.pageY-a.pageY))return!1},onTouchEnd:function(c){var a=c.changedTouches[0],c=c.target,j=new l({type:"tap",
target:c,currentTarget:c});f.mix(j,{pageX:a.pageX,pageY:a.pageY,which:1,touch:a});e.fire(c,"tap",j);if(j.isDefaultPrevented())e.on(c,"click",{fn:d,once:1})}});i.tap={handle:new g};return g});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(f,a){function d(a,b,i){var o=b.changedTouches[0],h=o.pageX-a.startX,r=o.pageY-a.startY,q=Math.abs(h),f=Math.abs(r);if(i){if(a.isVertical&&a.isHorizontal){if(5>Math.max(q,f))return c;f>q?a.isHorizontal=0:a.isVertical=0}}else if(a.isVertical&&f<j&&(a.isVertical=0),a.isHorizontal&&q<j)a.isHorizontal=0;if(a.isHorizontal)h=0>h?"left":"right";else if(a.isVertical)h=0>r?"up":"down",q=f;else return!1;e.fire(b.target,
i?m:l,{originalEvent:b.originalEvent,pageX:o.pageX,pageY:o.pageY,which:1,touch:o,direction:h,distance:q,duration:(b.timeStamp-a.startTime)/1E3});return c}function g(){}var i=a("./handle-map"),e=a("event/dom/base"),b=a("./single-touch"),l="swipe",c=c,m="swiping",j=50;f.extend(g,b,{onTouchStart:function(a){if(!1===g.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&
a.preventDefault();return c},onTouchMove:function(a){var c=a.changedTouches[0],b=c.pageY-this.startY,c=Math.abs(c.pageX-this.startX),b=Math.abs(b);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return d(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:d(this,a,0)}});i[l]=i[m]={handle:new g};return g});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(f,a){function d(){}var g=a("./handle-map"),i=a("event/dom/base"),e=a("./single-touch");f.extend(d,e,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var f=this.lastEndTime,c=a.timeStamp,e=a.target,
j=a.changedTouches[0],d=c-this.startTime;this.lastEndTime=c;if(f&&(d=c-f,300>d)){this.lastEndTime=0;i.fire(e,"doubleTap",{touch:j,duration:d/1E3});return}d=c-this.startTime;300<d?i.fire(e,"singleTap",{touch:j,pageX:j.pageX,which:1,pageY:j.pageY,duration:d/1E3}):this.singleTapTimer=setTimeout(function(){i.fire(e,"singleTap",{touch:j,pageX:j.pageX,which:1,pageY:j.pageY,duration:d/1E3})},300)}});g.singleTap=g.doubleTap={handle:new d};return d});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(f,a){function d(){}var g=a("dom");d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var e=this.requiredTouchCount,b=a.touches.length;b===e?this.start():b>e&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(a){var e=a.touches,a=e[0].target,e=e[1].target;if(a==e||g.contains(a,e))return a;for(;;){if(g.contains(e,
a))return e;e=e.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function d(){}function g(a){2==a.touches.length&&a.preventDefault()}var i=a("./handle-map"),e=a("event/dom/base"),b=a("./multi-touch");f.extend(d,b,{onTouchMove:function(a){if(this.isTracking){var c=a.touches;if(0<c[0].pageX&&0<c[0].pageY&&0<c[1].pageX&&0<c[1].pageY){var b,d=c[0],g=c[1];b=d.pageX-g.pageX;d=d.pageY-g.pageY;b=Math.sqrt(b*b+d*d);this.lastTouches=c;this.isStarted?e.fire(this.target,"pinch",
f.mix(a,{distance:b,scale:b/this.startDistance})):(this.isStarted=!0,this.startDistance=b,c=this.target=this.getCommonTarget(a),e.fire(c,"pinchStart",f.mix(a,{distance:b,scale:1})))}}},fireEnd:function(a){e.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});b=new d;i.pinchStart=i.pinchEnd={handle:b};i.pinch={handle:b,setup:function(){e.on(this,"touchmove",g)},tearDown:function(){e.detach(this,"touchmove",g)}};return d});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(f,a){function d(){}var g=a("./handle-map"),i=a("event/dom/base"),e=a("./single-touch");f.extend(d,e,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var d=a.touches[0];i.fire(a.target,"tapHold",{touch:d,pageX:d.pageX,pageY:d.pageY,which:1,duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});g.tapHold={handle:new d};return d});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(f,a){function d(){}function g(a){2==a.touches.length&&a.preventDefault()}var i=a("./handle-map"),e=a("event/dom/base"),b=a("./multi-touch"),l=180/Math.PI;f.extend(d,b,{onTouchMove:function(a){if(this.isTracking){var d=a.touches,b=d[0],g=d[1],i=this.lastAngle,b=Math.atan2(g.pageY-b.pageY,g.pageX-b.pageX)*l;if(void 0!==i){var g=Math.abs(b-i),k=(b+360)%360,o=(b-360)%360;Math.abs(k-i)<g?b=k:Math.abs(o-i)<g&&
(b=o)}this.lastTouches=d;this.lastAngle=b;this.isStarted?e.fire(this.target,"rotate",f.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),e.fire(this.target,"rotateStart",f.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;d.superclass.end.apply(this,arguments)},fireEnd:function(a){e.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});b=new d;i.rotateEnd=i.rotateStart={handle:b};i.rotate={handle:b,
setup:function(){e.on(this,"touchmove",g)},tearDown:function(){e.detach(this,"touchmove",g)}};return d});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(f,a){function d(a){return f.startsWith(a,"touch")}function g(a){return f.startsWith(a,"mouse")}function i(a){return f.startsWith(a,"MSPointer")||f.startsWith(a,"pointer")}function e(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var b=a("dom"),l=a("./handle-map"),c=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var m=f.guid("touch-handle"),j=f.Features,p,n,k;if(j.isTouchEventSupported())if(f.UA.ios){k="touchend touchcancel";p="touchstart";n="touchmove"}else{k="touchend touchcancel mouseup";p="touchstart mousedown";n="touchmove mousemove"}else if(j.isPointerSupported()){p="pointerdown";n="pointermove";k="pointerup pointercancel"}else if(j.isMsPointerSupported()){p="MSPointerDown";n="MSPointerMove";k="MSPointerUp MSPointerCancel"}else{p="mousedown";n="mousemove";
k="mouseup"}e.prototype={constructor:e,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;c.on(a,p,this.onTouchStart,this);if(!i(n))c.on(a,n,this.onTouchMove,this);c.on(a,k,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var h=0,r=a.pointerId,b=this.touches,d=b.length;h<d;h++){a=b[h];if(a.pointerId===r){b.splice(h,1);break}}},updateTouch:function(a){for(var h=0,b,d=a.pointerId,c=this.touches,e=c.length;h<e;h++){b=c[h];
b.pointerId===d&&(c[h]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var h=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};h.push(b);setTimeout(function(){var a=h.indexOf(b);a>-1&&h.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var h=
this.lastTouches,b=a.clientX,a=a.clientY,d=0,c=h.length,e;d<c&&(e=h[d]);d++){var f=Math.abs(b-e.x),g=Math.abs(a-e.y);if(f<=25&&g<=25)return true}return 0},normalize:function(a){var h=a.type,b;if(d(h)){b=h=="touchend"||h=="touchcancel"?a.changedTouches:a.touches;if(b.length==1){a.which=1;a.pageX=b[0].pageX;a.pageY=b[0].pageY}return a}b=this.touches;h=!h.match(/(up|cancel)$/i);a.touches=h?b:[];a.targetTouches=h?b:[];a.changedTouches=b;return a},onTouchStart:function(a){var b,e;e=a.type;var f=this.eventHandle;
if(d(e)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(g(e)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(i(e)){this.addTouch(a.originalEvent);if(this.touches.length==1)c.on(this.doc,n,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in f){e=f[b].handle;e.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(!d(b))if(g(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(i(b))this.updateTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,e=a.type;if(!g(e)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(d(e)){b.dupMouse(a);f.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(g(e))b.touches=[];else if(i(e)){b.removeTouch(a.originalEvent);b.touches.length||c.detach(b.doc,n,b.onTouchMove,b)}}},
callEventHandle:function(a,b){var d=this.eventHandle,e,c,b=this.normalize(b);if(b.changedTouches.length){for(e in d){c=d[e].handle;if(!c.processed){c.processed=1;if(c.isActive&&c[a]&&c[a](b)===false)c.isActive=0}}for(e in d){c=d[e].handle;c.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=l[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;c.detach(a,
p,this.onTouchStart,this);c.detach(a,n,this.onTouchMove,this);c.detach(a,k,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,c){var d=b.getDocument(a),f=b.data(d,m);f||b.data(d,m,f=new e(d));c&&f.addEventHandle(c)},removeDocumentHandle:function(a,c){var d=b.getDocument(a),e=b.data(d,m);if(e){c&&e.removeEventHandle(c);if(f.isEmptyObject(e.eventHandle)){e.destroy();b.removeData(d,m)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(f,a){function d(a){c.addDocumentHandle(this,a);l[a].setup.apply(this,arguments)}function g(a){c.removeDocumentHandle(this,a);l[a].tearDown.apply(this,arguments)}function i(a){c.addDocumentHandle(this,a)}function e(a){c.removeDocumentHandle(this,a)}var b=a("event/dom/base"),l=a("./touch/handle-map"),c=a("./touch/handle"),m=b.Gesture,j=m.start="KSPointerDown",p=m.move="KSPointerMove",n=m.end="KSPointerUp";
m.tap="tap";m.doubleTap="doubleTap";l[j]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,j,a)}}};l[p]={handle:{isActive:1,onTouchMove:function(a){b.fire(a.target,p,a)}}};l[n]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,n,a)}}};var m=b.Special,k,o,h;for(o in l)k={},h=l[o],k.setup=h.setup?d:i,k.tearDown=h.tearDown?g:e,h.add&&(k.add=h.add),h.remove&&(k.remove=h.remove),m[o]=k});
