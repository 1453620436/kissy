/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Oct 10 13:54
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(c){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:c.noop,onTouchEnd:c.noop};return b});
KISSY.add("event/dom/touch/tap",function(c,b,d,a){function e(c){c.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var k=d.Object;c.extend(h,a,{onTouchMove:function(){return!1},onTouchEnd:function(a){var b=a.changedTouches[0],a=a.target,f=new k({type:"tap",target:a,currentTarget:a});c.mix(f,{pageX:b.pageX,pageY:b.pageY,which:1,touch:b});d.fire(a,"tap",f);if(f.isDefaultPrevented())d.on(a,"click",{fn:e,once:1})}});b.tap={handle:new h};return h},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(c,b,d,a){function e(f,a,c){var g=a.changedTouches[0],j=g.pageX-f.startX,o=g.pageY-f.startY,b=Math.abs(j),e=Math.abs(o);if(c){if(f.isVertical&&f.isHorizontal){if(5>Math.max(b,e))return;e>b?f.isHorizontal=0:f.isVertical=0}}else if(f.isVertical&&e<n&&(f.isVertical=0),f.isHorizontal&&b<n)f.isHorizontal=0;if(f.isHorizontal)j=0>j?"left":"right";else if(f.isVertical)j=0>o?"up":"down",b=e;else return!1;d.fire(a.target,c?m:k,{originalEvent:a.originalEvent,pageX:g.pageX,
pageY:g.pageY,which:1,touch:g,direction:j,distance:b,duration:(a.timeStamp-f.startTime)/1E3})}function h(){}var k="swipe",m="swiping",n=50;c.extend(h,a,{onTouchStart:function(a){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var c=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var c=a.changedTouches[0],b=c.pageY-this.startY,c=Math.abs(c.pageX-
this.startX),b=Math.abs(b);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return e(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:e(this,a,0)}});b[k]=b[m]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(c,b,d,a){function e(){}c.extend(e,a,{onTouchStart:function(a){if(!1===e.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,e=a.target,f=a.changedTouches[0],i=b-this.startTime;this.lastEndTime=b;if(c&&(i=b-c,300>i)){this.lastEndTime=0;d.fire(e,"doubleTap",
{touch:f,duration:i/1E3});return}i=b-this.startTime;300<i?d.fire(e,"singleTap",{touch:f,pageX:f.pageX,which:1,pageY:f.pageY,duration:i/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(e,"singleTap",{touch:f,pageX:f.pageX,which:1,pageY:f.pageY,duration:i/1E3})},300)}});b.singleTap=b.doubleTap={handle:new e};return e},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(c,b){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var c=this.requiredTouchCount,b=a.touches.length;b===c?this.start():b>c&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:c.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a==c||b.contains(a,c))return a;for(;;){if(b.contains(c,a))return c;c=c.parentNode}"getCommonTarget error!"},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(c,b,d,a){function e(){}function h(a){2==a.touches.length&&a.preventDefault()}c.extend(e,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,e,f=b[0],i=b[1];e=f.pageX-i.pageX;f=f.pageY-i.pageY;e=Math.sqrt(e*e+f*f);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",c.mix(a,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",c.mix(a,{distance:e,scale:1})))}},
fireEnd:function(a){d.fire(this.target,"pinchEnd",c.mix(a,{touches:this.lastTouches}))}});a=new e;b.pinchStart=b.pinchEnd={handle:a};b.pinch={handle:a,add:function(){d.on(this,"touchmove",h)},remove:function(){d.detach(this,"touchmove",h)}};return e},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(c,b,d,a){function e(){}function h(a){1==a.touches.length&&a.preventDefault()}c.extend(e,d,{onTouchStart:function(b){if(!1===e.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var e=b.touches[0];a.fire(b.target,"tapHold",{touch:e,pageX:e.pageX,pageY:e.pageY,which:1,duration:(c.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){a.on(this,"touchstart",h)},tearDown:function(){a.detach(this,"touchstart",h)},handle:new e};return e},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(c,b,d,a,e){function h(){}function k(a){2==a.touches.length&&a.preventDefault()}var m=180/Math.PI;c.extend(h,d,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,d=f[0],h=f[1],g=this.lastAngle,d=Math.atan2(h.pageY-d.pageY,h.pageX-d.pageX)*m;if(g!==e){var h=Math.abs(d-g),j=(d+360)%360,o=(d-360)%360;Math.abs(j-g)<h?d=j:Math.abs(o-g)<h&&(d=o)}this.lastTouches=f;this.lastAngle=d;this.isStarted?a.fire(this.target,"rotate",c.mix(b,{angle:d,rotation:d-
this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",c.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=e;h.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",c.mix(b,{touches:this.lastTouches}))}});d=new h;b.rotateEnd=b.rotateStart={handle:d};b.rotate={handle:d,add:function(){a.on(this,"touchmove",k)},remove:function(){a.detach(this,"touchmove",k)}};return h},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(c,b,d,a){function e(g){return c.startsWith(g,"touch")}function h(g){return c.startsWith(g,"mouse")}function k(g){this.doc=g;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var m=c.guid("touch-handle"),n=c.Features,f,i,l;n.isTouchEventSupported()?(l="touchend touchcancel mouseup",f="touchstart mousedown",i="touchmove mousemove",c.UA.ios&&(l="touchend touchcancel",f="touchstart",i="touchmove")):n.isMsPointerSupported()?(f="MSPointerDown",i=
"MSPointerMove",l="MSPointerUp MSPointerCancel"):(f="mousedown",i="mousemove",l="mouseup");k.prototype={constructor:k,lastTouches:[],firstTouch:null,init:function(){var g=this.doc;a.on(g,f,this.onTouchStart,this);a.on(g,i,this.onTouchMove,this);a.on(g,l,this.onTouchEnd,this)},addTouch:function(g){g.identifier=g.pointerId;this.touches.push(g)},removeTouch:function(g){for(var a=0,b=g.pointerId,c=this.touches,d=c.length;a<d;a++){g=c[a];if(g.pointerId===b){c.splice(a,1);break}}},updateTouch:function(g){for(var a=
0,c,b=g.pointerId,d=this.touches,e=d.length;a<e;a++){c=d[a];c.pointerId===b&&(d[a]=g)}},isPrimaryTouch:function(g){return this.firstTouch===g.identifier},setPrimaryTouch:function(g){if(this.firstTouch===null)this.firstTouch=g.identifier},removePrimaryTouch:function(g){if(this.isPrimaryTouch(g))this.firstTouch=null},dupMouse:function(g){var a=this.lastTouches,g=g.changedTouches[0];if(this.isPrimaryTouch(g)){var c={x:g.clientX,y:g.clientY};a.push(c);setTimeout(function(){var g=a.indexOf(c);g>-1&&a.splice(g,
1)},2500)}},isEventSimulatedFromTouch:function(g){for(var a=this.lastTouches,c=g.clientX,g=g.clientY,b=0,d=a.length,e;b<d&&(e=a[b]);b++){var f=Math.abs(c-e.x),h=Math.abs(g-e.y);if(f<=25&&h<=25)return true}return 0},normalize:function(a){var c=a.type,b;if(e(c)){b=c=="touchend"||c=="touchcancel"?a.changedTouches:a.touches;if(b.length==1){a.which=1;a.pageX=b[0].pageX;a.pageY=b[0].pageY}return a}b=this.touches;c=!c.match(/(up|cancel)$/i);a.touches=c?b:[];a.targetTouches=c?b:[];a.changedTouches=b;return a},
onTouchStart:function(a){var b,d;d=a.type;var f=this.eventHandle;if(e(d)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(d)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(c.startsWith(d,"MSPointer"))this.addTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);for(b in f){d=f[b].handle;d.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(!e(b))if(h(b)){if(this.isEventSimulatedFromTouch(b))return;
this.touches=[a.originalEvent]}else if(c.startsWith(b,"MSPointer"))this.updateTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,d=a.type;if(!h(d)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(e(d)){b.dupMouse(a);c.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else h(d)?b.touches=[]:c.startsWith(d,"MSPointer")&&b.removeTouch(a.originalEvent)}},callEventHandle:function(a,
b){var c=this.eventHandle,d,e,b=this.normalize(b);for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var b=this.doc;a.detach(b,f,this.onTouchStart,this);a.detach(b,i,this.onTouchMove,
this);a.detach(b,l,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,c){var d=b.getDocument(a),e=b.data(d,m);e||b.data(d,m,e=new k(d));c&&e.addEventHandle(c)},removeDocumentHandle:function(a,d){var e=b.getDocument(a),f=b.data(e,m);if(f){d&&f.removeEventHandle(d);if(c.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,m)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(c,b,d,a){function e(b){a.addDocumentHandle(this,b);d[b].setup.apply(this,arguments)}function h(b){a.removeDocumentHandle(this,b);d[b].tearDown.apply(this,arguments)}function k(b){a.addDocumentHandle(this,b)}function m(b){a.removeDocumentHandle(this,b)}var c=b.Gesture,n=c.start="KSPointerDown",f=c.move="KSPointerMove",i=c.end="KSPointerUp";c.tap="tap";c.doubleTap="doubleTap";d[n]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,n,a)}}};d[f]={setup:function(){var a=
this.ownerDocument||this;a.__ks__pointer_events_count=a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var c=a.target;(c.ownerDocument||c).__ks__pointer_events_count&&b.fire(c,f,a)}}};d[i]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,i,a)}}};var c=b.Special,l,g,j;for(g in d)l={},j=d[g],l.setup=j.setup?e:k,l.tearDown=
j.tearDown?h:m,j.add&&(l.add=j.add),j.remove&&(l.remove=j.remove),c[g]=l},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
