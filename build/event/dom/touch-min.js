/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Jan 23 19:27
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(g){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(g){if(g.touches.length!==this.requiredTouchCount)return!1;g=this.lastTouches=g.touches;this.lastXY={pageX:g[0].pageX,pageY:g[0].pageY}},onTouchMove:g.noop,onTouchEnd:g.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(g,a){function j(c){c.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var d=a("./handle-map"),k=a("event/dom/base"),i=a("./single-touch"),m=k.Object;g.extend(h,i,{onTouchStart:function(c){var f=this;if(!1===h.superclass.onTouchStart.call(f,c))return!1;f.tapHoldTimer&&clearTimeout(f.tapHoldTimer);f.tapHoldTimer=setTimeout(function(){var b=g.mix({touch:c.touches[0],which:1,TAP_HOLD_DELAY:(g.now()-
c.timeStamp)/1E3},f.lastXY);f.tapHoldTimer=0;f.lastXY=0;k.fire(c.target,"tapHold",b)},1E3);f.startTime=c.timeStamp;f.singleTapTimer&&(clearTimeout(f.singleTapTimer),f.singleTapTimer=0)},onTouchMove:function(c){var f;if(!(f=this.lastXY))return!1;c=c.changedTouches[0];if(!c||5<Math.abs(c.pageX-f.pageX)||5<Math.abs(c.pageY-f.pageY))return!1},onTouchEnd:function(c){var f;if(f=this.lastXY){var b=c.target,d=c.changedTouches[0];this.tapHoldTimer&&(clearTimeout(this.tapHoldTimer),this.tapHoldTimer=0);var a=
new m({type:"tap",which:1,pageX:f.pageX,pageY:f.pageY,target:b,currentTarget:b});a.touch=d;k.fire(b,"tap",a);if(a.isDefaultPrevented()&&g.UA.mobile)if(g.UA.ios)c.preventDefault();else k.on(b.ownerDocument||b,"click",{fn:j,once:1});var a=this.lastEndTime,c=c.timeStamp,l;this.lastEndTime=c;if(a&&(l=c-a,300>l)){this.lastEndTime=0;k.fire(b,"doubleTap",{touch:d,pageX:f.pageX,pageY:f.pageY,which:1,duration:l/1E3});return}l=c-this.startTime;300<l?k.fire(b,"singleTap",{touch:d,pageX:f.pageX,pageY:f.pageY,
which:1,duration:l/1E3}):this.singleTapTimer=setTimeout(function(){k.fire(b,"singleTap",{touch:d,pageX:f.pageX,pageY:f.pageY,which:1,duration:l/1E3})},300)}}});d.tap=d.doubleTap=d.singleTap=d.tapHold={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(g,a){function j(b,d,g){var a=d.changedTouches[0],e=a.pageX-b.startX,q=a.pageY-b.startY,n=Math.abs(e),r=Math.abs(q);if(g){if(b.isVertical&&b.isHorizontal){if(5>Math.max(n,r))return;r>n?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&r<f&&(b.isVertical=0),b.isHorizontal&&n<f)b.isHorizontal=0;if(b.isHorizontal)e=0>e?"left":"right";else if(b.isVertical)e=0>q?"up":"down",n=r;else return!1;k.fire(d.target,
g?c:m,{originalEvent:d.originalEvent,pageX:a.pageX,pageY:a.pageY,which:1,touch:a,direction:e,distance:n,duration:(d.timeStamp-b.startTime)/1E3})}function h(){}var d=a("./handle-map"),k=a("event/dom/base"),i=a("./single-touch"),m="swipe",c="swiping",f=50;g.extend(h,i,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var c=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(b){var c=b.changedTouches[0],f=c.pageY-this.startY,c=Math.abs(c.pageX-this.startX),f=Math.abs(f);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<f&&(this.isHorizontal=0);return j(this,b,1)},onTouchEnd:function(c){return!1===this.onTouchMove(c)?!1:j(this,c,0)}});d[m]=d[c]={handle:new h};return h});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(g,a){function j(){}var h=a("dom");j.prototype={constructor:j,requiredTouchCount:2,onTouchStart:function(d){var a=this.requiredTouchCount,g=d.touches.length;g===a?this.start():g>a&&this.end(d)},onTouchEnd:function(d){this.end(d)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(d){var a=d.touches,d=a[0].target,a=a[1].target;if(d===a||h.contains(d,a))return d;for(;;){if(h.contains(a,
d))return a;a=a.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return j});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(g,a){function j(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var d=a("./handle-map"),k=a("event/dom/base"),i=a("./multi-touch");g.extend(j,i,{onTouchMove:function(a){if(this.isTracking){var c=a.touches;if(0<c[0].pageX&&0<c[0].pageY&&0<c[1].pageX&&0<c[1].pageY){var f,b=c[0],d=c[1];f=b.pageX-d.pageX;b=b.pageY-d.pageY;f=Math.sqrt(f*f+b*b);this.lastTouches=c;this.isStarted?k.fire(this.target,
"pinch",g.mix(a,{distance:f,scale:f/this.startDistance})):(this.isStarted=!0,this.startDistance=f,c=this.target=this.getCommonTarget(a),k.fire(c,"pinchStart",g.mix(a,{distance:f,scale:1})))}}},fireEnd:function(a){k.fire(this.target,"pinchEnd",g.mix(a,{touches:this.lastTouches}))}});i=new j;d.pinchStart=d.pinchEnd={handle:i};d=d.pinch={handle:i};g.Features.isTouchEventSupported()&&(d.setup=function(){this.addEventListener("touchmove",h,!1)},d.tearDown=function(){this.removeEventListener("touchmove",
h,!1)});return j});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(g,a){function j(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var d=a("./handle-map"),k=a("event/dom/base"),i=a("./multi-touch"),m=180/Math.PI;g.extend(j,i,{onTouchMove:function(a){if(this.isTracking){var f=a.touches,b=f[0],d=f[1],h=this.lastAngle,b=Math.atan2(d.pageY-b.pageY,d.pageX-b.pageX)*m;if(void 0!==h){var d=Math.abs(b-h),i=(b+360)%360,e=(b-360)%360;Math.abs(i-h)<d?b=i:Math.abs(e-
h)<d&&(b=e)}this.lastTouches=f;this.lastAngle=b;this.isStarted?k.fire(this.target,"rotate",g.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),k.fire(this.target,"rotateStart",g.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;j.superclass.end.apply(this,arguments)},fireEnd:function(a){k.fire(this.target,"rotateEnd",g.mix(a,{touches:this.lastTouches}))}});i=new j;d.rotateEnd=d.rotateStart={handle:i};d=d.rotate=
{handle:i};g.Features.isTouchEventSupported()&&(d.setup=function(){this.addEventListener("touchmove",h,!1)},d.tearDown=function(){this.removeEventListener("touchmove",h,!1)});return j});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./pinch,./rotate".split(","),function(g,a){function j(e){return g.startsWith(e,"touch")}function h(e){return g.startsWith(e,"mouse")}function d(e){return g.startsWith(e,"MSPointer")||g.startsWith(e,"pointer")}function k(e){this.doc=e;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var i=a("dom"),m=a("./handle-map"),c=a("event/dom/base");a("./tap");a("./swipe");a("./pinch");a("./rotate");var f=g.guid("touch-handle"),
b=g.Features,p,o,l;if(b.isTouchEventSupported())if(g.UA.ios){l="touchend touchcancel";p="touchstart";o="touchmove"}else{l="touchend touchcancel mouseup";p="touchstart mousedown";o="touchmove mousemove"}else if(b.isPointerSupported()){p="pointerdown";o="pointermove";l="pointerup pointercancel"}else if(b.isMsPointerSupported()){p="MSPointerDown";o="MSPointerMove";l="MSPointerUp MSPointerCancel"}else{p="mousedown";o="mousemove";l="mouseup"}k.prototype={constructor:k,lastTouches:[],firstTouch:null,init:function(){var e=
this.doc;c.on(e,p,this.onTouchStart,this);if(!d(o))c.on(e,o,this.onTouchMove,this);c.on(e,l,this.onTouchEnd,this)},addTouch:function(e){e.identifier=e.pointerId;this.touches.push(e)},removeTouch:function(e){for(var a=0,n=e.pointerId,c=this.touches,b=c.length;a<b;a++){e=c[a];if(e.pointerId===n){c.splice(a,1);break}}},updateTouch:function(e){for(var a=0,n,c=e.pointerId,b=this.touches,d=b.length;a<d;a++){n=b[a];n.pointerId===c&&(b[a]=e)}},isPrimaryTouch:function(e){return this.firstTouch===e.identifier},
setPrimaryTouch:function(e){if(this.firstTouch===null)this.firstTouch=e.identifier},removePrimaryTouch:function(e){if(this.isPrimaryTouch(e))this.firstTouch=null},dupMouse:function(e){var a=this.lastTouches,e=e.changedTouches[0];if(this.isPrimaryTouch(e)){var n={x:e.clientX,y:e.clientY};a.push(n);setTimeout(function(){var e=a.indexOf(n);e>-1&&a.splice(e,1)},2500)}},isEventSimulatedFromTouch:function(e){for(var a=this.lastTouches,n=e.clientX,e=e.clientY,c=0,b=a.length,d;c<b&&(d=a[c]);c++){var f=Math.abs(n-
d.x),g=Math.abs(e-d.y);if(f<=25&&g<=25)return true}return 0},normalize:function(e){var a=e.type,c;if(j(a)){c=a==="touchend"||a==="touchcancel"?e.changedTouches:e.touches;if(c.length===1){e.which=1;e.pageX=c[0].pageX;e.pageY=c[0].pageY}return e}c=this.touches;a=!a.match(/(up|cancel)$/i);e.touches=a?c:[];e.targetTouches=a?c:[];e.changedTouches=c;return e},onTouchStart:function(e){var a,b;b=e.type;var f=this.eventHandle;if(j(b)){this.setPrimaryTouch(e.changedTouches[0]);this.dupMouse(e)}else if(h(b)){if(this.isEventSimulatedFromTouch(e))return;
this.touches=[e.originalEvent]}else if(d(b)){this.addTouch(e.originalEvent);if(this.touches.length===1)c.on(this.doc,o,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+e.type);for(a in f){b=f[a].handle;b.isActive=1}this.callEventHandle("onTouchStart",e)},onTouchMove:function(e){var a=e.type;if(h(a)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[e.originalEvent]}else if(d(a))this.updateTouch(e.originalEvent);else if(!j(a))throw Error("unrecognized touch event: "+e.type);
this.callEventHandle("onTouchMove",e)},onTouchEnd:function(a){var b=this,f=a.type;if(!h(f)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(j(f)){b.dupMouse(a);g.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(f))b.touches=[];else if(d(f)){b.removeTouch(a.originalEvent);b.touches.length||c.detach(b.doc,o,b.onTouchMove,b)}}},callEventHandle:function(a,b){var c=this.eventHandle,f,d,b=this.normalize(b);if(b.changedTouches.length){for(f in c){d=
c[f].handle;if(!d.processed){d.processed=1;if(d.isActive&&d[a]&&d[a](b)===false)d.isActive=0}}for(f in c){d=c[f].handle;d.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=m[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;c.detach(a,p,this.onTouchStart,this);c.detach(a,o,this.onTouchMove,this);c.detach(a,l,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,
b){var c=i.getDocument(a),d=i.data(c,f);d||i.data(c,f,d=new k(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=i.getDocument(a),d=i.data(c,f);if(d){b&&d.removeEventHandle(b);if(g.isEmptyObject(d.eventHandle)){d.destroy();i.removeData(c,f)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(g,a){function j(a){c.addDocumentHandle(this,a);m[a].setup.apply(this,arguments)}function h(a){c.removeDocumentHandle(this,a);m[a].tearDown.apply(this,arguments)}function d(a){c.addDocumentHandle(this,a)}function k(a){c.removeDocumentHandle(this,a)}var i=a("event/dom/base"),m=a("./touch/handle-map"),c=a("./touch/handle"),f=i.Gesture,b=f.start="KSPointerDown",p=f.move="KSPointerMove",o=f.end="KSPointerUp";
f.tap="tap";f.singleTap="singleTap";f.doubleTap="doubleTap";m[b]={handle:{isActive:1,onTouchStart:function(a){i.fire(a.target,b,a)}}};m[p]={handle:{isActive:1,onTouchMove:function(a){i.fire(a.target,p,a)}}};m[o]={handle:{isActive:1,onTouchEnd:function(a){i.fire(a.target,o,a)}}};var f=i.Special,l,e,q;for(e in m)l={},q=m[e],l.setup=q.setup?j:d,l.tearDown=q.tearDown?h:k,q.add&&(l.add=q.add),q.remove&&(l.remove=q.remove),f[e]=l});
