/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Oct 25 12:24
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(a){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:a.noop,onTouchEnd:a.noop};return b});
KISSY.add("event/dom/touch/tap",function(a,b,f,c){function d(a){a.preventDefault()}function e(){e.superclass.constructor.apply(this,arguments)}var m=f.Object;a.extend(e,c,{onTouchMove:function(a){var c=this.lastXY,a=a.changedTouches[0];if(5<Math.abs(a.pageX-c.pageX)||5<Math.abs(a.pageY-c.pageY))return!1},onTouchEnd:function(c){var b=c.changedTouches[0],c=c.target,h=new m({type:"tap",target:c,currentTarget:c});a.mix(h,{pageX:b.pageX,pageY:b.pageY,which:1,touch:b});f.fire(c,"tap",h);if(h.isDefaultPrevented())f.on(c,
"click",{fn:d,once:1})}});b.tap={handle:new e};return e},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(a,b,f,c){function d(a,c,b){var l=c.changedTouches[0],i=l.pageX-a.startX,g=l.pageY-a.startY,d=Math.abs(i),e=Math.abs(g);if(b){if(a.isVertical&&a.isHorizontal){if(5>Math.max(d,e))return;e>d?a.isHorizontal=0:a.isVertical=0}}else if(a.isVertical&&e<o&&(a.isVertical=0),a.isHorizontal&&d<o)a.isHorizontal=0;if(a.isHorizontal)i=0>i?"left":"right";else if(a.isVertical)i=0>g?"up":"down",d=e;else return!1;f.fire(c.target,b?n:m,{originalEvent:c.originalEvent,pageX:l.pageX,
pageY:l.pageY,which:1,touch:l,direction:i,distance:d,duration:(c.timeStamp-a.startTime)/1E3})}function e(){}var m="swipe",n="swiping",o=50;a.extend(e,c,{onTouchStart:function(a){if(!1===e.superclass.onTouchStart.apply(this,arguments))return!1;var c=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var c=a.changedTouches[0],b=c.pageY-this.startY,c=Math.abs(c.pageX-
this.startX),b=Math.abs(b);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return d(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:d(this,a,0)}});b[m]=b[n]={handle:new e};return e},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(a,b,f,c){function d(){}a.extend(d,c,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,d=a.target,h=a.changedTouches[0],j=b-this.startTime;this.lastEndTime=b;if(c&&(j=b-c,300>j)){this.lastEndTime=0;f.fire(d,"doubleTap",
{touch:h,duration:j/1E3});return}j=b-this.startTime;300<j?f.fire(d,"singleTap",{touch:h,pageX:h.pageX,which:1,pageY:h.pageY,duration:j/1E3}):this.singleTapTimer=setTimeout(function(){f.fire(d,"singleTap",{touch:h,pageX:h.pageX,which:1,pageY:h.pageY,duration:j/1E3})},300)}});b.singleTap=b.doubleTap={handle:new d};return d},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(a,b){function f(){}f.prototype={constructor:f,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,f=a.touches.length;f===b?this.start():f>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:a.noop,getCommonTarget:function(a){var d=a.touches,a=d[0].target,d=d[1].target;if(a==d||b.contains(a,d))return a;for(;;){if(b.contains(d,a))return d;d=d.parentNode}"getCommonTarget error!"},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return f},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(a,b,f,c){function d(){}function e(a){2==a.touches.length&&a.preventDefault()}a.extend(d,c,{onTouchMove:function(c){if(this.isTracking){var b=c.touches,d,e=b[0],j=b[1];d=e.pageX-j.pageX;e=e.pageY-j.pageY;d=Math.sqrt(d*d+e*e);this.lastTouches=b;this.isStarted?f.fire(this.target,"pinch",a.mix(c,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,b=this.target=this.getCommonTarget(c),f.fire(b,"pinchStart",a.mix(c,{distance:d,scale:1})))}},
fireEnd:function(c){f.fire(this.target,"pinchEnd",a.mix(c,{touches:this.lastTouches}))}});c=new d;b.pinchStart=b.pinchEnd={handle:c};b.pinch={handle:c,add:function(){f.on(this,"touchmove",e)},remove:function(){f.detach(this,"touchmove",e)}};return d},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(a,b,f,c){function d(){}function e(a){1==a.touches.length&&a.preventDefault()}a.extend(d,f,{onTouchStart:function(b){if(!1===d.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var d=b.touches[0];c.fire(b.target,"tapHold",{touch:d,pageX:d.pageX,pageY:d.pageY,which:1,duration:(a.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){c.on(this,"touchstart",e)},tearDown:function(){c.detach(this,"touchstart",e)},handle:new d};return d},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(a,b,f,c,d){function e(){}function m(a){2==a.touches.length&&a.preventDefault()}var n=180/Math.PI;a.extend(e,f,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,e=f[0],k=f[1],l=this.lastAngle,e=Math.atan2(k.pageY-e.pageY,k.pageX-e.pageX)*n;if(l!==d){var k=Math.abs(e-l),i=(e+360)%360,g=(e-360)%360;Math.abs(i-l)<k?e=i:Math.abs(g-l)<k&&(e=g)}this.lastTouches=f;this.lastAngle=e;this.isStarted?c.fire(this.target,"rotate",a.mix(b,{angle:e,rotation:e-
this.startAngle})):(this.isStarted=!0,this.startAngle=e,this.target=this.getCommonTarget(b),c.fire(this.target,"rotateStart",a.mix(b,{angle:e,rotation:0})))}},end:function(){this.lastAngle=d;e.superclass.end.apply(this,arguments)},fireEnd:function(b){c.fire(this.target,"rotateEnd",a.mix(b,{touches:this.lastTouches}))}});f=new e;b.rotateEnd=b.rotateStart={handle:f};b.rotate={handle:f,add:function(){c.on(this,"touchmove",m)},remove:function(){c.detach(this,"touchmove",m)}};return e},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(a,b,f,c){function d(l){return a.startsWith(l,"touch")}function e(l){return a.startsWith(l,"mouse")}function m(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var n=a.guid("touch-handle"),o=a.Features,h,j,k;o.isTouchEventSupported()?(k="touchend touchcancel mouseup",h="touchstart mousedown",j="touchmove mousemove",a.UA.ios&&(k="touchend touchcancel",h="touchstart",j="touchmove")):o.isMsPointerSupported()?(h="MSPointerDown",j=
"MSPointerMove",k="MSPointerUp MSPointerCancel"):(h="mousedown",j="mousemove",k="mouseup");m.prototype={constructor:m,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;c.on(a,h,this.onTouchStart,this);c.on(a,j,this.onTouchMove,this);c.on(a,k,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var i=0,g=a.pointerId,b=this.touches,c=b.length;i<c;i++){a=b[i];if(a.pointerId===g){b.splice(i,1);break}}},updateTouch:function(a){for(var b=
0,g,c=a.pointerId,d=this.touches,e=d.length;b<e;b++){g=d[b];g.pointerId===c&&(d[b]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var g={x:a.clientX,y:a.clientY};b.push(g);setTimeout(function(){var a=b.indexOf(g);a>-1&&b.splice(a,
1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,g=a.clientX,a=a.clientY,c=0,d=b.length,e;c<d&&(e=b[c]);c++){var f=Math.abs(g-e.x),h=Math.abs(a-e.y);if(f<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,g;if(d(b)){g=b=="touchend"||b=="touchcancel"?a.changedTouches:a.touches;if(g.length==1){a.which=1;a.pageX=g[0].pageX;a.pageY=g[0].pageY}return a}g=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?g:[];a.targetTouches=b?g:[];a.changedTouches=g;return a},
onTouchStart:function(b){var c,g;g=b.type;var f=this.eventHandle;if(d(g)){this.setPrimaryTouch(b.changedTouches[0]);this.dupMouse(b)}else if(e(g)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[b.originalEvent]}else if(a.startsWith(g,"MSPointer"))this.addTouch(b.originalEvent);else throw Error("unrecognized touch event: "+b.type);for(c in f){g=f[c].handle;g.isActive=1}this.callEventHandle("onTouchStart",b)},onTouchMove:function(b){var c=b.type;if(!d(c))if(e(c)){if(this.isEventSimulatedFromTouch(c))return;
this.touches=[b.originalEvent]}else if(a.startsWith(c,"MSPointer"))this.updateTouch(b.originalEvent);else throw Error("unrecognized touch event: "+b.type);this.callEventHandle("onTouchMove",b)},onTouchEnd:function(b){var c=this,g=b.type;if(!e(g)||!c.isEventSimulatedFromTouch(b)){c.callEventHandle("onTouchEnd",b);if(d(g)){c.dupMouse(b);a.makeArray(b.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else e(g)?c.touches=[]:a.startsWith(g,"MSPointer")&&c.removeTouch(b.originalEvent)}},callEventHandle:function(a,
b){var c=this.eventHandle,d,e,b=this.normalize(b);for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=f[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;c.detach(a,h,this.onTouchStart,this);c.detach(a,j,this.onTouchMove,
this);c.detach(a,k,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,c){var d=b.getDocument(a),e=b.data(d,n);e||b.data(d,n,e=new m(d));c&&e.addEventHandle(c)},removeDocumentHandle:function(c,d){var e=b.getDocument(c),f=b.data(e,n);if(f){d&&f.removeEventHandle(d);if(a.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,n)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(a,b,f,c){function d(a){c.addDocumentHandle(this,a);f[a].setup.apply(this,arguments)}function e(a){c.removeDocumentHandle(this,a);f[a].tearDown.apply(this,arguments)}function m(a){c.addDocumentHandle(this,a)}function n(a){c.removeDocumentHandle(this,a)}var a=b.Gesture,o=a.start="KSPointerDown",h=a.move="KSPointerMove",j=a.end="KSPointerUp";a.tap="tap";a.doubleTap="doubleTap";f[o]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,o,a)}}};f[h]={setup:function(){var a=
this.ownerDocument||this;a.__ks__pointer_events_count=a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var c=a.target;(c.ownerDocument||c).__ks__pointer_events_count&&b.fire(c,h,a)}}};f[j]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,j,a)}}};var a=b.Special,k,l,i;for(l in f)k={},i=f[l],k.setup=i.setup?d:m,k.tearDown=
i.tearDown?e:n,i.add&&(k.add=i.add),i.remove&&(k.remove=i.remove),a[l]=k},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
