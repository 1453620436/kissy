/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Aug 30 01:39
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(a){function b(){}b.prototype={constructor:b,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=a.touches},onTouchMove:a.noop,onTouchEnd:a.noop};return b});
KISSY.add("event/dom/touch/tap",function(a,b,e,c){function d(a){a.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var l=e.Object;a.extend(h,c,{onTouchMove:function(){return!1},onTouchEnd:function(c){var k=c.changedTouches[0],c=c.target,f=new l({type:"tap",target:c,currentTarget:c});a.mix(f,{pageX:k.pageX,pageY:k.pageY,which:1,touch:k});e.fire(c,"tap",f);if(f.isDefaultPrevented())e.on(c,"click",{fn:d,once:1})}});b.tap={handle:new h};return h},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(a,b,e,c){function d(f,c,g){var j=c.changedTouches[0],a=j.pageX-f.startX,d=j.pageY-f.startY,p=Math.abs(a),b=Math.abs(d);if(g)f.isVertical&&f.isHorizontal&&(b>p?f.isHorizontal=0:f.isVertical=0);else if(f.isVertical&&b<k&&(f.isVertical=0),f.isHorizontal&&p<k)f.isHorizontal=0;if(f.isHorizontal)a=0>a?"left":"right";else if(f.isVertical)a=0>d?"up":"down",p=b;else return!1;e.fire(c.target,g?m:l,{originalEvent:c.originalEvent,pageX:j.pageX,pageY:j.pageY,which:1,
touch:j,direction:a,distance:p,duration:(c.timeStamp-f.startTime)/1E3})}function h(){}var l="swipe",m="swiping",k=50;a.extend(h,c,{onTouchStart:function(a){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var c=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var c=a.changedTouches[0],g=c.pageY-this.startY,c=Math.abs(c.pageX-this.startX),g=Math.abs(g);
if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<c&&(this.isVertical=0);this.isHorizontal&&35<g&&(this.isHorizontal=0);return d(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:d(this,a,0)}});b[l]=b[m]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(a,b,e,c){function d(){}a.extend(d,c,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,d=a.timeStamp,b=a.target,f=a.changedTouches[0],i=d-this.startTime;this.lastEndTime=d;if(c&&(i=d-c,300>i)){this.lastEndTime=0;e.fire(b,"doubleTap",
{touch:f,duration:i/1E3});return}i=d-this.startTime;300<i?e.fire(b,"singleTap",{touch:f,pageX:f.pageX,which:1,pageY:f.pageY,duration:i/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(b,"singleTap",{touch:f,pageX:f.pageX,which:1,pageY:f.pageY,duration:i/1E3})},300)}});b.singleTap=b.doubleTap={handle:new d};return d},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(a,b){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(a){var d=this.requiredTouchCount,b=a.touches.length;b===d?this.start():b>d&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:a.noop,getCommonTarget:function(a){var d=a.touches,a=d[0].target,d=d[1].target;if(a==d||b.contains(a,d))return a;for(;;){if(b.contains(d,a))return d;d=d.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(a,b,e,c){function d(){}function h(a){2==a.touches.length&&a.preventDefault()}a.extend(d,c,{onTouchMove:function(c){if(this.isTracking){var d=c.touches,b,f=d[0],i=d[1];b=f.pageX-i.pageX;f=f.pageY-i.pageY;b=Math.sqrt(b*b+f*f);this.lastTouches=d;this.isStarted?e.fire(this.target,"pinch",a.mix(c,{distance:b,scale:b/this.startDistance})):(this.isStarted=!0,this.startDistance=b,d=this.target=this.getCommonTarget(c),e.fire(d,"pinchStart",a.mix(c,{distance:b,scale:1})))}},
fireEnd:function(c){e.fire(this.target,"pinchEnd",a.mix(c,{touches:this.lastTouches}))}});c=new d;b.pinchStart=b.pinchEnd={handle:c};b.pinch={handle:c,add:function(){e.on(this,"touchmove",h)},remove:function(){e.detach(this,"touchmove",h)}};return d},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(a,b,e,c){function d(){}function h(a){1==a.touches.length&&a.preventDefault()}a.extend(d,e,{onTouchStart:function(b){if(!1===d.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var d=b.touches[0];c.fire(b.target,"tapHold",{touch:d,pageX:d.pageX,pageY:d.pageY,which:1,duration:(a.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold=
{setup:function(){c.on(this,"touchstart",h)},tearDown:function(){c.detach(this,"touchstart",h)},handle:new d};return d},{requires:["./handle-map","./single-touch","event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(a,b,e,c,d){function h(){}function l(a){2==a.touches.length&&a.preventDefault()}var m=180/Math.PI;a.extend(h,e,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,e=f[0],g=f[1],j=this.lastAngle,e=Math.atan2(g.pageY-e.pageY,g.pageX-e.pageX)*m;if(j!==d){var g=Math.abs(e-j),o=(e+360)%360,n=(e-360)%360;Math.abs(o-j)<g?e=o:Math.abs(n-j)<g&&(e=n)}this.lastTouches=f;this.lastAngle=e;this.isStarted?c.fire(this.target,"rotate",a.mix(b,{angle:e,rotation:e-
this.startAngle})):(this.isStarted=!0,this.startAngle=e,this.target=this.getCommonTarget(b),c.fire(this.target,"rotateStart",a.mix(b,{angle:e,rotation:0})))}},end:function(){this.lastAngle=d;h.superclass.end.apply(this,arguments)},fireEnd:function(b){c.fire(this.target,"rotateEnd",a.mix(b,{touches:this.lastTouches}))}});e=new h;b.rotateEnd=b.rotateStart={handle:e};b.rotate={handle:e,add:function(){c.on(this,"touchmove",l)},remove:function(){c.detach(this,"touchmove",l)}};return h},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(a,b,e,c){function d(g){return a.startsWith(g.type,"touch")}function h(g){this.doc=g;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var l=a.guid("touch-handle"),m=a.Features,k,f,i;m.isTouchEventSupported()?(i="touchend touchcancel mouseup",k="touchstart mousedown",f="touchmove mousemove",a.UA.ios&&(i="touchend touchcancel",k="touchstart",f="touchmove")):m.isMsPointerSupported()?(k="MSPointerDown",f="MSPointerMove",i="MSPointerUp MSPointerCancel"):
(k="mousedown",f="mousemove",i="mouseup");h.prototype={lastTouches:[],firstTouch:null,init:function(){var g=this.doc;c.on(g,k,this.onTouchStart,this);c.on(g,f,this.onTouchMove,this);c.on(g,i,this.onTouchEnd,this)},isPrimaryTouch:function(g){return this.firstTouch===g.identifier},setPrimaryTouch:function(g){if(this.firstTouch===null)this.firstTouch=g.identifier},removePrimaryTouch:function(g){if(this.isPrimaryTouch(g))this.firstTouch=null},dupMouse:function(g){var a=this.lastTouches,g=g.changedTouches[0];
if(this.isPrimaryTouch(g)){g={x:g.clientX,y:g.clientY};a.push(g);a=function(a,g){var b=a.indexOf(g);b>-1&&a.splice(b,1)}.bind(null,a,g);setTimeout(a,2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,c=a.clientX,a=a.clientY,d=0,e=b.length,f;d<e&&(f=b[d]);d++){var h=Math.abs(c-f.x),i=Math.abs(a-f.y);if(h<=25&&i<=25)return true}return 0},constructor:h,normalize:function(a){var b=a.type,c;if(d(a)){c=b=="touchend"||b=="touchcancel"?a.changedTouches:a.touches;if(c.length==1){a.which=
1;a.pageX=c[0].pageX;a.pageY=c[0].pageY}return a}c=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?c:[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchStart:function(g){var b,c,e=this.eventHandle;if(d(g)){this.setPrimaryTouch(g.changedTouches[0]);this.dupMouse(g)}else if(a.startsWith(g.type,"mouse")&&this.isEventSimulatedFromTouch(g))return;for(b in e){c=e[b].handle;c.isActive=1}this.touches=d(g)?a.makeArray(g.touches):[g.originalEvent];this.callEventHandle("onTouchStart",g)},onTouchMove:function(b){if(!a.startsWith(b.type,
"mouse")||!this.isEventSimulatedFromTouch(b)){this.touches=[b.originalEvent];this.callEventHandle("onTouchMove",b)}},onTouchEnd:function(b){var c=this;if(!a.startsWith(b.type,"mouse")||!c.isEventSimulatedFromTouch(b)){c.callEventHandle("onTouchEnd",b);if(d(b)){c.touches=a.makeArray(b.touches);c.dupMouse(b);a.makeArray(b.changedTouches).forEach(function(a){c.removePrimaryTouch(a)})}else c.touches=[]}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);for(d in c){e=c[d].handle;
if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=e[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;c.detach(a,k,this.onTouchStart,this);c.detach(a,f,this.onTouchMove,this);c.detach(a,i,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,
c){var d=b.getDocument(a),e=b.data(d,l);e||b.data(d,l,e=new h(d));c&&e.addEventHandle(c)},removeDocumentHandle:function(c,d){var e=b.getDocument(c),f=b.data(e,l);if(f){d&&f.removeEventHandle(d);if(a.isEmptyObject(f.eventHandle)){f.destroy();b.removeData(e,l)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(a,b,e,c){function d(a){l.call(this,a);e[a].setup.apply(this,arguments)}function h(a){m.call(this,a);e[a].tearDown.apply(this,arguments)}function l(a){var b=this.style;k&&b&&(this.__ks_touch_action||(this.__ks_touch_action=b.msTouchAction,this.__ks_user_select=b.msUserSelect,b.msTouchAction=b.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);c.addDocumentHandle(this,a)}function m(a){var b=this.style;
k&&b&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(b.msUserSelect=this.__ks_user_select,b.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));c.removeDocumentHandle(this,a)}var k=a.Features.isMsPointerSupported(),a=b.Gesture,f=a.start="KSPointerDown",i=a.move="KSPointerMove",g=a.end="KSPointerUp";a.tap="tap";a.doubleTap="doubleTap";e[f]={handle:{isActive:1,onTouchStart:function(a){b.fire(a.target,f,a)}}};e[i]={setup:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count=
a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var c=a.target;(c.ownerDocument||c).__ks__pointer_events_count&&b.fire(c,i,a)}}};e[g]={handle:{isActive:1,onTouchEnd:function(a){b.fire(a.target,g,a)}}};var a=b.Special,j,o,n;for(o in e)j={},n=e[o],j.setup=n.setup?d:l,j.tearDown=n.tearDown?h:m,n.add&&(j.add=n.add),n.remove&&(j.remove=
n.remove),a[o]=j},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
