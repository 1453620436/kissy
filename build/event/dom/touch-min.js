/*
Copyright 2013, KISSY v1.50
MIT Licensed
build time: Dec 19 00:19
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(d){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!==this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:d.noop,onTouchEnd:d.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(d,a){function c(e){e.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var f=a("./handle-map"),j=a("event/dom/base"),g=a("./single-touch"),l=j.Object;d.extend(h,g,{onTouchMove:function(e){var a=this.lastXY,e=e.changedTouches[0];if(!e||5<Math.abs(e.pageX-a.pageX)||5<Math.abs(e.pageY-a.pageY))return!1},onTouchEnd:function(e){var a=e.changedTouches[0],b=e.target,f=new l({type:"tap",
target:b,currentTarget:b});d.mix(f,{pageX:a.pageX,pageY:a.pageY,originalEvent:e.originalEvent,which:1,touch:a});j.fire(b,"tap",f);if(f.isDefaultPrevented())j.on(b,"click",{fn:c,once:1})}});f.tap={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(d,a){function c(b,a,f){var g=a.changedTouches[0],p=g.pageX-b.startX,k=g.pageY-b.startY,i=Math.abs(p),d=Math.abs(k);if(f){if(b.isVertical&&b.isHorizontal){if(5>Math.max(i,d))return;d>i?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&d<m&&(b.isVertical=0),b.isHorizontal&&i<m)b.isHorizontal=0;if(b.isHorizontal)p=0>p?"left":"right";else if(b.isVertical)p=0>k?"up":"down",i=d;else return!1;j.fire(a.target,
f?e:l,{originalEvent:a.originalEvent,pageX:g.pageX,pageY:g.pageY,which:1,touch:g,direction:p,distance:i,duration:(a.timeStamp-b.startTime)/1E3})}function h(){}var f=a("./handle-map"),j=a("event/dom/base"),g=a("./single-touch"),l="swipe",e="swiping",m=50;d.extend(h,g,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(b){var a=b.changedTouches[0],e=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),e=Math.abs(e);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<e&&(this.isHorizontal=0);return c(this,b,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});f[l]=f[e]={handle:new h};return h});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(d,a){function c(){}var h=a("./handle-map"),f=a("event/dom/base"),j=a("./single-touch");d.extend(c,j,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var d=this.lastEndTime,e=a.timeStamp,j=a.target,
b=a.changedTouches[0],c=e-this.startTime;this.lastEndTime=e;if(d&&(c=e-d,300>c)){this.lastEndTime=0;f.fire(j,"doubleTap",{touch:b,pageX:b.pageX,pageY:b.pageY,which:1,duration:c/1E3});return}c=e-this.startTime;300<c?f.fire(j,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3}):this.singleTapTimer=setTimeout(function(){f.fire(j,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3})},300)}});h.singleTap=h.doubleTap={handle:new c};return c});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(d,a){function c(){}var h=a("dom");c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(a){var d=this.requiredTouchCount,c=a.touches.length;c===d?this.start():c>d&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:d.noop,getCommonTarget:function(a){var d=a.touches,a=d[0].target,d=d[1].target;if(a===d||h.contains(a,d))return a;for(;;){if(h.contains(d,
a))return d;d=d.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return c});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(d,a){function c(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var f=a("./handle-map"),j=a("event/dom/base"),g=a("./multi-touch");d.extend(c,g,{onTouchMove:function(a){if(this.isTracking){var e=a.touches;if(0<e[0].pageX&&0<e[0].pageY&&0<e[1].pageX&&0<e[1].pageY){var c,b=e[0],f=e[1];c=b.pageX-f.pageX;b=b.pageY-f.pageY;c=Math.sqrt(c*c+b*b);this.lastTouches=e;this.isStarted?j.fire(this.target,
"pinch",d.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,e=this.target=this.getCommonTarget(a),j.fire(e,"pinchStart",d.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){j.fire(this.target,"pinchEnd",d.mix(a,{touches:this.lastTouches}))}});g=new c;f.pinchStart=f.pinchEnd={handle:g};f=f.pinch={handle:g};d.Features.isTouchEventSupported()&&(f.set=function(){this.addEventListener("touchmove",h,!1)},f.tearDown=function(){this.removeEventListener("touchmove",
h,!1)});return c});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(d,a){function c(){}var h=a("./handle-map"),f=a("event/dom/base"),j=a("./single-touch");d.extend(c,j,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var c=a.touches[0];f.fire(a.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(d.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});h.tapHold={handle:new c};return c});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(d,a){function c(){}function h(a){2===a.targetTouches.length&&a.preventDefault()}var f=a("./handle-map"),j=a("event/dom/base"),g=a("./multi-touch"),l=180/Math.PI;d.extend(c,g,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],f=c[1],g=this.lastAngle,b=Math.atan2(f.pageY-b.pageY,f.pageX-b.pageX)*l;if(void 0!==g){var f=Math.abs(b-g),h=(b+360)%360,p=(b-360)%360;Math.abs(h-g)<f?b=h:Math.abs(p-
g)<f&&(b=p)}this.lastTouches=c;this.lastAngle=b;this.isStarted?j.fire(this.target,"rotate",d.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),j.fire(this.target,"rotateStart",d.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;c.superclass.end.apply(this,arguments)},fireEnd:function(a){j.fire(this.target,"rotateEnd",d.mix(a,{touches:this.lastTouches}))}});g=new c;f.rotateEnd=f.rotateStart={handle:g};f=f.rotate=
{handle:g};d.Features.isTouchEventSupported()&&(f.set=function(){this.addEventListener("touchmove",h,!1)},f.tearDown=function(){this.removeEventListener("touchmove",h,!1)});return c});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(d,a){function c(a){return d.startsWith(a,"touch")}function h(a){return d.startsWith(a,"mouse")}function f(a){return d.startsWith(a,"MSPointer")||d.startsWith(a,"pointer")}function j(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var g=a("dom"),l=a("./handle-map"),e=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var m=d.guid("touch-handle"),b=d.Features,q,o,n;if(b.isTouchEventSupported())if(d.UA.ios){n="touchend touchcancel";q="touchstart";o="touchmove"}else{n="touchend touchcancel mouseup";q="touchstart mousedown";o="touchmove mousemove"}else if(b.isPointerSupported()){q="pointerdown";o="pointermove";n="pointerup pointercancel"}else if(b.isMsPointerSupported()){q="MSPointerDown";o="MSPointerMove";n="MSPointerUp MSPointerCancel"}else{q="mousedown";o="mousemove";
n="mouseup"}j.prototype={constructor:j,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;e.on(a,q,this.onTouchStart,this);if(!f(o))e.on(a,o,this.onTouchMove,this);e.on(a,n,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var k=0,i=a.pointerId,b=this.touches,c=b.length;k<c;k++){a=b[k];if(a.pointerId===i){b.splice(k,1);break}}},updateTouch:function(a){for(var k=0,i,b=a.pointerId,c=this.touches,d=c.length;k<d;k++){i=c[k];
i.pointerId===b&&(c[k]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var k=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};k.push(b);setTimeout(function(){var a=k.indexOf(b);a>-1&&k.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var k=
this.lastTouches,b=a.clientX,a=a.clientY,c=0,d=k.length,e;c<d&&(e=k[c]);c++){var f=Math.abs(b-e.x),g=Math.abs(a-e.y);if(f<=25&&g<=25)return true}return 0},normalize:function(a){var b=a.type,i;if(c(b)){i=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;if(i.length===1){a.which=1;a.pageX=i[0].pageX;a.pageY=i[0].pageY}return a}i=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?i:[];a.targetTouches=b?i:[];a.changedTouches=i;return a},onTouchStart:function(a){var b,i;i=a.type;var d=this.eventHandle;
if(c(i)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(i)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(f(i)){this.addTouch(a.originalEvent);if(this.touches.length===1)e.on(this.doc,o,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in d){i=d[b].handle;i.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(h(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(f(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,i=a.type;if(!h(i)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(i)){b.dupMouse(a);d.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(i))b.touches=[];else if(f(i)){b.removeTouch(a.originalEvent);b.touches.length||e.detach(b.doc,o,b.onTouchMove,
b)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=l[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;
e.detach(a,q,this.onTouchStart,this);e.detach(a,o,this.onTouchMove,this);e.detach(a,n,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=g.getDocument(a),d=g.data(c,m);d||g.data(c,m,d=new j(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=g.getDocument(a),e=g.data(c,m);if(e){b&&e.removeEventHandle(b);if(d.isEmptyObject(e.eventHandle)){e.destroy();g.removeData(c,m)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(d,a){function c(a){e.addDocumentHandle(this,a);l[a].setup.apply(this,arguments)}function h(a){e.removeDocumentHandle(this,a);l[a].tearDown.apply(this,arguments)}function f(a){e.addDocumentHandle(this,a)}function j(a){e.removeDocumentHandle(this,a)}var g=a("event/dom/base"),l=a("./touch/handle-map"),e=a("./touch/handle"),m=g.Gesture,b=m.start="KSPointerDown",q=m.move="KSPointerMove",o=m.end="KSPointerUp";
m.tap="tap";m.singleTap="singleTap";m.doubleTap="doubleTap";l[b]={handle:{isActive:1,onTouchStart:function(a){g.fire(a.target,b,a)}}};l[q]={handle:{isActive:1,onTouchMove:function(a){g.fire(a.target,q,a)}}};l[o]={handle:{isActive:1,onTouchEnd:function(a){g.fire(a.target,o,a)}}};var m=g.Special,n,p,k;for(p in l)n={},k=l[p],n.setup=k.setup?c:f,n.tearDown=k.tearDown?h:j,k.add&&(n.add=k.add),k.remove&&(n.remove=k.remove),m[p]=n});
