/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 8 11:55
*/
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(j,e){var g=e("tree/control"),i=e("tree/node"),d=e("tree/check-node"),a=e("tree/check-tree");g.Node=i;g.CheckNode=d;g.CheckTree=a;return g});
KISSY.add("tree/control",["./node","./tree-manager"],function(j,e){var g=e("./node"),i=e("./tree-manager");return g.extend([i],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d){this.callSuper(d);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree"})});
KISSY.add("tree/node",["node","component/container","./node-xtpl","component/extension/content-box"],function(j,e){function g(b){if(b.target===this){var a=b.component,c=this.get("depth"),b=b.index,d=this.get("tree");d&&(l(d,a,c+1),n(this,b))}}function i(b){b.target===this&&(l(this.get("tree"),b.component),n(this,b.index))}function d(b){b.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(b){var a=b.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||
a===b}function o(b){var a=b.get("isLeaf");return!(!1===a||void 0===a&&b.get("children").length)}function k(b){var a=b.get("children");return!b.get("expanded")||!a.length?b:k(a[a.length-1])}function f(b){b.refreshCss(a(b),o(b))}function l(b,a,c){void 0!==c&&a.set("depth",c);j.each(a.get("children"),function(a){"number"===typeof c?l(b,a,c+1):l(b,a)})}function n(b,a){f(b);for(var a=Math.max(0,a-1),c=b.get("children"),d,k=c.length;a<k;a++)d=c[a],f(d),d.el.setAttribute("aria-posinset",a+1)}var c=e("node"),
h=e("component/container"),p=c.all,m=c.KeyCode,c=e("./node-xtpl"),q=e("component/extension/content-box");return h.extend([q],{beforeCreateDom:function(b){j.mix(b.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+b.id,"aria-expanded":b.expanded?"true":"false","aria-selected":b.selected?"true":"false","aria-level":b.depth,title:b.tooltip})},bindUI:function(){this.on("afterAddChild",g);this.on("afterRemoveChild",i);this.on("afterAddChild afterRemoveChild",d)},syncUI:function(){f(this);d.call(this,
{target:this})},handleKeyDownInternal:function(b){var a=!0,c=this.get("tree"),d=this.get("expanded"),f,e=this.get("isLeaf"),h=this.get("children");switch(b.keyCode){case m.ENTER:return this.handleClickInternal(b);case m.HOME:f=c;break;case m.END:f=k(c);break;case m.UP:f=b=(b=this.prev())?k(b):this.get("parent");break;case m.DOWN:b=this.get("children");if(this.get("expanded")&&b.length)f=b[0];else{b=this.next();for(c=this;!b&&(c=c.get("parent"));)b=c.next();f=b}break;case m.LEFT:d&&(h.length||!1===
e)?this.set("expanded",!1):f=this.get("parent");break;case m.RIGHT:if(h.length||!1===e)d?f=h[0]:this.set("expanded",!0);break;default:a=!1}f&&f.select();return a},next:function(){var b=this.get("parent"),a;if(!b)return null;b=b.get("children");a=j.indexOf(this,b);return a===b.length-1?null:b[a+1]},prev:function(){var b=this.get("parent"),a;if(!b)return null;b=b.get("children");a=j.indexOf(this,b);return 0===a?null:b[a-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(b){b.stopPropagation();
var a=p(b.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(b);a.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var b=this.get("tree");b&&(l(b,this,0),n(this,0))}},refreshCss:function(b,a){var c=this.get("iconEl"),d,f,h=this.get("expandIconEl"),e=this.getChildrenContainerEl();a?(d="file-icon",f="expand-icon-{t}"):this.get("expanded")?
(d="expanded-folder-icon",f="expand-icon-{t}minus"):(d="collapsed-folder-icon",f="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(d);h[0].className=this.getBaseCssClasses(["expand-icon",j.substitute(f,{t:b?"l":"t"})]);e[0].className=this.getBaseCssClasses(b?"lchildren":"children")},_onSetDepth:function(b){this.el.setAttribute("aria-level",b)},getChildrenContainerEl:function(){return this.get("childrenEl")},_onSetExpanded:function(b){this.getChildrenContainerEl()[b?"show":"hide"]();this.el.setAttribute("aria-expanded",
b);f(this);this.fire(b?"expand":"collapse")},_onSetSelected:function(b,a){this.get("rowEl")[b?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",b);var c=this.get("tree");if(!a||!a.byPassSetTreeSelectedItem)c.set("selectedItem",b?this:null)},expandAll:function(){this.set("expanded",!0);j.each(this.get("children"),function(b){b.expandAll()})},collapseAll:function(){this.set("expanded",!1);j.each(this.get("children"),function(b){b.collapseAll()})}},{ATTRS:{contentTpl:{value:c},
handleGestureEvents:{value:!1},isLeaf:{render:1,sync:0,parse:function(b){if(b.hasClass(this.getBaseCssClass("leaf")))return!0;if(b.hasClass(this.getBaseCssClass("folder")))return!1}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},
expanded:{sync:0,value:!1,render:1,parse:function(){return"none"!==this.get("childrenEl").css("display")}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var b=this;b&&!b.isTree;)b=b.get("parent");return b}},depth:{render:1,sync:0},focusable:{value:!1},defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree-node"})});
KISSY.add("tree/node-xtpl",[],function(j,e,g,i){e=function(d,a,e,k){var f=this,l=f.utils.callFn,g=f.nativeCommands["if"];if("5.0.0"!==j.version)throw Error("current xtemplate file("+f.name+")(v5.0.0) need to be recompiled using current kissy(v"+j.version+")!");a.write('<div class="',0);var c={escape:1},h=[];h.push("row");c.params=h;if((c=l(f,d,c,a,["getBaseCssClasses"],0,1))&&c.isBuffer)a=c,c=k;a.write(c,!0);a.write("\r\n     ",0);var c={escape:1},h=[],i=d.resolve(["selected"],0);h.push(i);c.params=
h;c.fn=function(a,c){c.write("\r\n        ",0);var b={escape:1},d=[];d.push("selected");b.params=d;if((b=l(f,a,b,c,["getBaseCssClasses"],0,3))&&b.isBuffer)c=b,b=k;c.write(b,!0);c.write("\r\n     ",0);return c};a=g.call(f,d,c,a,2,e);a.write('\r\n     ">\r\n    <div class="',0);c={escape:1};h=[];h.push("expand-icon");c.params=h;if((c=l(f,d,c,a,["getBaseCssClasses"],0,6))&&c.isBuffer)a=c,c=k;a.write(c,!0);a.write('">\r\n    </div>\r\n    ',0);c={escape:1};h=[];i=d.resolve(["checkable"],0);h.push(i);
c.params=h;c.fn=function(a,c){c.write('\r\n    <div class="',0);var b={escape:1},d=[],e="checked",e="checked"+a.resolve(["checkState"],0);d.push(e);b.params=d;if((b=l(f,a,b,c,["getBaseCssClasses"],0,9))&&b.isBuffer)c=b,b=k;c.write(b,!0);c.write(" ",0);b={escape:1};d=[];d.push("checked");b.params=d;if((b=l(f,a,b,c,["getBaseCssClasses"],0,9))&&b.isBuffer)c=b,b=k;c.write(b,!0);c.write('"></div>\r\n    ',0);return c};a=g.call(f,d,c,a,8,e);a.write('\r\n    <div class="',0);c={escape:1};h=[];h.push("icon");
c.params=h;if((c=l(f,d,c,a,["getBaseCssClasses"],0,11))&&c.isBuffer)a=c,c=k;a.write(c,!0);a.write('">\r\n\r\n    </div>\r\n    <div class="',0);c={escape:1};h=[];h.push("content");c.params=h;if((c=l(f,d,c,a,["getBaseCssClasses"],0,14))&&c.isBuffer)a=c,c=k;a.write(c,!0);a.write('">',0);c=d.resolve(["content"],0);a.write(c,!1);a.write('</div>\r\n</div>\r\n<div class="',0);c={escape:1};h=[];h.push("children");c.params=h;if((c=l(f,d,c,a,["getBaseCssClasses"],0,16))&&c.isBuffer)a=c,c=k;a.write(c,!0);a.write('"\r\n',
0);c={escape:1};h=[];i=d.resolve(["expanded"],0);h.push(!i);c.params=h;c.fn=function(a,c){c.write('\r\nstyle="display:none"\r\n',0);return c};a=g.call(f,d,c,a,17,e);a.write("\r\n>\r\n</div>",0);return a};e.TPL_NAME=i.name;return e});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap"],function(j,e){function g(){}var i=e("component/extension/delegate-children"),d=e("event/gesture/tap");g.ATTRS={showRootNode:{value:!0,render:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};j.augment(g,i,{isTree:1,__bindUI:function(){var a=this.get("prefixCls")+"tree-node";this.$el.delegate(d.TAP,"."+a,this.handleChildrenEvents,this)},_onSetSelectedItem:function(a,d){a&&d.prevVal&&d.prevVal.set("selected",
!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return g});
KISSY.add("tree/check-node",["node","./node"],function(j,e){var g=e("node"),i=e("./node"),d=g.all,g=i.extend({handleClickInternal:function(a){var e=this.get("expanded"),k=this.get("expandIconEl"),f=this.get("tree"),g=d(a.target);f.focus();this.callSuper(a);if(g.equals(k))this.set("expanded",!e);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),!0},_onSetCheckState:function(a){var d=this.get("parent"),e,f,g,i;e=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(e);
(1===a||0===a)&&j.each(this.get("children"),function(c){c.set("checkState",a)});if(d){e=0;i=d.get("children");for(f=0;f<i.length;f++){g=i[f];g=g.get("checkState");if(2===g){d.set("checkState",2);return}1===g&&e++}0===e?d.set("checkState",0):e===i.length?d.set("checkState",1):d.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var a=this.get("checkIconEl");
if(a)for(var d="checked0 checked1 checked2".split(/\s+/),e=0;e<d.length;e++)if(a.hasClass(this.getBaseCssClass(d[e])))return e}},defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree-node"});g.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return g});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(j,e){var g=e("./check-node"),i=e("./tree-manager");return g.extend([i],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d,a){this.callSuper(d,a);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree"})});
