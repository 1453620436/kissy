/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 29 15:13
*/
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(k,f){var g=f("tree/control"),l=f("tree/node"),d=f("tree/check-node"),b=f("tree/check-tree");g.Node=l;g.CheckNode=d;g.CheckTree=b;return g});
KISSY.add("tree/control",["./node","./tree-manager"],function(k,f){var g=f("./node"),l=f("./tree-manager");return g.extend([l],{handleKeyDownInternal:function(d){var b=this.get("selectedItem");return b===this?this.callSuper(d):b&&b.handleKeyDownInternal(d)},_onSetFocused:function(d){this.callSuper(d);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})});
KISSY.add("tree/node",["node","component/container","./node-xtpl","component/extension/content-box"],function(k,f){function g(a){if(a.target===this){var i=a.component,b=this.get("depth"),a=a.index,c=this.get("tree");c&&(e(c,i,b+1),n(this,a))}}function l(a){a.target===this&&(e(this.get("tree"),a.component),n(this,a.index))}function d(a){a.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function b(a){var i=a.get("parent"),i=(i=i&&i.get("children"))&&i[i.length-1];return!i||
i===a}function q(a){var i=a.get("isLeaf");return!(!1===i||void 0===i&&a.get("children").length)}function m(a){var i=a.get("children");return!a.get("expanded")||!i.length?a:m(i[i.length-1])}function h(a){a.refreshCss(b(a),q(a))}function e(a,i,b){void 0!==b&&i.set("depth",b);k.each(i.get("children"),function(i){"number"===typeof b?e(a,i,b+1):e(a,i)})}function n(a,b){h(a);for(var b=Math.max(0,b-1),c=a.get("children"),e,d=c.length;b<d;b++)e=c[b],h(e),e.el.setAttribute("aria-posinset",b+1)}var p=f("node"),
c=f("component/container"),j=p.all,o=p.KeyCode,p=f("./node-xtpl"),r=f("component/extension/content-box");return c.extend([r],{beforeCreateDom:function(a){k.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip})},bindUI:function(){this.on("afterAddChild",g);this.on("afterRemoveChild",l);this.on("afterAddChild afterRemoveChild",d)},syncUI:function(){h(this);d.call(this,
{target:this})},handleKeyDownInternal:function(a){var b=!0,c=this.get("tree"),e=this.get("expanded"),d,h=this.get("isLeaf"),f=this.get("children");switch(a.keyCode){case o.ENTER:return this.handleClickInternal(a);case o.HOME:d=c;break;case o.END:d=m(c);break;case o.UP:d=a=(a=this.prev())?m(a):this.get("parent");break;case o.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)d=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();d=a}break;case o.LEFT:e&&(f.length||!1===
h)?this.set("expanded",!1):d=this.get("parent");break;case o.RIGHT:if(f.length||!1===h)e?d=f[0]:this.set("expanded",!0);break;default:b=!1}d&&d.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=k.indexOf(this,a);return b===a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=k.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){a.stopPropagation();
var b=j(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var a=this.get("tree");a&&(e(a,this,0),n(this,0))}},refreshCss:function(a,b){var c=this.get("iconEl"),d,e,h=this.get("expandIconEl"),f=this.getChildrenContainerEl();b?(d="file-icon",e="expand-icon-{t}"):this.get("expanded")?
(d="expanded-folder-icon",e="expand-icon-{t}minus"):(d="collapsed-folder-icon",e="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(d);h[0].className=this.getBaseCssClasses(["expand-icon",k.substitute(e,{t:a?"l":"t"})]);f[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},getChildrenContainerEl:function(){return this.get("childrenEl")},_onSetExpanded:function(a){this.getChildrenContainerEl()[a?"show":"hide"]();this.el.setAttribute("aria-expanded",
a);h(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){this.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a);var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);k.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);k.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{contentTpl:{value:p},
handleGestureEvents:{value:!1},isLeaf:{render:1,sync:0,parse:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},
expanded:{sync:0,value:!1,render:1,parse:function(){return"none"!==this.get("childrenEl").css("display")}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{render:1,sync:0},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})});
KISSY.add("tree/node-xtpl",["component/extension/content-xtpl"],function(k,f,g,l){g=function(d,b,g,m){var h=this,e=h.nativeCommands,n=h.utils.callFn,l=e["if"],e=e.include;if("5.0.0"!==k.version)throw Error("current xtemplate file("+h.name+")(v5.0.0) need to be recompiled using current kissy(v"+k.version+")!");b.write('<div class="',0);var c={escape:1},j=[];j.push("row");c.params=j;if((c=n(h,d,c,b,["getBaseCssClasses"],0,1))&&c.isBuffer)b=c,c=m;b.write(c,!0);b.write("\r\n     ",0);var c={escape:1},
j=[],o=d.resolve(["selected"],0);j.push(o);c.params=j;c.fn=function(b,a){a.write("\r\n        ",0);var c={escape:1},d=[];d.push("selected");c.params=d;if((c=n(h,b,c,a,["getBaseCssClasses"],0,3))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write("\r\n     ",0);return a};b=l.call(h,d,c,b,2,g);b.write('\r\n     ">\r\n    <div class="',0);c={escape:1};j=[];j.push("expand-icon");c.params=j;if((c=n(h,d,c,b,["getBaseCssClasses"],0,6))&&c.isBuffer)b=c,c=m;b.write(c,!0);b.write('">\r\n    </div>\r\n    ',0);c={escape:1};
j=[];o=d.resolve(["checkable"],0);j.push(o);c.params=j;c.fn=function(b,a){a.write('\r\n    <div class="',0);var c={escape:1},d=[],e="checked",e="checked"+b.resolve(["checkState"],0);d.push(e);c.params=d;if((c=n(h,b,c,a,["getBaseCssClasses"],0,9))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write(" ",0);c={escape:1};d=[];d.push("checked");c.params=d;if((c=n(h,b,c,a,["getBaseCssClasses"],0,9))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write('"></div>\r\n    ',0);return a};b=l.call(h,d,c,b,8,g);b.write('\r\n    <div class="',
0);c={escape:1};j=[];j.push("icon");c.params=j;if((c=n(h,d,c,b,["getBaseCssClasses"],0,11))&&c.isBuffer)b=c,c=m;b.write(c,!0);b.write('">\r\n\r\n    </div>\r\n    ',0);c={};j=[];j.push("component/extension/content-xtpl");c.params=j;f("component/extension/content-xtpl");if((e=e.call(h,d,c,b,14,g))&&e.isBuffer)b=e,e=m;b.write(e,!1);b.write('\r\n</div>\r\n<div class="',0);e={escape:1};c=[];c.push("children");e.params=c;if((e=n(h,d,e,b,["getBaseCssClasses"],0,16))&&e.isBuffer)b=e,e=m;b.write(e,!0);b.write('"\r\n',
0);e={escape:1};c=[];j=d.resolve(["expanded"],0);c.push(!j);e.params=c;e.fn=function(b,a){a.write('\r\nstyle="display:none"\r\n',0);return a};b=l.call(h,d,e,b,17,g);b.write("\r\n>\r\n</div>",0);return b};g.TPL_NAME=l.name;return g});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap"],function(k,f){function g(){}var l=f("component/extension/delegate-children"),d=f("event/gesture/tap");g.ATTRS={showRootNode:{value:!0,render:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};k.augment(g,l,{isTree:1,__bindUI:function(){var b=this.get("prefixCls")+"tree-node";this.$el.delegate(d.TAP,"."+b,this.handleChildrenEvents,this)},_onSetSelectedItem:function(b,d){b&&d.prevVal&&d.prevVal.set("selected",
!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(b){this.get("rowEl")[b?"show":"hide"]()}});return g});
KISSY.add("tree/check-node",["node","./node"],function(k,f){var g=f("node"),l=f("./node"),d=g.all,g=l.extend({handleClickInternal:function(b){var f=this.get("expanded"),g=this.get("expandIconEl"),h=this.get("tree"),e=d(b.target);h.focus();this.callSuper(b);if(e.equals(g))this.set("expanded",!f);else return b=this.get("checkState"),this.set("checkState",1===b?0:1),!0},_onSetCheckState:function(b){var d=this.get("parent"),f,h,e,g;f=this.getBaseCssClasses("checked").split(/\s+/).join(b+" ")+b;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(f);
(1===b||0===b)&&k.each(this.get("children"),function(d){d.set("checkState",b)});if(d){f=0;g=d.get("children");for(h=0;h<g.length;h++){e=g[h];e=e.get("checkState");if(2===e){d.set("checkState",2);return}1===e&&f++}0===f?d.set("checkState",0):f===g.length?d.set("checkState",1):d.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var b=this.get("checkIconEl");
if(b)for(var d="checked0 checked1 checked2".split(/\s+/),f=0;f<d.length;f++)if(b.hasClass(this.getBaseCssClass(d[f])))return f}},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});g.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return g});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(k,f){var g=f("./check-node"),l=f("./tree-manager");return g.extend([l],{handleKeyDownInternal:function(d){var b=this.get("selectedItem");return b===this?this.callSuper(d):b&&b.handleKeyDownInternal(d)},_onSetFocused:function(d,b){this.callSuper(d,b);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})});
