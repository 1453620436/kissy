/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 9 14:08
*/
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(i,g){var h=g("tree/control"),k=g("tree/node"),c=g("tree/check-node"),a=g("tree/check-tree");h.Node=k;h.CheckNode=c;h.CheckTree=a;return h});
KISSY.add("tree/control",["./node","./tree-manager"],function(i,g){var h=g("./node"),k=g("./tree-manager");return h.extend([k],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c){this.callSuper(c);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree"})});
KISSY.add("tree/node",["node","component/container","./node-xtpl","component/extension/content-box"],function(i,g){function h(d){if(d.target===this){var a=d.component,c=this.get("depth"),d=d.index,f=this.get("tree");f&&(n(f,a,c+1),b(this,d))}}function k(d){d.target===this&&(n(this.get("tree"),d.component),b(this,d.index))}function c(d){d.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(d){var a=d.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||
a===d}function j(d){var a=d.get("isLeaf");return!(!1===a||void 0===a&&d.get("children").length)}function f(d){var a=d.get("children");return!d.get("expanded")||!a.length?d:f(a[a.length-1])}function o(d){d.refreshCss(a(d),j(d))}function n(d,a,b){void 0!==b&&a.set("depth",b);i.each(a.get("children"),function(a){"number"===typeof b?n(d,a,b+1):n(d,a)})}function b(d,a){o(d);for(var a=Math.max(0,a-1),b=d.get("children"),c,f=b.length;a<f;a++)c=b[a],o(c),c.el.setAttribute("aria-posinset",a+1)}var e=g("node"),
p=g("component/container"),q=e.all,l=e.KeyCode,e=g("./node-xtpl"),m=g("component/extension/content-box");return p.extend([m],{beforeCreateDom:function(d){i.mix(d.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+d.id,"aria-expanded":d.expanded?"true":"false","aria-selected":d.selected?"true":"false","aria-level":d.depth,title:d.tooltip})},bindUI:function(){this.on("afterAddChild",h);this.on("afterRemoveChild",k);this.on("afterAddChild afterRemoveChild",c)},syncUI:function(){o(this);c.call(this,
{target:this})},handleKeyDownInternal:function(d){var a=!0,b=this.get("tree"),c=this.get("expanded"),e,j=this.get("isLeaf"),m=this.get("children");switch(d.keyCode){case l.ENTER:return this.handleClickInternal(d);case l.HOME:e=b;break;case l.END:e=f(b);break;case l.UP:e=d=(d=this.prev())?f(d):this.get("parent");break;case l.DOWN:d=this.get("children");if(this.get("expanded")&&d.length)e=d[0];else{d=this.next();for(b=this;!d&&(b=b.get("parent"));)d=b.next();e=d}break;case l.LEFT:c&&(m.length||!1===
j)?this.set("expanded",!1):e=this.get("parent");break;case l.RIGHT:if(m.length||!1===j)c?e=m[0]:this.set("expanded",!0);break;default:a=!1}e&&e.select();return a},next:function(){var d=this.get("parent"),a;if(!d)return null;d=d.get("children");a=i.indexOf(this,d);return a===d.length-1?null:d[a+1]},prev:function(){var d=this.get("parent"),a;if(!d)return null;d=d.get("children");a=i.indexOf(this,d);return 0===a?null:d[a-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){a.stopPropagation();
var b=q(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var a=this.get("tree");a&&(n(a,this,0),b(this,0))}},refreshCss:function(a,b){var c=this.get("iconEl"),e,f,m=this.get("expandIconEl"),j=this.getChildrenContainerEl();b?(e="file-icon",f="expand-icon-{t}"):this.get("expanded")?
(e="expanded-folder-icon",f="expand-icon-{t}minus"):(e="collapsed-folder-icon",f="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(e);m[0].className=this.getBaseCssClasses(["expand-icon",i.substitute(f,{t:a?"l":"t"})]);j[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},getChildrenContainerEl:function(){return this.get("childrenEl")},_onSetExpanded:function(a){this.getChildrenContainerEl()[a?"show":"hide"]();this.el.setAttribute("aria-expanded",
a);o(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){this.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a);var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);i.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);i.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{contentTpl:{value:e},
handleGestureEvents:{value:!1},isLeaf:{render:1,sync:0,parse:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},
expanded:{sync:0,value:!1,render:1,parse:function(){return"none"!==this.get("childrenEl").css("display")}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{render:1,sync:0},focusable:{value:!1},defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree-node"})});
KISSY.add("tree/node-xtpl",[],function(i,g,h,k){i=function(c,a,j){var f=this,g=f.root.utils.callFn,h=f.root.nativeCommands["if"];a.write('<div class="',0);var b={escape:1},e=[];e.push("row");b.params=e;if((b=g(f,c,b,a,["getBaseCssClasses"],0,1))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write("\r\n     ",0);var b={escape:1},e=[],i=c.resolve(["selected"],0);e.push(i);b.params=e;b.fn=function(a,b){b.write("\r\n        ",0);var c={escape:1},d=[];d.push("selected");c.params=d;if((c=g(f,a,c,b,["getBaseCssClasses"],
0,3))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write("\r\n     ",0);return b};a=h.call(f,c,b,a,2);a.write('\r\n     ">\r\n    <div class="',0);b={escape:1};e=[];e.push("expand-icon");b.params=e;if((b=g(f,c,b,a,["getBaseCssClasses"],0,6))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('">\r\n    </div>\r\n    ',0);b={escape:1};e=[];i=c.resolve(["checkable"],0);e.push(i);b.params=e;b.fn=function(a,b){b.write('\r\n    <div class="',0);var c={escape:1},d=[],e="checked",e="checked"+a.resolve(["checkState"],0);d.push(e);
c.params=d;if((c=g(f,a,c,b,["getBaseCssClasses"],0,9))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write(" ",0);c={escape:1};d=[];d.push("checked");c.params=d;if((c=g(f,a,c,b,["getBaseCssClasses"],0,9))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write('"></div>\r\n    ',0);return b};a=h.call(f,c,b,a,8);a.write('\r\n    <div class="',0);b={escape:1};e=[];e.push("icon");b.params=e;if((b=g(f,c,b,a,["getBaseCssClasses"],0,11))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('">\r\n\r\n    </div>\r\n    <div class="',0);b=
{escape:1};e=[];e.push("content");b.params=e;if((b=g(f,c,b,a,["getBaseCssClasses"],0,14))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('">',0);b=c.resolve(["content"],0);a.write(b,!1);a.write('</div>\r\n</div>\r\n<div class="',0);b={escape:1};e=[];e.push("children");b.params=e;if((b=g(f,c,b,a,["getBaseCssClasses"],0,16))&&b.isBuffer)a=b,b=j;a.write(b,!0);a.write('"\r\n',0);b={escape:1};e=[];i=c.resolve(["expanded"],0);e.push(!i);b.params=e;b.fn=function(a,b){b.write('\r\nstyle="display:none"\r\n',0);
return b};a=h.call(f,c,b,a,17);a.write("\r\n>\r\n</div>",0);return a};i.TPL_NAME=k.name;i.version="5.0.0";return i});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap"],function(i,g){function h(){}var k=g("component/extension/delegate-children"),c=g("event/gesture/tap");h.ATTRS={showRootNode:{value:!0,render:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};i.augment(h,k,{isTree:1,__bindUI:function(){var a=this.get("prefixCls")+"tree-node";this.$el.delegate(c.TAP,"."+a,this.handleChildrenEvents,this)},_onSetSelectedItem:function(a,c){a&&c.prevVal&&c.prevVal.set("selected",
!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return h});
KISSY.add("tree/check-node",["node","./node"],function(i,g){var h=g("node"),k=g("./node"),c=h.all,h=k.extend({handleClickInternal:function(a){var g=this.get("expanded"),f=this.get("expandIconEl"),i=this.get("tree"),h=c(a.target);i.focus();this.callSuper(a);if(h.equals(f))this.set("expanded",!g);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),!0},_onSetCheckState:function(a){var c=this.get("parent"),f,g,h,b;f=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(f);
(1===a||0===a)&&i.each(this.get("children"),function(b){b.set("checkState",a)});if(c){f=0;b=c.get("children");for(g=0;g<b.length;g++){h=b[g];h=h.get("checkState");if(2===h){c.set("checkState",2);return}1===h&&f++}0===f?c.set("checkState",0):f===b.length?c.set("checkState",1):c.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var a=this.get("checkIconEl");
if(a)for(var c="checked0 checked1 checked2".split(/\s+/),f=0;f<c.length;f++)if(a.hasClass(this.getBaseCssClass(c[f])))return f}},defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree-node"});h.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return h});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(i,g){var h=g("./check-node"),k=g("./tree-manager");return h.extend([k],{handleKeyDownInternal:function(c){var a=this.get("selectedItem");return a===this?this.callSuper(c):a&&a.handleKeyDownInternal(c)},_onSetFocused:function(c,a){this.callSuper(c,a);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree"})});
