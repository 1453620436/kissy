/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 15 17:57
*/
KISSY.add("tree/node-xtpl",["component/extension/content-xtpl"],function(k,h,f,l){f=function(d,a,f,m){var g=this,e=g.nativeCommands,p=g.utils;if("5.0.0"!==k.version)throw Error("current xtemplate file("+g.name+")(v5.0.0) need to be recompiled using current kissy(v"+k.version+")!");var n=p.callCommand,p=e["if"],e=e.include;a.write('<div class="');var c={escape:1},j=[];j.push("row");c.params=j;if((c=n(g,d,c,a,"getBaseCssClasses",1))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write("\r\n     ");var c={escape:1},
j=[],o=d.resolve(["selected"]);j.push(o);c.params=j;c.fn=function(a,b){b.write("\r\n        ");var i={escape:1},c=[];c.push("selected");i.params=c;if((i=n(g,a,i,b,"getBaseCssClasses",3))&&i.isBuffer)b=i,i=m;b.write(i,!0);b.write("\r\n     ");return b};a=p.call(g,d,c,a,2,f);a.write('\r\n     ">\r\n    <div class="');c={escape:1};j=[];j.push("expand-icon");c.params=j;if((c=n(g,d,c,a,"getBaseCssClasses",6))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write('">\r\n    </div>\r\n    ');c={escape:1};j=[];o=d.resolve(["checkable"]);
j.push(o);c.params=j;c.fn=function(a,b){b.write('\r\n    <div class="');var i={escape:1},c=[],e="checked",e="checked"+a.resolve(["checkState"]);c.push(e);i.params=c;if((i=n(g,a,i,b,"getBaseCssClasses",9))&&i.isBuffer)b=i,i=m;b.write(i,!0);b.write(" ");i={escape:1};c=[];c.push("checked");i.params=c;if((i=n(g,a,i,b,"getBaseCssClasses",9))&&i.isBuffer)b=i,i=m;b.write(i,!0);b.write('"></div>\r\n    ');return b};a=p.call(g,d,c,a,8,f);a.write('\r\n    <div class="');c={escape:1};j=[];j.push("icon");c.params=
j;if((c=n(g,d,c,a,"getBaseCssClasses",11))&&c.isBuffer)a=c,c=m;a.write(c,!0);a.write('">\r\n\r\n    </div>\r\n    ');c={};j=[];j.push("component/extension/content-xtpl");c.params=j;h("component/extension/content-xtpl");c.params[0]=l.resolve(c.params[0]);if((e=e.call(g,d,c,a,14,f))&&e.isBuffer)a=e,e=m;a.write(e,!1);a.write('\r\n</div>\r\n<div class="');e={escape:1};c=[];c.push("children");e.params=c;if((e=n(g,d,e,a,"getBaseCssClasses",16))&&e.isBuffer)a=e,e=m;a.write(e,!0);a.write('"\r\n');e={escape:1};
c=[];j=d.resolve(["expanded"]);c.push(!j);e.params=c;e.fn=function(a,b){b.write('\r\nstyle="display:none"\r\n');return b};a=p.call(g,d,e,a,17,f);a.write("\r\n>\r\n</div>");return a};f.TPL_NAME=l.name;return f});
KISSY.add("tree/node",["node","component/container","./node-xtpl","component/extension/content-box"],function(k,h){function f(b){if(b.target===this){var a=b.component,c=this.get("depth"),b=b.index,d=this.get("tree");d&&(e(d,a,c+1),p(this,b))}}function l(b){b.target===this&&(e(this.get("tree"),b.component),p(this,b.index))}function d(b){b.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function a(b){var a=b.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||
a===b}function q(b){var a=b.get("isLeaf");return!(!1===a||void 0===a&&b.get("children").length)}function m(b){var a=b.get("children");return!b.get("expanded")||!a.length?b:m(a[a.length-1])}function g(b){b.refreshCss(a(b),q(b))}function e(b,a,c){void 0!==c&&a.set("depth",c);k.each(a.get("children"),function(a){"number"===typeof c?e(b,a,c+1):e(b,a)})}function p(b,a){g(b);for(var a=Math.max(0,a-1),c=b.get("children"),e,d=c.length;a<d;a++)e=c[a],g(e),e.el.setAttribute("aria-posinset",a+1)}var n=h("node"),
c=h("component/container"),j=n.all,o=n.KeyCode,n=h("./node-xtpl"),r=h("component/extension/content-box");return c.extend([r],{beforeCreateDom:function(b){k.mix(b.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+b.id,"aria-expanded":b.expanded?"true":"false","aria-selected":b.selected?"true":"false","aria-level":b.depth,title:b.tooltip})},bindUI:function(){this.on("afterAddChild",f);this.on("afterRemoveChild",l);this.on("afterAddChild afterRemoveChild",d)},syncUI:function(){g(this);d.call(this,
{target:this})},handleKeyDownInternal:function(b){var a=!0,c=this.get("tree"),e=this.get("expanded"),d,f=this.get("isLeaf"),g=this.get("children");switch(b.keyCode){case o.ENTER:return this.handleClickInternal(b);case o.HOME:d=c;break;case o.END:d=m(c);break;case o.UP:d=b=(b=this.prev())?m(b):this.get("parent");break;case o.DOWN:b=this.get("children");if(this.get("expanded")&&b.length)d=b[0];else{b=this.next();for(c=this;!b&&(c=c.get("parent"));)b=c.next();d=b}break;case o.LEFT:e&&(g.length||!1===
f)?this.set("expanded",!1):d=this.get("parent");break;case o.RIGHT:if(g.length||!1===f)e?d=g[0]:this.set("expanded",!0);break;default:a=!1}d&&d.select();return a},next:function(){var b=this.get("parent"),a;if(!b)return null;b=b.get("children");a=k.indexOf(this,b);return a===b.length-1?null:b[a+1]},prev:function(){var b=this.get("parent"),a;if(!b)return null;b=b.get("children");a=k.indexOf(this,b);return 0===a?null:b[a-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(b){b.stopPropagation();
var a=j(b.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(b);a.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var b=this.get("tree");b&&(e(b,this,0),p(this,0))}},refreshCss:function(b,a){var c=this.get("iconEl"),d,e,f=this.get("expandIconEl"),g=this.getChildrenContainerEl();a?(d="file-icon",e="expand-icon-{t}"):this.get("expanded")?
(d="expanded-folder-icon",e="expand-icon-{t}minus"):(d="collapsed-folder-icon",e="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(d);f[0].className=this.getBaseCssClasses(["expand-icon",k.substitute(e,{t:b?"l":"t"})]);g[0].className=this.getBaseCssClasses(b?"lchildren":"children")},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},getChildrenContainerEl:function(){return this.get("childrenEl")},_onSetExpanded:function(a){this.getChildrenContainerEl()[a?"show":"hide"]();this.el.setAttribute("aria-expanded",
a);g(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,c){this.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a);var d=this.get("tree");if(!c||!c.byPassSetTreeSelectedItem)d.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);k.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);k.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{contentTpl:{value:n},
handleGestureEvents:{value:!1},isLeaf:{render:1,sync:0,parse:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},
expanded:{sync:0,value:!1,render:1,parse:function(){return"none"!==this.get("childrenEl").css("display")}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{render:1,sync:0},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap"],function(k,h){function f(){}var l=h("component/extension/delegate-children"),d=h("event/gesture/tap");f.ATTRS={showRootNode:{value:!0,render:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};k.augment(f,l,{isTree:1,__bindUI:function(){var a=this.get("prefixCls")+"tree-node";this.$el.delegate(d.TAP,"."+a,this.handleChildrenEvents,this)},_onSetSelectedItem:function(a,d){a&&d.prevVal&&d.prevVal.set("selected",
!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return f});
KISSY.add("tree/control",["./node","./tree-manager"],function(k,h){var f=h("./node"),l=h("./tree-manager");return f.extend([l],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d){this.callSuper(d);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})});
KISSY.add("tree/check-node",["node","./node"],function(k,h){var f=h("node"),l=h("./node"),d=f.all,f=l.extend({handleClickInternal:function(a){var f=this.get("expanded"),m=this.get("expandIconEl"),g=this.get("tree"),e=d(a.target);g.focus();this.callSuper(a);if(e.equals(m))this.set("expanded",!f);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),!0},_onSetCheckState:function(a){var d=this.get("parent"),f,g,e,h;f=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(f);
(1===a||0===a)&&k.each(this.get("children"),function(d){d.set("checkState",a)});if(d){f=0;h=d.get("children");for(g=0;g<h.length;g++){e=h[g];e=e.get("checkState");if(2===e){d.set("checkState",2);return}1===e&&f++}0===f?d.set("checkState",0):f===h.length?d.set("checkState",1):d.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var a=this.get("checkIconEl");
if(a)for(var d="checked0 checked1 checked2".split(/\s+/),f=0;f<d.length;f++)if(a.hasClass(this.getBaseCssClass(d[f])))return f}},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});f.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return f});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(k,h){var f=h("./check-node"),l=h("./tree-manager");return f.extend([l],{handleKeyDownInternal:function(d){var a=this.get("selectedItem");return a===this?this.callSuper(d):a&&a.handleKeyDownInternal(d)},_onSetFocused:function(d,a){this.callSuper(d,a);d&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})});
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(k,h){var f=h("tree/control"),l=h("tree/node"),d=h("tree/check-node"),a=h("tree/check-tree");f.Node=l;f.CheckNode=d;f.CheckTree=a;return f});
