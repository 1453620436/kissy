/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:29
*/
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(l,f){var g=f("tree/control"),k=f("tree/node"),c=f("tree/check-node"),b=f("tree/check-tree");g.Node=k;g.CheckNode=c;g.CheckTree=b;return g});
KISSY.add("tree/control",["./node","./tree-manager"],function(l,f){var g=f("./node"),k=f("./tree-manager");return g.extend([k],{handleKeyDownInternal:function(c){var b=this.get("selectedItem");return b===this?this.callSuper(c):b&&b.handleKeyDownInternal(c)},_onSetFocused:function(c){this.callSuper(c);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree"})});
KISSY.add("tree/node",["node","component/container","util","./node-xtpl","component/extension/content-box"],function(l,f){function g(d){if(d.target===this){var b=d.component,c=this.get("depth"),d=d.index,e=this.get("tree");e&&(o(e,b,c+1),a(this,d))}}function k(d){d.target===this&&(o(this.get("tree"),d.component),a(this,d.index))}function c(d){d.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function b(d){var a=d.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-
1];return!a||a===d}function j(d){var a=d.get("isLeaf");return!(!1===a||void 0===a&&d.get("children").length)}function i(d){var a=d.get("children");return!d.get("expanded")||!a.length?d:i(a[a.length-1])}function h(d){d.refreshCss(b(d),j(d))}function o(d,a,b){void 0!==b&&a.set("depth",b);m.each(a.get("children"),function(a){"number"===typeof b?o(d,a,b+1):o(d,a)})}function a(d,a){h(d);for(var a=Math.max(0,a-1),b=d.get("children"),e,c=b.length;a<c;a++)e=b[a],h(e),e.el.setAttribute("aria-posinset",a+1)}
var e=f("node"),p=f("component/container"),m=f("util"),q=e.all,n=e.KeyCode,e=f("./node-xtpl"),r=f("component/extension/content-box");return p.extend([r],{beforeCreateDom:function(d){m.mix(d.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+d.id,"aria-expanded":d.expanded?"true":"false","aria-selected":d.selected?"true":"false","aria-level":d.depth,title:d.tooltip})},bindUI:function(){this.on("afterAddChild",g);this.on("afterRemoveChild",k);this.on("afterAddChild afterRemoveChild",c)},syncUI:function(){h(this);
c.call(this,{target:this})},handleKeyDownInternal:function(d){var a=!0,b=this.get("tree"),e=this.get("expanded"),c,j=this.get("isLeaf"),h=this.get("children");switch(d.keyCode){case n.ENTER:return this.handleClickInternal(d);case n.HOME:c=b;break;case n.END:c=i(b);break;case n.UP:c=d=(d=this.prev())?i(d):this.get("parent");break;case n.DOWN:d=this.get("children");if(this.get("expanded")&&d.length)c=d[0];else{d=this.next();for(b=this;!d&&(b=b.get("parent"));)d=b.next();c=d}break;case n.LEFT:e&&(h.length||
!1===j)?this.set("expanded",!1):c=this.get("parent");break;case n.RIGHT:if(h.length||!1===j)e?c=h[0]:this.set("expanded",!0);break;default:a=!1}c&&c.select();return a},next:function(){var d=this.get("parent"),a;if(!d)return null;d=d.get("children");a=m.indexOf(this,d);return a===d.length-1?null:d[a+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=m.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){a.stopPropagation();
var b=q(a.target),c=this.get("expanded");this.get("tree").focus();this.callSuper(a);b.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var d=this.get("tree");d&&(o(d,this,0),a(this,0))}},refreshCss:function(a,b){var c=this.get("iconEl"),e,j,i=this.get("expandIconEl"),h=this.getChildrenContainerEl();b?(e="file-icon",j="expand-icon-{t}"):this.get("expanded")?
(e="expanded-folder-icon",j="expand-icon-{t}minus"):(e="collapsed-folder-icon",j="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(e);i[0].className=this.getBaseCssClasses(["expand-icon",m.substitute(j,{t:a?"l":"t"})]);h[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},getChildrenContainerEl:function(){return this.get("childrenEl")},_onSetExpanded:function(a){this.getChildrenContainerEl()[a?"show":"hide"]();this.el.setAttribute("aria-expanded",
a);h(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){this.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a);var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);m.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);m.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{contentTpl:{value:e},
handleGestureEvents:{value:!1},isLeaf:{render:1,sync:0,parse:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},
expanded:{sync:0,value:!1,render:1,parse:function(){return"none"!==this.get("childrenEl").css("display")}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{render:1,sync:0},focusable:{value:!1},defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree-node"})});
KISSY.add("tree/node-xtpl",[],function(l,f,g,k){l=function(c,b,j){var i=this,h=i.root.utils.callFn,f=i.root.nativeCommands["if"];b.write('<div class="',0);var a={escape:1},e=[];e.push("row");a.params=e;if((a=h(i,c,a,b,["getBaseCssClasses"],0,1))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write("\r\n     ",0);var a={escape:1},e=[],g=c.resolve(["selected"],0);e.push(g);a.params=e;a.fn=function(a,b){b.write("\r\n        ",0);var c={escape:1},e=[];e.push("selected");c.params=e;if((c=h(i,a,c,b,["getBaseCssClasses"],
0,3))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write("\r\n     ",0);return b};b=f.call(i,c,a,b,2);b.write('\r\n     ">\r\n    <div class="',0);a={escape:1};e=[];e.push("expand-icon");a.params=e;if((a=h(i,c,a,b,["getBaseCssClasses"],0,6))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('">\r\n    </div>\r\n    ',0);a={escape:1};e=[];g=c.resolve(["checkable"],0);e.push(g);a.params=e;a.fn=function(a,b){b.write('\r\n    <div class="',0);var c={escape:1},e=[],d="checked",d="checked"+a.resolve(["checkState"],0);e.push(d);
c.params=e;if((c=h(i,a,c,b,["getBaseCssClasses"],0,9))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write(" ",0);c={escape:1};e=[];e.push("checked");c.params=e;if((c=h(i,a,c,b,["getBaseCssClasses"],0,9))&&c.isBuffer)b=c,c=j;b.write(c,!0);b.write('"></div>\r\n    ',0);return b};b=f.call(i,c,a,b,8);b.write('\r\n    <div class="',0);a={escape:1};e=[];e.push("icon");a.params=e;if((a=h(i,c,a,b,["getBaseCssClasses"],0,11))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('">\r\n\r\n    </div>\r\n    <div class="',0);a=
{escape:1};e=[];e.push("content");a.params=e;if((a=h(i,c,a,b,["getBaseCssClasses"],0,14))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('">',0);a=c.resolve(["content"],0);b.write(a,!1);b.write('</div>\r\n</div>\r\n<div class="',0);a={escape:1};e=[];e.push("children");a.params=e;if((a=h(i,c,a,b,["getBaseCssClasses"],0,16))&&a.isBuffer)b=a,a=j;b.write(a,!0);b.write('"\r\n',0);a={escape:1};e=[];g=c.resolve(["expanded"],0);e.push(!g);a.params=e;a.fn=function(a,b){b.write('\r\nstyle="display:none"\r\n',0);
return b};b=f.call(i,c,a,b,17);b.write("\r\n>\r\n</div>",0);return b};l.TPL_NAME=k.name;l.version="5.0.0";return l});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap","util"],function(l,f){function g(){}var k=f("component/extension/delegate-children"),c=f("event/gesture/tap"),b=f("util");g.ATTRS={showRootNode:{value:!0,render:1},selectedItem:{},focusable:{value:!0},handleGestureEvents:{value:!0}};b.augment(g,k,{isTree:1,__bindUI:function(){var b=this.get("prefixCls")+"tree-node";this.$el.delegate(c.TAP,"."+b,this.handleChildrenEvents,this)},_onSetSelectedItem:function(b,
c){b&&c.prevVal&&c.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(b){this.get("rowEl")[b?"show":"hide"]()}});return g});
KISSY.add("tree/check-node",["node","./node","util"],function(l,f){var g=f("node"),k=f("./node"),c=f("util"),b=g.all,g=k.extend({handleClickInternal:function(c){var i=this.get("expanded"),h=this.get("expandIconEl"),f=this.get("tree"),a=b(c.target);f.focus();this.callSuper(c);if(a.equals(h))this.set("expanded",!i);else return c=this.get("checkState"),this.set("checkState",1===c?0:1),!0},_onSetCheckState:function(b){var f=this.get("parent"),h,g,a,e;h=this.getBaseCssClasses("checked").split(/\s+/).join(b+
" ")+b;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(h);(1===b||0===b)&&c.each(this.get("children"),function(a){a.set("checkState",b)});if(f){h=0;e=f.get("children");for(g=0;g<e.length;g++){a=e[g];a=a.get("checkState");if(2===a){f.set("checkState",2);return}1===a&&h++}0===h?f.set("checkState",0):h===e.length?f.set("checkState",1):f.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,
render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var b=this.get("checkIconEl");if(b)for(var c="checked0 checked1 checked2".split(/\s+/),f=0;f<c.length;f++)if(b.hasClass(this.getBaseCssClass(c[f])))return f}},defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree-node"});g.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return g});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(l,f){var g=f("./check-node"),k=f("./tree-manager");return g.extend([k],{handleKeyDownInternal:function(c){var b=this.get("selectedItem");return b===this?this.callSuper(c):b&&b.handleKeyDownInternal(c)},_onSetFocused:function(c,b){this.callSuper(c,b);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree"})});
