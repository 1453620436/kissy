/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Aug 26 16:11
*/
KISSY.add("tree",["tree/control","tree/node","tree/check-node","tree/check-tree"],function(f,a,k,h){var f=a("tree/control"),k=a("tree/node"),l=a("tree/check-node"),a=a("tree/check-tree");f.Node=k;f.CheckNode=l;f.CheckTree=a;h.exports=f});
KISSY.add("tree/control",["./node","./tree-manager"],function(f,a,k,h){f=a("./node");a=a("./tree-manager");h.exports=f.extend([a],{handleKeyDownInternal:function(a){var d=this.get("selectedItem");return d===this?this.callSuper(a):d&&d.handleKeyDownInternal(a)},_onSetFocused:function(a){this.callSuper(a);a&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree"})});
KISSY.add("tree/node","component/container,util,node,node,./node-xtpl,component/extension/content-box".split(","),function(f,a,k,h){function l(b){if(b.target===this){var q=b.component,d=this.get("depth"),b=b.index,a=this.get("tree");if(a){c(a,q,d+1);g(this,b)}}}function d(b){if(b.target===this){c(this.get("tree"),b.component);g(this,b.index)}}function j(b){b.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function i(b){var c=b.get("parent"),c=(c=c&&c.get("children"))&&
c[c.length-1];return!c||c===b}function e(b){var c=b.get("isLeaf");return!(c===false||c===void 0&&b.get("children").length)}function p(b){var c=b.get("children");return!b.get("expanded")||!c.length?b:p(c[c.length-1])}function m(b){b.refreshCss(i(b),e(b))}function c(b,d,a){a!==void 0&&d.set("depth",a);n.each(d.get("children"),function(d){typeof a==="number"?c(b,d,a+1):c(b,d)})}function g(b,c){m(b);for(var c=Math.max(0,c-1),d=b.get("children"),a,e=d.length;c<e;c++){a=d[c];m(a);a.el.setAttribute("aria-posinset",
c+1)}}var f=a("component/container"),n=a("util"),r=a("node"),o=a("node").Event.KeyCode,k=a("./node-xtpl"),a=a("component/extension/content-box");h.exports=f.extend([a],{beforeCreateDom:function(b){n.mix(b.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+b.id,"aria-expanded":b.expanded?"true":"false","aria-selected":b.selected?"true":"false","aria-level":b.depth,title:b.tooltip})},bindUI:function(){this.on("afterAddChild",l);this.on("afterRemoveChild",d);this.on("afterAddChild afterRemoveChild",
j)},syncUI:function(){m(this);j.call(this,{target:this})},handleKeyDownInternal:function(b){var c=true,d=this.get("tree"),a=this.get("expanded"),e,j=this.get("isLeaf"),i=this.get("children");switch(b.keyCode){case o.ENTER:return this.handleClickInternal(b);case o.HOME:e=d;break;case o.END:e=p(d);break;case o.UP:e=b=(b=this.prev())?p(b):this.get("parent");break;case o.DOWN:b=this.get("children");if(this.get("expanded")&&b.length)e=b[0];else{b=this.next();for(d=this;!b&&(d=d.get("parent"));)b=d.next();
e=b}break;case o.LEFT:a&&(i.length||j===false)?this.set("expanded",false):e=this.get("parent");break;case o.RIGHT:if(i.length||j===false)a?e=i[0]:this.set("expanded",true);break;default:c=false}e&&e.select();return c},next:function(){var b=this.get("parent"),c;if(!b)return null;b=b.get("children");c=n.indexOf(this,b);return c===b.length-1?null:b[c+1]},prev:function(){var b=this.get("parent"),c;if(!b)return null;b=b.get("children");c=n.indexOf(this,b);return c===0?null:b[c-1]},select:function(){this.set("selected",
true)},handleClickInternal:function(b){b.stopPropagation();var c=r(b.target),d=this.get("expanded");this.get("tree").focus();this.callSuper(b);if(c.equals(this.get("expandIconEl")))this.set("expanded",!d);else{this.select();this.fire("click",{domEvent:b})}return true},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var b=this.get("tree");if(b){c(b,this,0);g(this,0)}}},refreshCss:function(b,c){var d=this.get("iconEl"),a,e,i=this.get("expandIconEl"),j=
this.getChildrenContainerEl();if(c){a="file-icon";e="expand-icon-{t}"}else if(this.get("expanded")){a="expanded-folder-icon";e="expand-icon-{t}minus"}else{a="collapsed-folder-icon";e="expand-icon-{t}plus"}d[0].className=this.getBaseCssClasses(a);i[0].className=this.getBaseCssClasses(["expand-icon",n.substitute(e,{t:b?"l":"t"})]);j[0].className=this.getBaseCssClasses(b?"lchildren":"children")},_onSetDepth:function(b){this.el.setAttribute("aria-level",b)},getChildrenContainerEl:function(){return this.get("childrenEl")},
_onSetExpanded:function(b){this.getChildrenContainerEl()[b?"show":"hide"]();this.el.setAttribute("aria-expanded",b);m(this);this.fire(b?"expand":"collapse")},_onSetSelected:function(b,c){this.get("rowEl")[b?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",b);var d=this.get("tree");if(!c||!c.byPassSetTreeSelectedItem)d.set("selectedItem",b?this:null)},expandAll:function(){this.set("expanded",true);n.each(this.get("children"),function(b){b.expandAll()})},
collapseAll:function(){this.set("expanded",false);n.each(this.get("children"),function(b){b.collapseAll()})}},{ATTRS:{allowTextSelection:{value:true},focusable:{value:false},handleGestureEvents:{value:false},contentTpl:{value:k},isLeaf:{render:1,sync:0,parse:function(b){if(b.hasClass(this.getBaseCssClass("leaf")))return true;if(b.hasClass(this.getBaseCssClass("folder")))return false}},rowEl:{selector:function(){return"."+this.getBaseCssClass("row")}},childrenEl:{selector:function(){return"."+this.getBaseCssClass("children")}},
expandIconEl:{selector:function(){return"."+this.getBaseCssClass("expand-icon")}},iconEl:{selector:function(){return"."+this.getBaseCssClass("icon")}},selected:{render:1,sync:0},expanded:{sync:0,value:false,render:1,parse:function(){return this.get("childrenEl").css("display")!=="none"}},tooltip:{render:1,sync:0},tree:{getter:function(){for(var b=this;b&&!b.isTree;)b=b.get("parent");return b}},depth:{render:1,sync:0},defaultChildCfg:{valueFn:function(){return{xclass:"tree-node"}}}},xclass:"tree-node"})});
KISSY.add("tree/node-xtpl",[],function(f,a,k,h){h.exports=function(a,d,j){var i=this,e=i.pos={line:1,col:1},f=i.root.utils.callFn,m=i.root.nativeCommands["if"];d.append('<div class="');var c={escape:1},g=[];g.push("row");c.params=g;e.line=1;e.col=33;if((c=f(i,a,c,d,["getBaseCssClasses"]))&&c.isBuffer)d=c,c=j;d.writeEscaped(c);d.append("\r\n     ");var c={escape:1},g=[],h=a.resolve(["selected"]);g.push(h);c.params=g;c.fn=function(c,a){a.append("\r\n        ");var b={escape:1},d=[];d.push("selected");
b.params=d;e.line=3;e.col=28;if((b=f(i,c,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=j;a.writeEscaped(b);a.append("\r\n     ");return a};e.line=2;e.col=11;d=m.call(i,a,c,d);d.append('\r\n     ">\r\n    <div class="');c={escape:1};g=[];g.push("expand-icon");c.params=g;e.line=6;e.col=36;if((c=f(i,a,c,d,["getBaseCssClasses"]))&&c.isBuffer)d=c,c=j;d.writeEscaped(c);d.append('">\r\n    </div>\r\n    ');c={escape:1};g=[];h=a.resolve(["checkable"]);g.push(h);c.params=g;c.fn=function(c,a){a.append('\r\n    <div class="');
var b={escape:1},d=[],g="checked",g="checked"+c.resolve(["checkState"]);d.push(g);b.params=d;e.line=9;e.col=36;if((b=f(i,c,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=j;a.writeEscaped(b);a.append(" ");b={escape:1};d=[];d.push("checked");b.params=d;e.line=9;e.col=81;if((b=f(i,c,b,a,["getBaseCssClasses"]))&&b.isBuffer)a=b,b=j;a.writeEscaped(b);a.append('"></div>\r\n    ');return a};e.line=8;e.col=10;d=m.call(i,a,c,d);d.append('\r\n    <div class="');c={escape:1};g=[];g.push("icon");c.params=g;e.line=
11;e.col=36;if((c=f(i,a,c,d,["getBaseCssClasses"]))&&c.isBuffer)d=c,c=j;d.writeEscaped(c);d.append('">\r\n\r\n    </div>\r\n    <div class="');c={escape:1};g=[];g.push("content");c.params=g;e.line=14;e.col=36;if((c=f(i,a,c,d,["getBaseCssClasses"]))&&c.isBuffer)d=c,c=j;d.writeEscaped(c);d.append('">');c=a.resolve(["content"]);d.write(c);d.append('</div>\r\n</div>\r\n<div class="');c={escape:1};g=[];g.push("children");c.params=g;e.line=16;e.col=32;if((c=f(i,a,c,d,["getBaseCssClasses"]))&&c.isBuffer)d=
c,c=j;d.writeEscaped(c);d.append('"\r\n');c={escape:1};g=[];h=a.resolve(["expanded"]);g.push(!h);c.params=g;c.fn=function(c,a){a.append('\r\nstyle="display:none"\r\n');return a};e.line=17;e.col=6;d=m.call(i,a,c,d);d.append("\r\n>\r\n</div>");return d};h.exports.TPL_NAME=h.name});
KISSY.add("tree/tree-manager",["component/extension/delegate-children","event/gesture/tap","util"],function(f,a,k,h){function l(){}var f=a("component/extension/delegate-children"),d=a("event/gesture/tap"),a=a("util");l.ATTRS={allowTextSelection:{value:!0},focusable:{value:!0},handleGestureEvents:{value:!0},showRootNode:{value:!0,render:1},selectedItem:{}};a.augment(l,f,{isTree:1,__bindUI:function(){var a=this.get("prefixCls")+"tree-node";this.$el.delegate(d.TAP,"."+a,this.handleChildrenEvents,this)},
_onSetSelectedItem:function(a,d){a&&d.prevVal&&d.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});h.exports=l});
KISSY.add("tree/check-node",["./node","util","node"],function(f,a,k,h){var f=a("./node"),l=a("util"),d=a("node"),a=f.extend({handleClickInternal:function(a){var i=this.get("expanded"),e=this.get("expandIconEl"),f=this.get("tree"),h=d(a.target);f.focus();this.callSuper(a);if(h.equals(e))this.set("expanded",!i);else return a=this.get("checkState"),this.set("checkState",1===a?0:1),!0},_onSetCheckState:function(a){var d=this.get("parent"),e,f,h,c;e=this.getBaseCssClasses("checked").split(/\s+/).join(a+
" ")+a;this.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(e);(1===a||0===a)&&l.each(this.get("children"),function(c){c.set("checkState",a)});if(d){e=0;c=d.get("children");for(f=0;f<c.length;f++){h=c[f];h=h.get("checkState");if(2===h){d.set("checkState",2);return}1===h&&e++}0===e?d.set("checkState",0):e===c.length?d.set("checkState",1):d.set("checkState",2)}}},{ATTRS:{checkIconEl:{selector:function(){return"."+this.getBaseCssClass("checked")}},checkable:{value:!0,
render:1,sync:0},checkState:{value:0,sync:0,render:1,parse:function(){var a=this.get("checkIconEl");if(a)for(var d="checked0 checked1 checked2".split(/\s+/),e=0;e<d.length;e++)if(a.hasClass(this.getBaseCssClass(d[e])))return e}},defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree-node"});a.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};h.exports=a});
KISSY.add("tree/check-tree",["./check-node","./tree-manager"],function(f,a,k,h){f=a("./check-node");a=a("./tree-manager");h.exports=f.extend([a],{handleKeyDownInternal:function(a){var d=this.get("selectedItem");return d===this?this.callSuper(a):d&&d.handleKeyDownInternal(a)},_onSetFocused:function(a,d){this.callSuper(a,d);a&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{valueFn:function(){return{xclass:"check-tree-node"}}}},xclass:"check-tree"})});
