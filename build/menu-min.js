/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:49
*/
KISSY.add("menu/menu-render",["component/container"],function(e,a){return a("component/container").getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role="menu"},containsElement:function(a){var b=this.$el;return b&&(b[0]===a||b.contains(a))}})});
KISSY.add("menu/control",["node","component/container","component/extension/delegate-children","./menu-render"],function(e,a){function c(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var b=a("node"),g=a("component/container"),d=a("component/extension/delegate-children"),h=a("./menu-render"),i=b.KeyCode;return g.extend([d],{isMenu:1,_onSetHighlightedItem:function(a,f){var b;a&&f&&(b=f.prevVal)&&b.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},
_onSetVisible:function(a,f){this.callSuper(f);var b;!a&&(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",c,this)},getRootMenu:function(){return this},handleMouseEnterInternal:function(a){this.callSuper(a);if((a=this.getRootMenu())&&a._popupAutoHideTimer)clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(a){this.callSuper(a);var f;(f=this.get("highlightedItem"))&&f.set("highlighted",
!1)},_getNextEnabledHighlighted:function(a,f){var b=this.get("children"),d=b.length,c=a;do{var h=b[a];if(!h.get("disabled")&&!1!==h.get("visible"))return b[a];a=(a+f+d)%d}while(a!=c)},handleKeyDownInternal:function(a){var f=this.get("highlightedItem");if(f&&f.handleKeyDownInternal(a))return!0;var b=this.get("children"),d=b.length;if(0!==d){var c;switch(a.keyCode){case i.ESC:(f=this.get("highlightedItem"))&&f.set("highlighted",!1);break;case i.HOME:c=this._getNextEnabledHighlighted(0,1);break;case i.END:c=
this._getNextEnabledHighlighted(d-1,-1);break;case i.UP:f?(a=e.indexOf(f,b),d=(a-1+d)%d):d-=1;c=this._getNextEnabledHighlighted(d,-1);break;case i.DOWN:f?(a=e.indexOf(f,b),d=(a+1+d)%d):d=0,c=this._getNextEnabledHighlighted(d,1)}if(c)return c.set("highlighted",!0,{data:{fromKeyboard:1}}),!0}},containsElement:function(a){if(!this.get("visible")||!this.$el)return!1;if(this.view.containsElement(a))return!0;for(var f=this.get("children"),b=0,d=f.length;b<d;b++){var c=f[b];if(c.containsElement&&c.containsElement(a))return!0}return!1}},
{ATTRS:{highlightedItem:{value:null},xrender:{value:h},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"})});
KISSY.add("menu/menuitem-render",["component/control"],function(e,a){return a("component/control").getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role=a.selectable?"menuitemradio":"menuitem";a.selected&&a.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(a){var b=this.getBaseCssClasses("selected");this.$el[a?"addClass":"removeClass"](b)},containsElement:function(a){var b=this.$el;return b&&(b[0]==a||b.contains(a))}},{HTML_PARSER:{selectable:function(a){return a.hasClass(this.getBaseCssClass("selectable"))}}})});
KISSY.add("menu/menuitem",["component/control","./menuitem-render","node"],function(e,a){var c=a("component/control"),b=a("./menuitem-render"),g=a("node").all;return c.extend({isMenuItem:1,handleClickInternal:function(){this.callSuper();this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(a,b){var c=this.get("parent");if(!b||!b.byPassSetHighlightedItem)this.get("rendered")?c.set("highlightedItem",a?this:null):a&&c.set("highlightedItem",this);if(a){var e=
this.$el;(c=e.parent(function(a){return"visible"!=g(a).css("overflow")},c.get("el").parent()))&&e.scrollIntoView(c,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:b}},xclass:"menuitem"})});
KISSY.add("menu/check-menuitem-xtpl",["component/extension/content-xtpl"],function(e,a,c,b){return function(c,d,h){var e,d=this.config.utils;"undefined"!=typeof b&&b.kissy&&(e=b);var j=d.getPropertyOrRunCommand,d='<div class="',f={},k=[];k.push("checkbox");f.params=k;f=j(this,c,f,"getBaseCssClasses",0,1,!0,h);d=d+f+'">\n</div>\n';f={};k=[];k.push("component/extension/content-xtpl");f.params=k;e&&(a("component/extension/content-xtpl"),f.params[0]=e.resolveByName(f.params[0]));c=j(this,c,f,"include",
0,3,!1,h);return d+c}});KISSY.add("menu/check-menuitem-render",["./menuitem-render","component/extension/content-render","./check-menuitem-xtpl"],function(e,a){var c=a("./menuitem-render"),b=a("component/extension/content-render"),g=a("./check-menuitem-xtpl");return c.extend([b],{beforeCreateDom:function(a){a.checked&&a.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var b=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](b)}},{ATTRS:{contentTpl:{value:g}}})});
KISSY.add("menu/check-menuitem",["./menuitem","./check-menuitem-render"],function(e,a){var c=a("./menuitem"),b=a("./check-menuitem-render");return c.extend({handleClickInternal:function(){this.callSuper();this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:b}},xclass:"check-menuitem"})});
KISSY.add("menu/submenu-xtpl",[],function(){return function(e,a,c){var b;b=this.config.utils;var a=b.getExpression,g=b.getPropertyOrRunCommand;b='<div id="ks-content-';var d=g(this,e,{},"id",0,1,c,!1);b+=a(d,!0);b+='"\n     class="';var d={},h=[];h.push("content");d.params=h;d=g(this,e,d,"getBaseCssClasses",0,2,!0,c);b=b+d+'">';d=g(this,e,{},"content",0,2,c,!1);b+=a(d,!1);b+='</div>\n<span class="';e=g(this,e,{},"prefixCls",0,3,c,!1);b+=a(e,!0);return b+'submenu-arrow">\u25ba</span>'}});
KISSY.add("menu/submenu-render",["./submenu-xtpl","./menuitem-render","component/extension/content-render"],function(e,a){var c=a("./submenu-xtpl"),b=a("./menuitem-render"),g=a("component/extension/content-render");return b.extend([g],{decorateDom:function(a){var b=this.control,c=b.get("prefixCls"),a=a.one("."+c+"popupmenu"),e=a[0].ownerDocument.body;e.insertBefore(a[0],e.firstChild);e=this.getComponentConstructorByNode(c,a);b.setInternal("menu",new e({srcNode:a,prefixCls:c}))}},{ATTRS:{contentTpl:{value:c}}})});
KISSY.add("menu/submenu",["node","./menuitem","./submenu-render"],function(e,a){function c(a){var b=a.target;b!==this&&b.isMenuItem&&a.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),b.set("highlighted",!1),b.set("highlighted",!0)))}function b(){var a=this.get("menu"),b={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};e.mix(a.get("align"),b,!1);a.show();this.el.setAttribute("aria-haspopup",a.get("el").attr("id"))}function g(){this.get("menu").hide()}
var d=a("node"),h=a("./menuitem"),i=a("./submenu-render"),j=d.KeyCode;return h.extend({isSubMenu:1,clearShowPopupMenuTimers:function(){var a;if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",c,this)},handleMouseLeaveInternal:function(){this.set("highlighted",
!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=e.later(g,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=e.later(b,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,c){c&&(this.callSuper(c),c.fromMouse||(a&&!c.fromKeyboard?b.call(this):a||g.call(this)))},handleClickInternal:function(){b.call(this);
this.callSuper()},handleKeyDownInternal:function(a){var c=this.get("menu"),d,e=c.get("visible"),h=a.keyCode;if(e){if(!c.handleKeyDownInternal(a))if(h==j.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(h==j.RIGHT)b.call(this),a=c.get("children"),(d=a[0])&&d.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(h==j.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},
destructor:function(){var a=this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},xrender:{value:i}},xclass:"submenu"})});
KISSY.add("menu/popupmenu-render",["component/extension/content-render","./menu-render"],function(e,a){var c=a("component/extension/content-render");return a("./menu-render").extend([c])});
KISSY.add("menu/popupmenu",["component/extension/align","component/extension/shim","./control","./popupmenu-render"],function(e,a){var c=a("component/extension/align"),b=a("component/extension/shim"),g=a("./control"),d=a("./popupmenu-render");return g.extend([b,c],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var b=this.getRootMenu();
b&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=setTimeout(function(){var a;(a=b.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{},visible:{value:!1},xrender:{value:d}},xclass:"popupmenu"})});
KISSY.add("menu",["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"],function(e,a){var c=a("menu/control"),b=a("menu/menuitem"),g=a("menu/check-menuitem"),d=a("menu/submenu"),h=a("menu/popupmenu");c.Item=b;c.CheckItem=g;c.SubMenu=d;c.PopupMenu=h;return c});
