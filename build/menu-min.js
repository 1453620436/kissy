/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 11 14:24
*/
KISSY.add("menu/menu-render",function(i,d){return d.getDefaultRender().extend({beforeCreateDom:function(d){d.elAttrs.role="menu"},containsElement:function(d){var c=this.$el;return c&&(c[0]===d||c.contains(d))}})},{requires:["component/container"]});
KISSY.add("menu/control",function(i,d,h,c,a,j){function f(b){b.target.isMenu&&(b=b.newVal,this.el.setAttribute("aria-activedescendant",b&&b.el.id||""))}var g=d.KeyCode;return h.extend([c],{isMenu:1,_onSetHighlightedItem:function(b,k){var a;b&&k&&(a=k.prevVal)&&a.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(b,k){this.callSuper(k);var a;!b&&(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",f,this)},getRootMenu:function(){return this},
handleMouseEnterInternal:function(b){this.callSuper(b);if((b=this.getRootMenu())&&b._popupAutoHideTimer)clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(b){this.callSuper(b);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(b,a){var d=this.get("children"),c=d.length,f=b;do{var g=d[b];if(!g.get("disabled")&&!1!==g.get("visible"))return d[b];b=(b+a+c)%c}while(b!=f);return j},handleKeyDownInternal:function(b){var a=
this.get("highlightedItem");if(a&&a.handleKeyDownInternal(b))return!0;var d=this.get("children"),c=d.length;if(0===c)return j;var f;switch(b.keyCode){case g.ESC:(a=this.get("highlightedItem"))&&a.set("highlighted",!1);break;case g.HOME:f=this._getNextEnabledHighlighted(0,1);break;case g.END:f=this._getNextEnabledHighlighted(c-1,-1);break;case g.UP:a?(b=i.indexOf(a,d),c=(b-1+c)%c):c-=1;f=this._getNextEnabledHighlighted(c,-1);break;case g.DOWN:a?(b=i.indexOf(a,d),c=(b+1+c)%c):c=0,f=this._getNextEnabledHighlighted(c,
1)}return f?(f.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):j},containsElement:function(b){if(!this.get("visible")||!this.$el)return!1;if(this.view.containsElement(b))return!0;for(var a=this.get("children"),c=0,d=a.length;c<d;c++){var f=a[c];if(f.containsElement&&f.containsElement(b))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:a},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"})},{requires:["node","component/container","component/extension/delegate-children",
"./menu-render"]});
KISSY.add("menu/menuitem-render",function(i,d,h){return h.getDefaultRender().extend({beforeCreateDom:function(c){c.elAttrs.role=c.selectable?"menuitemradio":"menuitem";c.selected&&c.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(c){var a=this.getBaseCssClasses("selected");this.$el[c?"addClass":"removeClass"](a)},containsElement:function(c){var a=this.$el;return a&&(a[0]==c||a.contains(c))}},{HTML_PARSER:{selectable:function(c){return c.hasClass(this.getBaseCssClass("selectable"))}}})},{requires:["node",
"component/control"]});
KISSY.add("menu/menuitem",function(i,d,h){var c=i.all;return d.extend({isMenuItem:1,handleMouseDownInternal:function(a){this.callSuper(a);this.set("highlighted",!0)},handleClickInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(a,d){var f=this.get("parent");if(!d||!d.byPassSetHighlightedItem)this.get("rendered")?f.set("highlightedItem",a?this:null):a&&f.set("highlightedItem",this);if(a){var g=this.$el;(f=g.parent(function(b){return"visible"!=
c(b).css("overflow")},f.get("el").parent()))&&g.scrollIntoView(f,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:h}},xclass:"menuitem"})},{requires:["component/control","./menuitem-render"]});KISSY.add("menu/check-menuitem-tpl","<div class=\"{{getBaseCssClasses 'checkbox'}}\">\n</div>\n{{{include 'component/extension/content-render/content-tpl'}}}");
KISSY.add("menu/check-menuitem-render",function(i,d,h,c){return d.extend([h],{beforeCreateDom:function(a){a.checked&&a.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var c=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](c)}},{ATTRS:{contentTpl:{value:c}}})},{requires:["./menuitem-render","component/extension/content-render","./check-menuitem-tpl"]});
KISSY.add("menu/check-menuitem",function(i,d,h){return d.extend({handleClickInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:h}},xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});KISSY.add("menu/submenu-tpl","{{{include 'component/extension/content-render/content-tpl'}}}\n<span class=\"{{prefixCls}}submenu-arrow\">\u25ba</span>");
KISSY.add("menu/submenu-render",function(i,d,h,c){return h.extend([c],{decorateDom:function(a){var c=this.control,d=c.get("prefixCls"),a=a.one("."+d+"popupmenu"),g=a[0].ownerDocument.body;g.insertBefore(a[0],g.firstChild);g=this.getComponentConstructorByNode(d,a);c.setInternal("menu",new g({srcNode:a,prefixCls:d}))}},{ATTRS:{contentTpl:{value:d}}})},{requires:["./submenu-tpl","./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/submenu",function(i,d,h,c){function a(b){var a=b.target;a!==this&&a.isMenuItem&&b.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),a.set("highlighted",!1),a.set("highlighted",!0)))}function j(){var b=this.get("menu"),a={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};i.mix(b.get("align"),a,!1);b.show();this.el.setAttribute("aria-haspopup",b.get("el").attr("id"))}function f(){this.get("menu").hide()}var g=d.KeyCode;return h.extend({isSubMenu:1,
clearShowPopupMenuTimers:function(){var b;if(b=this._showTimer)b.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var b;if(b=this._dismissTimer)b.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",a,this)},handleMouseLeaveInternal:function(){this.set("highlighted",!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=
i.later(f,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=i.later(j,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(b,a){a&&(this.callSuper(a),a.fromMouse||(b&&!a.fromKeyboard?j.call(this):b||f.call(this)))},handleClickInternal:function(){j.call(this);this.callSuper(e)},handleKeyDownInternal:function(b){var a=this.get("menu"),c,d=a.get("visible"),
f=b.keyCode;if(d){if(!a.handleKeyDownInternal(b))if(f==g.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(f==g.RIGHT)j.call(this),b=a.get("children"),(c=b[0])&&c.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(f==g.ENTER)return this.handleClickInternal(b);return}return!0},containsElement:function(b){return this.get("menu").containsElement(b)},destructor:function(){var b=this.get("menu");this.clearSubMenuTimers();b.destroy()}},{ATTRS:{menuDelay:{value:0.15},
menu:{value:{},getter:function(b){b.isControl||(b.xclass=b.xclass||"popupmenu",b=this.createComponent(b),this.setInternal("menu",b));return b},setter:function(b){b.isControl&&b.setInternal("parent",this)}},xrender:{value:c}},xclass:"submenu"})},{requires:["node","./menuitem","./submenu-render"]});KISSY.add("menu/popupmenu-render",function(i,d,h){return h.extend([d])},{requires:["component/extension/content-render","./menu-render"]});
KISSY.add("menu/popupmenu",function(i,d,h,c,a){return c.extend([h,d],{getRootMenu:function(){var a=this,c;do c=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return c===this?null:c},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var c=this.getRootMenu();c&&(clearTimeout(c._popupAutoHideTimer),c._popupAutoHideTimer=setTimeout(function(){var a;(a=c.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,
handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{},visible:{value:!1},xrender:{value:a}},xclass:"popupmenu"})},{requires:["component/extension/align","component/extension/shim","./control","./popupmenu-render"]});KISSY.add("menu",function(i,d,h,c,a,j){d.Item=h;d.CheckItem=c;d.SubMenu=a;d.PopupMenu=j;return d},{requires:["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"]});
