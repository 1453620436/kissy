/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 29 16:39
*/
KISSY.add("dom/selector",["./selector/parser.js","dom/basic"],function(A,D){function E(a){return a.replace(L,M)}function r(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function w(a){var b=0,c=0;if("number"===typeof a)c=a;else if("odd"===a)b=2,c=1;else if("even"===a)b=2,c=0;else if(a=a.replace(/\s/g,"").match(N))a[1]?(b=parseInt(a[2]),isNaN(b)&&(b="-"===a[2]?-1:1)):b=0,c=parseInt(a[3])||0;return{a:b,b:c}}function x(a,b,c,d){if(0===b){if(a===c)return d}else if(0<=(a-c)/b&&0===(a-c)%b&&d)return 1}
function F(a,b){return l._selectInternal(a,null,b)}function G(a,b){if(!b)return!0;if(!a||9===a.nodeType)return!1;var c=1,d=b.suffix,h,e;"tag"===b.t&&(c&=y.tag(a,b.value));if(c&&d){h=d.length;for(e=0;c&&e<h;e++){var j=d[e],g=j.t;y[g]&&(c&=y[g](a,j.value))}}return c}function O(a,b){var c=1,d=a,h,e=b;do if(c&=G(a,b)){b=b&&b.prev;if(!b)return!0;h=s[b.nextCombinator];a=r(a,h.dir);if(!h.immediate)return{el:a,match:b}}else if(h=s[b.nextCombinator],h.immediate)break;else return{el:a&&r(a,h.dir),match:b};
while(a);return{el:r(d,s[e.nextCombinator].dir),match:e}}function H(a,b){var c;if(q){if(!(c=a.getAttribute(z)))a.setAttribute(z,c=+new Date+"_"+ ++I)}else if(!(c=a[z]))c=a[z]=+new Date+"_"+ ++I;c=c+"_"+(b.order||0);if(c in t)return t[c];t[c]=P(a,b);return t[c]}function P(a,b){var c=O(a,b);if(!0===c)return!0;a=c.el;for(b=c.match;a;){if(H(a,b))return!0;a=r(a,s[b.nextCombinator].dir)}return!1}function J(a,b,c){B[a]||(B[a]=C.parse(a));var a=B[a],d=0,h=a.length,e,j,g=[];c&&(b=b||c[0].ownerDocument);e=
b&&b.ownerDocument||K;for(q=(j=(b=b||e)&&(b.ownerDocument||b).documentElement)?"html"!==j.nodeName.toLowerCase():!1;d<h;d++){t={};j=a[d];var f=j.suffix,k,i,n,p=c;n=null;if(!p){if(f&&!q){k=0;for(i=f.length;k<i;k++){var o=f[k];if("id"===o.t){n=o.value;break}}}if(n)if(k=!b.getElementById,i=l._contains(e,b),f=k?i?e.getElementById(n):null:b.getElementById(n),!f&&k||f&&u(f,"id")!==n){k=l._getElementsByTagName("*",b);i=k.length;for(o=0;o<i;o++)if(f=k[o],u(f,"id")===n){p=[f];break}o===i&&(p=[])}else i&&f&&
b!==e&&(f=l._contains(b,f)?f:null),p=f?[f]:[];else p=l._getElementsByTagName(j.value||"*",b)}n=0;if(f=p.length)for(;n<f;n++){k=p[n];a:{i=k;var o=void 0,m=j;do{if(!G(i,m)){i=null;break a}m=m.prev;if(!m){i=!0;break a}o=s[m.nextCombinator];i=r(i,o.dir)}while(i&&o.immediate);i=!i?null:{el:i,match:m}}!0===i?g.push(k):i&&H(i.el,i.match)&&g.push(k)}}1<h&&(g=l.unique(g));return g}var C=D("./selector/parser.js"),l=D("dom/basic");"use KISSY css3 selector";var K=A.Env.host.document,z="_ks_data_selector_id_",
B={},q,I=0,t={},u=function(a,b){return q?l._getSimpleAttr(a,b):l.attr(a,b)},Q=l._hasSingleClass,R=l._isTag,N=/^(([+-]?(?:\d+)?)?n)?([+-]?\d+)?$/,L=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,M=function(a,b){var c="0x"+b-65536;return isNaN(c)?b:0>c?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,c&1023|56320)};C.lexer.yy={unEscape:E,unEscapeStr:function(a){return this.unEscape(a.slice(1,-1))}};var v={"nth-child":function(a,b){var c=w(b),d=c.a,c=c.b;if(0===d&&0===c)return 0;var h=0,e=a.parentNode;
if(e)for(var e=e.childNodes,j=0,g,f=e.length;j<f;j++)if(g=e[j],1===g.nodeType&&(h++,g=x(h,d,c,g===a),void 0!==g))return g;return 0},"nth-last-child":function(a,b){var c=w(b),d=c.a,c=c.b;if(0===d&&0===c)return 0;var h=0,e=a.parentNode;if(e)for(var e=e.childNodes,j=e.length-1,g;0<=j;j--)if(g=e[j],1===g.nodeType&&(h++,g=x(h,d,c,g===a),void 0!==g))return g;return 0},"nth-of-type":function(a,b){var c=w(b),d=c.a,c=c.b;if(0===d&&0===c)return 0;var h=0,e=a.parentNode;if(e)for(var e=e.childNodes,j=a.tagName,
g=0,f,k=e.length;g<k;g++)if(f=e[g],f.tagName===j&&(h++,f=x(h,d,c,f===a),void 0!==f))return f;return 0},"nth-last-of-type":function(a,b){var c=w(b),d=c.a,c=c.b;if(0===d&&0===c)return 0;var h=0,e=a.parentNode;if(e)for(var e=e.childNodes,j=a.tagName,g=e.length-1,f;0<=g;g--)if(f=e[g],f.tagName===j&&(h++,f=x(h,d,c,f===a),void 0!==f))return f;return 0},lang:function(a,b){var c,b=E(b.toLowerCase());do if(c=q?a.getAttribute("xml:lang")||a.getAttribute("lang"):a.lang)return c=c.toLowerCase(),c===b||0===c.indexOf(b+
"-");while((a=a.parentNode)&&1===a.nodeType);return!1},not:function(a,b){return!y[b.t](a,b.value)}},m={empty:function(a){for(var a=a.childNodes,b=0,c=a.length-1,d;b<c;b++)if(d=a[b],d=d.nodeType,1===d||3===d||4===d||5===d)return 0;return 1},root:function(a){return a.ownerDocument&&a===a.ownerDocument.documentElement},"first-child":function(a){return v["nth-child"](a,1)},"last-child":function(a){return v["nth-last-child"](a,1)},"first-of-type":function(a){return v["nth-of-type"](a,1)},"last-of-type":function(a){return v["nth-last-of-type"](a,
1)},"only-child":function(a){return m["first-child"](a)&&m["last-child"](a)},"only-of-type":function(a){return m["first-of-type"](a)&&m["last-of-type"](a)},focus:function(a){var b=a.ownerDocument;return b&&a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&!(!a.type&&!(a.href||0<=a.tabIndex))},target:function(a){var b=location.hash;return b&&b.slice(1)===u(a,"id")},enabled:function(a){return!a.disabled},disabled:function(a){return a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===
b&&a.checked||"option"===b&&a.selected}},S={"~=":function(a,b){return!b||-1<b.indexOf(" ")?0:-1!==(" "+a+" ").indexOf(" "+b+" ")},"|=":function(a,b){return-1!==(" "+a).indexOf(" "+b+"-")},"^=":function(a,b){return b&&A.startsWith(a,b)},"$=":function(a,b){return b&&A.endsWith(a,b)},"*=":function(a,b){return b&&-1!==a.indexOf(b)},"=":function(a,b){return a===b}},y={tag:R,cls:Q,id:function(a,b){return u(a,"id")===b},attrib:function(a,b){var c=b.ident;q||(c=c.toLowerCase());var c=u(a,c),d=b.match;if(!d&&
void 0!==c)return 1;if(d){if(void 0===c)return 0;if(d=S[d])return d(c+"",b.value+"")}return 0},pseudo:function(a,b){var c,d;if(d=b.fn){if(!(c=v[d]))throw new SyntaxError("Syntax error: not support pseudo: "+d);return c(a,b.param)}if(c=b.ident){if(!m[c])throw new SyntaxError("Syntax error: not support pseudo: "+c);return m[c](a)}return 0}},s={">":{dir:"parentNode",immediate:1}," ":{dir:"parentNode"},"+":{dir:"previousSibling",immediate:1},"~":{dir:"previousSibling"}};"sourceIndex"in K.documentElement&&
(l._compareNodeOrder=function(a,b){return a.sourceIndex-b.sourceIndex});l._matchesInternal=F;l._selectInternal=J;return{parse:function(a){return C.parse(a)},select:J,matches:F}});
