/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 8 11:54
*/
KISSY.add("menu",["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"],function(i,b){var g=b("menu/control"),f=b("menu/menuitem"),d=b("menu/check-menuitem"),a=b("menu/submenu"),c=b("menu/popupmenu");g.Item=f;g.CheckItem=d;g.SubMenu=a;g.PopupMenu=c;return g});
KISSY.add("menu/control",["node","component/container","component/extension/delegate-children"],function(i,b){function g(e){e.target.isMenu&&(e=e.newVal,this.el.setAttribute("aria-activedescendant",e&&e.el.id||""))}var f=b("node"),d=b("component/container"),a=b("component/extension/delegate-children"),c=f.KeyCode;return d.extend([a],{isMenu:1,beforeCreateDom:function(e){e.elAttrs.role="menu"},bindUI:function(){this.on("afterHighlightedItemChange",g,this)},_onSetHighlightedItem:function(e,a){var c;
e&&a&&(c=a.prevVal)&&c.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(e,a){this.callSuper(e,a);var c;!e&&(c=this.get("highlightedItem"))&&c.set("highlighted",!1)},getRootMenu:function(){return this},handleMouseEnterInternal:function(e){this.callSuper(e);if((e=this.getRootMenu())&&e._popupAutoHideTimer)clearTimeout(e._popupAutoHideTimer),e._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(e){this.callSuper(e);var a;(a=this.get("highlightedItem"))&&
a.set("highlighted",!1)},_getNextEnabledHighlighted:function(e,a){var c=this.get("children"),h=c.length,d=e;do{var b=c[e];if(!b.get("disabled")&&!1!==b.get("visible"))return c[e];e=(e+a+h)%h}while(e!==d)},handleKeyDownInternal:function(e){var a=this.get("highlightedItem");if(a&&a.handleKeyDownInternal(e))return!0;var d=this.get("children"),h=d.length;if(0!==h){var b;switch(e.keyCode){case c.ESC:(a=this.get("highlightedItem"))&&a.set("highlighted",!1);break;case c.HOME:b=this._getNextEnabledHighlighted(0,
1);break;case c.END:b=this._getNextEnabledHighlighted(h-1,-1);break;case c.UP:a?(e=i.indexOf(a,d),h=(e-1+h)%h):h-=1;b=this._getNextEnabledHighlighted(h,-1);break;case c.DOWN:a?(e=i.indexOf(a,d),h=(e+1+h)%h):h=0,b=this._getNextEnabledHighlighted(h,1)}if(b)return b.set("highlighted",!0,{data:{fromKeyboard:1}}),!0}},containsElement:function(a){var c=this.$el;if(!this.get("visible")||!c)return!1;if(c&&(c[0]===a||c.contains(a)))return!0;for(var c=this.get("children"),d=0,h=c.length;d<h;d++){var b=c[d];
if(b.containsElement&&b.containsElement(a))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},defaultChildCfg:{valueFn:function(){return{xclass:"menuitem"}}}},xclass:"menu"})});
KISSY.add("menu/menuitem",["component/control","node"],function(i,b){var g=b("component/control"),f=b("node").all;return g.extend({isMenuItem:1,beforeCreateDom:function(d){d.elAttrs.role=d.selectable?"menuitemradio":"menuitem";d.selected&&d.elCls.push(this.getBaseCssClasses("selected"))},handleClickInternal:function(d){this.callSuper(d);d.preventDefault();this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(d,a){var c=this.get("parent");this.callSuper(d,
a);if(!a||!a.byPassSetHighlightedItem)this.get("rendered")?c.set("highlightedItem",d?this:null):d&&c.set("highlightedItem",this);if(d){var e=this.$el;(c=e.parent(function(a){return"visible"!==f(a).css("overflow")},c.get("el").parent()))&&e.scrollIntoView(c,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},_onSetSelected:function(d){var a=this.getBaseCssClasses("selected");this.$el[d?"addClass":"removeClass"](a)},containsElement:function(d){var a=this.$el;return a&&(a[0]===d||a.contains(d))}},
{ATTRS:{focusable:{value:!1},handleGestureEvents:{value:!1},selectable:{sync:0,render:1,parse:function(d){return d.hasClass(this.getBaseCssClass("selectable"))}},value:{},selected:{sync:0,render:1}},xclass:"menuitem"})});
KISSY.add("menu/check-menuitem",["./menuitem","component/extension/content-box","./check-menuitem-xtpl"],function(i,b){var g=b("./menuitem"),f=b("component/extension/content-box"),d=b("./check-menuitem-xtpl");return g.extend([f],{beforeCreateDom:function(a){a.checked&&a.elCls.push(this.getBaseCssClasses("checked"))},_onSetChecked:function(a){var c=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](c)},handleClickInternal:function(a){this.callSuper(a);this.set("checked",!this.get("checked"));
this.fire("click");return!0}},{ATTRS:{contentTpl:{value:d},checked:{render:1,sync:0}},xclass:"check-menuitem"})});
KISSY.add("menu/check-menuitem-xtpl",[],function(i,b,g,f){b=function(d,a,c,e){c=this.utils.callFn;if("5.0.0"!==i.version)throw Error("current xtemplate file("+this.name+")(v5.0.0) need to be recompiled using current kissy(v"+i.version+")!");a.write('<div class="',0);var b={escape:1},f=[];f.push("checkbox");b.params=f;if((b=c(this,d,b,a,["getBaseCssClasses"],0,1))&&b.isBuffer)a=b,b=e;a.write(b,!0);a.write('">\r\n</div>\r\n<div class="',0);b={escape:1};f=[];f.push("content");b.params=f;if((c=c(this,
d,b,a,["getBaseCssClasses"],0,3))&&c.isBuffer)a=c,c=e;a.write(c,!0);a.write('">',0);d=d.resolve(["content"],0);a.write(d,!1);a.write("</div>",0);return a};b.TPL_NAME=f.name;return b});
KISSY.add("menu/submenu",["node","./submenu-xtpl","./menuitem","component/extension/content-box"],function(i,b){function g(a){var c=a.target;c!==this&&c.isMenuItem&&a.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),c.set("highlighted",!1),c.set("highlighted",!0)))}function f(){var a=this.get("menu"),c={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};i.mix(a.get("align"),c,!1);a.show();this.el.setAttribute("aria-haspopup",a.get("el").attr("id"))}
function d(){this.get("menu").hide()}var a=b("node"),c=b("./submenu-xtpl"),e=b("./menuitem"),k=b("component/extension/content-box"),j=a.KeyCode;return e.extend([k],{isSubMenu:1,decorateDom:function(a){var c=this.get("prefixCls"),a=a.one("."+c+"popupmenu"),b=a[0].ownerDocument.body;b.insertBefore(a[0],b.firstChild);this.setInternal("menu",new (this.getComponentConstructorByNode(c,a))({srcNode:a,prefixCls:c}))},bindUI:function(){this.on("afterHighlightedChange",g,this)},clearShowPopupMenuTimers:function(){var a;
if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},handleMouseLeaveInternal:function(){this.set("highlighted",!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=i.later(d,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",
!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=i.later(f,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,c){this.callSuper(a,c);c&&!c.fromMouse&&(a&&!c.fromKeyboard?f.call(this):a||d.call(this))},handleClickInternal:function(a){f.call(this);this.callSuper(a)},handleKeyDownInternal:function(a){var c=this.get("menu"),b,e=c.get("visible"),d=a.keyCode;if(e){if(!c.handleKeyDownInternal(a))if(d===j.LEFT)this.set("highlighted",!1),this.set("highlighted",
!0,{data:{fromKeyboard:1}});else return}else if(d===j.RIGHT)f.call(this),a=c.get("children"),(b=a[0])&&b.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(d===j.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},destructor:function(){var a=this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{contentTpl:{value:c},menuDelay:{value:0.15},menu:{getter:function(a){a=a||{};a.isControl||(a.xclass=a.xclass||"popupmenu",
a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}}},xclass:"submenu"})});
KISSY.add("menu/submenu-xtpl",[],function(i,b,g,f){b=function(b,a,c,e){c=this.utils.callFn;if("5.0.0"!==i.version)throw Error("current xtemplate file("+this.name+")(v5.0.0) need to be recompiled using current kissy(v"+i.version+")!");a.write('<div class="',0);var f={escape:1},g=[];g.push("content");f.params=g;if((c=c(this,b,f,a,["getBaseCssClasses"],0,1))&&c.isBuffer)a=c,c=e;a.write(c,!0);a.write('">',0);e=b.resolve(["content"],0);a.write(e,!1);a.write('</div>\r\n<span class="',0);b=b.resolve(["prefixCls"],
0);a.write(b,!0);a.write('submenu-arrow">\u25ba</span>',0);return a};b.TPL_NAME=f.name;return b});
KISSY.add("menu/popupmenu",["component/extension/align","component/extension/shim","./control","component/extension/content-box"],function(i,b){var g=b("component/extension/align"),f=b("component/extension/shim"),d=b("./control"),a=b("component/extension/content-box");return d.extend([a,f,g],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var b=
this.getRootMenu();b&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=setTimeout(function(){var a;(a=b.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},visible:{value:!1}},xclass:"popupmenu"})});
