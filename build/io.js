/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 11 20:56
*/
KISSY.add("io","io/form-serializer,io/base,util,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(o,a,n,m){function l(a,h,i,j,g){if(typeof h==="function"){j=i;i=h;h=void 0}return e({type:g||"get",url:a,data:h,success:i,dataType:j})}var o=a("io/form-serializer"),e=a("io/base"),n=a("util");a("io/xhr-transport");a("io/script-transport");a("io/jsonp");a("io/form");a("io/iframe-transport");a("io/methods");n.mix(e,{serialize:o.serialize,get:l,post:function(a,
e,i,j){if(typeof e==="function"){j=i;i=e;e=void 0}return l(a,e,i,j,"post")},jsonp:function(a,e,i){if(typeof e==="function"){i=e;e=void 0}return l(a,e,i,"jsonp")},getScript:a.load,getJSON:function(a,e,i){if(typeof e==="function"){i=e;e=void 0}return l(a,e,i,"json")},upload:function(a,h,i,j,g){if(typeof i==="function"){g=j;j=i;i=void 0}return e({url:a,type:"post",dataType:g,form:h,data:i,success:j})}});m.exports=e});
KISSY.add("io/form-serializer",["util","dom","querystring"],function(o,a,n,m){function l(a){return a.replace(j,"\r\n")}var e=a("util"),f=a("dom"),h=a("querystring"),i=/^(?:select|textarea)/i,j=/\r?\n/g,g,k=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;g={serialize:function(a,j){return h.stringify(g.getFormData(a),void 0,void 0,j||!1)},getFormData:function(a){var j=[],r={};e.each(f.query(a),function(d){if(d.elements){for(var d=d.elements,b=[],c=
0;c<d.length;c++)b.push(d[c]);d=b}else d=[d];j.push.apply(j,d)});j=e.filter(j,function(d){return d.name&&!d.disabled&&(d.checked||i.test(d.nodeName)||k.test(d.type))});e.each(j,function(d){var b=f.val(d),c;null!==b&&(b=e.isArray(b)?e.map(b,l):l(b),(c=r[d.name])?(c&&!e.isArray(c)&&(c=r[d.name]=[c]),c.push.apply(c,e.makeArray(b))):r[d.name]=b)});return r}};m.exports=g});
KISSY.add("io/base","util,querystring,logger,event/custom,promise,url".split(","),function(o,a,n,m){function l(b){var c=b.context;delete b.context;b=f.mix(f.clone(d),b,{deep:true});b.context=c||b;var a,r=b.type,e=b.dataType,c=b.uri=j.parse(j.resolve(p,b.url),true);c.search=null;c.query=c.query||{};if(!("crossDomain"in b))b.crossDomain=c.protocol===q.prototype&&c.host===q.host;r=b.type=r.toUpperCase();b.hasContent=!k.test(r);if(b.processData&&(a=b.data)&&typeof a!=="string")b.data=h.stringify(a,void 0,
void 0,b.serializeArray);e=b.dataType=f.trim(e||"*").split(g);if(!("cache"in b)&&f.inArray(e[0],["script","jsonp"]))b.cache=false;if(!b.hasContent){if(b.data){h.parse(b.data);f.mix(c.query,h.parse(b.data))}if(b.cache===false)c.query._ksTS=f.now()+"_"+f.guid()}return b}function e(b){var c=this;if(!(c instanceof e))return new e(b);e.superclass.constructor.call(c);i.Defer(c);c.userConfig=b;b=l(b);f.mix(c,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",
responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});var d;e.fire("start",{ajaxConfig:b,io:c});d=new (r[b.dataType[0]]||r["*"])(c);c.transport=d;b.contentType&&c.setRequestHeader("Content-Type",b.contentType);var a=b.dataType[0],j,g=b.timeout,p=b.context,q=b.headers,k=b.accepts;c.setRequestHeader("Accept",a&&k[a]?k[a]+(a==="*"?"":", */*; q=0.01"):k["*"]);for(j in q)c.setRequestHeader(j,q[j]);if(b.beforeSend&&b.beforeSend.call(p,c,b)===false)return c;
c.readyState=1;e.fire("send",{ajaxConfig:b,io:c});if(b.async&&g>0)c.timeoutTimer=setTimeout(function(){c.abort("timeout")},g*1E3);try{c.state=1;d.send()}catch(h){c.state<2&&c._ioReady(-1,h.message||"send error")}return c}var f=a("util"),h=a("querystring");a("logger");var o=a("event/custom"),i=a("promise"),j=a("url"),g=/\s+/,a=function(b){return b},k=/^(?:GET|HEAD)$/,p=location.href,q=j.parse(p),n=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(q.protocol),r={},d={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,html:a,text:a,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};d.converters.html=d.converters.text;f.mix(e,o.Target);f.mix(e,{isLocal:n,setupConfig:function(b){f.mix(d,b,{deep:true})},setupTransport:function(b,c){r[b]=c},getTransport:function(b){return r[b]},
getConfig:function(){return d}});m.exports=e});
KISSY.add("io/xhr-transport","util,./base,./xhr-transport-base,./xdr-flash-transport,./sub-domain-transport,logger".split(","),function(o,a){function n(a){var k=a.config,p=k.crossDomain,q=k.xdr||{},r=q.subDomain=q.subDomain||{};this.io=a;if(p&&!e.supportCORS){if(i.domain&&m.endsWith(k.uri.hostname,i.domain)&&r.proxy!==false)return new h(a);if(""+q.use==="flash"||!j)return new f(a)}this.nativeXhr=e.nativeXhr(p);return this}var m=a("util"),l=a("./base"),e=a("./xhr-transport-base"),f=a("./xdr-flash-transport"),
h=a("./sub-domain-transport");a("logger");var i=document,j=e.XDomainRequest_;m.augment(n,e.proto,{send:function(){this.sendInternal()}});l.setupTransport("*",n)});
KISSY.add("io/xhr-transport-base",["util","./base","ua","logger"],function(o,a,n,m){function l(a,d){try{return new (d||j).XMLHttpRequest}catch(b){}}function e(a){var d;a.ifModified&&(d=a.uri,!1===a.cache&&(d=d.clone(),d.query.remove("_ksTS")),d=d.toString());return d}var f=a("util"),h=a("./base"),o=a("ua"),i=a("logger"),j=window,g=7<o.ieMode&&j.XDomainRequest,a={proto:{}},k={},p={};h.__lastModifiedCached=k;h.__eTagCached=p;var q=a.supportCORS="withCredentials"in a.nativeXhr();a.nativeXhr=j.ActiveXObject?
function(a,d){var b;if(!q&&a&&g)b=new g;else if(!(b=!h.isLocal&&l(a,d)))a:{try{b=new (d||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}return b}:l;a.XDomainRequest_=g;f.mix(a.proto,{sendInternal:function(){var a=this,d=a.io,b=d.config,c=a.nativeXhr,j=b.files,h=j?"post":b.type,i=b.async,l,m=d.mimeType,n=d.requestHeaders||{},d=d._getUrlForSend(),o=e(b),s,t;if(o){if(s=k[o])n["If-Modified-Since"]=s;if(s=p[o])n["If-None-Match"]=s}(l=b.username)?c.open(h,d,i,l,b.password):c.open(h,d,
i);h=b.xhrFields||{};"withCredentials"in h&&(q||delete h.withCredentials);for(t in h)try{c[t]=h[t]}catch(w){}m&&c.overrideMimeType&&c.overrideMimeType(m);!1===n["X-Requested-With"]&&delete n["X-Requested-With"];if("undefined"!==typeof c.setRequestHeader)for(t in n)c.setRequestHeader(t,n[t]);var u=b.hasContent&&b.data||null;j&&(m=u,n={},m&&(n=f.unparam(m)),n=f.mix(n,j),u=new FormData,f.each(n,function(a,c){f.isArray(a)?f.each(a,function(a){u.append(c+(b.serializeArray?"[]":""),a)}):u.append(c,a)}));
c.send(u);!i||4===c.readyState?a._callback():g&&c instanceof g?(c.onload=function(){c.readyState=4;c.status=200;a._callback()},c.onerror=function(){c.readyState=4;c.status=500;a._callback()}):c.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,d){var b=this.nativeXhr,c=this.io,j,q,l,n,m,o=c.config;try{if(d||4===b.readyState)if(g&&b instanceof g?(b.onerror=f.noop,b.onload=f.noop):b.onreadystatechange=f.noop,d)4!==b.readyState&&b.abort();else{j=
e(o);var v=b.status;g&&b instanceof g||(c.responseHeadersString=b.getAllResponseHeaders());j&&(q=b.getResponseHeader("Last-Modified"),l=b.getResponseHeader("ETag"),q&&(k[j]=q),l&&(p[l]=l));if((m=b.responseXML)&&m.documentElement)c.responseXML=m;var s=c.responseText=b.responseText;if(o.files&&s){var t,w;if(-1!==(t=s.indexOf("<body>")))w=s.lastIndexOf("</body>"),-1===w&&(w=s.length),s=s.slice(t+6,w);c.responseText=f.unEscapeHtml(s)}try{n=b.statusText}catch(u){n=""}!v&&h.isLocal&&!o.crossDomain?v=c.responseText?
200:404:1223===v&&(v=204);c._ioReady(v,n)}}catch(x){i.log(x.stack||x,"error"),b.onreadystatechange=f.noop,d||c._ioReady(-1,x.message||"process error")}}});m.exports=a});
KISSY.add("io/xdr-flash-transport",["util","./base","dom","logger"],function(o,a,n,m){function l(a,d,b){q||(q=!0,a='<object id="'+g+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+d+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',d=p.createElement("div"),i.prepend(d,p.body||p.documentElement),d.innerHTML=a)}function e(a){this.io=a}var f=a("util"),h=a("./base"),
i=a("dom");a("logger");var j={},g="io_swf",k,p=document,q=!1;f.augment(e,{send:function(){var e=this,d=e.io,b=d.config;l((b.xdr||{}).src||a.toUrl("../assets/io.swf"),1,1);k?(e._uid=f.guid(),j[e._uid]=e,k.send(d._getUrlForSend(),{id:e._uid,uid:e._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){e.send()},200)},abort:function(){k.abort(this._uid)},_xdrResponse:function(a,d){var b,c=d.id,e,g=d.c,f=this.io;if(g&&(e=g.responseText))f.responseText=decodeURI(e);switch(a){case "success":b=
{status:200,statusText:"success"};delete j[c];break;case "abort":delete j[c];break;case "timeout":case "transport error":case "failure":delete j[c],b={status:"status"in g?g.status:500,statusText:g.statusText||a}}b&&f._ioReady(b.status,b.statusText)}});h.applyTo=function(a,d,b){var a=d.split(".").slice(1),c=h;f.each(a,function(b){c=c[b]});c.apply(null,b)};h.xdrReady=function(){k=p.getElementById(g)};h.xdrResponse=function(a,d){var b=j[d.uid];b&&b._xdrResponse(a,d)};m.exports=e});
KISSY.add("io/sub-domain-transport","util,event/dom,url,dom,./xhr-transport-base,logger".split(","),function(o,a,n,m){function l(a){var j=a.config;this.io=a;j.crossDomain=false}function e(){var a=p[this.io.config.uri.hostname];a.ready=1;f.detach(a.iframe,"load",e,this);this.send()}var o=a("util"),f=a("event/dom"),h=a("url"),i=a("dom"),j=a("./xhr-transport-base"),g=a("logger"),k=document,p={};o.augment(l,j.proto,{send:function(){var a=this.io.config,r=a.uri,d=r.hostname,b=p[d],c="/sub_domain_proxy.html";
if(a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy)c=a.xdr.subDomain.proxy;if(b&&b.ready)(this.nativeXhr=j.nativeXhr(0,b.iframe.contentWindow))?this.sendInternal():g.error("document.domain not set correctly!");else{if(b)a=b.iframe;else{b=p[d]={};a=b.iframe=k.createElement("iframe");i.css(a,{position:"absolute",left:"-9999px",top:"-9999px"});i.prepend(a,k.body||k.documentElement);d={};d.protocol=r.protocol;d.host=r.host;d.pathname=c;a.src=h.stringify(d)}f.on(a,"load",e,this)}}});m.exports=l});
KISSY.add("io/script-transport",["util","./base","logger"],function(o,a){function n(a){if(!a.config.crossDomain)return new (l.getTransport("*"))(a);this.io=a;return this}var m=a("util"),l=a("./base");a("logger");l.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){m.globalEval(a);return a}}}});m.augment(n,{send:function(){var e=this,f=e.io,h=f.config;
e.script=a.load(f._getUrlForSend(),{charset:h.scriptCharset,success:function(){e._callback("success")},error:function(){e._callback("error")}})},_callback:function(a,f){var h=this.io;this.script&&(this.script=void 0,f||("error"!==a?h._ioReady(200,"success"):"error"===a&&h._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});l.setupTransport("script",n)});
KISSY.add("io/jsonp",["util","./base"],function(o,a){var n=a("util"),m=a("./base"),l=window;m.setupConfig({jsonp:"callback",jsonpCallback:function(){return n.guid("jsonp")}});m.on("start",function(a){var f=a.io,h=f.config,a=h.dataType;if("jsonp"===a[0]){delete h.contentType;var i,j=h.jsonpCallback,g="function"===typeof j?j():j,k=l[g];h.uri.query[h.jsonp]=g;l[g]=function(a){1<arguments.length&&(a=n.makeArray(arguments));i=[a]};f.fin(function(){l[g]=k;if(void 0===k)try{delete l[g]}catch(a){}else i&&
k(i[0])});f=h.converters;f.script=f.script||{};f.script.json=function(){if(!i)throw Error("not call jsonpCallback: "+g);return i[0]};a.length=2;a[0]="script";a[1]="json"}})});
KISSY.add("io/form",["util","./base","dom","querystring","./form-serializer"],function(o,a){var n=a("util"),m=a("./base"),l=a("dom"),e=a("querystring"),f=a("./form-serializer"),h=Array.prototype.slice,i=window.FormData;m.on("start",function(a){var g,k,a=a.io.config;if(k=a.form){g=l.get(k);k=a.data;for(var p=!1,q={},r=l.query("input",g),d=0,b=r.length;d<b;d++){var c=r[d];if("file"===c.type.toLowerCase()){p=!0;if(!i)break;var m=h.call(c.files,0);q[l.attr(c,"name")]=1<m.length?m:m[0]||null}}p&&i&&(a.files=
a.files||{},n.mix(a.files,q),delete a.contentType);!p||i?(g=f.getFormData(g),a.hasContent?(g=e.stringify(g,void 0,void 0,a.serializeArray),a.data=k?a.data+("&"+g):g):n.mix(a.uri.query,g)):(k=a.dataType,a=k[0],"*"===a&&(a="text"),k.length=2,k[0]="iframe",k[1]=a)}})});
KISSY.add("io/iframe-transport","util,dom,./base,event/dom,logger,ua".split(","),function(o,a){function n(a){var j=e.guid("io-iframe"),k=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(k?' src="'+k+'" ':"")+' id="'+j+'" name="'+j+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,g.body||g.documentElement);return a}function m(a,j,k){var d=[],b,c,h,i;e.each(a,function(a,p){b=e.isArray(a);c=e.makeArray(a);for(h=0;h<c.length;h++){i=g.createElement("input");i.type="hidden";i.name=
p+(b&&k?"[]":"");i.value=c[h];f.append(i,j);d.push(i)}});return d}function l(a){this.io=a}var e=a("util"),f=a("dom"),h=a("./base"),i=a("event/dom");a("logger");var j=a("ua"),g=document,k=e.clone(h.getConfig().converters.text);k.json=function(a){return e.parseJson(e.unEscapeHtml(a))};h.setupConfig({converters:{iframe:k,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(l,{send:function(){function a(){i.on(c,"load error",g._callback,g);o.submit()}var g=this,k=g.io,d=
k.config,b,c,h,l=d.data,o=f.get(d.form);g.attrs={target:f.attr(o,"target")||"",action:f.attr(o,"action")||"",encoding:f.attr(o,"encoding"),enctype:f.attr(o,"enctype"),method:f.attr(o,"method")};g.form=o;c=n(k);f.attr(o,{target:c.id,action:k._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});l&&(h=e.unparam(l));h&&(b=m(h,o,d.serializeArray));g.fields=b;j.ie===6?setTimeout(a,0):a()},_callback:function(a){var g=this,k=g.form,d=g.io,a=a.type,b,c=d.iframe;if(c){a===
"abort"&&j.ie===6?setTimeout(function(){f.attr(k,g.attrs)},0):f.attr(k,g.attrs);f.remove(this.fields);i.detach(c);setTimeout(function(){f.remove(c)},30);d.iframe=null;if(a==="load")try{if((b=c.contentWindow.document)&&b.body){d.responseText=f.html(b.body);if(e.startsWith(d.responseText,"<?xml"))d.responseText=void 0}d.responseXML=b&&b.XMLDocument?b.XMLDocument:b;b?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(h){d._ioReady(500,"parser error")}else a==="error"&&d._ioReady(500,"error")}},
abort:function(){this._callback({type:"abort"})}});h.setupTransport("iframe",l)});
KISSY.add("io/methods",["util","promise","./base","logger","url"],function(o,a){function n(a){var g=a.responseText,e=a.responseXML,f=a.config,h=f.converters,i,d,b=f.contents,c=f.dataType;if(g||e){for(f=a.mimeType||a.getResponseHeader("Content-Type");"*"===c[0];)c.shift();if(!c.length)for(i in b)if(b[i].test(f)){c[0]!==i&&c.unshift(i);break}c[0]=c[0]||"text";for(i=0;i<c.length;i++)if("text"===c[i]&&void 0!==g){d=g;break}else if("xml"===c[i]&&void 0!==e){d=e;break}if(!d){var l={text:g,xml:e};m.each(["text",
"xml"],function(a){var b=c[0];if(h[a]&&h[a][b]&&l[a])return c.unshift(a),d="text"===a?g:e,!1})}}b=c[0];for(f=1;f<c.length;f++){i=c[f];var n=h[b]&&h[b][i];if(!n)throw Error("no covert for "+b+" => "+i);d=n(d);b=i}a.responseData=d}var m=a("util"),l=a("promise"),e=a("./base"),f=a("logger"),h=a("url"),i=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;m.extend(e,l,{setRequestHeader:function(a,e){this.requestHeaders[a]=e;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},
getResponseHeader:function(a){var e,f,a=a.toLowerCase();if(2===this.state){if(!(f=this.responseHeaders))for(f=this.responseHeaders={};e=i.exec(this.responseHeadersString);)f[e[1].toLowerCase()]=e[2];e=f[a]}return void 0===e?null:e},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,g){if(2!==
this.state){this.state=2;this.readyState=4;var h;if(200<=a&&300>a||304===a)if(304===a)g="not modified",h=!0;else try{n(this),g="success",h=!0}catch(i){f.log(i.stack||i,"error"),g=i.message||"parser error"}else 0>a&&(a=0);this.status=a;this.statusText=g;var l=this.defer,m=this.config,d;if(d=this.timeoutTimer)clearTimeout(d),this.timeoutTimer=0;d=h?"success":"error";var b,c=[this.responseData,g,this],o=m.context,y={ajaxConfig:m,io:this};(b=m[d])&&b.apply(o,c);(b=m.complete)&&b.apply(o,c);e.fire(d,y);
e.fire("complete",y);l[h?"resolve":"reject"](c)}},_getUrlForSend:function(){var a=this.config,e=a.uri,f=h.parse(a.url).search;return h.stringify(e,a.serializeArray)+(f?(e.search?"&":"?")+f:"")}})});
