/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:27
*/
KISSY.add("io","io/form-serializer,io/base,util,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(h,c){function o(d,e,a,m,g){if(typeof e==="function"){m=a;a=e;e=void 0}return f({type:g||"get",url:d,data:e,success:a,dataType:m})}var l=c("io/form-serializer"),f=c("io/base"),d=c("util");c("io/xhr-transport");c("io/script-transport");c("io/jsonp");c("io/form");c("io/iframe-transport");c("io/methods");d.mix(f,{serialize:l.serialize,get:o,post:function(d,
e,a,m){if(typeof e==="function"){m=a;a=e;e=void 0}return o(d,e,a,m,"post")},jsonp:function(d,e,a){if(typeof e==="function"){a=e;e=void 0}return o(d,e,a,"jsonp")},getScript:h.getScript,getJSON:function(d,e,a){if(typeof e==="function"){a=e;e=void 0}return o(d,e,a,"json")},upload:function(d,e,a,m,g){if(typeof a==="function"){g=m;m=a;a=void 0}return f({url:d,type:"post",dataType:g,form:e,data:a,success:m})}});return h.IO=f});
KISSY.add("io/form-serializer",["util","dom"],function(h,c){function o(a){return a.replace(k,"\r\n")}var l=c("util"),f=c("dom"),d=/^(?:select|textarea)/i,k=/\r?\n/g,e,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(a,d){return l.param(e.getFormData(a),void 0,void 0,d||!1)},getFormData:function(m){var g=[],e={};l.each(f.query(m),function(j){if(j.elements){for(var j=j.elements,a=[],b=0;b<j.length;b++)a.push(j[b]);j=a}else j=
[j];g.push.apply(g,j)});g=l.filter(g,function(j){return j.name&&!j.disabled&&(j.checked||d.test(j.nodeName)||a.test(j.type))});l.each(g,function(j){var a=f.val(j),b;null!==a&&(a=l.isArray(a)?l.map(a,o):o(a),(b=e[j.name])?(b&&!l.isArray(b)&&(b=e[j.name]=[b]),b.push.apply(b,l.makeArray(a))):e[j.name]=a)});return e}}});
KISSY.add("io/base",["util","event/custom","promise","uri"],function(h,c){function o(b){var j=b.context;delete b.context;b=f.mix(f.clone(i),b,{deep:!0});b.context=j||b;var d,e=b.type,m=b.dataType,j=b.uri=n.resolve(b.url);b.uri.setQuery("");"crossDomain"in b||(b.crossDomain=!b.uri.isSameOriginAs(n));e=b.type=e.toUpperCase();b.hasContent=!g.test(e);if(b.processData&&(d=b.data)&&"string"!==typeof d)b.data=f.param(d,void 0,void 0,b.serializeArray);m=b.dataType=f.trim(m||"*").split(a);!("cache"in b)&&
f.inArray(m[0],["script","jsonp"])&&(b.cache=!1);b.hasContent||(b.data&&j.query.add(f.unparam(b.data)),!1===b.cache&&j.query.set("_ksTS",f.now()+"_"+f.guid()));return b}function l(b){var a=this;if(!(a instanceof l))return new l(b);l.superclass.constructor.call(a);k.Defer(a);a.userConfig=b;b=o(b);f.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});
var i;l.fire("start",{ajaxConfig:b,io:a});i=new (j[b.dataType[0]]||j["*"])(a);a.transport=i;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var d=b.dataType[0],e,m=b.timeout,g=b.context,c=b.headers,n=b.accepts;a.setRequestHeader("Accept",d&&n[d]?n[d]+("*"===d?"":", */*; q=0.01"):n["*"]);for(e in c)a.setRequestHeader(e,c[e]);if(b.beforeSend&&!1===b.beforeSend.call(g,a,b))return a;a.readyState=1;l.fire("send",{ajaxConfig:b,io:a});b.async&&0<m&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},
1E3*m));try{a.state=1,i.send()}catch(h){2>a.state&&(setTimeout(function(){throw h;},0),a._ioReady(-1,h.message))}return a}var f=c("util"),d=c("event/custom"),k=c("promise"),e=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,m=function(b){return b},g=/^(?:GET|HEAD)$/,n=new (c("uri"))((h.Env.host.location||{}).href),e=n&&e.test(n.getScheme()),j={},i={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",
html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,html:m,text:m,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};i.converters.html=i.converters.text;f.mix(l,d.Target);f.mix(l,{isLocal:e,setupConfig:function(b){f.mix(i,b,{deep:!0})},setupTransport:function(b,a){j[b]=a},getTransport:function(b){return j[b]},getConfig:function(){return i}});return l});
KISSY.add("io/xhr-transport",["util","./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(h,c){function o(g){var n=g.config,j=n.crossDomain,i=n.xdr||{},b=i.subDomain=i.subDomain||{};this.io=g;if(j&&!d.supportCORS){n=n.uri.getHostname();if(a.domain&&l.endsWith(n,a.domain)&&!1!==b.proxy)return new e(g);if("flash"===""+i.use||!m)return new k(g)}this.nativeXhr=d.nativeXhr(j);return this}var l=c("util"),f=c("./base"),d=c("./xhr-transport-base"),k=c("./xdr-flash-transport"),
e=c("./sub-domain-transport"),a=h.Env.host.document,m=d.XDomainRequest_;l.augment(o,d.proto,{send:function(){this.sendInternal()}});f.setupTransport("*",o);return f});
KISSY.add("io/xhr-transport-base",["util","./base","ua"],function(h,c){function o(a,i){try{return new (i||e).XMLHttpRequest}catch(b){}}function l(a){var i;a.ifModified&&(i=a.uri,!1===a.cache&&(i=i.clone(),i.query.remove("_ksTS")),i=i.toString());return i}var f=c("util"),d=c("./base"),k=c("ua"),e=h.Env.host,a=7<k.ieMode&&e.XDomainRequest,k={proto:{}},m={},g={};d.__lastModifiedCached=m;d.__eTagCached=g;k.nativeXhr=e.ActiveXObject?function(j,i){var b;if(!n&&j&&a)b=new a;else if(!(b=!d.isLocal&&o(j,i)))a:{try{b=
new (i||e).ActiveXObject("Microsoft.XMLHTTP");break a}catch(m){}b=void 0}return b}:o;k.XDomainRequest_=a;var n=k.supportCORS="withCredentials"in k.nativeXhr();f.mix(k.proto,{sendInternal:function(){var j=this,i=j.io,b=i.config,d=j.nativeXhr,e=b.files,c=e?"post":b.type,k=b.async,o,h=i.mimeType,p=i.requestHeaders||{},i=i._getUrlForSend(),s=l(b),q,t;if(s){if(q=m[s])p["If-Modified-Since"]=q;if(q=g[s])p["If-None-Match"]=q}(o=b.username)?d.open(c,i,k,o,b.password):d.open(c,i,k);c=b.xhrFields||{};"withCredentials"in
c&&(n||delete c.withCredentials);for(t in c)try{d[t]=c[t]}catch(w){}h&&d.overrideMimeType&&d.overrideMimeType(h);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof d.setRequestHeader)for(t in p)d.setRequestHeader(t,p[t]);var u=b.hasContent&&b.data||null;e&&(h=u,p={},h&&(p=f.unparam(h)),p=f.mix(p,e),u=new FormData,f.each(p,function(a,j){f.isArray(a)?f.each(a,function(a){u.append(j+(b.serializeArray?"[]":""),a)}):u.append(j,a)}));d.send(u);!k||4===d.readyState?j._callback():
a&&d instanceof a?(d.onload=function(){d.readyState=4;d.status=200;j._callback()},d.onerror=function(){d.readyState=4;d.status=500;j._callback()}):d.onreadystatechange=function(){j._callback()}},abort:function(){this._callback(0,1)},_callback:function(j,i){var b=this.nativeXhr,e=this.io,c,n,k,o,h,p=e.config;try{if(i||4===b.readyState)if(a&&b instanceof a?(b.onerror=f.noop,b.onload=f.noop):b.onreadystatechange=f.noop,i)4!==b.readyState&&b.abort();else{c=l(p);var s=b.status;a&&b instanceof a||(e.responseHeadersString=
b.getAllResponseHeaders());c&&(n=b.getResponseHeader("Last-Modified"),k=b.getResponseHeader("ETag"),n&&(m[c]=n),k&&(g[k]=k));if((h=b.responseXML)&&h.documentElement)e.responseXML=h;var q=e.responseText=b.responseText;if(p.files&&q){var t,w;if(-1!==(t=q.indexOf("<body>")))w=q.lastIndexOf("</body>"),-1===w&&(w=q.length),q=q.slice(t+6,w);e.responseText=f.unEscapeHtml(q)}try{o=b.statusText}catch(u){o=""}!s&&d.isLocal&&!p.crossDomain?s=e.responseText?200:404:1223===s&&(s=204);e._ioReady(s,o)}}catch(z){setTimeout(function(){throw z;
},0),b.onreadystatechange=f.noop,i||e._ioReady(-1,z)}}});return k});
KISSY.add("io/xdr-flash-transport",["util","./base","dom"],function(h,c){function o(j,d,b){n||(n=!0,j='<object id="'+a+'" type="application/x-shockwave-flash" data="'+j+'" width="0" height="0"><param name="movie" value="'+j+'" /><param name="FlashVars" value="yid='+d+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',d=g.createElement("div"),k.prepend(d,g.body||g.documentElement),d.innerHTML=j)}function l(a){this.io=a}var f=c("util"),d=c("./base"),k=c("dom"),
e={},a="io_swf",m,g=h.Env.host.document,n=!1;f.augment(l,{send:function(){var a=this,d=a.io,b=d.config;o((b.xdr||{}).src||h.config("base")+"io/assets/io.swf",1,1);m?(a._uid=f.guid(),e[a._uid]=a,m.send(d._getUrlForSend(),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){m.abort(this._uid)},_xdrResponse:function(a,d){var b,m=d.id,c,g=d.c,n=this.io;if(g&&(c=g.responseText))n.responseText=decodeURI(c);switch(a){case "success":b=
{status:200,statusText:"success"};delete e[m];break;case "abort":delete e[m];break;case "timeout":case "transport error":case "failure":delete e[m],b={status:"status"in g?g.status:500,statusText:g.statusText||a}}b&&n._ioReady(b.status,b.statusText)}});d.applyTo=function(a,e,b){var a=e.split(".").slice(1),m=d;f.each(a,function(a){m=m[a]});m.apply(null,b)};d.xdrReady=function(){m=g.getElementById(a)};d.xdrResponse=function(a,d){var b=e[d.uid];b&&b._xdrResponse(a,d)};return l});
KISSY.add("io/sub-domain-transport",["util","event/dom","uri","dom","./xhr-transport-base"],function(h,c){function o(a){var d=a.config;this.io=a;d.crossDomain=!1}function l(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;d.detach(a.iframe,"load",l,this);this.send()}var f=c("util"),d=c("event/dom"),k=c("uri"),e=c("dom"),a=c("./xhr-transport-base"),m=h.Env.host.document,g={};f.augment(o,a.proto,{send:function(){var c=this.io.config,j=c.uri,i=j.getHostname(),b;b=g[i];var f="/sub_domain_proxy.html";
c.xdr&&c.xdr.subDomain&&c.xdr.subDomain.proxy&&(f=c.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=a.nativeXhr(0,b.iframe.contentWindow))&&this.sendInternal():(b?c=b.iframe:(b=g[i]={},c=b.iframe=m.createElement("iframe"),e.css(c,{position:"absolute",left:"-9999px",top:"-9999px"}),e.prepend(c,m.body||m.documentElement),b=new k,b.setScheme(j.getScheme()),b.setPort(j.getPort()),b.setHostname(i),b.setPath(f),c.src=b.toString()),d.on(c,"load",l,this))}});return o});
KISSY.add("io/script-transport",["util","./base"],function(h,c){function o(d){if(!d.config.crossDomain)return new (f.getTransport("*"))(d);this.io=d;return this}var l=c("util"),f=c("./base");f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){l.globalEval(d);return d}}}});l.augment(o,{send:function(){var d=this,c=d.io,e=c.config;d.script=h.getScript(c._getUrlForSend(),
{charset:e.scriptCharset,success:function(){d._callback("success")},error:function(){d._callback("error")}})},_callback:function(d,c){var e=this.io;this.script&&(this.script=void 0,c||("error"!==d?e._ioReady(200,"success"):"error"===d&&e._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});f.setupTransport("script",o);return f});
KISSY.add("io/jsonp",["util","./base"],function(h,c){var o=c("util"),l=c("./base"),f=h.Env.host;l.setupConfig({jsonp:"callback",jsonpCallback:function(){return o.guid("jsonp")}});l.on("start",function(d){var c=d.io,e=c.config,d=e.dataType;if("jsonp"===d[0]){delete e.contentType;var a,m=e.jsonpCallback,g="function"===typeof m?m():m,n=f[g];e.uri.query.set(e.jsonp,g);f[g]=function(d){1<arguments.length&&(d=o.makeArray(arguments));a=[d]};c.fin(function(){f[g]=n;if(void 0===n)try{delete f[g]}catch(d){}else a&&
n(a[0])});c=e.converters;c.script=c.script||{};c.script.json=function(){return a[0]};d.length=2;d[0]="script";d[1]="json"}});return l});
KISSY.add("io/form",["util","./base","dom","./form-serializer"],function(h,c){var o=c("util"),l=c("./base"),f=c("dom"),d=c("./form-serializer"),k=Array.prototype.slice,e=h.Env.host.FormData;l.on("start",function(a){var c,g,a=a.io.config;if(g=a.form){c=f.get(g);g=a.data;for(var n=!1,j={},i=f.query("input",c),b=0,l=i.length;b<l;b++){var x=i[b];if("file"===x.type.toLowerCase()){n=!0;if(!e)break;var h=k.call(x.files,0);j[f.attr(x,"name")]=1<h.length?h:h[0]||null}}n&&e&&(a.files=a.files||{},o.mix(a.files,
j),delete a.contentType);!n||e?(c=d.getFormData(c),a.hasContent?(c=o.param(c,void 0,void 0,a.serializeArray),a.data=g?a.data+("&"+c):c):a.uri.query.add(c)):(g=a.dataType,a=g[0],"*"===a&&(a="text"),g.length=2,g[0]="iframe",g[1]=a)}});return l});
KISSY.add("io/iframe-transport",["util","dom","./base","event/dom","ua"],function(h,c){function o(a){var c=d.guid("io-iframe"),b=k.getEmptyIframeSrc(),a=a.iframe=k.create("<iframe "+(b?' src="'+b+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');k.prepend(a,g.body||g.documentElement);return a}function l(a,c,b){var e=[],m,f,n,l;d.each(a,function(a,j){m=d.isArray(a);f=d.makeArray(a);for(n=0;n<f.length;n++)l=g.createElement("input"),l.type="hidden",l.name=j+(m&&
b?"[]":""),l.value=f[n],k.append(l,c),e.push(l)});return e}function f(a){this.io=a}var d=c("util"),k=c("dom"),e=c("./base"),a=c("event/dom"),m=c("ua"),g=h.Env.host.document,n=d.clone(e.getConfig().converters.text);n.json=function(a){return d.parseJson(d.unEscapeHtml(a))};e.setupConfig({converters:{iframe:n,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(f,{send:function(){function c(){a.on(n,"load error",e._callback,e);r.submit()}var e=this,b=e.io,g=b.config,f,
n,h,y=g.data,r=k.get(g.form);e.attrs={target:k.attr(r,"target")||"",action:k.attr(r,"action")||"",encoding:k.attr(r,"encoding"),enctype:k.attr(r,"enctype"),method:k.attr(r,"method")};e.form=r;n=o(b);k.attr(r,{target:n.id,action:b._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});y&&(h=d.unparam(y));h&&(f=l(h,r,g.serializeArray));e.fields=f;6===m.ie?setTimeout(c,0):c()},_callback:function(c){var e=this,b=e.form,g=e.io,c=c.type,f,n=g.iframe;if(n)if("abort"===
c&&6===m.ie?setTimeout(function(){k.attr(b,e.attrs)},0):k.attr(b,e.attrs),k.remove(this.fields),a.detach(n),setTimeout(function(){k.remove(n)},30),g.iframe=null,"load"===c)try{if((f=n.contentWindow.document)&&f.body)g.responseText=k.html(f.body),d.startsWith(g.responseText,"<?xml")&&(g.responseText=void 0);g.responseXML=f&&f.XMLDocument?f.XMLDocument:f;f?g._ioReady(200,"success"):g._ioReady(500,"parser error")}catch(l){g._ioReady(500,"parser error")}else"error"===c&&g._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
e.setupTransport("iframe",f);return e});
KISSY.add("io/methods",["util","promise","./base","uri"],function(h,c){function o(a){var c=a.responseText,d=a.responseXML,e=a.config,f=e.converters,i,b,k=e.contents,h=e.dataType;if(c||d){for(e=a.mimeType||a.getResponseHeader("Content-Type");"*"===h[0];)h.shift();if(!h.length)for(i in k)if(k[i].test(e)){h[0]!==i&&h.unshift(i);break}h[0]=h[0]||"text";for(i=0;i<h.length;i++)if("text"===h[i]&&void 0!==c){b=c;break}else if("xml"===h[i]&&void 0!==d){b=d;break}if(!b){var o={text:c,xml:d};l.each(["text",
"xml"],function(a){var e=h[0];if(f[a]&&f[a][e]&&o[a])return h.unshift(a),b="text"===a?c:d,!1})}}k=h[0];for(e=1;e<h.length;e++){i=h[e];var v=f[k]&&f[k][i];if(!v)throw"no covert for "+k+" => "+i;b=v(b);k=i}a.responseData=b}var l=c("util"),f=c("promise"),d=c("./base"),k=c("uri"),e=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;l.extend(d,f,{setRequestHeader:function(a,c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var c,
d,a=a.toLowerCase();if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders={};c=e.exec(this.responseHeadersString);)d[c[1].toLowerCase()]=c[2];c=d[a]}return void 0===c?null:c},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,c){if(2!==this.state){this.state=2;this.readyState=
4;var e;if(200<=a&&300>a||304===a)if(304===a)c="not modified",e=!0;else try{o(this),c="success",e=!0}catch(f){setTimeout(function(){throw f;},0),c="parser error"}else 0>a&&(a=0);this.status=a;this.statusText=c;var j=this.defer,i=this.config,b;if(b=this.timeoutTimer)clearTimeout(b),this.timeoutTimer=0;b=e?"success":"error";var h,k=[this.responseData,c,this],l=i.context,v={ajaxConfig:i,io:this};(h=i[b])&&h.apply(l,k);(h=i.complete)&&h.apply(l,k);d.fire(b,v);d.fire("complete",v);j[e?"resolve":"reject"](k)}},
_getUrlForSend:function(){var a=this.config,c=a.uri,d=k.getComponents(a.url).query||"";return c.toString.call(c,a.serializeArray)+(d?(c.query.has()?"&":"?")+d:d)}})});
