/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 13 11:52
*/
KISSY.add("io","io/form-serializer,io/base,util,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(m,a,o,l){function g(a,d,h,f,j){if(typeof d==="function"){f=h;h=d;d=void 0}return b({type:j||"get",url:a,data:d,success:h,dataType:f})}var m=a("io/form-serializer"),b=a("io/base"),o=a("util");a("io/xhr-transport");a("io/script-transport");a("io/jsonp");a("io/form");a("io/iframe-transport");a("io/methods");o.mix(b,{serialize:m.serialize,get:g,post:function(a,
b,h,f){if(typeof b==="function"){f=h;h=b;b=void 0}return g(a,b,h,f,"post")},jsonp:function(a,b,h){if(typeof b==="function"){h=b;b=void 0}return g(a,b,h,"jsonp")},getScript:a.load,getJSON:function(a,b,h){if(typeof b==="function"){h=b;b=void 0}return g(a,b,h,"json")},upload:function(a,d,h,f,j){if(typeof h==="function"){j=f;f=h;h=void 0}return b({url:a,type:"post",dataType:j,form:d,data:h,success:f})}});l.exports=b});
KISSY.add("io/form-serializer",["util","dom","querystring"],function(m,a,o,l){function g(a){return a.replace(f,"\r\n")}var b=a("util"),i=a("dom"),d=a("querystring"),h=/^(?:select|textarea)/i,f=/\r?\n/g,j,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;j={serialize:function(a,f){return d.stringify(j.getFormData(a),void 0,void 0,f||!1)},getFormData:function(a){var f=[],q={};b.each(i.query(a),function(a){if(a.elements){for(var a=a.elements,c=[],n=
0;n<a.length;n++)c.push(a[n]);a=c}else a=[a];f.push.apply(f,a)});f=b.filter(f,function(a){return a.name&&!a.disabled&&(a.checked||h.test(a.nodeName)||e.test(a.type))});b.each(f,function(a){var c=i.val(a),n;null!==c&&(c=b.isArray(c)?b.map(c,g):g(c),(n=q[a.name])?(n&&!b.isArray(n)&&(n=q[a.name]=[n]),n.push.apply(n,b.makeArray(c))):q[a.name]=c)});return q}};l.exports=j});
KISSY.add("io/base","util,querystring,logger-manager,event/custom,promise,url".split(","),function(m,a,o,l){function g(c){var a=c.context;delete c.context;c=i.mix(i.clone(r),c,{deep:true});c.context=a||c;var b,q=c.type,h=c.dataType,a=c.uri=f.parse(f.resolve(k,c.url),true);a.query={};if(!("crossDomain"in c))c.crossDomain=!(a.protocol===p.protocol&&a.host===p.host);q=c.type=q.toUpperCase();c.hasContent=!e.test(q);if(c.processData&&(b=c.data)&&typeof b!=="string")c.data=d.stringify(b,void 0,void 0,c.serializeArray);
h=c.dataType=i.trim(h||"*").split(j);if(!("cache"in c)&&i.inArray(h[0],["script","jsonp"]))c.cache=false;if(!c.hasContent){c.data&&i.mix(a.query,d.parse(c.data));if(c.cache===false)a.query._ksTS=i.now()+"_"+i.guid()}return c}function b(c){var a=this;if(!(a instanceof b))return new b(c);b.superclass.constructor.call(a);h.Defer(a);a.userConfig=c;c=g(c);i.mix(a,{responseData:null,config:c||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},
readyState:0,state:0,statusText:null,status:0,transport:null});var f;b.fire("start",{ajaxConfig:c,io:a});f=new (q[c.dataType[0]]||q["*"])(a);a.transport=f;c.contentType&&a.setRequestHeader("Content-Type",c.contentType);var p=c.dataType[0],j,r=c.timeout,e=c.context,d=c.headers,k=c.accepts;a.setRequestHeader("Accept",p&&k[p]?k[p]+(p==="*"?"":", */*; q=0.01"):k["*"]);for(j in d)a.setRequestHeader(j,d[j]);if(c.beforeSend&&c.beforeSend.call(e,a,c)===false)return a;a.readyState=1;b.fire("send",{ajaxConfig:c,
io:a});if(c.async&&r>0)a.timeoutTimer=setTimeout(function(){a.abort("timeout")},r*1E3);try{a.state=1;f.send()}catch(l){a.state<2&&a._ioReady(-1,l.message||"send error")}return a}var i=a("util"),d=a("querystring");a("logger-manager");var m=a("event/custom"),h=a("promise"),f=a("url"),j=/\s+/,a=function(a){return a},e=/^(?:GET|HEAD)$/,k=location.href,p=f.parse(k),o=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(p.protocol),q={},r={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:i.parseJson,html:a,text:a,xml:i.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};r.converters.html=r.converters.text;i.mix(b,m.Target);i.mix(b,{isLocal:o,setupConfig:function(a){i.mix(r,a,{deep:true})},setupTransport:function(a,f){q[a]=f},getTransport:function(a){return q[a]},
getConfig:function(){return r}});l.exports=b});
KISSY.add("io/xhr-transport","util,./base,./xhr-transport-base,./xdr-flash-transport,./sub-domain-transport,logger-manager".split(","),function(m,a){function o(a){var e=a.config,k=e.crossDomain,p=e.xdr||{},q=p.subDomain=p.subDomain||{};this.io=a;if(k&&!b.supportCORS){if(h.domain&&l.endsWith(e.uri.hostname,h.domain)&&q.proxy!==false)return new d(a);if(""+p.use==="flash"||!f)return new i(a)}this.nativeXhr=b.nativeXhr(k);return this}var l=a("util"),g=a("./base"),b=a("./xhr-transport-base"),i=a("./xdr-flash-transport"),
d=a("./sub-domain-transport");a("logger-manager");var h=document,f=b.XDomainRequest_;l.augment(o,b.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",o)});
KISSY.add("io/xhr-transport-base","util,url,querystring,./base,ua,logger-manager".split(","),function(m,a,o,l){function g(a,f){try{return new (f||k).XMLHttpRequest}catch(b){}}function b(a){var f;if(a.ifModified){f=a.uri;if(a.cache===false){f=i.clone(f);delete f.query._ksTS}f=d.stringify(f)}return f}var i=a("util"),d=a("url"),h=a("querystring"),f=a("./base"),m=a("ua"),j=a("logger-manager"),e,k=window,p=m.ieMode>7&&k.XDomainRequest,a={proto:{}},q={},r={};f.__lastModifiedCached=q;f.__eTagCached=r;a.nativeXhr=
k.ActiveXObject?function(a,b){var q;if(!e&&a&&p)q=new p;else if(!(q=!f.isLocal&&g(a,b)))a:{try{q=new (b||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(j){}q=void 0}return q}:g;e=a.supportCORS="withCredentials"in a.nativeXhr();a.XDomainRequest_=p;i.mix(a.proto,{sendInternal:function(){var a=this,f=a.io,j=f.config,d=a.nativeXhr,k=j.files,g=k?"post":j.type,l=j.async,o,m=f.mimeType,s=f.requestHeaders||{},f=f._getUrlForSend(),v=b(j),t,w;if(v){if(t=q[v])s["If-Modified-Since"]=t;if(t=r[v])s["If-None-Match"]=
t}(o=j.username)?d.open(g,f,l,o,j.password):d.open(g,f,l);g=j.xhrFields||{};"withCredentials"in g&&(e||delete g.withCredentials);for(w in g)try{d[w]=g[w]}catch(y){}m&&d.overrideMimeType&&d.overrideMimeType(m);s["X-Requested-With"]===false&&delete s["X-Requested-With"];if(typeof d.setRequestHeader!=="undefined")for(w in s)d.setRequestHeader(w,s[w]);var x=j.hasContent&&j.data||null;if(k){m=x;s={};m&&(s=h.parse(m));s=i.mix(s,k);x=new FormData;i.each(s,function(a,f){i.isArray(a)?i.each(a,function(a){x.append(f+
(j.serializeArray?"[]":""),a)}):x.append(f,a)})}d.send(x);if(!l||d.readyState===4)a._callback();else if(p&&d instanceof p){d.onload=function(){d.readyState=4;d.status=200;a._callback()};d.onerror=function(){d.readyState=4;d.status=500;a._callback()}}else d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,d){var e=this.nativeXhr,h=this.io,k,g,l,o,m,s=h.config;try{if(d||e.readyState===4){if(p&&e instanceof p){e.onerror=i.noop;e.onload=i.noop}else e.onreadystatechange=
i.noop;if(d)e.readyState!==4&&e.abort();else{k=b(s);var v=e.status;if(!(p&&e instanceof p))h.responseHeadersString=e.getAllResponseHeaders();if(k){g=e.getResponseHeader("Last-Modified");l=e.getResponseHeader("ETag");g&&(q[k]=g);l&&(r[l]=l)}if((m=e.responseXML)&&m.documentElement)h.responseXML=m;var t=h.responseText=e.responseText;if(s.files&&t){var w,y;if((w=t.indexOf("<body>"))!==-1){y=t.lastIndexOf("</body>");if(y===-1)y=t.length;t=t.slice(w+6,y)}h.responseText=i.unEscapeHtml(t)}try{o=e.statusText}catch(x){o=
""}!v&&f.isLocal&&!s.crossDomain?v=h.responseText?200:404:v===1223&&(v=204);h._ioReady(v,o)}}}catch(z){j.log(z.stack||z,"error");e.onreadystatechange=i.noop;d||h._ioReady(-1,z.message||"process error")}}});l.exports=a});
KISSY.add("io/xdr-flash-transport",["util","./base","dom","logger-manager"],function(m,a,o,l){function g(a,f,c){p||(p=!0,a='<object id="'+j+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+f+"&uid="+c+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',f=k.createElement("div"),h.prepend(f,k.body||k.documentElement),f.innerHTML=a)}function b(a){this.io=a}var i=a("util"),d=a("./base"),
h=a("dom");a("logger-manager");var f={},j="io_swf",e,k=document,p=!1;i.augment(b,{send:function(){var b=this,d=b.io,c=d.config;g((c.xdr||{}).src||a.toUrl("../assets/io.swf"),1,1);e?(b._uid=i.guid(),f[b._uid]=b,e.send(d._getUrlForSend(),{id:b._uid,uid:b._uid,method:c.type,data:c.hasContent&&c.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(a,b){var c,d=b.id,j,e=b.c,p=this.io;if(e&&(j=e.responseText))p.responseText=decodeURI(j);switch(a){case "success":c=
{status:200,statusText:"success"};delete f[d];break;case "abort":delete f[d];break;case "timeout":case "transport error":case "failure":delete f[d],c={status:"status"in e?e.status:500,statusText:e.statusText||a}}c&&p._ioReady(c.status,c.statusText)}});d.applyTo=function(a,f,c){var a=f.split(".").slice(1),b=d;i.each(a,function(a){b=b[a]});b.apply(null,c)};d.xdrReady=function(){e=k.getElementById(j)};d.xdrResponse=function(a,b){var c=f[b.uid];c&&c._xdrResponse(a,b)};l.exports=b});
KISSY.add("io/sub-domain-transport","util,event/dom,url,dom,./xhr-transport-base,logger-manager".split(","),function(m,a,o,l){function g(a){var f=a.config;this.io=a;f.crossDomain=false}function b(){var a=k[this.io.config.uri.hostname];a.ready=1;i.detach(a.iframe,"load",b,this);this.send()}var m=a("util"),i=a("event/dom"),d=a("url"),h=a("dom"),f=a("./xhr-transport-base"),j=a("logger-manager"),e=document,k={};m.augment(g,f.proto,{send:function(){var a=this.io.config,q=a.uri,r=q.hostname,c=k[r],n="/sub_domain_proxy.html";
if(a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy)n=a.xdr.subDomain.proxy;if(c&&c.ready)(this.nativeXhr=f.nativeXhr(0,c.iframe.contentWindow))?this.sendInternal():j.error("document.domain not set correctly!");else{if(c)a=c.iframe;else{c=k[r]={};a=c.iframe=e.createElement("iframe");h.css(a,{position:"absolute",left:"-9999px",top:"-9999px"});h.prepend(a,e.body||e.documentElement);r={};r.protocol=q.protocol;r.host=q.host;r.pathname=n;a.src=d.stringify(r)}i.on(a,"load",b,this)}}});l.exports=g});
KISSY.add("io/script-transport",["util","./base","logger-manager"],function(m,a){function o(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var l=a("util"),g=a("./base");a("logger-manager");g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){l.globalEval(a);return a}}}});l.augment(o,{send:function(){var b=this,
i=b.io,d=i.config;b.script=a.load(i._getUrlForSend(),{charset:d.scriptCharset,success:function(){b._callback("success")},error:function(){b._callback("error")}})},_callback:function(a,i){var d=this.io;this.script&&(this.script=void 0,i||("error"!==a?d._ioReady(200,"success"):"error"===a&&d._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});g.setupTransport("script",o)});
KISSY.add("io/jsonp",["util","./base"],function(m,a){var o=a("util"),l=a("./base"),g=window;l.setupConfig({jsonp:"callback",jsonpCallback:function(){return o.guid("jsonp")}});l.on("start",function(a){var i=a.io,d=i.config,a=d.dataType;if("jsonp"===a[0]){delete d.contentType;var h,f=d.jsonpCallback,j="function"===typeof f?f():f,e=g[j];d.uri.query[d.jsonp]=j;g[j]=function(a){1<arguments.length&&(a=o.makeArray(arguments));h=[a]};i.fin(function(){g[j]=e;if(void 0===e)try{delete g[j]}catch(a){}else h&&
e(h[0])});i=d.converters;i.script=i.script||{};i.script.json=function(){if(!h)throw Error("not call jsonpCallback: "+j);return h[0]};a.length=2;a[0]="script";a[1]="json"}})});
KISSY.add("io/form",["util","./base","dom","querystring","./form-serializer"],function(m,a){var o=a("util"),l=a("./base"),g=a("dom"),b=a("querystring"),i=a("./form-serializer"),d=Array.prototype.slice,h=window.FormData;l.on("start",function(a){var j,e,a=a.io.config;if(e=a.form){j=g.get(e);e=a.data;for(var k=!1,p={},q=g.query("input",j),r=0,c=q.length;r<c;r++){var n=q[r];if("file"===n.type.toLowerCase()){k=!0;if(!h)break;var l=d.call(n.files,0);p[g.attr(n,"name")]=1<l.length?l:l[0]||null}}k&&h&&(a.files=
a.files||{},o.mix(a.files,p),delete a.contentType);!k||h?(j=i.getFormData(j),a.hasContent?(j=b.stringify(j,void 0,void 0,a.serializeArray),a.data=e?a.data+("&"+j):j):o.mix(a.uri.query,j)):(e=a.dataType,a=e[0],"*"===a&&(a="text"),e.length=2,e[0]="iframe",e[1]=a)}})});
KISSY.add("io/iframe-transport","util,querystring,dom,./base,event/dom,logger-manager,ua".split(","),function(m,a){function o(a){var f=b.guid("io-iframe"),j=d.getEmptyIframeSrc(),a=a.iframe=d.create("<iframe "+(j?' src="'+j+'" ':"")+' id="'+f+'" name="'+f+'" style="position:absolute;left:-9999px;top:-9999px;"/>');d.prepend(a,e.body||e.documentElement);return a}function l(a,f,j){var c=[],h,i,k,g;b.each(a,function(a,p){h=b.isArray(a);i=b.makeArray(a);for(k=0;k<i.length;k++){g=e.createElement("input");
g.type="hidden";g.name=p+(h&&j?"[]":"");g.value=i[k];d.append(g,f);c.push(g)}});return c}function g(a){this.io=a}var b=a("util"),i=a("querystring"),d=a("dom"),h=a("./base"),f=a("event/dom");a("logger-manager");var j=a("ua"),e=document,k=b.clone(h.getConfig().converters.text);k.json=function(a){return b.parseJson(b.unEscapeHtml(a))};h.setupConfig({converters:{iframe:k,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});b.augment(g,{send:function(){function a(){f.on(k,"load error",
b._callback,b);u.submit()}var b=this,e=b.io,c=e.config,h,k,g,m=c.data,u=d.get(c.form);b.attrs={target:d.attr(u,"target")||"",action:d.attr(u,"action")||"",encoding:d.attr(u,"encoding"),enctype:d.attr(u,"enctype"),method:d.attr(u,"method")};b.form=u;k=o(e);d.attr(u,{target:k.id,action:e._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});m&&(g=i.parse(m));g&&(h=l(g,u,c.serializeArray));b.fields=h;j.ie===6?setTimeout(a,0):a()},_callback:function(a){var e=this,
h=e.form,c=e.io,a=a.type,k,g=c.iframe;if(g){a==="abort"&&j.ie===6?setTimeout(function(){d.attr(h,e.attrs)},0):d.attr(h,e.attrs);d.remove(this.fields);f.detach(g);setTimeout(function(){d.remove(g)},30);c.iframe=null;if(a==="load")try{if((k=g.contentWindow.document)&&k.body){c.responseText=d.html(k.body);if(b.startsWith(c.responseText,"<?xml"))c.responseText=void 0}c.responseXML=k&&k.XMLDocument?k.XMLDocument:k;k?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(i){c._ioReady(500,"parser error")}else a===
"error"&&c._ioReady(500,"error")}},abort:function(){this._callback({type:"abort"})}});h.setupTransport("iframe",g)});
KISSY.add("io/methods",["util","promise","./base","logger-manager","url"],function(m,a){function o(a){var b=a.responseText,e=a.responseXML,d=a.config,h=d.converters,g,i,c=d.contents,n=d.dataType;if(b||e){for(d=a.mimeType||a.getResponseHeader("Content-Type");"*"===n[0];)n.shift();if(!n.length)for(g in c)if(c[g].test(d)){n[0]!==g&&n.unshift(g);break}n[0]=n[0]||"text";for(g=0;g<n.length;g++)if("text"===n[g]&&void 0!==b){i=b;break}else if("xml"===n[g]&&void 0!==e){i=e;break}if(!i){var m={text:b,xml:e};
l.each(["text","xml"],function(a){var c=n[0];if(h[a]&&h[a][c]&&m[a])return n.unshift(a),i="text"===a?b:e,!1})}}c=n[0];for(d=1;d<n.length;d++){g=n[d];var o=h[c]&&h[c][g];if(!o)throw Error("no covert for "+c+" => "+g);i=o(i);c=g}a.responseData=i}var l=a("util"),g=a("promise"),b=a("./base"),i=a("logger-manager"),d=a("url"),h=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;l.extend(b,g,{setRequestHeader:function(a,b){this.requestHeaders[a]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:
null},getResponseHeader:function(a){var b,d,a=a.toLowerCase();if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders={};b=h.exec(this.responseHeadersString);)d[b[1].toLowerCase()]=b[2];b=d[a]}return void 0===b?null:b},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,
d){if(2!==this.state){this.state=2;this.readyState=4;var e;if(200<=a&&300>a||304===a)if(304===a)d="not modified",e=!0;else try{o(this),d="success",e=!0}catch(g){i.log(g.stack||g,"error"),d=g.message||"parser error"}else 0>a&&(a=0);this.status=a;this.statusText=d;var h=this.defer,l=this.config,m;if(m=this.timeoutTimer)clearTimeout(m),this.timeoutTimer=0;m=e?"success":"error";var c,n=[this.responseData,d,this],A=l.context,B={ajaxConfig:l,io:this};(c=l[m])&&c.apply(A,n);(c=l.complete)&&c.apply(A,n);
b.fire(m,B);b.fire("complete",B);h[e?"resolve":"reject"](n)}},_getUrlForSend:function(){var a=this.config,b=a.uri,e=b.search||"";delete b.search;e&&!l.isEmptyObject(b.query)&&(e="&"+e.substring(1));return d.stringify(b,a.serializeArray)+e}})});
