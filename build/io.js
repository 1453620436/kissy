/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 22 12:07
*/
KISSY.add("io","io/form-serializer,io/base,util,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(i,c){function o(h,d,a,m,g){if(typeof d==="function"){m=a;a=d;d=void 0}return e({type:g||"get",url:h,data:d,success:a,dataType:m})}var k=c("io/form-serializer"),e=c("io/base"),h=c("util");c("io/xhr-transport");c("io/script-transport");c("io/jsonp");c("io/form");c("io/iframe-transport");c("io/methods");h.mix(e,{serialize:k.serialize,get:o,post:function(h,
d,a,m){if(typeof d==="function"){m=a;a=d;d=void 0}return o(h,d,a,m,"post")},jsonp:function(h,d,a){if(typeof d==="function"){a=d;d=void 0}return o(h,d,a,"jsonp")},getScript:i.getScript,getJSON:function(h,d,a){if(typeof d==="function"){a=d;d=void 0}return o(h,d,a,"json")},upload:function(h,d,a,m,g){if(typeof a==="function"){g=m;m=a;a=void 0}return e({url:h,type:"post",dataType:g,form:d,data:a,success:m})}});return i.IO=e});
KISSY.add("io/form-serializer",["util","dom"],function(i,c){function o(a){return a.replace(j,"\r\n")}var k=c("util"),e=c("dom"),h=/^(?:select|textarea)/i,j=/\r?\n/g,d,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return d={serialize:function(a,g){return k.param(d.getFormData(a),void 0,void 0,g||!1)},getFormData:function(m){var g=[],d={};k.each(e.query(m),function(l){if(l.elements){for(var l=l.elements,a=[],b=0;b<l.length;b++)a.push(l[b]);l=a}else l=
[l];g.push.apply(g,l)});g=k.filter(g,function(l){return l.name&&!l.disabled&&(l.checked||h.test(l.nodeName)||a.test(l.type))});k.each(g,function(a){var f=e.val(a),b;null!==f&&(f=k.isArray(f)?k.map(f,o):o(f),(b=d[a.name])?(b&&!k.isArray(b)&&(b=d[a.name]=[b]),b.push.apply(b,k.makeArray(f))):d[a.name]=f)});return d}}});
KISSY.add("io/base",["util","event/custom","promise","uri"],function(i,c){function o(b){var l=b.context;delete b.context;b=e.mix(e.clone(f),b,{deep:!0});b.context=l||b;var d,h=b.type,m=b.dataType,l=b.uri=n.resolve(b.url);b.uri.setQuery("");"crossDomain"in b||(b.crossDomain=!b.uri.isSameOriginAs(n));h=b.type=h.toUpperCase();b.hasContent=!g.test(h);if(b.processData&&(d=b.data)&&"string"!==typeof d)b.data=e.param(d,void 0,void 0,b.serializeArray);m=b.dataType=e.trim(m||"*").split(a);!("cache"in b)&&
e.inArray(m[0],["script","jsonp"])&&(b.cache=!1);b.hasContent||(b.data&&l.query.add(e.unparam(b.data)),!1===b.cache&&l.query.set("_ksTS",e.now()+"_"+e.guid()));return b}function k(b){var a=this;if(!(a instanceof k))return new k(b);k.superclass.constructor.call(a);j.Defer(a);a.userConfig=b;b=o(b);e.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});
var f;k.fire("start",{ajaxConfig:b,io:a});f=new (l[b.dataType[0]]||l["*"])(a);a.transport=f;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var d=b.dataType[0],h,m=b.timeout,g=b.context,c=b.headers,n=b.accepts;a.setRequestHeader("Accept",d&&n[d]?n[d]+("*"===d?"":", */*; q=0.01"):n["*"]);for(h in c)a.setRequestHeader(h,c[h]);if(b.beforeSend&&!1===b.beforeSend.call(g,a,b))return a;a.readyState=1;k.fire("send",{ajaxConfig:b,io:a});b.async&&0<m&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},
1E3*m));try{a.state=1,f.send()}catch(i){2>a.state&&(setTimeout(function(){throw i;},0),a._ioReady(-1,i.message))}return a}var e=c("util"),h=c("event/custom"),j=c("promise"),d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,m=function(b){return b},g=/^(?:GET|HEAD)$/,n=new (c("uri"))((i.Env.host.location||{}).href),d=n&&d.test(n.getScheme()),l={},f={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",
html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parseJson,html:m,text:m,xml:e.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};f.converters.html=f.converters.text;e.mix(k,h.Target);e.mix(k,{isLocal:d,setupConfig:function(b){e.mix(f,b,{deep:!0})},setupTransport:function(b,a){l[b]=a},getTransport:function(b){return l[b]},getConfig:function(){return f}});return k});
KISSY.add("io/xhr-transport",["util","./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(i,c){function o(g){var n=g.config,l=n.crossDomain,f=n.xdr||{},b=f.subDomain=f.subDomain||{};this.io=g;if(l&&!h.supportCORS){n=n.uri.getHostname();if(a.domain&&k.endsWith(n,a.domain)&&!1!==b.proxy)return new d(g);if("flash"===""+f.use||!m)return new j(g)}this.nativeXhr=h.nativeXhr(l);return this}var k=c("util"),e=c("./base"),h=c("./xhr-transport-base"),j=c("./xdr-flash-transport"),
d=c("./sub-domain-transport"),a=i.Env.host.document,m=h.XDomainRequest_;k.augment(o,h.proto,{send:function(){this.sendInternal()}});e.setupTransport("*",o);return e});
KISSY.add("io/xhr-transport-base",["util","./base","ua"],function(i,c){function o(a,f){try{return new (f||d).XMLHttpRequest}catch(b){}}function k(a){var f;a.ifModified&&(f=a.uri,!1===a.cache&&(f=f.clone(),f.query.remove("_ksTS")),f=f.toString());return f}var e=c("util"),h=c("./base"),j=c("ua"),d=i.Env.host,a=7<j.ieMode&&d.XDomainRequest,j={proto:{}},m={},g={};h.__lastModifiedCached=m;h.__eTagCached=g;j.nativeXhr=d.ActiveXObject?function(l,f){var b;if(!n&&l&&a)b=new a;else if(!(b=!h.isLocal&&o(l,f)))a:{try{b=
new (f||d).ActiveXObject("Microsoft.XMLHTTP");break a}catch(m){}b=void 0}return b}:o;j.XDomainRequest_=a;var n=j.supportCORS="withCredentials"in j.nativeXhr();e.mix(j.proto,{sendInternal:function(){var l=this,f=l.io,b=f.config,d=l.nativeXhr,h=b.files,c=h?"post":b.type,j=b.async,o,i=f.mimeType,p=f.requestHeaders||{},f=f._getUrlForSend(),s=k(b),q,t;if(s){if(q=m[s])p["If-Modified-Since"]=q;if(q=g[s])p["If-None-Match"]=q}(o=b.username)?d.open(c,f,j,o,b.password):d.open(c,f,j);c=b.xhrFields||{};"withCredentials"in
c&&(n||delete c.withCredentials);for(t in c)try{d[t]=c[t]}catch(w){}i&&d.overrideMimeType&&d.overrideMimeType(i);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof d.setRequestHeader)for(t in p)d.setRequestHeader(t,p[t]);var u=b.hasContent&&b.data||null;h&&(i=u,p={},i&&(p=e.unparam(i)),p=e.mix(p,h),u=new FormData,e.each(p,function(a,l){e.isArray(a)?e.each(a,function(a){u.append(l+(b.serializeArray?"[]":""),a)}):u.append(l,a)}));d.send(u);!j||4===d.readyState?l._callback():
a&&d instanceof a?(d.onload=function(){d.readyState=4;d.status=200;l._callback()},d.onerror=function(){d.readyState=4;d.status=500;l._callback()}):d.onreadystatechange=function(){l._callback()}},abort:function(){this._callback(0,1)},_callback:function(l,f){var b=this.nativeXhr,d=this.io,c,n,j,o,i,p=d.config;try{if(f||4===b.readyState)if(a&&b instanceof a?(b.onerror=e.noop,b.onload=e.noop):b.onreadystatechange=e.noop,f)4!==b.readyState&&b.abort();else{c=k(p);var s=b.status;a&&b instanceof a||(d.responseHeadersString=
b.getAllResponseHeaders());c&&(n=b.getResponseHeader("Last-Modified"),j=b.getResponseHeader("ETag"),n&&(m[c]=n),j&&(g[j]=j));if((i=b.responseXML)&&i.documentElement)d.responseXML=i;var q=d.responseText=b.responseText;if(p.files&&q){var t,w;if(-1!==(t=q.indexOf("<body>")))w=q.lastIndexOf("</body>"),-1===w&&(w=q.length),q=q.slice(t+6,w);d.responseText=e.unEscapeHtml(q)}try{o=b.statusText}catch(u){o=""}!s&&h.isLocal&&!p.crossDomain?s=d.responseText?200:404:1223===s&&(s=204);d._ioReady(s,o)}}catch(A){setTimeout(function(){throw A;
},0),b.onreadystatechange=e.noop,f||d._ioReady(-1,A)}}});return j});
KISSY.add("io/xdr-flash-transport",["util","./base","dom"],function(i,c){function o(l,d,b){n||(n=!0,l='<object id="'+a+'" type="application/x-shockwave-flash" data="'+l+'" width="0" height="0"><param name="movie" value="'+l+'" /><param name="FlashVars" value="yid='+d+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',d=g.createElement("div"),j.prepend(d,g.body||g.documentElement),d.innerHTML=l)}function k(a){this.io=a}var e=c("util"),h=c("./base"),j=c("dom"),
d={},a="io_swf",m,g=i.Env.host.document,n=!1;e.augment(k,{send:function(){var a=this,f=a.io,b=f.config;o((b.xdr||{}).src||i.config("base")+"io/assets/io.swf",1,1);m?(a._uid=e.guid(),d[a._uid]=a,m.send(f._getUrlForSend(),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){m.abort(this._uid)},_xdrResponse:function(a,f){var b,h=f.id,m,g=f.c,c=this.io;if(g&&(m=g.responseText))c.responseText=decodeURI(m);switch(a){case "success":b=
{status:200,statusText:"success"};delete d[h];break;case "abort":delete d[h];break;case "timeout":case "transport error":case "failure":delete d[h],b={status:"status"in g?g.status:500,statusText:g.statusText||a}}b&&c._ioReady(b.status,b.statusText)}});h.applyTo=function(a,d,b){var a=d.split(".").slice(1),m=h;e.each(a,function(b){m=m[b]});m.apply(null,b)};h.xdrReady=function(){m=g.getElementById(a)};h.xdrResponse=function(a,f){var b=d[f.uid];b&&b._xdrResponse(a,f)};return k});
KISSY.add("io/sub-domain-transport",["util","event/dom","uri","dom","./xhr-transport-base"],function(i,c){function o(a){var d=a.config;this.io=a;d.crossDomain=!1}function k(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;h.detach(a.iframe,"load",k,this);this.send()}var e=c("util"),h=c("event/dom"),j=c("uri"),d=c("dom"),a=c("./xhr-transport-base"),m=i.Env.host.document,g={};e.augment(o,a.proto,{send:function(){var c=this.io.config,l=c.uri,f=l.getHostname(),b;b=g[f];var e="/sub_domain_proxy.html";
c.xdr&&c.xdr.subDomain&&c.xdr.subDomain.proxy&&(e=c.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=a.nativeXhr(0,b.iframe.contentWindow))&&this.sendInternal():(b?c=b.iframe:(b=g[f]={},c=b.iframe=m.createElement("iframe"),d.css(c,{position:"absolute",left:"-9999px",top:"-9999px"}),d.prepend(c,m.body||m.documentElement),b=new j,b.setScheme(l.getScheme()),b.setPort(l.getPort()),b.setHostname(f),b.setPath(e),c.src=b.toString()),h.on(c,"load",k,this))}});return o});
KISSY.add("io/script-transport",["util","./base"],function(i,c){function o(c){if(!c.config.crossDomain)return new (e.getTransport("*"))(c);this.io=c;return this}var k=c("util"),e=c("./base");e.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(c){k.globalEval(c);return c}}}});k.augment(o,{send:function(){var c=this,e=c.io,d=e.config;c.script=i.getScript(e._getUrlForSend(),
{charset:d.scriptCharset,success:function(){c._callback("success")},error:function(){c._callback("error")}})},_callback:function(c,e){var d=this.io;this.script&&(this.script=void 0,e||("error"!==c?d._ioReady(200,"success"):"error"===c&&d._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});e.setupTransport("script",o);return e});
KISSY.add("io/jsonp",["util","./base"],function(i,c){var o=c("util"),k=c("./base"),e=i.Env.host;k.setupConfig({jsonp:"callback",jsonpCallback:function(){return o.guid("jsonp")}});k.on("start",function(c){var j=c.io,d=j.config,c=d.dataType;if("jsonp"===c[0]){delete d.contentType;var a,m=d.jsonpCallback,g="function"===typeof m?m():m,n=e[g];d.uri.query.set(d.jsonp,g);e[g]=function(d){1<arguments.length&&(d=o.makeArray(arguments));a=[d]};j.fin(function(){e[g]=n;if(void 0===n)try{delete e[g]}catch(d){}else a&&
n(a[0])});j=d.converters;j.script=j.script||{};j.script.json=function(){if(!a)throw Error("not call jsonpCallback: "+g);return a[0]};c.length=2;c[0]="script";c[1]="json"}});return k});
KISSY.add("io/form",["util","./base","dom","./form-serializer"],function(i,c){var o=c("util"),k=c("./base"),e=c("dom"),h=c("./form-serializer"),j=Array.prototype.slice,d=i.Env.host.FormData;k.on("start",function(a){var c,g,a=a.io.config;if(g=a.form){c=e.get(g);g=a.data;for(var n=!1,l={},f=e.query("input",c),b=0,k=f.length;b<k;b++){var x=f[b];if("file"===x.type.toLowerCase()){n=!0;if(!d)break;var i=j.call(x.files,0);l[e.attr(x,"name")]=1<i.length?i:i[0]||null}}n&&d&&(a.files=a.files||{},o.mix(a.files,
l),delete a.contentType);!n||d?(c=h.getFormData(c),a.hasContent?(c=o.param(c,void 0,void 0,a.serializeArray),a.data=g?a.data+("&"+c):c):a.uri.query.add(c)):(g=a.dataType,a=g[0],"*"===a&&(a="text"),g.length=2,g[0]="iframe",g[1]=a)}});return k});
KISSY.add("io/iframe-transport",["util","dom","./base","event/dom","ua"],function(i,c){function o(a){var c=h.guid("io-iframe"),b=j.getEmptyIframeSrc(),a=a.iframe=j.create("<iframe "+(b?' src="'+b+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');j.prepend(a,g.body||g.documentElement);return a}function k(a,c,b){var d=[],m,e,k,n;h.each(a,function(a,l){m=h.isArray(a);e=h.makeArray(a);for(k=0;k<e.length;k++)n=g.createElement("input"),n.type="hidden",n.name=l+(m&&
b?"[]":""),n.value=e[k],j.append(n,c),d.push(n)});return d}function e(a){this.io=a}var h=c("util"),j=c("dom"),d=c("./base"),a=c("event/dom"),m=c("ua"),g=i.Env.host.document,n=h.clone(d.getConfig().converters.text);n.json=function(a){return h.parseJson(h.unEscapeHtml(a))};d.setupConfig({converters:{iframe:n,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});h.augment(e,{send:function(){function c(){a.on(n,"load error",d._callback,d);r.submit()}var d=this,b=d.io,g=b.config,e,
n,i,z=g.data,r=j.get(g.form);d.attrs={target:j.attr(r,"target")||"",action:j.attr(r,"action")||"",encoding:j.attr(r,"encoding"),enctype:j.attr(r,"enctype"),method:j.attr(r,"method")};d.form=r;n=o(b);j.attr(r,{target:n.id,action:b._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});z&&(i=h.unparam(z));i&&(e=k(i,r,g.serializeArray));d.fields=e;6===m.ie?setTimeout(c,0):c()},_callback:function(d){var c=this,b=c.form,g=c.io,d=d.type,e,n=g.iframe;if(n)if("abort"===
d&&6===m.ie?setTimeout(function(){j.attr(b,c.attrs)},0):j.attr(b,c.attrs),j.remove(this.fields),a.detach(n),setTimeout(function(){j.remove(n)},30),g.iframe=null,"load"===d)try{if((e=n.contentWindow.document)&&e.body)g.responseText=j.html(e.body),h.startsWith(g.responseText,"<?xml")&&(g.responseText=void 0);g.responseXML=e&&e.XMLDocument?e.XMLDocument:e;e?g._ioReady(200,"success"):g._ioReady(500,"parser error")}catch(k){g._ioReady(500,"parser error")}else"error"===d&&g._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
d.setupTransport("iframe",e);return d});
KISSY.add("io/methods",["util","promise","./base","uri"],function(i,c){function o(a){var d=a.responseText,c=a.responseXML,e=a.config,h=e.converters,f,b,j=e.contents,i=e.dataType;if(d||c){for(e=a.mimeType||a.getResponseHeader("Content-Type");"*"===i[0];)i.shift();if(!i.length)for(f in j)if(j[f].test(e)){i[0]!==f&&i.unshift(f);break}i[0]=i[0]||"text";for(f=0;f<i.length;f++)if("text"===i[f]&&void 0!==d){b=d;break}else if("xml"===i[f]&&void 0!==c){b=c;break}if(!b){var o={text:d,xml:c};k.each(["text",
"xml"],function(a){var e=i[0];if(h[a]&&h[a][e]&&o[a])return i.unshift(a),b="text"===a?d:c,!1})}}j=i[0];for(e=1;e<i.length;e++){f=i[e];var v=h[j]&&h[j][f];if(!v)throw"no covert for "+j+" => "+f;b=v(b);j=f}a.responseData=b}var k=c("util"),e=c("promise"),h=c("./base"),j=c("uri"),d=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;k.extend(h,e,{setRequestHeader:function(a,d){this.requestHeaders[a]=d;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var c,
e,a=a.toLowerCase();if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders={};c=d.exec(this.responseHeadersString);)e[c[1].toLowerCase()]=c[2];c=e[a]}return void 0===c?null:c},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,c){if(2!==this.state){this.state=2;this.readyState=
4;var d;if(200<=a&&300>a||304===a)if(304===a)c="not modified",d=!0;else try{o(this),c="success",d=!0}catch(e){c=e.message||"parser error"}else 0>a&&(a=0);this.status=a;this.statusText=c;var j=this.defer,f=this.config,b;if(b=this.timeoutTimer)clearTimeout(b),this.timeoutTimer=0;b=d?"success":"error";var i,k=[this.responseData,c,this],y=f.context,v={ajaxConfig:f,io:this};(i=f[b])&&i.apply(y,k);(i=f.complete)&&i.apply(y,k);h.fire(b,v);h.fire("complete",v);j[d?"resolve":"reject"](k)}},_getUrlForSend:function(){var a=
this.config,c=a.uri,d=j.getComponents(a.url).query||"";return c.toString.call(c,a.serializeArray)+(d?(c.query.has()?"&":"?")+d:d)}})});
