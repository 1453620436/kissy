/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 9 14:05
*/
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(d,e){function m(d,c,a,j,k){if(typeof c==="function"){j=a;a=c;c=void 0}return h({type:k||"get",url:d,data:c,success:a,dataType:j})}var n=e("io/form-serializer"),h=e("io/base");e("io/xhr-transport");e("io/script-transport");e("io/jsonp");e("io/form");e("io/iframe-transport");e("io/methods");d.mix(h,{serialize:n.serialize,get:m,post:function(d,c,a,j){if(typeof c===
"function"){j=a;a=c;c=void 0}return m(d,c,a,j,"post")},jsonp:function(d,c,a){if(typeof c==="function"){a=c;c=void 0}return m(d,c,a,"jsonp")},getScript:d.getScript,getJSON:function(d,c,a){if(typeof c==="function"){a=c;c=void 0}return m(d,c,a,"json")},upload:function(d,c,a,j,k){if(typeof a==="function"){k=j;j=a;a=void 0}return h({url:d,type:"post",dataType:k,form:c,data:a,success:j})}});return d.IO=h});
KISSY.add("io/form-serializer",["dom"],function(d,e){function m(a){return a.replace(f,"\r\n")}var n=e("dom"),h=/^(?:select|textarea)/i,f=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,k){return d.param(c.getFormData(a),void 0,void 0,k||!1)},getFormData:function(j){var k=[],c={};d.each(n.query(j),function(i){if(i.elements){for(var i=i.elements,a=[],b=0;b<i.length;b++)a.push(i[b]);i=a}else i=[i];k.push.apply(k,
i)});k=d.filter(k,function(i){return i.name&&!i.disabled&&(i.checked||h.test(i.nodeName)||a.test(i.type))});d.each(k,function(i){var a=n.val(i),b;null!==a&&(a=d.isArray(a)?d.map(a,m):m(a),(b=c[i.name])?(b&&!d.isArray(b)&&(b=c[i.name]=[b]),b.push.apply(b,d.makeArray(a))):c[i.name]=a)});return c}}});
KISSY.add("io/base",["event/custom","promise","uri"],function(d,e){function m(b){var i=b.context;delete b.context;b=d.mix(d.clone(l),b,{deep:!0});b.context=i||b;var c,j=b.type,h=b.dataType,i=b.uri=g.resolve(b.url);b.uri.setQuery("");"crossDomain"in b||(b.crossDomain=!b.uri.isSameOriginAs(g));j=b.type=j.toUpperCase();b.hasContent=!k.test(j);if(b.processData&&(c=b.data)&&"string"!==typeof c)b.data=d.param(c,void 0,void 0,b.serializeArray);h=b.dataType=d.trim(h||"*").split(a);!("cache"in b)&&d.inArray(h[0],
["script","jsonp"])&&(b.cache=!1);b.hasContent||(b.data&&i.query.add(d.unparam(b.data)),!1===b.cache&&i.query.set("_ksTS",d.now()+"_"+d.guid()));return b}function n(b){var a=this;if(!(a instanceof n))return new n(b);n.superclass.constructor.call(a);f.Defer(a);a.userConfig=b;b=m(b);d.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});
var l;n.fire("start",{ajaxConfig:b,io:a});l=new (i[b.dataType[0]]||i["*"])(a);a.transport=l;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var c=b.dataType[0],j,k=b.timeout,h=b.context,g=b.headers,e=b.accepts;a.setRequestHeader("Accept",c&&e[c]?e[c]+("*"===c?"":", */*; q=0.01"):e["*"]);for(j in g)a.setRequestHeader(j,g[j]);if(b.beforeSend&&!1===b.beforeSend.call(h,a,b))return a;a.readyState=1;n.fire("send",{ajaxConfig:b,io:a});b.async&&0<k&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},
1E3*k));try{a.state=1,l.send()}catch(q){2>a.state&&(setTimeout(function(){throw q;},0),a._ioReady(-1,q.message))}return a}var h=e("event/custom"),f=e("promise"),c=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,j=function(b){return b},k=/^(?:GET|HEAD)$/,g=new (e("uri"))((d.Env.host.location||{}).href),c=g&&c.test(g.getScheme()),i={},l={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",
html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:d.parseJson,html:j,text:j,xml:d.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};l.converters.html=l.converters.text;d.mix(n,h.Target);d.mix(n,{isLocal:c,setupConfig:function(b){d.mix(l,b,{deep:!0})},setupTransport:function(b,a){i[b]=a},getTransport:function(b){return i[b]},getConfig:function(){return l}});return n});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(d,e){function m(k){var g=k.config,i=g.crossDomain,l=g.xdr||{},b=l.subDomain=l.subDomain||{};this.io=k;if(i&&!h.supportCORS){g=g.uri.getHostname();if(a.domain&&d.endsWith(g,a.domain)&&!1!==b.proxy)return new c(k);if("flash"===""+l.use||!j)return new f(k)}this.nativeXhr=h.nativeXhr(i);return this}var n=e("./base"),h=e("./xhr-transport-base"),f=e("./xdr-flash-transport"),c=e("./sub-domain-transport"),
a=d.Env.host.document,j=h.XDomainRequest_;d.augment(m,h.proto,{send:function(){this.sendInternal()}});n.setupTransport("*",m);return n});
KISSY.add("io/xhr-transport-base",["./base","ua"],function(d,e){function m(a,l){try{return new (l||c).XMLHttpRequest}catch(b){}}function n(a){var l;a.ifModified&&(l=a.uri,!1===a.cache&&(l=l.clone(),l.query.remove("_ksTS")),l=l.toString());return l}var h=e("./base"),f=e("ua"),c=d.Env.host,a=7<f.ieMode&&c.XDomainRequest,f={proto:{}},j={},k={};h.__lastModifiedCached=j;h.__eTagCached=k;f.nativeXhr=c.ActiveXObject?function(i,l){var b;if(!g&&i&&a)b=new a;else if(!(b=!h.isLocal&&m(i,l)))a:{try{b=new (l||
c).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}b=void 0}return b}:m;f.XDomainRequest_=a;var g=f.supportCORS="withCredentials"in f.nativeXhr();d.mix(f.proto,{sendInternal:function(){var i=this,l=i.io,b=l.config,c=i.nativeXhr,h=b.files,e=h?"post":b.type,f=b.async,m,o=l.mimeType,p=l.requestHeaders||{},l=l._getUrlForSend(),r=n(b),q,s;if(r){if(q=j[r])p["If-Modified-Since"]=q;if(q=k[r])p["If-None-Match"]=q}(m=b.username)?c.open(e,l,f,m,b.password):c.open(e,l,f);e=b.xhrFields||{};"withCredentials"in
e&&(g||delete e.withCredentials);for(s in e)try{c[s]=e[s]}catch(y){}o&&c.overrideMimeType&&c.overrideMimeType(o);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof c.setRequestHeader)for(s in p)c.setRequestHeader(s,p[s]);var x=b.hasContent&&b.data||null;h&&(o=x,p={},o&&(p=d.unparam(o)),p=d.mix(p,h),x=new FormData,d.each(p,function(a,i){d.isArray(a)?d.each(a,function(a){x.append(i+(b.serializeArray?"[]":""),a)}):x.append(i,a)}));c.send(x);!f||4===c.readyState?i._callback():
a&&c instanceof a?(c.onload=function(){c.readyState=4;c.status=200;i._callback()},c.onerror=function(){c.readyState=4;c.status=500;i._callback()}):c.onreadystatechange=function(){i._callback()}},abort:function(){this._callback(0,1)},_callback:function(i,c){var b=this.nativeXhr,g=this.io,e,f,m,w,o,p=g.config;try{if(c||4===b.readyState)if(a&&b instanceof a?(b.onerror=d.noop,b.onload=d.noop):b.onreadystatechange=d.noop,c)4!==b.readyState&&b.abort();else{e=n(p);var r=b.status;a&&b instanceof a||(g.responseHeadersString=
b.getAllResponseHeaders());e&&(f=b.getResponseHeader("Last-Modified"),m=b.getResponseHeader("ETag"),f&&(j[e]=f),m&&(k[m]=m));if((o=b.responseXML)&&o.documentElement)g.responseXML=o;var q=g.responseText=b.responseText;if(p.files&&q){var s,y;if(-1!==(s=q.indexOf("<body>")))y=q.lastIndexOf("</body>"),-1===y&&(y=q.length),q=q.slice(s+6,y);g.responseText=d.unEscapeHtml(q)}try{w=b.statusText}catch(x){w=""}!r&&h.isLocal&&!p.crossDomain?r=g.responseText?200:404:1223===r&&(r=204);g._ioReady(r,w)}}catch(z){setTimeout(function(){throw z;
},0),b.onreadystatechange=d.noop,c||g._ioReady(-1,z)}}});return f});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(d,e){function m(i,c,b){g||(g=!0,i='<object id="'+a+'" type="application/x-shockwave-flash" data="'+i+'" width="0" height="0"><param name="movie" value="'+i+'" /><param name="FlashVars" value="yid='+c+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',c=k.createElement("div"),f.prepend(c,k.body||k.documentElement),c.innerHTML=i)}function n(a){this.io=a}var h=e("./base"),f=e("dom"),c={},a="io_swf",j,k=
d.Env.host.document,g=!1;d.augment(n,{send:function(){var a=this,l=a.io,b=l.config;m((b.xdr||{}).src||d.config("base")+"io/assets/io.swf",1,1);j?(a._uid=d.guid(),c[a._uid]=a,j.send(l._getUrlForSend(),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){j.abort(this._uid)},_xdrResponse:function(a,d){var b,j=d.id,k,g=d.c,h=this.io;if(g&&(k=g.responseText))h.responseText=decodeURI(k);switch(a){case "success":b={status:200,statusText:"success"};
delete c[j];break;case "abort":delete c[j];break;case "timeout":case "transport error":case "failure":delete c[j],b={status:"status"in g?g.status:500,statusText:g.statusText||a}}b&&h._ioReady(b.status,b.statusText)}});h.applyTo=function(a,c,b){var a=c.split(".").slice(1),j=h;d.each(a,function(a){j=j[a]});j.apply(null,b)};h.xdrReady=function(){j=k.getElementById(a)};h.xdrResponse=function(a,d){var b=c[d.uid];b&&b._xdrResponse(a,d)};return n});
KISSY.add("io/sub-domain-transport",["event/dom","uri","dom","./xhr-transport-base"],function(d,e){function m(a){var c=a.config;this.io=a;c.crossDomain=!1}function n(){var a=this.io.config.uri.getHostname(),a=k[a];a.ready=1;h.detach(a.iframe,"load",n,this);this.send()}var h=e("event/dom"),f=e("uri"),c=e("dom"),a=e("./xhr-transport-base"),j=d.Env.host.document,k={};d.augment(m,a.proto,{send:function(){var d=this.io.config,i=d.uri,l=i.getHostname(),b;b=k[l];var e="/sub_domain_proxy.html";d.xdr&&d.xdr.subDomain&&
d.xdr.subDomain.proxy&&(e=d.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=a.nativeXhr(0,b.iframe.contentWindow))&&this.sendInternal():(b?d=b.iframe:(b=k[l]={},d=b.iframe=j.createElement("iframe"),c.css(d,{position:"absolute",left:"-9999px",top:"-9999px"}),c.prepend(d,j.body||j.documentElement),b=new f,b.setScheme(i.getScheme()),b.setPort(i.getPort()),b.setHostname(l),b.setPath(e),d.src=b.toString()),h.on(d,"load",n,this))}});return m});
KISSY.add("io/script-transport",["./base"],function(d,e){function m(d){if(!d.config.crossDomain)return new (n.getTransport("*"))(d);this.io=d;return this}var n=e("./base");n.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){d.globalEval(e);return e}}}});d.augment(m,{send:function(){var e=this,f=e.io,c=f.config;e.script=d.getScript(f._getUrlForSend(),
{charset:c.scriptCharset,success:function(){e._callback("success")},error:function(){e._callback("error")}})},_callback:function(d,e){var c=this.io;this.script&&(this.script=void 0,e||("error"!==d?c._ioReady(200,"success"):"error"===d&&c._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});n.setupTransport("script",m);return n});
KISSY.add("io/jsonp",["./base"],function(d,e){var m=e("./base"),n=d.Env.host;m.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});m.on("start",function(e){var f=e.io,c=f.config,e=c.dataType;if("jsonp"===e[0]){delete c.contentType;var a,j=c.jsonpCallback,k="function"===typeof j?j():j,g=n[k];c.uri.query.set(c.jsonp,k);n[k]=function(c){1<arguments.length&&(c=d.makeArray(arguments));a=[c]};f.fin(function(){n[k]=g;if(void 0===g)try{delete n[k]}catch(d){}else a&&g(a[0])});
f=c.converters;f.script=f.script||{};f.script.json=function(){return a[0]};e.length=2;e[0]="script";e[1]="json"}});return m});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(d,e){var m=e("./base"),n=e("dom"),h=e("./form-serializer"),f=Array.prototype.slice,c=d.Env.host.FormData;m.on("start",function(a){var j,e,a=a.io.config;if(e=a.form){j=n.get(e);e=a.data;for(var g=!1,i={},l=n.query("input",j),b=0,m=l.length;b<m;b++){var t=l[b];if("file"===t.type.toLowerCase()){g=!0;if(!c)break;var u=f.call(t.files,0);i[n.attr(t,"name")]=1<u.length?u:u[0]||null}}g&&c&&(a.files=a.files||{},d.mix(a.files,i),delete a.contentType);
!g||c?(j=h.getFormData(j),a.hasContent?(j=d.param(j,void 0,void 0,a.serializeArray),a.data=e?a.data+("&"+j):j):a.uri.query.add(j)):(e=a.dataType,a=e[0],"*"===a&&(a="text"),e.length=2,e[0]="iframe",e[1]=a)}});return m});
KISSY.add("io/iframe-transport",["dom","./base","event/dom","ua"],function(d,e){function m(a){var c=d.guid("io-iframe"),b=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(b?' src="'+b+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,k.body||k.documentElement);return a}function n(a,c,b){var e=[],j,g,h,m;d.each(a,function(a,i){j=d.isArray(a);g=d.makeArray(a);for(h=0;h<g.length;h++)m=k.createElement("input"),m.type="hidden",m.name=i+(j&&b?"[]":
""),m.value=g[h],f.append(m,c),e.push(m)});return e}function h(a){this.io=a}var f=e("dom"),c=e("./base"),a=e("event/dom"),j=e("ua"),k=d.Env.host.document,g=d.clone(c.getConfig().converters.text);g.json=function(a){return d.parseJson(d.unEscapeHtml(a))};c.setupConfig({converters:{iframe:g,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(h,{send:function(){function c(){a.on(h,"load error",e._callback,e);o.submit()}var e=this,b=e.io,k=b.config,g,h,v,w=k.data,o=f.get(k.form);
e.attrs={target:f.attr(o,"target")||"",action:f.attr(o,"action")||"",encoding:f.attr(o,"encoding"),enctype:f.attr(o,"enctype"),method:f.attr(o,"method")};e.form=o;h=m(b);f.attr(o,{target:h.id,action:b._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});w&&(v=d.unparam(w));v&&(g=n(v,o,k.serializeArray));e.fields=g;6===j.ie?setTimeout(c,0):c()},_callback:function(c){var e=this,b=e.form,k=e.io,c=c.type,g,h=k.iframe;if(h)if("abort"===c&&6===j.ie?setTimeout(function(){f.attr(b,
e.attrs)},0):f.attr(b,e.attrs),f.remove(this.fields),a.detach(h),setTimeout(function(){f.remove(h)},30),k.iframe=null,"load"===c)try{if((g=h.contentWindow.document)&&g.body)k.responseText=f.html(g.body),d.startsWith(k.responseText,"<?xml")&&(k.responseText=void 0);k.responseXML=g&&g.XMLDocument?g.XMLDocument:g;g?k._ioReady(200,"success"):k._ioReady(500,"parser error")}catch(m){k._ioReady(500,"parser error")}else"error"===c&&k._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
c.setupTransport("iframe",h);return c});
KISSY.add("io/methods",["promise","./base","uri"],function(d,e){function m(a){var c=a.responseText,e=a.responseXML,g=a.config,i=g.converters,l,b,h=g.contents,f=g.dataType;if(c||e){for(g=a.mimeType||a.getResponseHeader("Content-Type");"*"===f[0];)f.shift();if(!f.length)for(l in h)if(h[l].test(g)){f[0]!==l&&f.unshift(l);break}f[0]=f[0]||"text";for(l=0;l<f.length;l++)if("text"===f[l]&&void 0!==c){b=c;break}else if("xml"===f[l]&&void 0!==e){b=e;break}if(!b){var m={text:c,xml:e};d.each(["text","xml"],
function(a){var d=f[0];if(i[a]&&i[a][d]&&m[a])return f.unshift(a),b="text"===a?c:e,!1})}}h=f[0];for(g=1;g<f.length;g++){l=f[g];var n=i[h]&&i[h][l];if(!n)throw"no covert for "+h+" => "+l;b=n(b);h=l}a.responseData=b}var n=e("promise"),h=e("./base"),f=e("uri"),c=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;d.extend(h,n,{setRequestHeader:function(a,c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var d,e,
a=a.toLowerCase();if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders={};d=c.exec(this.responseHeadersString);)e[d[1].toLowerCase()]=d[2];d=e[a]}return void 0===d?null:d},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,c){if(2!==this.state){this.state=2;this.readyState=
4;var d;if(200<=a&&300>a||304===a)if(304===a)c="not modified",d=!0;else try{m(this),c="success",d=!0}catch(e){setTimeout(function(){throw e;},0),c="parser error"}else 0>a&&(a=0);this.status=a;this.statusText=c;var f=this.defer,l=this.config,b;if(b=this.timeoutTimer)clearTimeout(b),this.timeoutTimer=0;b=d?"success":"error";var n,t=[this.responseData,c,this],u=l.context,v={ajaxConfig:l,io:this};(n=l[b])&&n.apply(u,t);(n=l.complete)&&n.apply(u,t);h.fire(b,v);h.fire("complete",v);f[d?"resolve":"reject"](t)}},
_getUrlForSend:function(){var a=this.config,c=a.uri,d=f.getComponents(a.url).query||"";return c.toString.call(c,a.serializeArray)+(d?(c.query.has()?"&":"?")+d:d)}})});
