/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Apr 4 12:22
*/
KISSY.add("filter-menu/render-xtpl",["component/extension/content-xtpl"],function(i,f,j,k){j=function(b,a,g,l){var e=this.nativeCommands,c=this.utils;if("1.50"!==i.version)throw Error("current xtemplate file("+this.name+")(v1.50) need to be recompiled using current kissy(v"+i.version+")!");c=c.callCommand;e=e.include;a.write('<div id="ks-filter-menu-input-wrap-');var d=b.resolve(["id"]);a.write(d,!0);a.write('"\n     class="');var d={escape:1},h=[];h.push("input-wrap");d.params=h;if((d=c(this,b,d,
a,"getBaseCssClasses",2))&&d.isBuffer)a=d,d=l;a.write(d,!0);a.write('">\n    <div id="ks-filter-menu-placeholder-');d=b.resolve(["id"]);a.write(d,!0);a.write('"\n         class="');d={escape:1};h=[];h.push("placeholder");d.params=h;if((d=c(this,b,d,a,"getBaseCssClasses",4))&&d.isBuffer)a=d,d=l;a.write(d,!0);a.write('">\n        ');d=b.resolve(["placeholder"]);a.write(d,!0);a.write('\n    </div>\n    <input id="ks-filter-menu-input-');d=b.resolve(["id"]);a.write(d,!0);a.write('"\n           class="');
d={escape:1};h=[];h.push("input");d.params=h;if((c=c(this,b,d,a,"getBaseCssClasses",8))&&c.isBuffer)a=c,c=l;a.write(c,!0);a.write('"\n            autocomplete="off"/>\n</div>\n');c={};d=[];d.push("component/extension/content-xtpl");c.params=d;f("component/extension/content-xtpl");c.params[0]=k.resolve(c.params[0]);if((b=e.call(this,b,c,a,11,g))&&b.isBuffer)a=b,b=l;a.write(b,!1);return a};j.TPL_NAME=k.name;return j});
KISSY.add("filter-menu/render",["menu","./render-xtpl","component/extension/content-render"],function(i,f){var j=f("menu"),k=f("./render-xtpl"),b=f("component/extension/content-render");return j.getDefaultRender().extend([b],{beforeCreateDom:function(a,b){i.mix(b,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},
{ATTRS:{contentTpl:{value:k}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})});
KISSY.add("filter-menu",["menu","filter-menu/render"],function(i,f){var j=f("menu"),k=f("filter-menu/render");return j.extend({bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(b){this.callSuper(b);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b;b=this.get("filterInput");var a=this.get("highlightedItem");this.set("filterStr",b.val());b=b.val();this.get("allowMultiple")&&(b=b.replace(/^.+,/,""));if(!b&&
a)a.set("highlighted",!1);else if(b&&(!a||!a.get("visible")))(a=this._getNextEnabledHighlighted(0,1))&&a.set("highlighted",!0)},_onSetFilterStr:function(b){this.filterItems(b)},filterItems:function(b){var a=this.get("prefixCls"),g=this.get("placeholderEl"),f=this.get("filterInput");g[b?"hide":"show"]();if(this.get("allowMultiple")){var g=[],e;e=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var c=[];e&&(c=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(b)?(g=[],e&&(g=c,e=c[c.length-1],(c=(c=this.get("highlightedItem"))&&
c.get("content"))&&-1<c.indexOf(e)&&e&&(g[g.length-1]=c),f.val(g.join(",")+",")),b=""):(e&&(b=e[2]||""),g=c);this.get("enteredItems").length!==g.length&&this.set("enteredItems",g)}var f=this.get("children"),d=b&&RegExp(i.escapeRegExp(b),"ig");i.each(f,function(c){var e=c.get("content");b?-1<e.indexOf(b)?(c.set("visible",!0),c.get("el").html(e.replace(d,function(b){return'<span class="'+a+'menuitem-hit">'+b+"</span>"}))):c.set("visible",!1):(c.get("el").html(e),c.set("visible",!0))})},reset:function(){this.set("filterStr",
"");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:k}},xclass:"filter-menu"})});
