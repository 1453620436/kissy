/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 31 19:28
*/
KISSY.add("filter-menu/render-xtpl",["component/extension/content-xtpl"],function(h,g,k,i){h=function(a,d,b,h,e){var f,l=this.nativeCommands,c=this.utils;if("1.50"!==d.version)throw Error("current xtemplate file("+this.name+")(v1.50) need to be recompiled using current kissy(v"+d.version+")!");"undefined"!==typeof i&&i.kissy&&(f=i);d=c.callCommand;l=l.include;b.write('<div id="ks-filter-menu-input-wrap-');c=a.resolve(["id"]);b.write(c,!0);b.write('"\n     class="');var c={escape:1},j=[];j.push("input-wrap");
c.params=j;if((c=d(this,a,c,b,"getBaseCssClasses",2))&&c.isBuffer)b=c,c=e;b.write(c,!0);b.write('">\n    <div id="ks-filter-menu-placeholder-');c=a.resolve(["id"]);b.write(c,!0);b.write('"\n         class="');c={escape:1};j=[];j.push("placeholder");c.params=j;if((c=d(this,a,c,b,"getBaseCssClasses",4))&&c.isBuffer)b=c,c=e;b.write(c,!0);b.write('">\n        ');c=a.resolve(["placeholder"]);b.write(c,!0);b.write('\n    </div>\n    <input id="ks-filter-menu-input-');c=a.resolve(["id"]);b.write(c,!0);b.write('"\n           class="');
c={escape:1};j=[];j.push("input");c.params=j;if((d=d(this,a,c,b,"getBaseCssClasses",8))&&d.isBuffer)b=d,d=e;b.write(d,!0);b.write('"\n            autocomplete="off"/>\n</div>\n');d={};c=[];c.push("component/extension/content-xtpl");d.params=c;f&&(g("component/extension/content-xtpl"),d.params[0]=f.resolve(d.params[0]));if((a=l.call(this,a,d,b,11,h))&&a.isBuffer)b=a,a=e;b.write(a,!1);return b};h.TPL_NAME=i.name;return h});
KISSY.add("filter-menu/render",["menu","./render-xtpl","component/extension/content-render"],function(h,g){var k=g("menu"),i=g("./render-xtpl"),a=g("component/extension/content-render");return k.getDefaultRender().extend([a],{beforeCreateDom:function(a,b){h.mix(b,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},
{ATTRS:{contentTpl:{value:i}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})});
KISSY.add("filter-menu",["menu","filter-menu/render"],function(h,g){var k=g("menu"),i=g("filter-menu/render");return k.extend({bindUI:function(){this.get("filterInput").on("input",this.handleFilterEvent,this)},handleMouseEnterInternal:function(a){this.callSuper(a);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("filterInput");var d=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&
d)d.set("highlighted",!1);else if(a&&(!d||!d.get("visible")))(d=this._getNextEnabledHighlighted(0,1))&&d.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var d=this.get("prefixCls"),b=this.get("placeholderEl"),g=this.get("filterInput");b[a?"hide":"show"]();if(this.get("allowMultiple")){var b=[],e;e=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var f=[];e&&(f=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(b=[],e&&(b=f,e=f[f.length-1],(f=(f=this.get("highlightedItem"))&&
f.get("content"))&&-1<f.indexOf(e)&&e&&(b[b.length-1]=f),g.val(b.join(",")+",")),a=""):(e&&(a=e[2]||""),b=f);this.get("enteredItems").length!==b.length&&this.set("enteredItems",b)}var g=this.get("children"),i=a&&RegExp(h.escapeRegExp(a),"ig");h.each(g,function(b){var e=b.get("content");a?-1<e.indexOf(a)?(b.set("visible",!0),b.get("el").html(e.replace(i,function(a){return'<span class="'+d+'menuitem-hit">'+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(e),b.set("visible",!0))})},reset:function(){this.set("filterStr",
"");this.set("enteredItems",[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:i}},xclass:"filter-menu"})});
