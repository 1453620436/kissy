/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 5 23:30
*/
KISSY.add("url",["querystring","path"],function(v,k,w,p){function l(b){":"===b.slice(-1)&&(b=b.slice(0,-1));return"http"===b||"https"===b||"ftp"===b||"gopher"===b||"file"===b}function j(b,f){return encodeURI(b).replace(f,function(b){b=b.charCodeAt(0).toString(16);return"%"+(1===b.length?"0"+b:b)})}var m=k("querystring"),q=k("path"),n=/[#\/\?@]/g,r=/[#\?]/g,s=/[#@]/g,t=/#/g,u=RegExp("^([\\w\\d+.-]+:)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?([^?#]+)?(\\?[^#]*)?(#.*)?$"),
o={protocol:1,auth:2,hostname:3,port:4,pathname:5,search:6,hash:7},i={parse:function(b,f){var d=b.match(u)||[],a={},e;for(e in o)a[e]=d[o[e]];a.protocol&&(a.protocol=a.protocol.toLowerCase());a.hostname&&(a.hostname=a.hostname.toLowerCase());if((d=a.protocol)&&!l(d.slice(0,-1))){if(-1===b.lastIndexOf(d+"//"))return b=b.slice(0,d.length)+"//"+b.slice(d.length),i.parse(b,f)}else a.hostname&&!a.pathname&&(a.pathname="/");a.path=a.pathname;a.search&&(a.path+=a.search);a.host=a.hostname;a.port&&(a.host=
a.hostname+":"+a.port);a.search&&(a.query=a.search.substring(1));f&&a.query&&(a.query=m.parse(a.query));a.href=i.format(a);return a},format:function(b,f){var d=b.host;void 0===d&&(d=b.hostname,b.port&&(d+=":"+b.port));var a=b.search,e=b.query;void 0===a&&void 0!==e&&("string"!==typeof e&&(e=m.stringify(e,void 0,void 0,f)),a="?"+e);a&&"?"!==a.charAt(0)&&(a="?"+a);(e=b.hash||"")&&"#"!==e.charAt(0)&&(e="#"+e);var g=b.pathname||"",h=[],c;if(c=b.protocol)":"!==c.slice(-1)&&(c+=":"),h.push(j(c,n));if(void 0!==
d){c&&l(c)&&h.push("//");if(c=b.auth)h.push(j(c,n)),h.push("@");h.push(encodeURIComponent(d))}g&&h.push(j(g,r));a&&h.push(j(a,s));e&&h.push("#"+j(e.substring(1),t));return h.join("")},resolve:function(b,f){for(var d=0,a,e="protocol,auth,host,pathname,search,hash".split(","),g={},b=i.parse(b),f=i.parse(f),h=0;h<e.length;h++)if(a=e[h],d)g[a]=f[a];else if(g[a]=b[a],"pathname"===a){var c=f.pathname;if(c){d=1;if("/"!==c.charAt(0))if(g.hostname&&!g.pathname)c="/"+c;else if(g.pathname){if("/."===c.slice(-2)||
"/.."===c.slice(-3)||"."===c||".."===c)c+="/";a=g.pathname.lastIndexOf("/");-1!==a&&(c=g.pathname.slice(0,a+1)+c)}g.pathname=q.normalize(c)}}else"search"===a?f.search&&(g.search=f.search,d=1):f[a]&&(d=d||g[a]!==f[a],g[a]=f[a]);return i.format(g)}};p.exports=i});
