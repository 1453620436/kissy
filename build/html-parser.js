/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 14 22:26
*/
KISSY.add("html-parser","html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(","),function(d,a){var h=a("html-parser/dtd"),i=a("html-parser/lexer/lexer"),b=a("html-parser/parser"),n=a("html-parser/writer/basic"),c=a("html-parser/writer/beautify"),l=a("html-parser/writer/minify"),
o=a("html-parser/writer/filter"),m=a("html-parser/nodes/cdata"),g=a("html-parser/nodes/comment"),k=a("html-parser/nodes/node"),p=a("html-parser/nodes/tag"),e=a("html-parser/nodes/text");return{CData:m,Comment:g,Node:k,Tag:p,Text:e,Lexer:i,Parser:b,BasicWriter:n,BeautifyWriter:c,MinifyWriter:l,Filter:o,DTD:h,serialize:function(k,f){var e=new n;k.writeHtml(e,f);return e.getHtml()},parse:function(k){return(new b(k)).parse()}}});
KISSY.add("html-parser/dtd",["util"],function(d,a,h,i){var d=a("util").merge,a={isindex:1,fieldset:1},b={input:1,button:1,select:1,textarea:1,label:1},h=d({a:1},b),n=d({iframe:1},h),c={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},l={ins:1,del:1,script:1,style:1},o=d({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},l),m=
d({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},o),g=d({p:1},m),b=d({iframe:1},m,b),m={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,
a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},k=d({a:1},b),p={tr:1},e={"#text":1},j=d({param:1},m),f=d({form:1},a,n,c,g),v={li:1},r={base:1,link:1,meta:1,title:1},s=d(r,{style:1,script:1}),q={head:1,body:1},u={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},i=i.exports={$nonBodyContent:d({html:1},q,r),$block:u,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},
$inline:k,$body:d({script:1,style:1},u),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,
area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:q,head:s,style:e,body:f,base:{},link:{},meta:{},title:e,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:f,td:f,br:{},th:f,center:f,kbd:k,button:d(g,c),basefont:{},h5:k,h4:k,samp:k,h6:k,ol:v,h1:k,h3:k,option:e,h2:k,form:d(a,n,c,g),select:{optgroup:1,option:1},font:k,ins:k,menu:v,abbr:k,label:k,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},
code:k,script:e,tfoot:p,cite:k,li:f,input:{},iframe:f,strong:k,textarea:e,noframes:f,big:k,small:k,span:k,hr:{},dt:k,sub:k,optgroup:{option:1},param:{},bdo:k,"var":k,div:f,object:j,sup:k,dd:f,strike:k,area:{},dir:v,map:d({area:1,form:1,p:1},a,l,c),applet:j,dl:{dt:1,dd:1},del:k,isindex:{},fieldset:d({legend:1},m),thead:p,ul:v,acronym:k,b:k,a:b,blockquote:f,caption:k,i:k,u:k,tbody:p,s:k,address:d(n,g),tt:k,legend:k,q:k,pre:d(o,h),p:k,em:k,dfn:k},a="article,figure,nav,aside,section,footer".split(","),
t;for(t in i)for(var w in i[t])if("div"===w)for(d=0;d<a.length;d++)i[t][a[d]]=i[t][w];for(d=0;d<a.length;d++)i[a[d]]=i.div});
KISSY.add("html-parser/lexer/lexer","./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(","),function(d,a){function h(k,g){this.page=new b(k);this.cursor=new i;this.nodeFactory=this;this.cfg=g||{}}var i=a("./cursor"),b=a("./page"),n=a("../nodes/text"),c=a("../nodes/cdata"),l=a("../utils"),o=a("../nodes/attribute"),m=a("../nodes/tag"),g=a("../nodes/comment");h.prototype={constructor:h,setPosition:function(k){this.cursor.position=k},getPosition:function(){return this.cursor.position},
nextNode:function(k){var g,e,j=this.cursor,f=this.page;g=j.position;e=f.getChar(j);switch(e){case -1:k=null;break;case "<":e=f.getChar(j);if(e===-1)k=this.makeString(g,j.position);else if(e==="/"||l.isLetter(e)){f.ungetChar(j);k=this.parseTag(g)}else if("!"===e||"?"===e){e=f.getChar(j);if(e===-1)k=this.makeString(g,j.position);else if(">"===e)k=this.makeComment(g,j.position);else{f.ungetChar(j);if("-"===e)k=this.parseComment(g,k);else{f.ungetChar(j);k=this.parseTag(g)}}}else{f.ungetChar(j);k=this.parseString(g,
k)}break;default:f.ungetChar(j);k=this.parseString(g,k)}return k},makeComment:function(k,g){var e;e=g-k;if(0!==e){if(2>e)return this.makeString(k,g);e=this.nodeFactory.createCommentNode(this.page,k,g)}else e=null;return e},makeString:function(k,g){var e=null;g-k>0&&(e=this.nodeFactory.createStringNode(this.page,k,g));return e},makeCData:function(k,g){var e=null;g-k>0&&(e=this.nodeFactory.createCDataNode(this.page,k,g));return e},makeTag:function(k,g,e){var j;j=g-k;if(0!==j){if(2>j)return this.makeString(k,
g);k=this.nodeFactory.createTagNode(this.page,k,g,e)}else k=null;return k},createTagNode:function(k,g,e,j){return new m(k,g,e,j)},createStringNode:function(g,p,e){return new n(g,p,e)},createCDataNode:function(g,p,e){return new c(g,p,e)},createCommentNode:function(k,p,e){return new g(k,p,e)},parseTag:function(g){var p,e=[],j=[],f,b=this.cfg.strict,r=this.page,a=0,c=this.cursor;for(e[0]=c.position;!p;){e[a+1]=c.position;f=r.getChar(c);switch(a){case 0:if(f===-1||">"===f||"<"===f){if("<"===f){r.ungetChar(c);
e[a+1]=c.position}p=true}else if(f==="/"||l.isValidAttributeNameStartChar(f))a=1;break;case 1:if(-1===f||">"===f||"<"===f){if("<"===f){r.ungetChar(c);e[a+1]=c.getPosition}this.standalone(j,e);p=true}else if(l.isWhitespace(f)){e[6]=e[2];a=6}else"="===f&&(a=2);break;case 2:if(-1===f||">"===f){this.standalone(j,e);p=true}else if("'"===f){a=4;e[4]=e[3]}else if('"'===f){a=5;e[5]=e[3]}else l.isWhitespace(f)||(a=3);break;case 3:if(-1===f||">"===f){this.naked(j,e);p=true}else if(l.isWhitespace(f)){this.naked(j,
e);e[0]=e[4];a=0}break;case 4:if(-1===f){this.singleQuote(j,e);p=true}else if("'"===f){this.singleQuote(j,e);e[0]=e[5]+1;a=0}break;case 5:if(-1===f){this.doubleQuote(j,e);p=true}else if('"'===f){this.doubleQuote(j,e);e[0]=e[6]+1;a=0}break;case 6:if(-1===f){this.standalone(j,e);e[0]=e[6];r.ungetChar(c);a=0}else if("="===f){e[2]=e[6];e[3]=e[7];a=2}else if(!l.isWhitespace(f)){this.standalone(j,e);e[0]=e[6];r.ungetChar(c);a=0}break;default:throw Error("how ** did we get in state "+a);}if(b&&f===-1&&j.length)throw Error(j[0].name+
" syntax error at row "+(r.row(c)+1)+" , col "+(r.col(c)+1));}return this.makeTag(g,c.position,j)},parseComment:function(g,a){var e,j,f=this.page,b=this.cursor,c;e=false;for(c=0;!e;){j=f.getChar(b);if(-1===j)e=true;else switch(c){case 0:if(">"===j)e=true;else if("-"===j)c=1;else return this.parseString(g,a);break;case 1:if("-"===j){j=f.getChar(b);if(-1===j)e=true;else if(">"===j)e=true;else{f.ungetChar(b);c=2}}else return this.parseString(g,a);break;case 2:if("-"===j)c=3;else if(-1===j)return this.parseString(g,
a);break;case 3:c="-"===j?4:2;break;case 4:">"===j?e=true:l.isWhitespace(j)||(c=2);break;default:throw Error("how ** did we get in state "+c);}}return this.makeComment(g,b.position)},parseString:function(g,a){for(var e=0,j,f=this.page,c=this.cursor,b=0;!e;){j=f.getChar(c);if(-1===j)e=1;else if(a&&0===b&&('"'===j||"'"===j))b=j;else if(a&&0!==b&&"\\"===j){j=f.getChar(c);-1!==j&&"\\"!==j&&j!==b&&f.ungetChar(c)}else if(a&&j===b)b=0;else if(a&&0===b&&j==="/"){j=f.getChar(c);if(-1===j)e=1;else if("/"===
j){do j=f.getChar(c);while(-1!==j&&"\n"!==j)}else if("*"===j){do{do j=f.getChar(c);while(-1!==j&&"*"!==j);j=f.getChar(c);j==="*"&&f.ungetChar(c)}while(-1!==j&&"/"!==j)}else f.ungetChar(c)}else if(0===b&&"<"===j){j=f.getChar(c);if(-1===j)e=1;else{if("/"===j||l.isLetter(j)||"!"===j||"?"===j){e=1;f.ungetChar(c)}f.ungetChar(c)}}}return this.makeString(g,c.position)},parseCDATA:function(g,c){var e,j,f,a,b,h,d=this.cursor,i=this.page;e=d.position;j=0;f=false;a="";for(h=false;!f;){b=i.getChar(d);switch(j){case 0:switch(b){case -1:f=
true;break;case "'":g&&!h&&(""===a?a="'":"'"===a&&(a=""));break;case '"':g&&!h&&(""===a?a='"':'"'===a&&(a=""));break;case "\\":if(g&&""!==a){b=i.getChar(d);-1===b?f=true:b!=="\\"&&b!==a&&i.ungetChar(d)}break;case "/":if(g&&""===a){b=i.getChar(d);if(-1===b)f=true;else if("/"===b)h=true;else if("*"===b){do{do b=i.getChar(d);while(-1!==b&&"*"!==b);b=i.getChar(d);b==="*"&&i.ungetChar(d)}while(-1!==b&&"/"!==b)}else i.ungetChar(d)}break;case "\n":h=false;break;case "<":g?""===a&&(j=1):j=1}break;case 1:switch(b){case -1:f=
true;break;case "/":j=!c||i.getText(d.position,d.position+c.length)===c&&!i.getText(d.position+c.length,d.position+c.length+1).match(/\w/)?2:0;break;case "!":b=i.getChar(d);if(-1===b)f=true;else if("-"===b){b=i.getChar(d);-1===b?f=true:j="-"===b?3:0}else j=0;break;default:j=0}break;case 2:h=false;if(-1===b)f=true;else if(l.isLetter(b)){f=true;i.ungetChar(d);i.ungetChar(d);i.ungetChar(d)}else j=0;break;case 3:h=false;if(-1===b)f=true;else if("-"===b){b=i.getChar(d);if(-1===b)f=true;else if("-"===b){b=
i.getChar(d);if(-1===b)f=true;else if(">"===b)j=0;else{i.ungetChar(d);i.ungetChar(d)}}else i.ungetChar(d)}break;default:throw Error("unexpected "+j);}}return this.makeCData(e,d.position)},singleQuote:function(g,b){var e=this.page;g.push(new o(e.getText(b[1],b[2]),"=",e.getText(b[4]+1,b[5]),"'"))},doubleQuote:function(g,b){var e=this.page;g.push(new o(e.getText(b[1],b[2]),"=",e.getText(b[5]+1,b[6]),'"'))},standalone:function(g,b){g.push(new o(this.page.getText(b[1],b[2])))},naked:function(g,b){var e=
this.page;g.push(new o(e.getText(b[1],b[2]),"=",e.getText(b[3],b[4])))}};return h});KISSY.add("html-parser/lexer/cursor",[],function(){function d(a){this.position=a||0}d.prototype={constructor:d,advance:function(){this.position++},clone:function(){var a=new d;a.position=this.position;return a},retreat:function(){this.position=Math.max(--this.position,0)}};return d});
KISSY.add("html-parser/lexer/page",["./index"],function(d,a){function h(b){this.source=b;this.lineIndex=new i}var i=a("./index");h.prototype={constructor:h,getChar:function(b){var a=this.source,c=b.position;if(c>=a.length)return-1;var h=a.charAt(c);b.advance();"\r"===h&&(h="\n",c=b.position,"\n"===a.charAt(c)&&b.advance());"\n"===h&&this.lineIndex.add(b);return h},ungetChar:function(b){var a=this.source;b.retreat();var c=b.position,h=a.charAt(c);"\n"===h&&0!==c&&(h=a.charAt(c-1),"\r"===h&&b.retreat())},
getText:function(b,a){return this.source.slice(b,a)},row:function(b){return this.lineIndex.row(b)},col:function(b){return this.lineIndex.col(b)}};return h});
KISSY.add("html-parser/lexer/index",[],function(){function d(){this.lineCursors=[]}d.prototype={constructor:d,add:function(a){var h;a:{h=this.lineCursors;for(var d=a.position,b=0;b<h.length;b++){var n=h[b].position;if(n===d){h=-1;break a}if(n>d)break}h=b}-1!==h&&this.lineCursors.splice(h,0,a.clone())},remove:function(a){var h=this.lineCursors,d;a:{d=this.lineCursors;for(var a=a.position,b=0;b<d.length;b++){var n=d[b].position;if(n===a){d=b;break a}if(n<a)break}d=-1}-1!==d&&h.splice(d,1)},row:function(a){for(var h=
this.lineCursors,d=0;d<h.length;d++)if(h[d].position>a.position)return d-1;return d},col:function(a){var d=0,i=this.lineCursors[this.row(a)-1];i&&(d=i.position);return a.position-d}};return d});
KISSY.add("html-parser/nodes/text",["./node","util"],function(d,a){function h(b){"string"===typeof b?(this.nodeValue=b,h.superclass.constructor.apply(this,[null,-1,-1])):(h.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}var i=a("./node");a("util").extend(h,i,{writeHtml:function(b,a){var c;if(!a||!1!==(c=a.onText(this)))c&&this!==c?c.writeHtml(b,a):b.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:h.superclass.toHtml.apply(this,
arguments)}});return h});
KISSY.add("html-parser/nodes/node",[],function(){function d(a){var d=0;a.replace(/\n/g,function(){d++});return d}function a(a,d,b){this.parentNode=null;this.page=a;this.startPosition=d;this.endPosition=b;this.nextSibling=this.previousSibling=this.nodeName=null}a.prototype={constructor:a,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=d(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=d(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");a.push(this.toHtml());return a.join("")}};return a});
KISSY.add("html-parser/nodes/cdata",["./text","util"],function(d,a){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}var i=a("./text");a("util").extend(h,i,{writeHtml:function(b,a){var c;if(!a||!1!==(c=a.onCData(this)))c&&this!==c?c.writeHtml(b,a):b.cdata(this.toHtml())}});return h});
KISSY.add("html-parser/utils",[],function(){return{isBooleanAttribute:function(d){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(d)},collapseWhitespace:function(d){return d.replace(/[\s\xa0]+/g," ")},isLetter:function(d){return"a"<=d&&"z">=d||"A"<=d&&"Z">=d},isValidAttributeNameStartChar:function(d){return!this.isWhitespace(d)&&'"'!==d&&"'"!==d&&">"!==d&&d!==""<""&&"/"!==d&&"="!==d},isWhitespace:function(d){return/^[\s\xa0]$/.test(d)}}});
KISSY.add("html-parser/nodes/attribute",["util"],function(d,a){function h(b,a,c,d){this.nodeType=2;this.name=b;this.assignment=a;this.value=c;this.quote=d}var i=a("util");h.prototype={clone:function(){var b=new h;i.mix(b,this);return b},equals:function(b){return this.name===b.name&&this.value===b.value&&this.nodeType===b.nodeType}};h.prototype.clone=function(){var b=new h;i.mix(b,this);return b};return h});
KISSY.add("html-parser/nodes/tag",["./node","./attribute","../dtd","util"],function(d,a){function h(g,b,a){g.nodeName=g.tagName=b.toLowerCase();g._updateSelfClosed();m.each(a,function(b,a){g.setAttribute(a,b)})}function i(g,b,a,e){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=e||[];this.nodeType=1;if("string"===typeof g)h.apply(null,[this].concat(m.makeArray(arguments)));else{i.superclass.constructor.apply(this,arguments);e=this.attributes;e[0]&&(this.nodeName=e[0].name.toLowerCase(),
this.tagName=this.nodeName.replace(/\//,""),this._updateSelfClosed(),e.splice(0,1));var c=e[e.length-1];if(c=!(!c||!/\/$/.test(c.name)))e.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||c}this.closedEndPosition=this.closedStartPosition=-1}function b(g){var b=g.childNodes;g.firstChild=b[0];g.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=g);if(1<b.length){for(var a=0;a<b.length-1;a++)b[a].nextSibling=b[a+1],b[a+1].previousSibling=b[a],b[a+1].parentNode=
g;b[b.length-1].nextSibling=null}}function n(g,b){if(g&&g.length)for(var a=0;a<g.length;a++)if(g[a].name===b)return g[a];return null}var c=a("./node"),l=a("./attribute"),o=a("../dtd"),m=a("util");m.extend(i,c,{_updateSelfClosed:function(){this.isSelfClosed=!!o.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var g=new i,b=[];m.each(this.attributes,function(g){b.push(g.clone())});m.mix(g,{childNodes:[],firstChild:null,
lastChild:null,attributes:b,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return g},setTagName:function(g){(this.nodeName=this.tagName=g)&&this._updateSelfClosed()},equals:function(g){if(!g||this.nodeName!==g.nodeName||this.nodeType!==g.nodeType||this.attributes.length!==g.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(g.attributes[b]))return 0;
return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(g){this.childNodes.push(g);b(this)},replace:function(g){var a=g.parentNode.childNodes,c=m.indexOf(g,a);a[c]=this;b(g.parentNode)},replaceChild:function(g,a){var c=this.childNodes,e=m.indexOf(a,c);c[e]=g;b(this)},prepend:function(g){this.childNodes.unshift(g);b(this)},insertBefore:function(g){var a=g.parentNode.childNodes,c=m.indexOf(g,a);a.splice(c,0,this);b(g.parentNode)},insertAfter:function(b){var a=b.parentNode.childNodes,
c=m.indexOf(b,a);c===a.length-1?b.parentNode.appendChild(this):this.insertBefore(b.parentNode.childNodes[[c+1]])},empty:function(){this.childNodes=[];b(this)},removeChild:function(g){var a=g.parentNode.childNodes,c=m.indexOf(g,a);a.splice(c,1);b(g.parentNode)},getAttribute:function(b){return(b=n(this.attributes,b))&&b.value},setAttribute:function(b,a){var c=n(this.attributes,b);c?c.value=a:this.attributes.push(new l(b,"=",a,'"'))},removeAttribute:function(b){(b=n(this.attributes,b))&&this.attributes.splice(m.indexOf(b,
this.attributes),1)},filterChildren:function(){var b=this;if(!b.isChildrenFiltered){var a=new (d.require("html-parser/writer/basic"));b._writeChildrenHTML(a);a=(new (d.require("html-parser/parser"))(a.getHtml())).parse().childNodes;b.empty();m.each(a,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHtml:function(b,a){var c=this,e;e=c.tagName;if("!doctype"===e)b.append(this.toHtml()+"\n");else{c.__filter=a;c.isChildrenFiltered=0;if(a){if(!(e=a.onTagName(e)))return;c.tagName=e;e=a.onTag(c);
if(!1===e)return;e&&(c=e);if(1!==c.nodeType){c.writeHtml(b,a);return}if(!c.tagName){c._writeChildrenHTML(b);return}}b.openTag(c);for(var j=c.attributes,f=0;f<j.length;f++){var d=j[f];e=d.name;if(a){if(!(e=a.onAttributeName(e,c)))continue;d.name=e;if(!1===a.onAttribute(d,c))continue}b.attribute(d,c)}b.openTagClose(c);c.isSelfClosed||(c._writeChildrenHTML(b),b.closeTag(c))}},_writeChildrenHTML:function(b){var a=this.isChildrenFiltered?0:this.__filter;m.each(this.childNodes,function(c){c.writeHtml(b,
a)})},outerHtml:function(){var b=new (d.require("html-parser/writer/basic"));this.writeHtml(b);return b.getHtml()}});return i});
KISSY.add("html-parser/nodes/comment",["./text","util"],function(d,a){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}var i=a("./text");a("util").extend(h,i,{writeHtml:function(b,a){var c;if(!a||!1!==(c=a.onComment(this)))c&&this!==c?c.writeHtml(b,a):b.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var b=i.superclass.toHtml.apply(this,arguments);return b.substring(4,b.length-3)}});return h});
KISSY.add("html-parser/parser","util,./dtd,./nodes/tag,./nodes/fragment,./lexer/lexer,./nodes/document,./scanner".split(","),function(d,a){function h(b,a){this.originalHTML=b=l.trim(b);b=/^(<!doctype|<html|<body)/i.test(b)?"<document>"+b+"</document>":"<body>"+b+"</body>";this.lexer=new k(b);this.opts=a||{}}function i(b){var a=n(b,"body",3);if(a){var b=a.parentNode,c=b.childNodes,g=l.indexOf(a,c);if(g!==c.length-1){c=c.slice(g+1,c.length);for(g=0;g<c.length;g++){b.removeChild(c[g]);c[g].tagName===
"body"?l.each(c[g].childNodes,function(b){a.appendChild(b)}):a.appendChild(c[g])}}}return a}function b(b){var a=b.childNodes,c,g,e=o.p,d=0;for(g=0;g<a.length;g++){c=a[g];if(c.nodeType===3||c.nodeType===1&&e[c.nodeName]){d=1;break}}if(d){var d=[],h=new m;h.nodeName=h.tagName="p";for(g=0;g<a.length;g++){c=a[g];if(c.nodeType===3||c.nodeType===1&&e[c.nodeName])h.appendChild(c);else{if(h.childNodes.length){d.push(h);h=h.clone()}d.push(c)}}h.childNodes.length&&d.push(h);b.empty();for(g=0;g<d.length;g++)b.appendChild(d[g])}}
function n(b,a,c){if(c===0)return 0;typeof c==="number"&&c--;var g=b.childNodes;if(g)for(var e=0;e<g.length;e++){if(g[e].tagName===a)return g[e];if(b=n(g[e],a,c))return b}return 0}function c(b){for(var a=[].concat(b.childNodes),c=0;c<a.length;c++)if(a[c].nodeName==="html"){for(var g=a[c],e=0;e<c;e++)a[e].nodeType===3&&!l.trim(a[e].toHtml())&&b.removeChild(a[e]);for(;g.firstChild&&g.firstChild.nodeType===3&&!l.trim(g.firstChild.toHtml());)g.removeChild(g.firstChild);break}}var l=a("util"),o=a("./dtd"),
m=a("./nodes/tag"),g=a("./nodes/fragment"),k=a("./lexer/lexer"),p=a("./nodes/document"),e=a("./scanner");h.prototype={constructor:h,elements:function(){var a,f,d=this.lexer,h=this.opts;f=a=d.nextNode();if(a.tagName!=="document"){f=new p;f.appendChild(a)}f.nodeType=9;e.getScanner("div").scan(a,d,h);(a=i(f))&&h.autoParagraph&&b(a);c(f);var h=this.originalHTML,k=new g;f=/^(<!doctype|<html|<body)/i.test(h)?f.childNodes:a.childNodes;l.each(f,function(b){k.appendChild(b)});return k},parse:function(){return this.elements()}};
return h});KISSY.add("html-parser/nodes/fragment",["./tag","util"],function(d,a){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}var i=a("./tag");a("util").extend(h,i,{writeHtml:function(b,a){this.__filter=a;this.isChildrenFiltered=0;if(a)a.onFragment(this);this._writeChildrenHTML(b)}});return h});
KISSY.add("html-parser/nodes/document",["./tag","util"],function(d,a){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}var i=a("./tag");a("util").extend(h,i,{writeHtml:function(b,a){this.__filter=a;this._writeChildrenHTML(b)}});return h});
KISSY.add("html-parser/scanner",["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"],function(d,a){var h=a("./scanners/tag-scanner"),i=a("./scanners/special-scanners");a("./scanners/quote-cdata-scanner");a("./scanners/textarea-scanner");return{getScanner:function(b){return i[b]||h}}});
KISSY.add("html-parser/scanners/tag-scanner",["../dtd","../nodes/tag","./special-scanners","util"],function(d,a){function h(a,c){function d(){f.childNodes.length&&(f.insertAfter(m),m=f,f=a.clone())}a.closed=1;if(!c.fixByDtd)return 0;var e=1,j=[].concat(a.childNodes);l.each(j,function(b){if(!i(a,b))return e=0,!1});if(e)return 0;for(var f=a.clone(),m=a,r=[],s=0;s<j.length;s++){var q=j[s];if(i(f,q))f.appendChild(q);else if(1===q.nodeType){var u=q.tagName;if(b.$listItem[u]){d();var q=o[q.tagName],t=new n;
for(t.nodeName=t.tagName=q;s<j.length;){if(j[s].tagName===u)t.appendChild(j[s]);else if(3===j[s].nodeType&&l.trim(j[s].toHtml()))break;s++}t.insertAfter(m);m=t;s--}else d(),q.equals(f)?(q.insertAfter(m),m=q):i(q,f)?(f=a.clone(),l.each(q.childNodes,function(b){f.appendChild(b)}),q.empty(),q.insertAfter(m),m=q,q.appendChild(f),r.push(f),f=a.clone()):(q.insertAfter(m),m=q)}}f.childNodes.length&&f.insertAfter(m);a.parentNode.removeChild(a);l.each(r,function(b){h(b,c)});return 1}function i(a,c){return 9===
a.nodeType||8===c.nodeType?1:!!b[a.tagName][c.tagName||c.nodeName]}var b=a("../dtd"),n=a("../nodes/tag"),c=a("./special-scanners"),l=a("util"),o={li:"ul",dt:"dl",dd:"dl"},m={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(b,a,d){function e(a,c){for(l=a;l>c;l--){var e=i[l];i[l-1].appendChild(e);h(e,d)}b=i[c];i.length=c}function j(b){var a=0,c;if(c=m[b.tagName]){for(var g=i.length-1,f=i[g];f&&!(f.tagName in c);){if(f.tagName===b.tagName){a=1;break}g--;
f=i[g]}a&&e(i.length-1,g-1)}return a}var f,l,i;i=d.stack=d.stack||[];do{if(f=a.nextNode())if(1===f.nodeType)if(f.isEndTag()&&f.tagName===b.tagName)f=null;else if(f.isEndTag()){if(f.isEndTag()){var o=-1;for(l=i.length-1;0<=l;l--)if(i[l].tagName===f.tagName){o=l;break}-1!==o&&(i[i.length-1].appendChild(b),h(b,d),e(i.length-1,o),f=null)}}else c[f.tagName]?(c[f.tagName].scan(f,a,d),b.appendChild(f)):f.isSelfClosed?b.appendChild(f):(i.push(b),j(f)&&i.push(b),b=f);else b.appendChild(f);null===f&&0<i.length&&
(f=i[i.length-1],c[f.tagName]?f=null:(i.length-=1,f.appendChild(b),h(b,d),b=f))}while(f);h(b,d)}}});KISSY.add("html-parser/scanners/special-scanners",[],function(){return{}});KISSY.add("html-parser/scanners/quote-cdata-scanner",["./cdata-scanner","../dtd","./special-scanners"],function(d,a){var h=a("./cdata-scanner"),i=a("../dtd"),b=a("./special-scanners"),n={scan:function(b,a,c){c=c||{};c.quoteSmart=1;h.scan(b,a,c);c.quoteSmart=0}},c;for(c in i.$cdata)b[c]=n;return n});
KISSY.add("html-parser/scanners/cdata-scanner",[],function(){return{scan:function(d,a,h){var h=a.parseCDATA(h.quoteSmart,d.nodeName),i=a.getPosition(),b=a.nextNode();b&&(1!==b.nodeType||!(b.isEndTag()&&b.tagName===d.tagName))&&a.setPosition(i);d.closed=!0;h&&d.appendChild(h)}}});KISSY.add("html-parser/scanners/textarea-scanner",["./cdata-scanner","./special-scanners"],function(d,a){var h=a("./cdata-scanner"),i=a("./special-scanners");i.textarea={scan:function(b,a,c){c=c||{};h.scan(b,a,c)}};return i.textarea});
KISSY.add("html-parser/writer/basic",["../utils"],function(d,a){function h(){this.output=[]}var i=a("../utils").isBooleanAttribute;h.prototype={constructor:h,append:function(){for(var b=this.output,a=arguments,c,d=0;d<a.length;d++)if(c=a[d],1<c.length)for(var h=0;h<c.length;h++)b.push(c.charAt(h));else b.push(c);return this},openTag:function(b){this.append("<",b.tagName)},openTagClose:function(b){b.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(b){this.append("</",b.tagName,
">")},attribute:function(b){var a=b.value||"",b=b.name;i(b)&&!a&&(a=b);this.append(" ",b,'="',(""+a).replace(/'/g,"&quot;"),'"')},text:function(b){this.append(b)},cdata:function(b){this.append(b)},comment:function(b){this.append("<\!--"+b+"--\>")},getHtml:function(){return this.output.join("")}};return h});
KISSY.add("html-parser/writer/beautify",["./basic","../dtd","../utils","util"],function(d,a){function h(){var a=this;h.superclass.constructor.apply(a,arguments);a.inPre=0;a.indentChar="\t";a.indentLevel=0;a.allowIndent=0;a.rules={};var d=c.merge(b.$nonBodyContent,b.$block,b.$listItem,b.$tableContent,{select:1,script:1,style:1}),i;for(i in d)a.setRules(i,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});c.each("p,h1,h2,h3,h4,h5,h6".split(","),function(b){a.setRules(b,
{allowIndent:0,breakAfterOpen:0,breakBeforeClose:0})});a.setRules("option",{breakBeforeOpen:1});a.setRules("optiongroup",{breakBeforeOpen:1});a.setRules("br",{breakAfterOpen:1});a.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});a.setRules("pre",{breakAfterOpen:1,allowIndent:0})}var i=a("./basic"),b=a("../dtd"),n=a("../utils"),c=a("util");c.extend(h,i,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=
this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(a,b){this.rules[a]||(this.rules[a]={});c.mix(this.rules[a],b)},openTag:function(a){var b=this.rules[a.tagName]||{};this.allowIndent?this.indentation():b.breakBeforeOpen&&(this.lineBreak(),this.indentation());h.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,c=this.rules[b]||{};a.isSelfClosed?this.append(" />"):
(this.append(">"),c.allowIndent&&this.indentLevel++);c.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var b=a.tagName,c=this.rules[b]||{};c.allowIndent&&this.indentLevel--;this.allowIndent?this.indentation():c.breakBeforeClose&&(this.lineBreak(),this.indentation());h.superclass.closeTag.apply(this,arguments);"pre"===b&&(this.inPre=0);c.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=n.collapseWhitespace(a));
this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(a){this.allowIndent&&this.indentation();this.append(c.trim(a))}});return h});
KISSY.add("html-parser/writer/minify",["./basic","../utils","util"],function(d,a){function h(){h.superclass.constructor.apply(this,arguments);this.inPre=0}var i=a("./basic"),b=a("../utils"),n=a("util"),c=n.trim,l=b.isBooleanAttribute,o=b.collapseWhitespace,m=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");n.extend(h,i,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,
"$1"),h.superclass.comment.call(this,a))},openTag:function(a){"pre"===a.tagName&&(this.inPre=1);h.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"===a.tagName&&(this.inPre=0);h.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=c(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");h.superclass.cdata.call(this,a)},attribute:function(a,b){var d=
a.name,e,h=a.value||"";e=a.name;if(!(e=!c(a.value||"")?"input"===b&&"value"===e||m.test(e):0)){e=b.nodeName;var f=a.name,i=a.value||"",i=c(i.toLowerCase());e="script"===e&&"language"===f&&"javascript"===i||"form"===e&&"method"===f&&"get"===i||"input"===e&&"type"===f&&"text"===i||"script"===e&&"type"===f&&"text/javascript"===i||"style"===e&&"type"===f&&"text/css"===i||"area"===e&&"shape"===f&&"rect"===i}if(!e)if(l(d))this.append(" ",d);else{e=b.nodeName;f=a.name;i=a.value||"";/^on[a-z]+/.test(f)?i=
c(i).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===f?i=o(c(i)):/^(?:a|area|link|base)$/.test(e)&&"href"===f||"img"===e&&/^(?:src|longdesc|usemap)$/.test(f)||"object"===e&&/^(?:classid|codebase|data|usemap)$/.test(f)||"q"===e&&"cite"===f||"blockquote"===e&&"cite"===f||("ins"===e||"del"===e)&&"cite"===f||"form"===e&&"action"===f||"input"===e&&("src"===f||"usemap"===f)||"head"===e&&"profile"===f||"script"===e&&("src"===f||"for"===f)||/^(?:a|area|object|button)$/.test(e)&&"tabindex"===
f||"input"===e&&("maxlength"===f||"tabindex"===f)||"select"===e&&("size"===f||"tabindex"===f)||"textarea"===e&&/^(?:rows|cols|tabindex)$/.test(f)||"colgroup"===e&&"span"===f||"col"===e&&"span"===f||("th"===e||"td"===e)&&("rowspan"===f||"colspan"===f)?i=c(i):"style"===f&&(i=c(i).replace(/[\s\xa0]*;[\s\xa0]*$/,""));e=(""+i).replace(/"/g,"&quot;");if(!h||/[ "'=<>`]/.test(h))e='"'+e+'"';this.append(" ",d,"=",e)}},text:function(a){this.inPre||(a=o(a));this.append(a)}});return h});
KISSY.add("html-parser/writer/filter",["util"],function(d,a){function h(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function i(a,b){for(var d=0;a&&d<a.length;d++)n.each(a[d].value,function(a){b=b.replace(a[0],a[1])});return b}function b(a,b,d){var h,g;for(g=0;a&&g<a.length;g++){h=a[g].value;if(!1===(h=h.apply(null,b)))return!1;if(d&&h&&h!==d){if("string"===typeof h){if(d.toHtml()===h)break;d.nodeValue=h;h=d}return this.onNode(h)}}return d}
var n=a("util");h.prototype={constructor:h,addRules:function(a,b){var b=b||10,d;for(d in a){var h=this[d];if(h){var g;a:{for(g=0;h&&g<h.length;g++)if(h[g].priority>b)break a;g=h.length}h.splice(g,0,{value:a[d],priority:b})}}},onTagName:function(a){return i(this.tagNames,a)},onAttributeName:function(a){return i(this.attributeNames,a)},onText:function(a){return b.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return b.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,b){var d;
a:{d=this.attributes;for(var h=0;d&&h<d.length;h++){var g=d[h].value,i,n=a.name;if(g[n]&&!1===(i=g[n].call(null,a.value,b))){d=i;break a}"string"===typeof i&&(a.value=i)}d=a}return d},onComment:function(a){return b.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var b=a.nodeType;if(1===b)return this.onTag(a);if(3===b)return this.onText(a);if(8===b)return this.onComment(a)},onFragment:function(a){return b.call(this,this.root,[a],a)},onTag:function(a){for(var b=["^",a.tagName,"$"],d=this.tags,
h,g=0;g<b.length;g++)for(var i=b[g],n=0;n<d.length;n++)if(h=d[n].value,h[i]){if(!1===(h=h[i](a)))return!1;if(h&&h!==a)return this.onNode(h);if(!a.tagName)return a}return a}};return h});
