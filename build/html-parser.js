/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: May 9 14:05
*/
KISSY.add("html-parser","html-parser/dtd,html-parser/lexer/lexer,html-parser/parser,html-parser/writer/basic,html-parser/writer/beautify,html-parser/writer/minify,html-parser/writer/filter,html-parser/nodes/cdata,html-parser/nodes/comment,html-parser/nodes/node,html-parser/nodes/tag,html-parser/nodes/text".split(","),function(c,d){var b=d("html-parser/dtd"),i=d("html-parser/lexer/lexer"),a=d("html-parser/parser"),j=d("html-parser/writer/basic"),f=d("html-parser/writer/beautify"),n=d("html-parser/writer/minify"),
o=d("html-parser/writer/filter"),h=d("html-parser/nodes/cdata"),m=d("html-parser/nodes/comment"),l=d("html-parser/nodes/node"),r=d("html-parser/nodes/tag"),k=d("html-parser/nodes/text");return{CData:h,Comment:m,Node:l,Tag:r,Text:k,Lexer:i,Parser:a,BasicWriter:j,BeautifyWriter:f,MinifyWriter:n,Filter:o,DTD:b,serialize:function(e,l){var h=new j;e.writeHtml(h,l);return h.getHtml()},parse:function(e){return(new a(e)).parse()}}});
KISSY.add("html-parser/dtd",[],function(c,d,b,i){var c=c.merge,d={isindex:1,fieldset:1},a={input:1,button:1,select:1,textarea:1,label:1},b=c({a:1},a),j=c({iframe:1},b),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},n={ins:1,del:1,script:1,style:1},o=c({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},n),h=c({sub:1,img:1,
object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},o),m=c({p:1},h),a=c({iframe:1},h,a),h={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,
i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},l=c({a:1},a),r={tr:1},k={"#text":1},e=c({param:1},h),g=c({form:1},d,j,f,m),u={li:1},q={base:1,link:1,meta:1,title:1},p=c(q,{style:1,script:1}),t={head:1,body:1},s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},i=i.exports={$nonBodyContent:c({html:1},t,q),$block:s,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:l,$body:c({script:1,
style:1},s),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,
object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:p,style:k,body:g,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:g,td:g,br:{},th:g,center:g,kbd:l,button:c(m,f),basefont:{},h5:l,h4:l,samp:l,h6:l,ol:u,h1:l,h3:l,option:k,h2:l,form:c(d,j,f,m),select:{optgroup:1,option:1},font:l,ins:l,menu:u,abbr:l,label:l,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:l,script:k,tfoot:r,
cite:l,li:g,input:{},iframe:g,strong:l,textarea:k,noframes:g,big:l,small:l,span:l,hr:{},dt:l,sub:l,optgroup:{option:1},param:{},bdo:l,"var":l,div:g,object:e,sup:l,dd:g,strike:l,area:{},dir:u,map:c({area:1,form:1,p:1},d,n,f),applet:e,dl:{dt:1,dd:1},del:l,isindex:{},fieldset:c({legend:1},h),thead:r,ul:u,acronym:l,b:l,a:a,blockquote:g,caption:l,i:l,u:l,tbody:r,s:l,address:c(j,m),tt:l,legend:l,q:l,pre:c(o,b),p:l,em:l,dfn:l},d="article,figure,nav,aside,section,footer".split(","),v;for(v in i)for(var w in i[v])if("div"===
w)for(c=0;c<d.length;c++)i[v][d[c]]=i[v][w];for(c=0;c<d.length;c++)i[d[c]]=i.div});
KISSY.add("html-parser/lexer/lexer","./cursor,./page,../nodes/text,../nodes/cdata,../utils,../nodes/attribute,../nodes/tag,../nodes/comment".split(","),function(c,d){function b(l,h){this.page=new a(l);this.cursor=new i;this.nodeFactory=this;this.cfg=h||{}}var i=d("./cursor"),a=d("./page"),j=d("../nodes/text"),f=d("../nodes/cdata"),n=d("../utils"),o=d("../nodes/attribute"),h=d("../nodes/tag"),m=d("../nodes/comment");b.prototype={constructor:b,setPosition:function(l){this.cursor.position=l},getPosition:function(){return this.cursor.position},
nextNode:function(l){var h,a,e=this.cursor,g=this.page;h=e.position;a=g.getChar(e);switch(a){case -1:l=null;break;case "<":a=g.getChar(e);if(a===-1)l=this.makeString(h,e.position);else if(a==="/"||n.isLetter(a)){g.ungetChar(e);l=this.parseTag(h)}else if("!"===a||"?"===a){a=g.getChar(e);if(a===-1)l=this.makeString(h,e.position);else if(">"===a)l=this.makeComment(h,e.position);else{g.ungetChar(e);if("-"===a)l=this.parseComment(h,l);else{g.ungetChar(e);l=this.parseTag(h)}}}else{g.ungetChar(e);l=this.parseString(h,
l)}break;default:g.ungetChar(e);l=this.parseString(h,l)}return l},makeComment:function(l,h){var a;a=h-l;if(0!==a){if(2>a)return this.makeString(l,h);a=this.nodeFactory.createCommentNode(this.page,l,h)}else a=null;return a},makeString:function(h,a){var k=null;a-h>0&&(k=this.nodeFactory.createStringNode(this.page,h,a));return k},makeCData:function(h,a){var k=null;a-h>0&&(k=this.nodeFactory.createCDataNode(this.page,h,a));return k},makeTag:function(h,a,k){var e;e=a-h;if(0!==e){if(2>e)return this.makeString(h,
a);h=this.nodeFactory.createTagNode(this.page,h,a,k)}else h=null;return h},createTagNode:function(a,r,k,e){return new h(a,r,k,e)},createStringNode:function(h,a,k){return new j(h,a,k)},createCDataNode:function(h,a,k){return new f(h,a,k)},createCommentNode:function(h,a,k){return new m(h,a,k)},parseTag:function(h){var a,k=[],e=[],g,f=this.cfg.strict,d=c.noop,b=this.page,j=0,m=this.cursor;f&&(d=function(){if(f&&g===-1&&e.length)throw Error(e[0].name+" syntax error at row "+(b.row(m)+1)+" , col "+(b.col(m)+
1));});for(k[0]=m.position;!a;){k[j+1]=m.position;g=b.getChar(m);switch(j){case 0:if(g===-1||">"===g||"<"===g){if("<"===g){b.ungetChar(m);k[j+1]=m.position}a=true}else if(g==="/"||n.isValidAttributeNameStartChar(g))j=1;break;case 1:if(-1===g||">"===g||"<"===g){if("<"===g){b.ungetChar(m);k[j+1]=m.getPosition}this.standalone(e,k);a=true}else if(n.isWhitespace(g)){k[6]=k[2];j=6}else"="===g&&(j=2);break;case 2:if(-1===g||">"===g){this.standalone(e,k);a=true}else if("'"===g){j=4;k[4]=k[3]}else if('"'===
g){j=5;k[5]=k[3]}else n.isWhitespace(g)||(j=3);break;case 3:if(-1===g||">"===g){this.naked(e,k);a=true}else if(n.isWhitespace(g)){this.naked(e,k);k[0]=k[4];j=0}break;case 4:if(-1===g){this.singleQuote(e,k);a=true}else if("'"===g){this.singleQuote(e,k);k[0]=k[5]+1;j=0}break;case 5:if(-1===g){this.doubleQuote(e,k);a=true}else if('"'===g){this.doubleQuote(e,k);k[0]=k[6]+1;j=0}break;case 6:if(-1===g){this.standalone(e,k);k[0]=k[6];b.ungetChar(m);j=0}else if("="===g){k[2]=k[6];k[3]=k[7];j=2}else if(!n.isWhitespace(g)){this.standalone(e,
k);k[0]=k[6];b.ungetChar(m);j=0}break;default:throw Error("how ** did we get in state "+j);}d()}return this.makeTag(h,m.position,e)},parseComment:function(a,h){var k,e,g=this.page,c=this.cursor,f;k=false;for(f=0;!k;){e=g.getChar(c);if(-1===e)k=true;else switch(f){case 0:if(">"===e)k=true;else if("-"===e)f=1;else return this.parseString(a,h);break;case 1:if("-"===e){e=g.getChar(c);if(-1===e)k=true;else if(">"===e)k=true;else{g.ungetChar(c);f=2}}else return this.parseString(a,h);break;case 2:if("-"===
e)f=3;else if(-1===e)return this.parseString(a,h);break;case 3:f="-"===e?4:2;break;case 4:">"===e?k=true:n.isWhitespace(e)||(f=2);break;default:throw Error("how ** did we get in state "+f);}}return this.makeComment(a,c.position)},parseString:function(a,h){for(var k=0,e,g=this.page,c=this.cursor,f=0;!k;){e=g.getChar(c);if(-1===e)k=1;else if(h&&0===f&&('"'===e||"'"===e))f=e;else if(h&&0!==f&&"\\"===e){e=g.getChar(c);-1!==e&&"\\"!==e&&e!==f&&g.ungetChar(c)}else if(h&&e===f)f=0;else if(h&&0===f&&e===
"/"){e=g.getChar(c);if(-1===e)k=1;else if("/"===e){do e=g.getChar(c);while(-1!==e&&"\n"!==e)}else if("*"===e){do{do e=g.getChar(c);while(-1!==e&&"*"!==e);e=g.getChar(c);e==="*"&&g.ungetChar(c)}while(-1!==e&&"/"!==e)}else g.ungetChar(c)}else if(0===f&&"<"===e){e=g.getChar(c);if(-1===e)k=1;else{if("/"===e||n.isLetter(e)||"!"===e||"?"===e){k=1;g.ungetChar(c)}g.ungetChar(c)}}}return this.makeString(a,c.position)},parseCDATA:function(a,h){var c,e,g,f,b,d,j=this.cursor,m=this.page;c=j.position;e=0;g=false;
f="";for(d=false;!g;){b=m.getChar(j);switch(e){case 0:switch(b){case -1:g=true;break;case "'":a&&!d&&(""===f?f="'":"'"===f&&(f=""));break;case '"':a&&!d&&(""===f?f='"':'"'===f&&(f=""));break;case "\\":if(a&&""!==f){b=m.getChar(j);-1===b?g=true:b!=="\\"&&b!==f&&m.ungetChar(j)}break;case "/":if(a&&""===f){b=m.getChar(j);if(-1===b)g=true;else if("/"===b)d=true;else if("*"===b){do{do b=m.getChar(j);while(-1!==b&&"*"!==b);b=m.getChar(j);b==="*"&&m.ungetChar(j)}while(-1!==b&&"/"!==b)}else m.ungetChar(j)}break;
case "\n":d=false;break;case "<":a?""===f&&(e=1):e=1}break;case 1:switch(b){case -1:g=true;break;case "/":e=!h||m.getText(j.position,j.position+h.length)===h&&!m.getText(j.position+h.length,j.position+h.length+1).match(/\w/)?2:0;break;case "!":b=m.getChar(j);if(-1===b)g=true;else if("-"===b){b=m.getChar(j);-1===b?g=true:e="-"===b?3:0}else e=0;break;default:e=0}break;case 2:d=false;if(-1===b)g=true;else if(n.isLetter(b)){g=true;m.ungetChar(j);m.ungetChar(j);m.ungetChar(j)}else e=0;break;case 3:d=false;
if(-1===b)g=true;else if("-"===b){b=m.getChar(j);if(-1===b)g=true;else if("-"===b){b=m.getChar(j);if(-1===b)g=true;else if(">"===b)e=0;else{m.ungetChar(j);m.ungetChar(j)}}else m.ungetChar(j)}break;default:throw Error("unexpected "+e);}}return this.makeCData(c,j.position)},singleQuote:function(a,h){var b=this.page;a.push(new o(b.getText(h[1],h[2]),"=",b.getText(h[4]+1,h[5]),"'"))},doubleQuote:function(h,a){var b=this.page;h.push(new o(b.getText(a[1],a[2]),"=",b.getText(a[5]+1,a[6]),'"'))},standalone:function(a,
h){a.push(new o(this.page.getText(h[1],h[2])))},naked:function(h,a){var b=this.page;h.push(new o(b.getText(a[1],a[2]),"=",b.getText(a[3],a[4])))}};return b});KISSY.add("html-parser/lexer/cursor",[],function(){function c(c){this.position=c||0}c.prototype={constructor:c,advance:function(){this.position++},clone:function(){var d=new c;d.position=this.position;return d},retreat:function(){this.position=Math.max(--this.position,0)}};return c});
KISSY.add("html-parser/lexer/page",["./index"],function(c,d){function b(a){this.source=a;this.lineIndex=new i}var i=d("./index");b.prototype={constructor:b,getChar:function(a){var b=this.source,f=a.position;if(f>=b.length)return-1;var c=b.charAt(f);a.advance();"\r"===c&&(c="\n",f=a.position,"\n"===b.charAt(f)&&a.advance());"\n"===c&&this.lineIndex.add(a);return c},ungetChar:function(a){var b=this.source;a.retreat();var c=a.position,d=b.charAt(c);"\n"===d&&0!==c&&(d=b.charAt(c-1),"\r"===d&&a.retreat())},
getText:function(a,b){return this.source.slice(a,b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return b});
KISSY.add("html-parser/lexer/index",[],function(){function c(){this.lineCursors=[]}c.prototype={constructor:c,add:function(c){var b;a:{b=this.lineCursors;for(var i=c.position,a=0;a<b.length;a++){var j=b[a].position;if(j===i){b=-1;break a}if(j>i)break}b=a}-1!==b&&this.lineCursors.splice(b,0,c.clone())},remove:function(c){var b=this.lineCursors,i;a:{i=this.lineCursors;for(var c=c.position,a=0;a<i.length;a++){var j=i[a].position;if(j===c){i=a;break a}if(j<c)break}i=-1}-1!==i&&b.splice(i,1)},row:function(c){for(var b=
this.lineCursors,i=0;i<b.length;i++)if(b[i].position>c.position)return i-1;return i},col:function(c){var b=0,i=this.lineCursors[this.row(c)-1];i&&(b=i.position);return c.position-b}};return c});
KISSY.add("html-parser/nodes/text",["./node"],function(c,d){function b(a){"string"===typeof a?(this.nodeValue=a,b.superclass.constructor.apply(this,[null,-1,-1])):(b.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}var i=d("./node");c.extend(b,i,{writeHtml:function(a,b){var c;if(!b||!1!==(c=b.onText(this)))c&&this!==c?c.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:b.superclass.toHtml.apply(this,
arguments)}});return b});
KISSY.add("html-parser/nodes/node",[],function(){function c(b){var c=0;b.replace(/\n/g,function(){c++});return c}function d(c,d,a){this.parentNode=null;this.page=c;this.startPosition=d;this.endPosition=a;this.nextSibling=this.previousSibling=this.nodeName=null}d.prototype={constructor:d,getStartLine:function(){if(this.page){if("startLine"in this)return this.startLine;this.startLine=c(this.page.getText(0,this.startPosition))}return-1},getEndLine:function(){if(this.page){if("endLine"in this)return this.endLine;
this.endLine=c(this.page.getText(0,this.endPosition))}return-1},toHtml:function(){return this.page&&this.page.getText?this.page.getText(this.startPosition,this.endPosition):""},toDebugString:function(){var c=[];c.push(this.nodeName+"  [ "+this.startPosition+"|"+this.getStartLine()+" : "+this.endPosition+"|"+this.getEndLine()+" ]\n");c.push(this.toHtml());return c.join("")}};return d});
KISSY.add("html-parser/nodes/cdata",["./text"],function(c,d){function b(){b.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}var i=d("./text");c.extend(b,i,{writeHtml:function(a,c){var b;if(!c||!1!==(b=c.onCData(this)))b&&this!==b?b.writeHtml(a,c):a.cdata(this.toHtml())}});return b});
KISSY.add("html-parser/utils",[],function(){return{isBooleanAttribute:function(c){return/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(c)},collapseWhitespace:function(c){return c.replace(/[\s\xa0]+/g," ")},isLetter:function(c){return"a"<=c&&"z">=c||"A"<=c&&"Z">=c},isValidAttributeNameStartChar:function(c){return!this.isWhitespace(c)&&'"'!==c&&"'"!==c&&">"!==c&&c!==""<""&&"/"!==c&&"="!==c},isWhitespace:function(c){return/^[\s\xa0]$/.test(c)}}});
KISSY.add("html-parser/nodes/attribute",[],function(c){function d(c,d,a,j){this.nodeType=2;this.name=c;this.assignment=d;this.value=a;this.quote=j}c.augment(d,{clone:function(){var b=new d;c.mix(b,this);return b},equals:function(c){return this.name===c.name&&this.value===c.value&&this.nodeType===c.nodeType}});d.prototype.clone=function(){var b=new d;c.mix(b,this);return b};return d});
KISSY.add("html-parser/nodes/tag",["./node","./attribute","../dtd"],function(c,d){function b(a,b,f){a.nodeName=a.tagName=b.toLowerCase();a._updateSelfClosed();c.each(f,function(c,b){a.setAttribute(b,c)})}function i(a,f,l,d){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=d||[];this.nodeType=1;if("string"===typeof a)b.apply(null,[this].concat(c.makeArray(arguments)));else{i.superclass.constructor.apply(this,arguments);d=this.attributes;d[0]&&(this.nodeName=d[0].name.toLowerCase(),
this.tagName=this.nodeName.replace(/\//,""),this._updateSelfClosed(),d.splice(0,1));var k=d[d.length-1];if(k=!(!k||!/\/$/.test(k.name)))d.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||k}this.closedEndPosition=this.closedStartPosition=-1}function a(a){var c=a.childNodes;a.firstChild=c[0];a.lastChild=c[c.length-1];1<=c.length&&(c[0].nextSibling=c[0].nextSibling=null,c[0].parentNode=a);if(1<c.length){for(var b=0;b<c.length-1;b++)c[b].nextSibling=c[b+1],c[b+1].previousSibling=c[b],c[b+1].parentNode=
a;c[c.length-1].nextSibling=null}}function j(a,c){if(a&&a.length)for(var b=0;b<a.length;b++)if(a[b].name===c)return a[b];return null}var f=d("./node"),n=d("./attribute"),o=d("../dtd");c.extend(i,f,{_updateSelfClosed:function(){this.isSelfClosed=!!o.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var a=new i,b=[];c.each(this.attributes,function(a){b.push(a.clone())});c.mix(a,{childNodes:[],firstChild:null,lastChild:null,
attributes:b,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return a},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!==a.nodeName||this.nodeType!==a.nodeType||this.attributes.length!==a.attributes.length)return 0;for(var c=0;c<this.attributes.length;c++)if(!this.attributes[c].equals(a.attributes[c]))return 0;
return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(c){this.childNodes.push(c);a(this)},replace:function(h){var b=h.parentNode.childNodes,f=c.indexOf(h,b);b[f]=this;a(h.parentNode)},replaceChild:function(h,b){var f=this.childNodes,d=c.indexOf(b,f);f[d]=h;a(this)},prepend:function(c){this.childNodes.unshift(c);a(this)},insertBefore:function(h){var b=h.parentNode.childNodes,f=c.indexOf(h,b);b.splice(f,0,this);a(h.parentNode)},insertAfter:function(a){var b=a.parentNode.childNodes,
f=c.indexOf(a,b);f===b.length-1?a.parentNode.appendChild(this):this.insertBefore(a.parentNode.childNodes[[f+1]])},empty:function(){this.childNodes=[];a(this)},removeChild:function(b){var f=b.parentNode.childNodes,d=c.indexOf(b,f);f.splice(d,1);a(b.parentNode)},getAttribute:function(a){return(a=j(this.attributes,a))&&a.value},setAttribute:function(a,c){var b=j(this.attributes,a);b?b.value=c:this.attributes.push(new n(a,"=",c,'"'))},removeAttribute:function(a){(a=j(this.attributes,a))&&this.attributes.splice(c.indexOf(a,
this.attributes),1)},filterChildren:function(){var a=this;if(!a.isChildrenFiltered){var b=new (c.require("html-parser/writer/basic"));a._writeChildrenHTML(b);b=(new (c.require("html-parser/parser"))(b.getHtml())).parse().childNodes;a.empty();c.each(b,function(c){a.appendChild(c)});a.isChildrenFiltered=1}},writeHtml:function(a,c){var b=this,f;f=b.tagName;if("!doctype"===f)a.append(this.toHtml()+"\n");else{b.__filter=c;b.isChildrenFiltered=0;if(c){if(!(f=c.onTagName(f)))return;b.tagName=f;f=c.onTag(b);
if(!1===f)return;f&&(b=f);if(1!==b.nodeType){b.writeHtml(a,c);return}if(!b.tagName){b._writeChildrenHTML(a);return}}a.openTag(b);for(var d=b.attributes,e=0;e<d.length;e++){var g=d[e];f=g.name;if(c){if(!(f=c.onAttributeName(f,b)))continue;g.name=f;if(!1===c.onAttribute(g,b))continue}a.attribute(g,b)}a.openTagClose(b);b.isSelfClosed||(b._writeChildrenHTML(a),a.closeTag(b))}},_writeChildrenHTML:function(a){var b=this.isChildrenFiltered?0:this.__filter;c.each(this.childNodes,function(c){c.writeHtml(a,
b)})},outerHtml:function(){var a=new (c.require("html-parser/writer/basic"));this.writeHtml(a);return a.getHtml()}});return i});
KISSY.add("html-parser/nodes/comment",["./text"],function(c,d){function b(){b.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}var i=d("./text");c.extend(b,i,{writeHtml:function(a,c){var b;if(!c||!1!==(b=c.onComment(this)))b&&this!==b?b.writeHtml(a,c):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=i.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return b});
KISSY.add("html-parser/parser","./dtd,./nodes/tag,./nodes/fragment,./lexer/lexer,./nodes/document,./scanner".split(","),function(c,d){function b(a,b){this.originalHTML=a=c.trim(a);a=/^(<!doctype|<html|<body)/i.test(a)?"<document>"+a+"</document>":"<body>"+a+"</body>";this.lexer=new m(a);this.opts=b||{}}function i(a){var b=j(a,"body",3);if(b){var a=b.parentNode,f=a.childNodes,h=c.indexOf(b,f);if(h!==f.length-1){f=f.slice(h+1,f.length);for(h=0;h<f.length;h++){a.removeChild(f[h]);f[h].tagName==="body"?
c.each(f[h].childNodes,function(a){b.appendChild(a)}):b.appendChild(f[h])}}}return b}function a(a){var b=a.childNodes,c,f,h=n.p,d=0;for(f=0;f<b.length;f++){c=b[f];if(c.nodeType===3||c.nodeType===1&&h[c.nodeName]){d=1;break}}if(d){var d=[],j=new o;j.nodeName=j.tagName="p";for(f=0;f<b.length;f++){c=b[f];if(c.nodeType===3||c.nodeType===1&&h[c.nodeName])j.appendChild(c);else{if(j.childNodes.length){d.push(j);j=j.clone()}d.push(c)}}j.childNodes.length&&d.push(j);a.empty();for(f=0;f<d.length;f++)a.appendChild(d[f])}}
function j(a,c,b){if(b===0)return 0;typeof b==="number"&&b--;var f=a.childNodes;if(f)for(var h=0;h<f.length;h++){if(f[h].tagName===c)return f[h];if(a=j(f[h],c,b))return a}return 0}function f(a){for(var b=[].concat(a.childNodes),f=0;f<b.length;f++)if(b[f].nodeName==="html"){for(var h=b[f],d=0;d<f;d++)b[d].nodeType===3&&!c.trim(b[d].toHtml())&&a.removeChild(b[d]);for(;h.firstChild&&h.firstChild.nodeType===3&&!c.trim(h.firstChild.toHtml());)h.removeChild(h.firstChild);break}}var n=d("./dtd"),o=d("./nodes/tag"),
h=d("./nodes/fragment"),m=d("./lexer/lexer"),l=d("./nodes/document"),r=d("./scanner");b.prototype={constructor:b,elements:function(){var b,e,d=this.lexer,j=this.opts;e=b=d.nextNode();if(b.tagName!=="document"){e=new l;e.appendChild(b)}e.nodeType=9;r.getScanner("div").scan(b,d,j);(b=i(e))&&j.autoParagraph&&a(b);f(e);var j=this.originalHTML,n=new h;e=/^(<!doctype|<html|<body)/i.test(j)?e.childNodes:b.childNodes;c.each(e,function(a){n.appendChild(a)});return n},parse:function(){return this.elements()}};
return b});KISSY.add("html-parser/nodes/fragment",["./tag"],function(c,d){function b(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}var i=d("./tag");c.extend(b,i,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHTML(a)}});return b});
KISSY.add("html-parser/nodes/document",["./tag"],function(c,d){function b(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}var i=d("./tag");c.extend(b,i,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHTML(a)}});return b});
KISSY.add("html-parser/scanner",["./scanners/tag-scanner","./scanners/special-scanners","./scanners/quote-cdata-scanner","./scanners/textarea-scanner"],function(c,d){var b=d("./scanners/tag-scanner"),i=d("./scanners/special-scanners");d("./scanners/quote-cdata-scanner");d("./scanners/textarea-scanner");return{getScanner:function(a){return i[a]||b}}});
KISSY.add("html-parser/scanners/tag-scanner",["../dtd","../nodes/tag","./special-scanners"],function(c,d){function b(f,d){function l(){e.childNodes.length&&(e.insertAfter(g),g=e,e=f.clone())}f.closed=1;if(!d.fixByDtd)return 0;var r=1,k=[].concat(f.childNodes);c.each(k,function(a){if(!i(f,a))return r=0,!1});if(r)return 0;for(var e=f.clone(),g=f,o=[],q=0;q<k.length;q++){var p=k[q];if(i(e,p))e.appendChild(p);else if(1===p.nodeType){var t=p.tagName;if(a.$listItem[t]){l();var p=n[p.tagName],s=new j;for(s.nodeName=
s.tagName=p;q<k.length;){if(k[q].tagName===t)s.appendChild(k[q]);else if(3===k[q].nodeType&&c.trim(k[q].toHtml()))break;q++}s.insertAfter(g);g=s;q--}else l(),p.equals(e)?(p.insertAfter(g),g=p):i(p,e)?(e=f.clone(),c.each(p.childNodes,function(a){e.appendChild(a)}),p.empty(),p.insertAfter(g),g=p,p.appendChild(e),o.push(e),e=f.clone()):(p.insertAfter(g),g=p)}}e.childNodes.length&&e.insertAfter(g);f.parentNode.removeChild(f);c.each(o,function(a){b(a,d)});return 1}function i(b,c){return 9===b.nodeType||
8===c.nodeType?1:!!a[b.tagName][c.tagName||c.nodeName]}var a=d("../dtd"),j=d("../nodes/tag"),f=d("./special-scanners"),n={li:"ul",dt:"dl",dd:"dl"},o={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(a,c,d){function j(c,f){for(g=c;g>f;g--){var e=n[g];n[g-1].appendChild(e);b(e,d)}a=n[f];n.length=f}function k(a){var b=0,c;if(c=o[a.tagName]){for(var f=n.length-1,e=n[f];e&&!(e.tagName in c);){if(e.tagName===a.tagName){b=1;break}f--;e=n[f]}b&&j(n.length-1,f-
1)}return b}var e,g,n;n=d.stack=d.stack||[];do{if(e=c.nextNode())if(1===e.nodeType)if(e.isEndTag()&&e.tagName===a.tagName)e=null;else if(e.isEndTag()){if(e.isEndTag()){var i=-1;for(g=n.length-1;0<=g;g--)if(n[g].tagName===e.tagName){i=g;break}-1!==i&&(n[n.length-1].appendChild(a),b(a,d),j(n.length-1,i),e=null)}}else f[e.tagName]?(f[e.tagName].scan(e,c,d),a.appendChild(e)):e.isSelfClosed?a.appendChild(e):(n.push(a),k(e)&&n.push(a),a=e);else a.appendChild(e);null===e&&0<n.length&&(e=n[n.length-1],f[e.tagName]?
e=null:(n.length-=1,e.appendChild(a),b(a,d),a=e))}while(e);b(a,d)}}});KISSY.add("html-parser/scanners/special-scanners",[],function(){return{}});KISSY.add("html-parser/scanners/quote-cdata-scanner",["./cdata-scanner","../dtd","./special-scanners"],function(c,d){var b=d("./cdata-scanner"),i=d("../dtd"),a=d("./special-scanners"),j={scan:function(a,c,f){f=f||{};f.quoteSmart=1;b.scan(a,c,f);f.quoteSmart=0}},f;for(f in i.$cdata)a[f]=j;return j});
KISSY.add("html-parser/scanners/cdata-scanner",[],function(){return{scan:function(c,d,b){var b=d.parseCDATA(b.quoteSmart,c.nodeName),i=d.getPosition(),a=d.nextNode();a&&(1!==a.nodeType||!(a.isEndTag()&&a.tagName===c.tagName))&&d.setPosition(i);c.closed=!0;b&&c.appendChild(b)}}});KISSY.add("html-parser/scanners/textarea-scanner",["./cdata-scanner","./special-scanners"],function(c,d){var b=d("./cdata-scanner"),i=d("./special-scanners");i.textarea={scan:function(a,c,f){f=f||{};b.scan(a,c,f)}};return i.textarea});
KISSY.add("html-parser/writer/basic",["../utils"],function(c,d){function b(){this.output=[]}var i=d("../utils").isBooleanAttribute;b.prototype={constructor:b,append:function(){for(var a=this.output,b=arguments,c,d=0;d<b.length;d++)if(c=b[d],1<c.length)for(var i=0;i<c.length;i++)a.push(c.charAt(i));else a.push(c);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,
">")},attribute:function(a){var b=a.value||"",a=a.name;i(a)&&!b&&(b=a);this.append(" ",a,'="',(""+b).replace(/'/g,"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return b});
KISSY.add("html-parser/writer/beautify",["./basic","../dtd","../utils"],function(c,d){function b(){var f=this;b.superclass.constructor.apply(f,arguments);f.inPre=0;f.indentChar="\t";f.indentLevel=0;f.allowIndent=0;f.rules={};var d=c.merge(a.$nonBodyContent,a.$block,a.$listItem,a.$tableContent,{select:1,script:1,style:1}),j;for(j in d)f.setRules(j,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});c.each("p,h1,h2,h3,h4,h5,h6".split(","),function(a){f.setRules(a,
{allowIndent:0,breakAfterOpen:0,breakBeforeClose:0})});f.setRules("option",{breakBeforeOpen:1});f.setRules("optiongroup",{breakBeforeOpen:1});f.setRules("br",{breakAfterOpen:1});f.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});f.setRules("pre",{breakAfterOpen:1,allowIndent:0})}var i=d("./basic"),a=d("../dtd"),j=d("../utils");c.extend(b,i,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=
this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(a,b){this.rules[a]||(this.rules[a]={});c.mix(this.rules[a],b)},openTag:function(a){var c=this.rules[a.tagName]||{};this.allowIndent?this.indentation():c.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,c=this.rules[b]||{};a.isSelfClosed?this.append(" />"):
(this.append(">"),c.allowIndent&&this.indentLevel++);c.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var c=a.tagName,d=this.rules[c]||{};d.allowIndent&&this.indentLevel--;this.allowIndent?this.indentation():d.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===c&&(this.inPre=0);d.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=j.collapseWhitespace(a));
this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(a){this.allowIndent&&this.indentation();this.append(c.trim(a))}});return b});
KISSY.add("html-parser/writer/minify",["./basic","../utils"],function(c,d){function b(){b.superclass.constructor.apply(this,arguments);this.inPre=0}var i=d("./basic"),a=d("../utils"),j=c.trim,f=a.isBooleanAttribute,n=a.collapseWhitespace,o=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");c.extend(b,i,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,
"$1"),b.superclass.comment.call(this,a))},openTag:function(a){"pre"===a.tagName&&(this.inPre=1);b.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"===a.tagName&&(this.inPre=0);b.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=j(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");b.superclass.cdata.call(this,a)},attribute:function(a,b){var c=
a.name,d,k=a.value||"";d=a.name;if(!(d=!j(a.value||"")?"input"===b&&"value"===d||o.test(d):0)){d=b.nodeName;var e=a.name,g=a.value||"",g=j(g.toLowerCase());d="script"===d&&"language"===e&&"javascript"===g||"form"===d&&"method"===e&&"get"===g||"input"===d&&"type"===e&&"text"===g||"script"===d&&"type"===e&&"text/javascript"===g||"style"===d&&"type"===e&&"text/css"===g||"area"===d&&"shape"===e&&"rect"===g}if(!d)if(f(c))this.append(" ",c);else{d=b.nodeName;e=a.name;g=a.value||"";/^on[a-z]+/.test(e)?g=
j(g).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===e?g=n(j(g)):/^(?:a|area|link|base)$/.test(d)&&"href"===e||"img"===d&&/^(?:src|longdesc|usemap)$/.test(e)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(e)||"q"===d&&"cite"===e||"blockquote"===d&&"cite"===e||("ins"===d||"del"===d)&&"cite"===e||"form"===d&&"action"===e||"input"===d&&("src"===e||"usemap"===e)||"head"===d&&"profile"===e||"script"===d&&("src"===e||"for"===e)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===
e||"input"===d&&("maxlength"===e||"tabindex"===e)||"select"===d&&("size"===e||"tabindex"===e)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(e)||"colgroup"===d&&"span"===e||"col"===d&&"span"===e||("th"===d||"td"===d)&&("rowspan"===e||"colspan"===e)?g=j(g):"style"===e&&(g=j(g).replace(/[\s\xa0]*;[\s\xa0]*$/,""));d=(""+g).replace(/"/g,"&quote;");if(!k||/[ "'=<>`]/.test(k))d='"'+d+'"';this.append(" ",c,"=",d)}},text:function(a){this.inPre||(a=n(a));this.append(a)}});return b});
KISSY.add("html-parser/writer/filter",[],function(c){function d(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function b(a,b){for(var d=0;a&&d<a.length;d++)c.each(a[d].value,function(a){b=b.replace(a[0],a[1])});return b}function i(a,b,c){var d,i;for(i=0;a&&i<a.length;i++){d=a[i].value;if(!1===(d=d.apply(null,b)))return!1;if(c&&d&&d!==c){if("string"===typeof d){if(c.toHtml()===d)break;c.nodeValue=d;d=c}return this.onNode(d)}}return c}
d.prototype={constructor:d,addRules:function(a,b){var b=b||10,c;for(c in a){var d=this[c];if(d){var i;a:{for(i=0;d&&i<d.length;i++)if(d[i].priority>b)break a;i=d.length}d.splice(i,0,{value:a[c],priority:b})}}},onTagName:function(a){return b(this.tagNames,a)},onAttributeName:function(a){return b(this.attributeNames,a)},onText:function(a){return i.call(this,this.text,[a.toHtml(),a],a)},onCData:function(a){return i.call(this,this.cdata,[a.toHtml(),a],a)},onAttribute:function(a,b){var c;a:{c=this.attributes;
for(var d=0;c&&d<c.length;d++){var i=c[d].value,h,m=a.name;if(i[m]&&!1===(h=i[m].call(null,a.value,b))){c=h;break a}"string"===typeof h&&(a.value=h)}c=a}return c},onComment:function(a){return i.call(this,this.comment,[a.toHtml(),a],a)},onNode:function(a){var b=a.nodeType;if(1===b)return this.onTag(a);if(3===b)return this.onText(a);if(8===b)return this.onComment(a)},onFragment:function(a){return i.call(this,this.root,[a],a)},onTag:function(a){for(var b=["^",a.tagName,"$"],c=this.tags,d,i=0;i<b.length;i++)for(var h=
b[i],m=0;m<c.length;m++)if(d=c[m].value,d[h]){if(!1===(d=d[h](a)))return!1;if(d&&d!==a)return this.onNode(d);if(!a.tagName)return a}return a}};return d});
