/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:38
*/
KISSY.add("component/control/process",["base","promise"],function(f,j){function k(b){b.fire("beforeSyncUI");b.syncUI();b.__callPluginsMethod("pluginSyncUI");b.fire("afterSyncUI")}var c=j("base"),l=j("promise").Defer,m=c.prototype.__getHook,h=f.noop,e=c.extend({bindInternal:h,syncInternal:h,initializer:function(){this._renderedDefer=new l},renderUI:h,syncUI:h,bindUI:h,onRendered:function(b){return this._renderedDefer.promise.then(b)},create:function(){this.get("created")||(this.fire("beforeCreateDom"),
this.createInternal(),this.__callPluginsMethod("pluginCreateDom"),this.fire("afterCreateDom"),this.setInternal("created",!0));return this},createInternal:function(){this.createDom()},render:function(){this.get("rendered")||(this.create(),this.fire("beforeRenderUI"),this.renderUI(),this.__callPluginsMethod("pluginRenderUI"),this.fire("afterRenderUI"),this.fire("beforeBindUI"),e.superclass.bindInternal.call(this),this.bindUI(),this.__callPluginsMethod("pluginBindUI"),this.fire("afterBindUI"),e.superclass.syncInternal.call(this),
k(this),this.setInternal("rendered",!0));return this},sync:function(){k(this)},plug:function(b){var c=this.get("plugins");this.callSuper(b);b=c[c.length-1];this.get("rendered")?(b.pluginCreateDom&&b.pluginCreateDom(this),b.pluginRenderUI&&b.pluginRenderUI(this),b.pluginBindUI&&b.pluginBindUI(this),b.pluginSyncUI&&b.pluginSyncUI(this)):this.get("created")&&b.pluginCreateDom&&b.pluginCreateDom(this);return this}},{__hooks__:{createDom:m("__createDom"),renderUI:m("__renderUI"),bindUI:m("__bindUI"),syncUI:m("__syncUI")},
name:"ComponentProcess",ATTRS:{rendered:{value:!1,setter:function(b){b&&this._renderedDefer.resolve(this)}},created:{value:!1}}});return e});
KISSY.add("component/control/render-xtpl",[],function(){return function(f,j,k){var c,l=this;c=this.config.utils;var j=c.runBlockCommand,m=c.getExpression,h=c.getPropertyOrRunCommand;c='<div id="';var e=h(l,f,{},"id",0,1,k,!1);c+=m(e,!0);c+='"\n class="';var e={},b=[];b.push("");e.params=b;e=h(l,f,e,"getBaseCssClasses",0,2,!0,k);c=c+e+"\n";var e={},b=[],n=h(l,f,{},"elCls",0,3,k,!0);b.push(n);e.params=b;e.fn=function(b){var c;c="\n ";b=h(l,b,{},".",0,4,k,!1);c+=m(b,!0);return c+"  \n"};c+=j(l,f,e,"each",
3);c+='\n"\n\n';e={};b=[];n=h(l,f,{},"elAttrs",0,8,k,!0);b.push(n);e.params=b;e.fn=function(b){var c;c=" \n ";var f=h(l,b,{},"xindex",0,9,k,!1);c+=m(f,!0);c+='="';b=h(l,b,{},".",0,9,k,!1);c+=m(b,!0);return c+'"\n'};c+=j(l,f,e,"each",8);c+='\n\nstyle="\n';e={};b=[];n=h(l,f,{},"elStyle",0,13,k,!0);b.push(n);e.params=b;e.fn=function(c){var b;b=" \n ";var f=h(l,c,{},"xindex",0,14,k,!1);b+=m(f,!0);b+=":";c=h(l,c,{},".",0,14,k,!1);b+=m(c,!0);return b+";\n"};c+=j(l,f,e,"each",13);return c+'\n">'}});
KISSY.add("component/control/render",["node","xtemplate/runtime","./process","./render-xtpl","component/manager"],function(f,j){function k(d){"number"==typeof d&&(d+="px");return d}function c(d){d||(d=[""]);"string"==typeof d&&(d=d.split(/\s+/));return d}function l(d,i,a){for(var b="",c=0,g=a.length,i=d+i;c<g;c++)d=(d=a[c])?"-"+d:d,b+=" "+i+d;return b}function m(d){var i;d.target==this.control&&(i=this[a+d.type.slice(5).slice(0,-6)],i.call(this,d.newVal,d))}function h(d,i){return this.config.view.getBaseCssClasses(i.params[0])}
function e(d,i){return this.config.view.getBaseCssClass(i.params[0])}var b=j("node"),n=j("xtemplate/runtime"),o=j("./process"),p=j("./render-xtpl"),q=j("component/manager"),a="_onSet",g=f.trim,r=b.all,s=f.UA,t=f.Env.host.document;return o.extend({isRender:!0,createInternal:function(){var d=this.control.get("srcNode");d?this.decorateDom(d):this.callSuper()},beforeCreateDom:function(d){var i=this.control,a,b,c,g=i.get("elAttrs"),f=i.get("elCls"),e;a=i.getAttrs();e=i.get("elStyle");var h=i.get("elCls");
for(b in a)c=a[b],c.view&&(d[b]=i.get(b));a=d.width;b=d.height;c=d.visible;d=d.zIndex;a&&(e.width=k(a));b&&(e.height=k(b));d&&(e["z-index"]=d);c||h.push(this.getBaseCssClasses("hidden"));if(e=i.get("disabled"))f.push(this.getBaseCssClasses("disabled")),g["aria-disabled"]="true";i.get("highlighted")&&f.push(this.getBaseCssClasses("hover"));i.get("focusable")&&(9>s.ieMode&&(g.hideFocus="true"),g.tabindex=e?"-1":"0")},createDom:function(){this.beforeCreateDom(this.renderData={},this.childrenElSelectors=
{},this.renderCommands={getBaseCssClasses:h,getBaseCssClass:e});var d=this.control,a;a=this.renderTpl(p)+this.renderTpl(this.get("contentTpl"))+"</div>";d.setInternal("el",this.$el=r(a));this.el=this.$el[0];this.fillChildrenElsBySelectors()},decorateDom:function(d){var a=this.control;d.attr("id")||d.attr("id",a.get("id"));var b=this.constructor.HTML_PARSER,c,g;for(c in b)g=b[c],"function"===typeof g?(g=g.call(this,d),void 0!==g&&a.setInternal(c,g)):"string"==typeof g?a.setInternal(c,d.one(g)):f.isArray(g)&&
g[0]&&a.setInternal(c,d.all(g[0]));a.setInternal("el",this.$el=d);this.el=d[0]},renderUI:function(){var d=this.control,a=this.$el;if(!d.get("srcNode")){var b=d.get("render");(d=d.get("elBefore"))?a.insertBefore(d,void 0):b?a.appendTo(b,void 0):a.appendTo(t.body,void 0)}},bindUI:function(){var d=this.control,b=d.getAttrs(),c,g;for(c in b){g=b[c];var e=f.ucfirst(c),h=this[a+e];if(g.view&&h)d.on("after"+e+"Change",m,this)}},destructor:function(){this.$el&&this.$el.remove()},$:function(d){return this.$el.all(d)},
fillChildrenElsBySelectors:function(d){var a=this.$el,b=this.control,c,g,d=d||this.childrenElSelectors;for(c in d)g=d[c],"function"===typeof g?b.setInternal(c,g(a)):b.setInternal(c,this.$(f.substitute(g,this.renderData))),delete d[c]},renderTpl:function(d,a,b){a=a||this.renderData;b=b||this.renderCommands;return(new (this.get("xtemplate"))(d,{control:this.control,view:this,commands:b})).render(a)},getComponentConstructorByNode:function(d,a){var b=a[0].className;return b?(b=b.replace(RegExp("\\b"+
d,"ig"),""),q.getConstructorByXClass(b)):null},getComponentCssClasses:function(){if(this.componentCssClasses)return this.componentCssClasses;for(var a=this.control.constructor,b,c=[];a&&!a.prototype.hasOwnProperty("isControl");)(b=a.xclass)&&c.push(b),a=a.superclass&&a.superclass.constructor;return this.componentCssClasses=c},getBaseCssClasses:function(a){for(var a=c(a),b=this.getComponentCssClasses(),e=0,f=this.get("control"),h="",k=b.length,f=f.get("prefixCls");e<k;e++)h+=l(f,b[e],a);return g(h)},
getBaseCssClass:function(a){return g(l(this.control.get("prefixCls"),this.getComponentCssClasses()[0],c(a)))},getKeyEventTarget:function(){return this.$el},_onSetWidth:function(a){this.$el.width(a)},_onSetHeight:function(a){this.$el.height(a)},_onSetContent:function(a){var b=this.$el;b.html(a);this.get("allowTextSelection")||b.unselectable()},_onSetVisible:function(a){var b=this.$el,c=this.getBaseCssClasses("hidden");a?b.removeClass(c):b.addClass(c)},_onSetHighlighted:function(a){var b=this.getBaseCssClasses("hover");
this.$el[a?"addClass":"removeClass"](b)},_onSetDisabled:function(a){var b=this.control,c=this.getBaseCssClasses("disabled");this.$el[a?"addClass":"removeClass"](c).attr("aria-disabled",a);b.get("focusable")&&this.getKeyEventTarget().attr("tabindex",a?-1:0)},_onSetActive:function(a){var b=this.getBaseCssClasses("active");this.$el[a?"addClass":"removeClass"](b).attr("aria-pressed",!!a)},_onSetFocused:function(a){var b=this.$el,c=this.getBaseCssClasses("focused");b[a?"addClass":"removeClass"](c)},_onSetZIndex:function(a){this.$el.css("z-index",
a)}},{__hooks__:{decorateDom:o.prototype.__getHook("__decorateDom"),beforeCreateDom:o.prototype.__getHook("__beforeCreateDom")},extend:function i(a,b,c){var g,e={};g=o.extend.apply(this,arguments);g.HTML_PARSER=g.HTML_PARSER||{};f.isArray(a)&&(f.each(a.concat(g),function(a){a&&f.each(a.HTML_PARSER,function(a,b){e[b]=a})}),g.HTML_PARSER=e);f.mix(g.HTML_PARSER,this.HTML_PARSER,!1);g.extend=i;return g},ATTRS:{control:{setter:function(a){this.control=a}},xtemplate:{value:n},contentTpl:{value:function(a){return a&&
a[a.length-1].content||""}}},HTML_PARSER:{id:function(a){return(a=a[0].id)?a:void 0},content:function(a){return a.html()},disabled:function(a){return a.hasClass(this.getBaseCssClass("disabled"))}},name:"render"})});
KISSY.add("component/control",["node","./control/process","component/manager","./control/render"],function(f,j){function k(){var a,b=this;do a=b.ATTRS,b=b.superclass;while(!a||!a.xrender);return a.xrender.value}var c=j("node"),l=j("./control/process"),m=j("component/manager"),h=j("./control/render"),e=f.UA.ieMode,b=b,n=f.Features,o=c.Gesture,p=n.isTouchGestureSupported(),q=n.isTouchEventSupported(),h=l.extend({isControl:!0,createDom:function(){var a=this.get("xrender"),b=this.get("view"),c=this.get("id");
b?b.set("control",this):this.set("view",this.view=b=new a({control:this}));b.create();a=b.getKeyEventTarget();this.get("allowTextSelection")||a.unselectable();m.addComponent(c,this)},renderUI:function(){this.view.render()},bindUI:function(){var a=this.view.getKeyEventTarget();if(this.get("focusable"))a.on("focus",this.handleFocus,this).on("blur",this.handleBlur,this).on("keydown",this.handleKeydown,this);if(this.get("handleMouseEvents")){a=this.$el;if(!q)a.on("mouseenter",this.handleMouseEnter,this).on("mouseleave",
this.handleMouseLeave,this).on("contextmenu",this.handleContextMenu,this);a.on(o.start,this.handleMouseDown,this).on(o.end,this.handleMouseUp,this).on(o.tap,this.handleClick,this);if(o.cancel)a.on(o.cancel,this.handleMouseUp,this);if(9>e)a.on("dblclick",this.handleDblClick,this)}},sync:function(){this.fire("beforeSyncUI");this.syncUI();this.view.sync();this.__callPluginsMethod("pluginSyncUI");this.fire("afterSyncUI")},createComponent:function(a,b){return m.createComponent(a,b||this)},_onSetFocused:function(a){var b=
this.view.getKeyEventTarget()[0];a?b.focus():b.ownerDocument.activeElement==b&&b.ownerDocument.body.focus()},_onSetX:function(a){this.$el.offset({left:a})},_onSetY:function(a){this.$el.offset({top:a})},_onSetVisible:function(a){this.fire(a?"show":"hide")},show:function(){this.render();this.set("visible",!0);return this},hide:function(){this.set("visible",!1);return this},focus:function(){this.get("focusable")&&this.set("focused",!0)},blur:function(){this.get("focusable")&&this.set("focused",!1)},
move:function(a,b){this.set({x:a,y:b})},handleDblClick:function(a){this.get("disabled")||this.handleDblClickInternal(a)},handleDblClickInternal:function(a){this.handleClickInternal(a)},handleMouseEnter:function(a){this.get("disabled")||this.handleMouseEnterInternal(a)},handleMouseEnterInternal:function(a){this.set("highlighted",!!a)},handleMouseLeave:function(a){this.get("disabled")||this.handleMouseLeaveInternal(a)},handleMouseLeaveInternal:function(a){this.set("active",!1);this.set("highlighted",
!a)},handleMouseDown:function(a){this.get("disabled")||this.handleMouseDownInternal(a)},handleMouseDownInternal:function(a){var b;if(1==a.which||p)this.get("activeable")&&this.set("active",!0),this.get("focusable")&&this.focus(),this.get("allowTextSelection")||(b=(b=a.target.nodeName)&&b.toLowerCase(),"input"!=b&&"textarea"!=b&&a.preventDefault())},handleMouseUp:function(a){this.get("disabled")||this.handleMouseUpInternal(a)},handleMouseUpInternal:function(a){this.get("active")&&(1==a.which||p)&&
this.set("active",!1)},handleContextMenu:function(a){this.get("disabled")||this.handleContextMenuInternal(a)},handleContextMenuInternal:function(){},handleFocus:function(){this.get("disabled")||this.handleFocusInternal()},handleFocusInternal:function(){this.focus();this.fire("focus")},handleBlur:function(){this.get("disabled")||this.handleBlurInternal()},handleBlurInternal:function(){this.blur();this.fire("blur")},handleKeydown:function(a){return!this.get("disabled")&&this.handleKeyDownInternal(a)?
(a.halt(),!0):b},handleKeyDownInternal:function(a){return a.keyCode==c.KeyCode.ENTER?this.handleClickInternal(a):b},handleClick:function(a){this.get("disabled")||this.handleClickInternal(a)},handleClickInternal:function(){this.get("focusable")&&this.focus()},destructor:function(){m.removeComponent(this.get("id"));this.view&&this.view.destroy()}},{name:"control",ATTRS:{id:{view:1,valueFn:function(){return f.guid("ks-component")}},content:{view:1,value:""},width:{view:1},height:{view:1},elCls:{view:1,
value:[],setter:function(a){"string"==typeof a&&(a=a.split(/\s+/));return a||[]}},elStyle:{view:1,value:{}},elAttrs:{view:1,value:{}},elBefore:{},el:{setter:function(a){this.$el=a;this.el=a[0]}},x:{},y:{},xy:{setter:function(a){var b=f.makeArray(a);b.length&&(b[0]&&this.set("x",b[0]),b[1]&&this.set("y",b[1]));return a},getter:function(){return[this.get("x"),this.get("y")]}},zIndex:{view:1},render:{},visible:{sync:0,value:!0,view:1},srcNode:{setter:function(a){return c.all(a)}},handleMouseEvents:{value:!0},
focusable:{value:!0,view:1},allowTextSelection:{value:!1},activeable:{value:!0},focused:{view:1},active:{view:1,value:!1},highlighted:{view:1,value:!1},prefixCls:{view:1,value:f.config("component/prefixCls")||"ks-"},prefixXClass:{},parent:{setter:function(a,b){(b=this.get("parent"))&&this.removeTarget(b);a&&this.addTarget(a)}},disabled:{view:1,value:!1},xrender:{value:h},view:{setter:function(a){this.view=a}}}});h.getDefaultRender=k;h.extend=function g(b,c,e){var d=f.makeArray(arguments),h,j=d[d.length-
1];if(h=j.xclass)j.name=h;d=l.extend.apply(this,d);h&&m.setConstructorByXClass(h,d);d.extend=g;d.getDefaultRender=k;return d};return h});
