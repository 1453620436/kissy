/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Sep 17 23:07
*/
KISSY.add("editor/iframe-content-tpl",'<!doctype html>\n<html>\n<head>{doctype}\n    <title>{title}</title>\n    {style}\n    {links}\n    </head> \n<body class="ks-editor">\n{data}\n{script}\n</body> \n</html>');
KISSY.add("editor/render-xtpl",function(){return function(a,b,r){var l=this,b=this.config.utils,n=b.runBlockCommand,s=b.getExpression,g=b.getPropertyOrRunCommand,b='<div class="',k=g(l,a,{},"prefixCls",0,1,r,!1),b=b+s(k,!0),b=b+'editor-tools"\r\n     id="ks-editor-tools-',k=g(l,a,{},"id",0,2,r,!1),b=b+s(k,!0),b=b+'">\r\n\r\n</div>\r\n\r\n<\!--\r\nhttp://johanbrook.com/browsers/native-momentum-scrolling-ios-5/\r\nios \u4e0d\u80fd\u653e\u5728 iframe \u4e0a\uff01\r\n--\>\r\n\r\n<div class="',k=g(l,a,{},"prefixCls",0,11,r,!1),b=b+
s(k,!0),b=b+'editor-textarea-wrap"\r\n\r\n',k={},o=[],p=g(l,a,{},"mobile",0,13,r,!0);o.push(p);k.params=o;k.fn=function(){return'\r\nstyle="overflow:scroll;-webkit-overflow-scrolling:touch;"\r\n'};b+=n(l,a,k,"if",13);b+='\r\n\r\nid="ks-editor-textarea-wrap-';k=g(l,a,{},"id",0,17,r,!1);b+=s(k,!0);b+='"\r\n>\r\n\r\n<textarea\r\n        id="ks-editor-textarea-';k=g(l,a,{},"id",0,21,r,!1);b+=s(k,!0);b+='"\r\n        class="';k=g(l,a,{},"prefixCls",0,22,r,!1);b+=s(k,!0);b+='editor-textarea"\r\n\r\n';k=
{};o=[];p=g(l,a,{},"textareaAttrs",0,24,r,!0);o.push(p);k.params=o;k.fn=function(a){var m;m="\r\n";var k=g(l,a,{},"xindex",0,25,r,!1);m+=s(k,!0);m+='="';a=g(l,a,{},".",0,25,r,!1);m+=s(a,!0);return m+'"\r\n'};b+=n(l,a,k,"each",24);b+="\r\n\r\n";k={};o=[];p=g(l,a,{},"mode",0,28,r,!0);o.push(p);k.params=o;k.fn=function(){return'\r\nstyle="display:none"\r\n'};b+=n(l,a,k,"if",28);b+="\r\n\r\n>";n=g(l,a,{},"data",0,32,r,!1);b+=s(n,!0);b+='</textarea>\r\n\r\n</div>\r\n\r\n<div class="';n=g(l,a,{},"prefixCls",
0,36,r,!1);b+=s(n,!0);b+='editor-status"\r\n     id="ks-editor-status-';a=g(l,a,{},"id",0,37,r,!1);b+=s(a,!0);return b+'">\r\n\r\n</div>'}});KISSY.add("editor/render",function(a,b,r){return b.getDefaultRender().extend({beforeCreateDom:function(b,n){a.mix(b,{mobile:a.UA.mobile});a.mix(n,{textarea:"#ks-editor-textarea-{id}",toolBarEl:"#ks-editor-tools-{id}",statusBarEl:"#ks-editor-status-{id}"})}},{ATTRS:{contentTpl:{value:r}}})},{requires:["component/control","./render-xtpl"]});
KISSY.add("editor/base",function(a,b,r,l){return r.extend({},{Config:{},XHTML_DTD:b.DTD,ATTRS:{textarea:{},textareaAttrs:{view:1},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{view:1,value:1},data:{view:1},customStyle:{value:""},customLink:{value:[]},xrender:{value:l}},xclass:"editor"})},{requires:["html-parser","component/control","./render"]});
KISSY.add("editor/utils",function(a,b){var r=a.Node,l=a.DOM,n=a.UA,s={debugUrl:function(g){var k=a.Config;k.debug||(g=g.replace(/\.(js|css)/i,"-min.$1"));-1==g.indexOf("?t")&&(g=-1!=g.indexOf("?")?g+"&":g+"?",g+="t="+encodeURIComponent(k.tag));return k.base+"editor/"+g},lazyRun:function(a,k,b){var p=a[k],l=a[b];a[k]=function(){p.apply(this,arguments);a[k]=a[b];return l.apply(this,arguments)}},getXY:function(a,k){var b=a.left,p=a.top,n=k.get("window")[0],b=b-l.scrollLeft(n),p=p-l.scrollTop(n),n=k.get("iframe").offset(),
b=b+n.left,p=p+n.top;return{left:b,top:p}},tryThese:function(a){for(var b,o=0,p=arguments.length;o<p;o++){var l=arguments[o];try{b=l();break}catch(m){}}return b},clearAllMarkers:function(a){for(var b in a)a[b]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},isNumber:function(g){return/^\d+(.\d+)?$/.test(a.trim(g))},verifyInputs:function(g){for(var b=0;b<g.length;b++){var o=new r(g[b]),p=a.trim(s.valInput(o)),l=o.attr("data-verify"),
o=o.attr("data-warning");if(l&&!RegExp(l).test(p))return alert(o),!1}return!0},sourceDisable:function(a,b){a.on("sourceMode",b.disable,b);a.on("wysiwygMode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");b&&n.ie?(a.addClass("ks-editor-input-tip"),a.val(b)):n.ie||a.val("")},valInput:function(a,b){if(void 0===b)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(b)},placeholder:function(g,b){g.attr("placeholder",b);n.ie&&(g.on("blur",function(){a.trim(g.val())||
(g.addClass("ks-editor-input-tip"),g.val(b))}),g.on("focus",function(){g.removeClass("ks-editor-input-tip");a.trim(g.val())==b&&g.val("")}))},normParams:function(b){var b=a.clone(b),k;for(k in b){var o=b[k];"function"===typeof o&&(b[k]=o())}return b},ieEngine:document.documentMode||n.ie,preventFocus:function(a){n.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(b){a.mix(l,b);for(var k in b)(function(k){r.prototype[k]=function(){var p=[].slice.call(arguments,0);p.unshift(this[0]);
return(p=b[k].apply(null,p))&&(p.nodeType||a.isWindow(p))?new r(p):a.isArray(p)&&(p.__IS_NODELIST||p[0]&&p[0].nodeType)?new r(p):p}})(k)},addRes:function(){var b=this.__res=this.__res||[];b.push.apply(b,a.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],b=0;b<a.length;b++){var o=a[b];"function"===typeof o?o():o.destroy?o.destroy():o.remove&&o.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,b){return b.toUpperCase()})+"Value"}};
return b.Utils=s},{requires:["./base","node"]});
KISSY.add("editor/dom",function(a,b,r){function l(a,f){var d=a[f?"next":"prev"](n,1);if(d&&d[0].nodeType==k.ELEMENT_NODE){for(var c=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemovable(n);)if(c.push(d),d=f?d.next(n,1):d.prev(n,1),!d)return;if(a._4e_isIdentical(d,n)){for(var i=new p(f?a[0].lastChild:a[0].firstChild);c.length;)c.shift()._4e_move(a,!f,n);d._4e_moveChildren(a,!f,n);d.remove();i[0]&&i[0].nodeType==k.ELEMENT_NODE&&i._4e_mergeSiblings()}}}var n=n,s=b.XHTML_DTD,g=a.DOM,k=g.NodeType,o=
a.UA,p=a.Node,v={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};b.PositionType={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var m=b.PositionType,w={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},j=function(a){return a&&(a[0]||a)};r.injectDom({_4e_sameLevel:function(a,f){var f=j(f),d=a.parentNode;return d&&d==f.parentNode},_4e_isBlockBoundary:function(q,f){var d=a.merge(x,f);return!(!w[g.css(q,"display")]&&!d[g.nodeName(q)])},_4e_index:function(a,f){for(var d=a.parentNode.childNodes,c,i=-1,e=0;e<d.length;e++)if(c=d[e],!f||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(i++,c===a)return i;return-1},_4e_move:function(a,
f,d){f=j(f);d?f.insertBefore(a,f.firstChild):f.appendChild(a)},_4e_isIdentical:function(a,f){if(!f)return!1;f=j(f);if(g.nodeName(a)!=g.nodeName(f))return!1;var d=a.attributes,c=f.attributes,i=d.length,e=c.length;if(i!=e)return!1;for(var h=0;h<i;h++){var b=d[h],t=b.name;if(b.specified&&g.attr(a,t)!=g.attr(f,t))return!1}if(8>r.ieEngine)for(h=0;h<e;h++)if(b=c[h],t=b.name,b.specified&&g.attr(a,t)!=g.attr(f,t))return!1;return!0},_4e_isEmptyInlineRemovable:function(q){if(!s.$removeEmpty[g.nodeName(q)])return!1;
for(var q=q.childNodes,f=0,d=q.length;f<d;f++){var c=q[f],i=c.nodeType;if(!(i==k.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(i==k.ELEMENT_NODE&&!g._4e_isEmptyInlineRemovable(c)||i==g.NodeType.TEXT_NODE&&a.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,f,d){f=j(f);if(a!=f)if(d)for(;d=a.lastChild;)f.insertBefore(a.removeChild(d),f.firstChild);else for(;d=a.firstChild;)f.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(a){a=new p(a);v[a.nodeName()]&&(l(a,!0),l(a))},_4e_splitText:function(a,
f){var d=a.ownerDocument;if(a.nodeType==g.NodeType.TEXT_NODE){if(o.ie&&f==a.nodeValue.length){var c=d.createTextNode("");g.insertAfter(c,a);return c}c=a.splitText(f);d.documentMode&&(d=d.createTextNode(""),g.insertAfter(d,c),g.remove(d));return c}},_4e_parents:function(a,f){var d=[];d.__IS_NODELIST=1;do d[f?"push":"unshift"](a);while(a=a.parentNode);return d},_4e_nextSourceNode:function(a,f,d,c){if(c&&!c.call)var i=j(c),c=function(a){return a!==i};var f=!f&&a.firstChild,e=a;if(!f){if(a.nodeType==
k.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.nextSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.nextSibling}return!f||c&&!1===c(f)?null:d&&d!=f.nodeType?g._4e_nextSourceNode(f,!1,d,c):f},_4e_previousSourceNode:function(a,f,d,c){if(c&&!c.call)var i=j(c),c=function(a){return a!==i};var f=!f&&a.lastChild,e=a;if(!f){if(a.nodeType==k.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.previousSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.previousSibling}return!f||
c&&!1===c(f)?null:d&&f.nodeType!=d?g._4e_previousSourceNode(f,!1,d,c):f},_4e_commonAncestor:function(a,f){f=j(f);if(a===f)return a;if(g.contains(f,a))return f;var d=a;do if(g.contains(d,f))return d;while(d=d.parentNode);return null},_4e_hasAttributes:9>r.ieEngine?function(a){for(var f=a.attributes,d=0;d<f.length;d++){var c=f[d];switch(c.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(a){o.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,f){var d=j(f);if(a.compareDocumentPosition)return a.compareDocumentPosition(d);if(a==d)return m.POSITION_IDENTICAL;if(a.nodeType==k.ELEMENT_NODE&&d.nodeType==k.ELEMENT_NODE){if(g.contains(a,d))return m.POSITION_CONTAINS+m.POSITION_PRECEDING;if(g.contains(d,a))return m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>d.sourceIndex?m.POSITION_DISCONNECTED:a.sourceIndex<d.sourceIndex?m.POSITION_PRECEDING:m.POSITION_FOLLOWING}for(var c=
g._4e_address(a),d=g._4e_address(d),i=Math.min(c.length,d.length),e=0;e<=i-1;e++)if(c[e]!=d[e])return c[e]<d[e]?m.POSITION_PRECEDING:m.POSITION_FOLLOWING;return c.length<d.length?m.POSITION_CONTAINS+m.POSITION_PRECEDING:m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING},_4e_address:function(a,f){for(var d=[],c=a.ownerDocument.documentElement,i=a;i&&i!=c;)d.unshift(g._4e_index(i,f)),i=i.parentNode;return d},_4e_remove:function(a,f){var d=a.parentNode;if(d){if(f)for(var c;c=a.firstChild;)d.insertBefore(a.removeChild(c),
a);d.removeChild(a)}return a},_4e_trim:function(a){g._4e_ltrim(a);g._4e_rtrim(a)},_4e_ltrim:function(a){for(var f;f=a.firstChild;){if(f.nodeType==g.NodeType.TEXT_NODE){var d=r.ltrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(g._4e_splitText(f,c-d.length),a.removeChild(a.firstChild));else{a.removeChild(f);continue}}break}},_4e_rtrim:function(a){for(var f;f=a.lastChild;){if(f.type==g.NodeType.TEXT_NODE){var d=r.rtrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(g._4e_splitText(f,d.length),
a.removeChild(a.lastChild));else{a.removeChild(f);continue}}break}!o.ie&&!o.opera&&(f=a.lastChild)&&1==f.nodeType&&"br"==g.nodeName(f)&&a.removeChild(f)},_4e_appendBogus:function(b){for(var f=b.lastChild;f&&f.nodeType==g.NodeType.TEXT_NODE&&!a.trim(f.nodeValue);)f=f.previousSibling;if(!f||f.nodeType==g.NodeType.TEXT_NODE||"br"!==g.nodeName(f))f=o.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),b.appendChild(f)},_4e_setMarker:function(b,f,d,c){var b=new p(b),i=b.data("list_marker_id")||
b.data("list_marker_id",a.guid()).data("list_marker_id"),e=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");f[i]=b;e[d]=1;return b.data(d,c)},_4e_clearMarkers:function(a,f,d){var a=new p(a),c=a.data("list_marker_names"),i=a.data("list_marker_id"),e;for(e in c)a.removeData(e);a.removeData("list_marker_names");d&&(a.removeData("list_marker_id"),delete f[i])},_4e_copyAttributes:function(a,f,d){for(var f=new p(f),c=a.attributes,d=d||{},i=0;i<c.length;i++){var e=c[i],
h=e.name.toLowerCase(),b;if(!(h in d))if("checked"==h&&(b=g.attr(a,h)))f.attr(h,b);else if(e.specified||o.ie&&e.value&&"value"==h)b=g.attr(a,h),null===b&&(b=e.nodeValue),f.attr(h,b)}""!==a.style.cssText&&(f[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=g.nodeName(a);return(a=!s.$nonEditable[a]&&(s[a]||s.span))&&a["#text"]},_4e_getByAddress:function(a,f,d){for(var a=a.documentElement,c=0;a&&c<f.length;c++){var i=f[c];if(d)for(var e=-1,h=0;h<a.childNodes.length;h++){var b=a.childNodes[h];
if(!(!0===d&&3==b.nodeType&&b.previousSibling&&3==b.previousSibling.nodeType)&&(e++,e==i)){a=b;break}}else a=a.childNodes[i]}return a}})},{requires:["./base","./utils","node"]});
KISSY.add("editor/focusManager",function(a,b){function r(){var a=this;a.__iframeFocus=o;g=a;s&&clearTimeout(s);s=setTimeout(function(){a.fire("focus")},30)}function l(){var a=this;a.__iframeFocus=p;g=v;s&&clearTimeout(s);s=setTimeout(function(){a.fire("blur")},30)}var n={},s,g,k={currentInstance:function(){return g},getInstance:function(a){return n[a]},register:function(a){n[a.get("id")]=a},add:function(a){this.register(a);a.get("window").on("focus",r,a).on("blur",l,a)},remove:function(a){delete n[a.get("id")];
a.get("window").detach("focus",r,a).detach("blur",l,a)}},o=!0,p=!1,v=null;b.focusManager=k;b.getInstances=function(){return n};return k},{requires:["./base","./dom"]});
KISSY.add("editor/walker",function(a,b){function r(a,d){if(this._.end)return k;var c,i=this.range,e,h=this.guard,b=this.type,t=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,i.trim(),i.collapsed))return this.end(),k;if(!a&&!this._.guardLTR){var j=i.endContainer[0],o=j.childNodes[i.endOffset];this._.guardLTR=function(a,c){return c&&(j==a||"body"==p.nodeName(a))?!1:a!=o}}if(a&&!this._.guardRTL){var l=i.startContainer[0],q=0<i.startOffset&&l.childNodes[i.startOffset-
1]||null;this._.guardRTL=function(a,c){return c&&(l==a||"body"==p.nodeName(a))?!1:a!=q}}var z=a?this._.guardRTL:this._.guardLTR;e=h?function(a,c){return z(a,c)===g?g:h(a,c)}:z;this.current?c=this.current[t](g,b,e):a?(c=i.endContainer,0<i.endOffset?(c=new m(c[0].childNodes[i.endOffset-1]),e(c[0])===g&&(c=k)):c=e(c,s)===g?k:c._4e_previousSourceNode(s,b,e,void 0)):(c=i.startContainer,c=new m(c[0].childNodes[i.startOffset]),c.length?e(c[0])===g&&(c=k):c=e(i.startContainer,s)===g?k:i.startContainer._4e_nextSourceNode(s,
b,e,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==g){if(!d)return c}else if(d&&this.evaluator)return g;c=c[t](g,b,e)}this.end();return this.current=k}function l(a){for(var d,c=k;d=r.call(this,a);)c=d;return c}function n(a){this.range=a;this.guard=this.evaluator=k;this._={}}var s=!0,g=!1,k=null,o=a.UA,p=a.DOM,v=b.XHTML_DTD,m=a.Node;a.augment(n,{end:function(){this._.end=1},next:function(){return r.call(this)},previous:function(){return r.call(this,s)},checkForward:function(){return r.call(this,
g,s)!==g},checkBackward:function(){return r.call(this,s,s)!==g},lastForward:function(){return l.call(this)},lastBackward:function(){return l.call(this,s)},reset:function(){delete this.current;this._={}},_iterator:r});a.mix(n,{blockBoundary:function(a){return function(d){return!(d.nodeType==p.NodeType.ELEMENT_NODE&&p._4e_isBlockBoundary(d,a))}},bookmark:function(a,d){function c(a){return"span"==p.nodeName(a)&&p.attr(a,"_ke_bookmark")}return function(i){var e,h;e=i.nodeType==p.NodeType.TEXT_NODE&&(h=
i.parentNode)&&c(h);e=a?e:e||c(i);return!!(d^e)}},whitespaces:function(f){return function(d){d=d.nodeType==p.NodeType.TEXT_NODE&&!a.trim(d.nodeValue);return!!(f^d)}},invisible:function(a){var d=n.whitespaces();return function(c){c=d(c)||c.nodeType==p.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var w=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,x=n.whitespaces(),j=n.bookmark(),q=function(a){var d=p.nodeName(a);return j(a)||x(a)||1==a.nodeType&&d in v.$inline&&!(d in v.$empty)};b.Utils.injectDom({_4e_getBogus:function(a){a=
new m(a);do a=a._4e_previousSourceNode();while(a&&q(a[0]));return a&&(!o.ie?"br"==a.nodeName():3==a[0].nodeType&&w.test(a.text()))?a[0]:!1}});return b.Walker=n},{requires:["./base","./utils","./dom","node"]});
KISSY.add("editor/elementPath",function(a,b){function r(a){for(var b=s,r=s,m=[];a;){if(a[0].nodeType==l.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var w=a.nodeName();if(!r&&(!b&&g[w]&&(b=a),k[w])){var x;if(x=!b)if(x="div"==w){a:{x=a[0].childNodes;for(var j=0,q=x.length;j<q;j++){var f=x[j];if(f.nodeType==l.NodeType.ELEMENT_NODE&&n.$block[f.nodeName.toLowerCase()]){x=!0;break a}}x=!1}x=!x}x?b=a:r=a}m.push(a);if("body"==w)break}a=a.parent()}this.block=b;this.blockLimit=r;this.elements=
m}var l=a.DOM,n=b.XHTML_DTD,s=null,g={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},k={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};r.prototype={constructor:r,compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var g=0;g<b.length;g++)if(!l.equals(b[g],a[g]))return!1;return!0},contains:function(a){for(var b=this.elements,g=0;g<b.length;g++)if(b[g].nodeName()in a)return b[g];return s},toString:function(){var a=
this.elements,b,g=[];for(b=0;b<a.length;b++)g.push(a[b].nodeName());return g.toString()}};return b.ElementPath=r},{requires:["./base","./dom","node"]});
KISSY.add("editor/range",function(a,b,r,l,n){function s(z){var e=z.nodeType!=f.NodeType.TEXT_NODE&&f.nodeName(z)in c.$removeEmpty,d=z.nodeType==f.NodeType.TEXT_NODE&&!a.trim(z.nodeValue),z=!!z.parentNode.getAttribute("_ke_bookmark");return e||d||z}function g(a){return!t(a)&&!D(a)}function k(c){var e=w;return function(i){if(D(i))return m;if(i.nodeType==f.NodeType.TEXT_NODE){if(a.trim(i.nodeValue).length)return w}else if(i.nodeType==f.NodeType.ELEMENT_NODE&&(i=f.nodeName(i),!K[i]))if(!c&&!d.ie&&"br"==
i&&!e)e=m;else return w;return m}}function o(a,c){var e=a.startContainer,u=a.endContainer,d=a.startOffset,b=a.endOffset,t,y=w,g=w,j=void 0,k=a.document,R;0<c&&(j=k.createDocumentFragment());if(a.collapsed)return j;a.optimizeBookmark();u[0].nodeType==f.NodeType.TEXT_NODE?(g=m,u=u._4e_splitText(b)):0<u[0].childNodes.length&&(b>=u[0].childNodes.length?(u=new i(u[0].appendChild(k.createTextNode(""))),R=m):u=new i(u[0].childNodes[b]));e[0].nodeType==f.NodeType.TEXT_NODE?(y=m,e._4e_splitText(d)):d?d>=e[0].childNodes.length?
(e=new i(e[0].appendChild(k.createTextNode(""))),t=m):e=new i(e[0].childNodes[d].previousSibling):(t=new i(k.createTextNode("")),e.prepend(t),e=t,t=m);var H=e._4e_parents(),J=u._4e_parents();H.each(function(a,c){H[c]=a});J.each(function(a,c){J[c]=a});for(var F,N,k=0;k<H.length&&!(F=H[k],N=J[k],!F.equals(N));k++);for(var d=j,B,l,q=k;q<H.length;q++){B=H[q];b=0<c&&!B.equals(e)?d.appendChild(B.clone()[0]):null;B=B[0].nextSibling;l=J[q];for(var n=u[0],D=l&&l[0];B&&!(D==B||n==B);){l=B.nextSibling;if(2==
c)d.appendChild(B.cloneNode(m));else{if(h[B.nodeName.toLowerCase()]){var p=B.cloneNode(m);B.innerHTML="";B=p}else f._4e_remove(B);1==c&&d.appendChild(B)}B=l}b&&(d=b)}for(d=j;k<J.length;k++){B=J[k];b=0<c&&!B.equals(u)?d.appendChild(B.clone()[0]):null;if(!H[k]||!B._4e_sameLevel(H[k]))for(B=B[0].previousSibling;B;)l=B.previousSibling,2==c?d.insertBefore(B.cloneNode(m),d.firstChild):(f._4e_remove(B),1==c&&d.insertBefore(B,d.firstChild)),B=l;b&&(d=b)}if(2==c){if(y&&(F=e[0],F.nodeType==f.NodeType.TEXT_NODE&&
F.nextSibling&&F.nextSibling.nodeType==f.NodeType.TEXT_NODE&&(F.data+=F.nextSibling.data,F.parentNode.removeChild(F.nextSibling))),g)g=u[0],g.nodeType==f.NodeType.TEXT_NODE&&g.previousSibling&&g.previousSibling.nodeType==f.NodeType.TEXT_NODE&&(g.previousSibling.data+=g.data,g.parentNode.removeChild(g))}else{if(F&&N&&(!e._4e_sameLevel(F)||!u._4e_sameLevel(N)))g=F._4e_index(),t&&F._4e_sameLevel(e)&&g--,a.setStart(F.parent(),g+1);a.collapse(m)}t&&e.remove();R&&u.remove();return j}function p(a){a.collapsed=
a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function v(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=x;this.collapsed=m;this.document=a}b.RangeType={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var m=!0,w=!1,x=null,j=b.RangeType,q=b.PositionType,f=a.DOM,
d=a.UA,c=b.XHTML_DTD,i=a.Node,e=i.all,h={td:1},y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},t=new l.whitespaces,D=new l.bookmark,E=l.whitespaces(m),C=l.bookmark(!1,!0),K={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(v,{toString:function(){var a=[],c=this.startContainer[0],e=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);
a.push((e.id||e.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,c=this.startOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),
a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=
c;this.endContainer||(this.endContainer=a,this.endOffset=c);p(this)},setEnd:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);p(this)},setStartAt:function(a,c){switch(c){case j.POSITION_AFTER_START:this.setStart(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);
break;case j.POSITION_BEFORE_START:this.setStartBefore(a);break;case j.POSITION_AFTER_END:this.setStartAfter(a)}p(this)},setEndAt:function(a,c){switch(c){case j.POSITION_AFTER_START:this.setEnd(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setEndBefore(a);break;case j.POSITION_AFTER_END:this.setEndAfter(a)}p(this)},cloneContents:function(){return o(this,2)},
deleteContents:function(){return o(this,0)},extractContents:function(){return o(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=m},clone:function(){var a=new v(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=
this.clone();a.optimize();if(a.startContainer[0].nodeType!=f.NodeType.ELEMENT_NODE||a.endContainer[0].nodeType!=f.NodeType.ELEMENT_NODE)return x;var c=new l(a);c.evaluator=function(a){return E(a)&&C(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:x},shrink:function(a,c){if(!this.collapsed){var a=a||j.SHRINK_TEXT,e=this.clone(),u=this.startContainer,d=this.endContainer,i=this.startOffset,b=this.endOffset,h=m,g,t,y=m;u&&u[0].nodeType==f.NodeType.TEXT_NODE&&(i?i>=u[0].nodeValue.length?
e.setStartAfter(u):(e.setStartBefore(u),h=w):e.setStartBefore(u));d&&d[0].nodeType==f.NodeType.TEXT_NODE&&(b?b>=d[0].nodeValue.length?e.setEndAfter(d):(e.setEndAfter(d),y=w):e.setEndBefore(d));if(h||y)t=new l(e),t.evaluator=function(c){return c.nodeType==(a==j.SHRINK_ELEMENT?f.NodeType.ELEMENT_NODE:f.NodeType.TEXT_NODE)},t.guard=function(c,e){if(a==j.SHRINK_ELEMENT&&c.nodeType==f.NodeType.TEXT_NODE||e&&c==g)return w;!e&&c.nodeType==f.NodeType.ELEMENT_NODE&&(g=c);return m};h&&(e=t[a==j.SHRINK_ELEMENT?
"lastForward":"next"]())&&this.setStartAt(e,c?j.POSITION_AFTER_START:j.POSITION_BEFORE_START);y&&(t.reset(),(t=t[a==j.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(t,c?j.POSITION_BEFORE_END:j.POSITION_AFTER_END));return h||y}},createBookmark2:function(a){var c=this.startContainer,e=this.endContainer,u=this.startOffset,d=this.endOffset,b,h;if(!c||!e)return{start:0,end:0};if(a){if(c[0].nodeType==f.NodeType.ELEMENT_NODE&&(b=new i(c[0].childNodes[u]))&&b[0]&&b[0].nodeType==f.NodeType.TEXT_NODE&&
0<u&&b[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)c=b,u=0;for(;c[0].nodeType==f.NodeType.TEXT_NODE&&(h=c.prev(void 0,1))&&h[0].nodeType==f.NodeType.TEXT_NODE;)c=h,u+=h[0].nodeValue.length;if(!this.collapsed){if(e[0].nodeType==f.NodeType.ELEMENT_NODE&&(b=new i(e[0].childNodes[d]))&&b[0]&&b[0].nodeType==f.NodeType.TEXT_NODE&&0<d&&b[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)e=b,d=0;for(;e[0].nodeType==f.NodeType.TEXT_NODE&&(h=e.prev(void 0,1))&&h[0].nodeType==f.NodeType.TEXT_NODE;)e=h,
d+=h[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?x:e._4e_address(a),startOffset:u,endOffset:d,normalized:a,is2:m}},createBookmark:function(c){var e,d,u,b,h=this.collapsed;e=new i("<span>",x,this.document);e.attr("_ke_bookmark",1);e.css("display","none");e.html("&nbsp;");c&&(u=a.guid("ke_bm_"),e.attr("id",u+"S"));h||(d=e.clone(),d.html("&nbsp;"),c&&d.attr("id",u+"E"),b=this.clone(),b.collapse(),b.insertNode(d));b=this.clone();b.collapse(m);b.insertNode(e);d?(this.setStartAfter(e),
this.setEndBefore(d)):this.moveToPosition(e,j.POSITION_AFTER_END);return{startNode:c?u+"S":e,endNode:c?u+"E":d,serializable:c,collapsed:h}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(m)},trim:function(a,c){var e=this.startContainer,d=this.startOffset,b=this.collapsed;if((!a||b)&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE){if(d)if(d>=e[0].nodeValue.length)d=e._4e_index()+1,e=e.parent();else{var i=e._4e_splitText(d),d=e._4e_index()+1,e=e.parent();f.equals(this.startContainer,this.endContainer)?
this.setEnd(i,this.endOffset-this.startOffset):f.equals(e,this.endContainer)&&(this.endOffset+=1)}else d=e._4e_index(),e=e.parent();this.setStart(e,d);if(b){this.collapse(m);return}}e=this.endContainer;d=this.endOffset;!c&&!b&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE&&(d?(d>=e[0].nodeValue.length||e._4e_splitText(d),d=e._4e_index()+1):d=e._4e_index(),e=e.parent(),this.setEnd(e,d))},insertNode:function(a){this.optimizeBookmark();this.trim(w,m);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||
null);c[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(c){var d=e(this.document);if(c.is2){var b=d._4e_getByAddress(c.start,c.normalized),u=c.startOffset,d=c.end&&d._4e_getByAddress(c.end,c.normalized),c=c.endOffset;this.setStart(b,u);d?this.setEnd(d,c):this.collapse(m)}else b=(u=c.serializable)?a.one("#"+c.startNode,d):c.startNode,c=u?a.one("#"+c.endNode,d):c.endNode,this.setStartBefore(b),b._4e_remove(),c&&c[0]?(this.setEndBefore(c),c._4e_remove()):this.collapse(m)},
getCommonAncestor:function(a,c){var e=this.startContainer,d=this.endContainer,e=e[0]==d[0]?a&&e[0].nodeType==f.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new i(e[0].childNodes[this.startOffset]):e:e._4e_commonAncestor(d);return c&&e[0].nodeType==f.NodeType.TEXT_NODE?e.parent():e},enlarge:function(){function a(c,d,u,b){var i=c[d?"startContainer":"endContainer"],h,g=d?0:1,y=0,j=d?"previousSibling":"nextSibling";h=c[d?"startOffset":"endOffset"];if(i[0].nodeType==f.NodeType.TEXT_NODE){if(d){if(h)return}else if(h<
i[0].nodeValue.length)return;h=i[0][j];i=i[0].parentNode}else h=i[0].childNodes[h+(d?-1:1)]||null,i=i[0];for(;i;){for(;h;)if(t(h)||D(h))h=h[j];else break;if(h){if(!y)c[d?"setStartAfter":"setEndBefore"](e(h));break}i=e(i);if("body"==i.nodeName())break;if(y||i.equals(b))u[g]=i,y=1;else c[d?"setStartBefore":"setEndAfter"](i);h=i[0][j];i=i[0].parentNode}}return function(c){switch(c){case j.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),d=[];a(this,1,d,c);a(this,0,d,c);d[0]&&d[1]&&
(c=d[0].contains(d[1])?d[1]:d[0],this.setStartBefore(c),this.setEndAfter(c));break;case j.ENLARGE_BLOCK_CONTENTS:case j.ENLARGE_LIST_ITEM_CONTENTS:var b=new v(this.document),d=new i(this.document.body);b.setStartAt(d,j.POSITION_AFTER_START);b.setEnd(this.startContainer,this.startOffset);var b=new l(b),h,t,g=l.blockBoundary(c==j.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:x),y=function(a){var c=g(a);c||(h=e(a));return c},k=function(a){var c=y(a);!c&&"br"==f.nodeName(a)&&(t=e(a));return c};b.guard=y;b=b.lastBackward();
h=h||d;this.setStartAt(h,"br"!=h.nodeName()&&(!b&&this.checkStartOfBlock()||b&&h.contains(b))?j.POSITION_AFTER_START:j.POSITION_AFTER_END);b=this.clone();b.collapse();b.setEndAt(d,j.POSITION_BEFORE_END);b=new l(b);b.guard=c==j.ENLARGE_LIST_ITEM_CONTENTS?k:y;h=x;b=b.lastForward();h=h||d;this.setEndAt(h,!b&&this.checkEndOfBlock()||b&&h.contains(b)?j.POSITION_BEFORE_END:j.POSITION_BEFORE_START);t&&this.setEndAfter(t)}}}(),checkStartOfBlock:function(){var c=this.startContainer,e=this.startOffset;if(e&&
c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(0,e)).length)return w;this.trim();c=new n(this.startContainer);e=this.clone();e.collapse(m);e.setStartAt(c.block||c.blockLimit,j.POSITION_AFTER_START);c=new l(e);c.evaluator=k(m);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,e=this.endOffset;if(c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(e)).length)return w;this.trim();c=new n(this.endContainer);e=this.clone();e.collapse(w);
e.setEndAt(c.block||c.blockLimit,j.POSITION_BEFORE_END);c=new l(e);c.evaluator=k(w);return c.checkForward()},checkBoundaryOfElement:function(a,c){var e=this.clone();e[c==j.START?"setStartAt":"setEndAt"](a,c==j.START?j.POSITION_AFTER_START:j.POSITION_BEFORE_END);e=new l(e);e.evaluator=s;return e[c==j.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,d=this.startOffset,b=this.endOffset,h;if(a[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=
a[0].childNodes.length,h>d)a=e(a[0].childNodes[d]);else if(0==h)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=e(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=c[0].childNodes.length,h>b)c=e(c[0].childNodes[b])._4e_previousSourceNode(m);else if(0==h)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=e(c)}a._4e_position(c)&q.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),
h=e(this.document.createElement(c));this.collapse(a);this.enlarge(j.ENLARGE_BLOCK_CONTENTS);h[0].appendChild(this.extractContents());h._4e_trim();d.ie||h._4e_appendBogus();this.insertNode(h);this.moveToBookmark(b);return h},splitBlock:function(c){var e=new n(this.startContainer),b=new n(this.endContainer),h=e.block,i=b.block,f=x;if(!e.blockLimit.equals(b.blockLimit))return x;"br"!=c&&(h||(h=this.fixBlock(m,c),i=(new n(this.endContainer)).block),i||(i=this.fixBlock(w,c)));c=h&&this.checkStartOfBlock();
e=i&&this.checkEndOfBlock();this.deleteContents();h&&h[0]==i[0]&&(e?(f=new n(this.startContainer),this.moveToPosition(i,j.POSITION_AFTER_END),i=x):c?(f=new n(this.startContainer),this.moveToPosition(h,j.POSITION_BEFORE_START),h=x):(i=this.splitElement(h),!d.ie&&!a.inArray(h.nodeName(),["ul","ol"])&&h._4e_appendBogus()));return{previousBlock:h,nextBlock:i,wasStartOfBlock:c,wasEndOfBlock:e,elementPath:f}},splitElement:function(a){if(!this.collapsed)return x;this.setEndAt(a,j.POSITION_BEFORE_END);var c=
this.extractContents(),e=a.clone(w);e[0].appendChild(c);e.insertAfter(a);this.moveToPosition(a,j.POSITION_AFTER_END);return e},moveToElementEditablePosition:function(a,c){for(var e=0;a;){if(a[0].nodeType==f.NodeType.TEXT_NODE){this.moveToPosition(a,c?j.POSITION_AFTER_END:j.POSITION_BEFORE_START);e=1;break}a[0].nodeType==f.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,c?j.POSITION_BEFORE_END:j.POSITION_AFTER_START),e=1);var d=a,h=e,b=void 0;d[0].nodeType==f.NodeType.ELEMENT_NODE&&
d._4e_isEditable()&&(b=d[c?"last":"first"](g,1));!h&&!b&&(b=d[c?"prev":"next"](g,1));a=b}return!!e},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==f.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var e,d,b,h=a.nodeName();e=c.$block[h];this.deleteContents();if(e){for(e=this.getCommonAncestor(w,m);(d=c[e.nodeName()])&&(!d||!d[h]);){var i=e.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(e),
this.collapse(m),e.remove()):b=e;e=i}b&&this.splitElement(b)}this.insertNode(a)}});r.injectDom({_4e_breakParent:function(a,c){var c=e(c),a=e(a),d,h=new b.Range(a[0].ownerDocument);h.setStartAfter(a);h.setEndAfter(c);d=h.extractContents();h.insertNode(a.remove());a.after(d)}});return b.Range=v},{requires:"./base,./utils,./walker,./elementPath,./dom,node".split(",")});
KISSY.add("editor/selection",function(a,b){function r(a){this.document=a;this._={cache:{}};if(m)try{var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=a||d.parentElement&&d.parentElement().ownerDocument!=a)this.isInvalid=n}catch(e){this.isInvalid=n}}function l(a){a=new r(a);return!a||a.isInvalid?s:a}b.SelectionType={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var n=!0,s=null,g=a.UA,k=a.DOM,o=a.Node,p=b.SelectionType,v=b.RangeType,m=g.ie,w=b.Walker,x=b.Range,j=
{img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(r,{getNative:!m?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=k.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!m?function(){var a=this._.cache;if(a.type)return a.type;var d=p.SELECTION_TEXT,e=this.getNative();if(e){if(1==e.rangeCount){var e=
e.getRangeAt(0),h=e.startContainer;h==e.endContainer&&h.nodeType==k.NodeType.ELEMENT_NODE&&1==Number(e.endOffset-e.startOffset)&&j[h.childNodes[e.startOffset].nodeName.toLowerCase()]&&(d=p.SELECTION_ELEMENT)}}else d=p.SELECTION_NONE;return a.type=d}:function(){var a=this._.cache;if(a.type)return a.type;var d=p.SELECTION_NONE;try{var e=this.getNative(),h=e.type;"Text"==h&&(d=p.SELECTION_TEXT);"Control"==h&&(d=p.SELECTION_ELEMENT);e.createRange().parentElement&&(d=p.SELECTION_TEXT)}catch(b){}return a.type=
d},getRanges:m?function(){var a=function(a,c){a=a.duplicate();a.collapse(c);for(var d=a.parentElement(),b=d.childNodes,f,g=0;g<b.length;g++){var j=b[g];if(j.nodeType==k.NodeType.ELEMENT_NODE){f=a.duplicate();f.moveToElementText(j);var j=f.compareEndPoints("StartToStart",a),m=f.compareEndPoints("EndToStart",a);f.collapse();if(0<j)break;else{if(!j||1==m&&-1==j)return{container:d,offset:g};if(!m)return{container:d,offset:g+1}}f=s}}f||(f=a.duplicate(),f.moveToElementText(d),f.collapse(!1));f.setEndPoint("StartToStart",
a);f=(""+f.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<f;)f-=b[--g].nodeValue.length}catch(l){f=0}return 0===f?{container:d,offset:g}:{container:b[g],offset:-f}};return function(d){var e=this._.cache;if(e.ranges&&!d)return e.ranges;var b=this.getNative(),d=b&&b.createRange(),f=this.getType();if(!b)return[];if(f==p.SELECTION_TEXT)return b=new x(this.document),f=a(d,n),b.setStart(new o(f.container),f.offset),f=a(d),b.setEnd(new o(f.container),f.offset),e.ranges=[b];if(f==p.SELECTION_ELEMENT){e=
e.ranges=[];for(f=0;f<d.length;f++){for(var g=d.item(f),j=g.parentNode,k=0,b=new x(this.document);k<j.childNodes.length&&j.childNodes[k]!=g;k++);b.setStart(new o(j),k);b.setEnd(new o(j),k+1);e.push(b)}return e}return e.ranges=[]}}():function(a){var d=this._.cache;if(d.ranges&&!a)return d.ranges;var a=[],e=this.getNative();if(!e)return[];for(var b=0;b<e.rangeCount;b++){var f=e.getRangeAt(b),g=new x(this.document);g.setStart(new o(f.startContainer),f.startOffset);g.setEnd(new o(f.endContainer),f.endOffset);
a.push(g)}return d.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var d,e=this.getNative();switch(this.getType()){case p.SELECTION_ELEMENT:return this.getSelectedElement();case p.SELECTION_TEXT:var b=this.getRanges()[0];if(b&&!b.collapsed){for(b.optimize();n;)if(d=b.startContainer,b.startOffset==(d[0].nodeType===k.NodeType.ELEMENT_NODE?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())b.setStartAfter(d);else break;d=b.startContainer;
if(d[0].nodeType!=k.NodeType.ELEMENT_NODE)return d.parent();d=new o(d[0].childNodes[b.startOffset]);if(!d[0]||d[0].nodeType!=k.NodeType.ELEMENT_NODE)return b.startContainer;for(b=d[0].firstChild;b&&b.nodeType==k.NodeType.ELEMENT_NODE;)d=new o(b),b=b.firstChild;return d}if(m)b=e.createRange(),b.collapse(n),d=new o(b.parentElement());else{if((d=e.anchorNode)&&d.nodeType!=k.NodeType.ELEMENT_NODE)d=d.parentNode;d&&(d=new o(d))}}return a.startElement=d},getSelectedElement:function(){var a,d=this._.cache;
if(void 0!==d.selectedElement)return d.selectedElement;m&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var e;if(a)e=new o(a);else{a=this.getRanges()[0];for(var b,f=2;f&&(!(e=a.getEnclosedNode())||!(e[0].nodeType==k.NodeType.ELEMENT_NODE&&j[e.nodeName()]&&(b=e)));f--)a.shrink(v.SHRINK_ELEMENT);e=b}return d.selectedElement=e},reset:function(){this._.cache={}},selectElement:function(a){var d,e=this.document;if(m)try{d=e.body.createControlRange(),d.addElement(a[0]),d.select()}catch(b){d=e.body.createTextRange(),
d.moveToElementText(a[0]),d.select()}finally{}else d=e.createRange(),d.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(d);this.reset()},selectRanges:function(a){if(m){if(1<a.length){var d=a[a.length-1];a[0].setEnd(d.endContainer,d.endOffset);a.length=1}a[0]&&a[0].select()}else{d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<a.length;e++){var b=a[e],f=this.document.createRange(),j=b.startContainer;if(b.collapsed&&(g.gecko&&1.09>g.gecko||g.opera||g.webkit)&&j[0].nodeType==
k.NodeType.ELEMENT_NODE&&!j[0].childNodes.length)j[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),b.startOffset++,b.endOffset++;f.setStart(j[0],b.startOffset);f.setEnd(b.endContainer[0],b.endOffset);d.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var d=[],e=this.getRanges(),b=0;b<e.length;b++)d.push(e[b].createBookmark2(a));return d},createBookmarks:function(d,b){for(var e=[],f=this.document,g,b=b||this.getRanges(),j=b.length,m=0;m<j;m++){e.push(g=b[m].createBookmark(d,
n));var l=(d=g.serializable)?a.one("#"+g.startNode,f):g.startNode;g=d?a.one("#"+g.endNode,f):g.endNode;for(var q=m+1;q<j;q++){var p=b[q],o=p.startContainer,r=p.endContainer;k.equals(o,l.parent())&&p.startOffset++;k.equals(o,g.parent())&&p.startOffset++;k.equals(r,l.parent())&&p.endOffset++;k.equals(r,g.parent())&&p.endOffset++}}return e},selectBookmarks:function(a){for(var d=[],e=0;e<a.length;e++){var b=new x(this.document);b.moveToBookmark(a[e]);d.push(b)}this.selectRanges(d);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();m?a&&a.clear():a&&a.removeAllRanges()}});var q={table:1,tbody:1,tr:1},f=w.whitespaces(n),d=/\ufeff|\u00a0/;x.prototype.select=x.prototype.select=!m?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
k.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&(a[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var d=this.document.createRange();d.setStart(a[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(n),d.setEnd(this.endContainer[0],this.endOffset);else throw e;}a=l(this.document).getNative();a.removeAllRanges();a.addRange(d)}:function(a){var b=this.collapsed,
e,h;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var g=this.startContainer[0].childNodes[this.startOffset];if(g.nodeType==k.NodeType.ELEMENT_NODE){(new r(this.document)).selectElement(new o(g));return}}(this.startContainer[0].nodeType==k.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in q||this.endContainer[0].nodeType==k.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in q)&&this.shrink(v.SHRINK_ELEMENT,n);var j=this.createBookmark(),g=j.startNode,
m;b||(m=j.endNode);j=this.document.body.createTextRange();j.moveToElementText(g[0]);j.moveStart("character",1);if(m)a=this.document.body.createTextRange(),a.moveToElementText(m[0]),j.setEndPoint("EndToEnd",a),j.moveEnd("character",-1);else{for(e=g[0].nextSibling;e&&!f(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(d))&&(a||!g[0].previousSibling||g[0].previousSibling&&"br"==k.nodeName(g[0].previousSibling));h=new o(this.document.createElement("span"));h.html("&#65279;");h.insertBefore(g);
e&&k.insertBefore(this.document.createTextNode("\ufeff"),g[0]||g)}this.setStartBefore(g);g._4e_remove();if(b){if(e?(j.moveStart("character",-1),j.select(),this.document.selection.clear()):j.select(),h)this.moveToPosition(h,v.POSITION_BEFORE_START),h._4e_remove()}else this.setEndBefore(m),m._4e_remove(),j.select()};r.getSelection=l;return b.Selection=r},{requires:["./base","./walker","./range","./dom","node"]});
KISSY.add("editor/domIterator",function(a,b){function r(a){1>arguments.length||(this.range=a,this.forceBrBreak=n,this.enlargeBr=l,this.enforceRealBlocks=n,this._||(this._={}))}var l=!0,n=!1,s=a.UA,g=b.Walker,k=b.Range,o=b.RangeType,p=b.ElementPath,v=a.Node,m=a.DOM,w=/^[\r\n\t ]*$/;a.augment(r,{getNextParagraph:function(b){var j,q,f,d,c;if(!this._.lastNode){q=this.range.clone();q.shrink(o.SHRINK_ELEMENT,l);q.enlarge(this.forceBrBreak||!this.enlargeBr?o.ENLARGE_LIST_ITEM_CONTENTS:o.ENLARGE_BLOCK_CONTENTS);
var i=new g(q),e=g.bookmark(l,l);i.evaluator=e;this._.nextNode=i.next();i=new g(q);i.evaluator=e;i=i.previous();this._.lastNode=i._4e_nextSourceNode(l);this._.lastNode&&this._.lastNode[0].nodeType==m.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(e=new k(q.document),e.moveToPosition(this._.lastNode,o.POSITION_AFTER_END),e.checkEndOfBlock()&&(e=new p(e.endContainer),this._.lastNode=(e.block||e.blockLimit)._4e_nextSourceNode(l)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new v(q.document.createTextNode("")),m.insertAfter(this._.lastNode[0],i[0]));q=null}e=this._.nextNode;i=this._.lastNode;for(this._.nextNode=null;e;){var h=n,y=e[0].nodeType!=m.NodeType.ELEMENT_NODE,t=n;if(y)e[0].nodeType==m.NodeType.TEXT_NODE&&w.test(e[0].nodeValue)&&(y=n);else{var r=e.nodeName();if(e._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==r)y=l;else if(!q&&!e[0].childNodes.length&&"hr"!=r){j=e;f=e.equals(i);break}q&&(q.setEndAt(e,o.POSITION_BEFORE_START),
"br"!=r&&(this._.nextNode=e));h=l}else{if(e[0].firstChild){q||(q=new k(this.range.document),q.setStartAt(e,o.POSITION_BEFORE_START));e=new v(e[0].firstChild);continue}y=l}}y&&!q&&(q=new k(this.range.document),q.setStartAt(e,o.POSITION_BEFORE_START));f=(!h||y)&&e.equals(i);if(q&&!h)for(;!e[0].nextSibling&&!f;){r=e.parent();if(r._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){h=l;f||r.equals(i);break}e=r;y=l;f=e.equals(i);t=l}y&&q.setEndAt(e,o.POSITION_AFTER_END);e=e._4e_nextSourceNode(t,null,i);if((f=
!e)||h&&q)break}if(!j){if(!q)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;j=new p(q.startContainer);e=j.blockLimit;h={div:1,th:1,td:1};j=j.block;if((!j||!j[0])&&!this.enforceRealBlocks&&h[e.nodeName()]&&q.checkStartOfBlock()&&q.checkEndOfBlock())j=e;else if(!j||this.enforceRealBlocks&&"li"==j.nodeName())j=new v(this.range.document.createElement(b||"p")),j[0].appendChild(q.extractContents()),j._4e_trim(),q.insertNode(j),d=c=l;else if("li"!=j.nodeName()){if(!q.checkStartOfBlock()||
!q.checkEndOfBlock())j=j.clone(n),j[0].appendChild(q.extractContents()),j._4e_trim(),c=q.splitBlock(),d=!c.wasStartOfBlock,c=!c.wasEndOfBlock,q.insertNode(j)}else f||(this._.nextNode=j.equals(i)?null:q.getBoundaryNodes().endNode._4e_nextSourceNode(l,null,i))}d&&(q=new v(j[0].previousSibling),q[0]&&q[0].nodeType==m.NodeType.ELEMENT_NODE&&("br"==q.nodeName()?q._4e_remove():q[0].lastChild&&"br"==m.nodeName(q[0].lastChild)&&m._4e_remove(q[0].lastChild)));c&&(q=g.bookmark(n,l),d=new v(j[0].lastChild),
d[0]&&d[0].nodeType==m.NodeType.ELEMENT_NODE&&"br"==d.nodeName()&&(s.ie||d.prev(q,1)||d.next(q,1))&&d.remove());this._.nextNode||(this._.nextNode=f||j.equals(i)?null:j._4e_nextSourceNode(l,null,i));return j}});k.prototype.createIterator=function(){return new r(this)};return r},{requires:["./base","./range","./elementPath","./walker","node"]});
KISSY.add("editor/styles",function(a,b){function r(a){return!E.attr(a,"_ke_bookmark")}function l(a,d){for(var e in a)"string"==typeof a[e]?a[e]=a[e].replace(S,function(a,e){return d[e]}):l(a[e],d)}function n(d,e){e&&(d=a.clone(d),l(d,e));var b=this.element=this.element=(d.element||"*").toLowerCase();this.type=this.type="#text"==b||I[b]?G.STYLE_BLOCK:P[b]?G.STYLE_OBJECT:G.STYLE_INLINE;this._={definition:d}}function s(a,d){var e=d?this.removeFromRange:this.applyToRange;a.body.focus();for(var b=new K(a),
c=b.getRanges(),f=0;f<c.length;f++)e.call(this,c[f]);b.selectRanges(c)}function g(a,d,e){var b=a.element;"*"==b&&(b="span");d=new u(d.createElement(b));e&&e._4e_copyAttributes(d);e=a._.definition;a=e.attributes;e=n.getStyleText(e);if(a)for(var c in a)d.attr(c,a[c]);e&&(d[0].style.cssText=e);return d}function k(a){var d=a.createBookmark(h),e=a.createIterator();e.enforceRealBlocks=h;e.enlargeBr=h;for(var b,c=a.document;b=e.getNextParagraph();){var f=g(this,c,b),i=f,f="pre"==i.nodeName,j="pre"==b.nodeName,
m=!f&&j;f&&!j?(j=b,m=j.html(),m=o(m,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),m=m.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),m=m.replace(/([ \t\n\r]+|&nbsp;)/g," "),m=m.replace(/<br\b[^>]*>/gi,"\n"),M.ie?(j=j[0].ownerDocument.createElement("div"),j.appendChild(i[0]),i.outerHtml("<pre>"+m+"</pre>"),i=new u(j.firstChild),i._4e_remove()):i.html(m)):m?i=v(p(b),i):b._4e_moveChildren(i);b[0].parentNode.replaceChild(i[0],b[0]);if(f&&(b=i,f=void 0,(f=b._4e_previousSourceNode(h,E.NodeType.ELEMENT_NODE))&&
"pre"==f.nodeName()))i=o(f.html(),/\n$/,"")+"\n\n"+o(b.html(),/^\n/,""),M.ie?b.outerHtml("<pre>"+i+"</pre>"):b.html(i),f._4e_remove()}a.moveToBookmark(d)}function o(a,d,e){var b="",c="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,d,e){d&&(b=d);e&&(c=e);return""});return b+a.replace(d,e)+c}function p(a){var d=[];o(a.outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,d,e){return d+"</pre>"+e+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,e){d.push(e)});return d}function v(a,d){for(var e=d[0].ownerDocument.createDocumentFragment(),b=0;b<a.length;b++){var c=a[b],c=c.replace(/(\r\n|\r)/g,"\n"),c=o(c,/^[ \t]*\n/,""),c=o(c,/\n$/,""),c=o(c,/^[ \t]+|[ \t]+$/g,function(a,d){return 1==a.length?"&nbsp;":d?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),c=c.replace(/\n/g,"<br>"),c=c.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=d.clone();f.html(c);e.appendChild(f[0])}return e}
function m(a){var d=a.document;if(a.collapsed)d=g(this,d,void 0),a.insertNode(d),a.moveToPosition(d,C.POSITION_BEFORE_END);else{var e=this.element,b=this._.definition,f,i=L[e];i||(f=h,i=L.span);var j=a.createBookmark();a.enlarge(C.ENLARGE_ELEMENT);a.trim();for(var m=a.createBookmark(),k=m.startNode,m=m.endNode,l=k,q;l&&l[0];){var A=y;if(E.equals(l,m))l=t,A=h;else{var p=l[0].nodeType,n=p==E.NodeType.ELEMENT_NODE?l.nodeName():t;if(n&&l.attr("_ke_bookmark")){l=l._4e_nextSourceNode(h);continue}if(!n||
i[n]&&(l._4e_position(m)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(l))){var o=l.parent();if(o&&"a"==e&&o.nodeName()==e)p=g(this,d,void 0),o._4e_moveChildren(p),o[0].parentNode.replaceChild(p[0],o[0]),p._4e_mergeSiblings();else if(o&&o[0]&&((L[o.nodeName()]||L.span)[e]||f)&&(!b.parentRule||b.parentRule(o))){if(!q&&(!n||!L.$removeEmpty[n]||(l._4e_position(m)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|
z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED))q=new O(d),q.setStartBefore(l);if(p==E.NodeType.TEXT_NODE||p==E.NodeType.ELEMENT_NODE&&!l[0].childNodes.length){o=l;for(p=null;(A=!o.next(r,1))&&(p=o.parent())&&i[p.nodeName()]&&(p._4e_position(k)|z.POSITION_FOLLOWING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_FOLLOWING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(p));)o=p;q.setEndAfter(o)}}else A=h}else A=h;l=l._4e_nextSourceNode()}if(A&&
q&&!q.collapsed){for(var A=g(this,d,void 0),o=q.getCommonAncestor(),p={},n={},I,w=null,D;A&&o&&A[0]&&o[0];){if(o.nodeName()==e){for(I in b.attributes)if(!n[I]&&(D=o.attr(w)))A.attr(I)==D?A.removeAttr(I):n[I]=1;for(w in b.styles)if(!p[w]&&(D=o.style(w)))A.style(w)==D?A.style(w,""):p[w]=1;if(!A._4e_hasAttributes()){A=t;break}}o=o.parent()}A?(A[0].appendChild(q.extractContents()),c(this,A),q.insertNode(A),A._4e_mergeSiblings(),M.ie||A[0].normalize()):(A=new u(d.createElement("span")),A[0].appendChild(q.extractContents()),
q.insertNode(A),c(this,A),A._4e_remove(!0));q=t}}k._4e_remove();m._4e_remove();a.moveToBookmark(j);a.shrink(C.SHRINK_TEXT)}}function w(a){a.enlarge(C.ENLARGE_ELEMENT);var d=a.createBookmark(),e=d.startNode;if(a.collapsed){for(var b=new A(e.parent()),c,h=0,g;h<b.elements.length&&(g=b.elements[h])&&!(g==b.block||g==b.blockLimit);h++)if(this.checkElementRemovable(g)){var j=a.checkBoundaryOfElement(g,C.END),m=!j&&a.checkBoundaryOfElement(g,C.START);m||j?(c=g,c.match=m?"start":"end"):(g._4e_mergeSiblings(),
g.nodeName()!=this.element?(j=q(this),i(g,j[g.nodeName()]||j["*"])):f(this,g))}if(c){g=e;for(h=0;;h++){j=b.elements[h];if(j.equals(c))break;else if(j.match)continue;else j=j.clone();j[0].appendChild(g[0]);g=j}g["start"==c.match?"insertBefore":"insertAfter"](c);b=c.html();!b||"\u200b"==b?c.remove():M.webkit&&D(a.document.createTextNode("\u200b")).insertBefore(g)}}else{var k=d.endNode,l=this;c=function(){for(var a=new A(e.parent()),d=new A(k.parent()),b=t,c=t,f=0;f<a.elements.length;f++){var h=a.elements[f];
if(h==a.block||h==a.blockLimit)break;l.checkElementRemovable(h)&&(b=h)}for(f=0;f<d.elements.length;f++){h=d.elements[f];if(h==d.block||h==d.blockLimit)break;l.checkElementRemovable(h)&&(c=h)}c&&k._4e_breakParent(c);b&&e._4e_breakParent(b)};c();for(b=new u(e[0].nextSibling);b[0]!==k[0];){h=b._4e_nextSourceNode();if(b[0]&&b[0].nodeType==E.NodeType.ELEMENT_NODE&&this.checkElementRemovable(b)&&(b.nodeName()==this.element?f(this,b):(g=q(this),i(b,g[b.nodeName()]||g["*"])),h[0].nodeType==E.NodeType.ELEMENT_NODE&&
h.contains(e)))c(),h=new u(e[0].nextSibling);b=h}}a.moveToBookmark(d)}function x(a){var d={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,e,b){d[e]=b});return d}function j(a,d){var e="";d!==y?(e=document.createElement("span"),e.style.cssText=a,e=e.style.cssText||""):e=a;return e.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function q(d){if(d._.overrides)return d._.overrides;var e=d._.overrides={},b=d._.definition.overrides;
if(b){a.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++){var f=b[c],h,g,u;"string"==typeof f?h=f.toLowerCase():(h=f.element?f.element.toLowerCase():d.element,g=f.attributes,u=f.styles);f=e[h]||(e[h]={});if(g){h=f.attributes=f.attributes||[];for(var i in g)h.push([i.toLowerCase(),g[i]])}if(u){var f=f.styles=f.styles||[],j;for(j in u)f.push([j.toLowerCase(),u[j]])}}}return e}function f(b,c){var f=b._.definition,g=q(b),u=a.merge(f.attributes,(g[c.nodeName()]||g["*"]||{}).attributes),f=a.merge(f.styles,
(g[c.nodeName()]||g["*"]||{}).styles),g=a.isEmptyObject(u)&&a.isEmptyObject(f),i;for(i in u)("class"==i||b._.definition.fullMatch)&&c.attr(i)!=d(i,u[i])||(g=g||!!c.hasAttr(i),c.removeAttr(i));for(var j in f)b._.definition.fullMatch&&c.style(j)!=d(j,f[j],h)||(g=g||!!c.style(j),c.style(j,""));e(c)}function d(a,d,e){var b=new u("<span>");b[e?"style":"attr"](a,d);return b[e?"style":"attr"](a)}function c(a,d){for(var e=q(a),b=d.all(a.element),c=b.length;0<=--c;)f(a,new u(b[c]));for(var h in e)if(h!=a.element){b=
d.all(h);for(c=b.length-1;0<=c;c--){var g=new u(b[c]);i(g,e[h])}}}function i(a,d){var b,c=d&&d.attributes;if(c)for(b=0;b<c.length;b++){var f=c[b][0],h;if(h=a.attr(f)){var g=c[b][1];(g===t||g.test&&g.test(h)||"string"==typeof g&&h==g)&&a[0].removeAttribute(f)}}if(c=d&&d.styles)for(b=0;b<c.length;b++)if(f=c[b][0],g=a.css(f)){var u=c[b][1];(u===t||u.test&&u.test(h)||"string"==typeof u&&g==u)&&a.css(f,"")}e(a)}function e(a){if(!a._4e_hasAttributes()){var d=a[0].firstChild,b=a[0].lastChild;a._4e_remove(h);
d&&(d.nodeType==E.NodeType.ELEMENT_NODE&&E._4e_mergeSiblings(d),b&&d!=b&&b.nodeType==E.NodeType.ELEMENT_NODE&&E._4e_mergeSiblings(b))}}var h=!0,y=!1,t=null,D=a.all,E=a.DOM,C=b.RangeType,K=b.Selection,z=b.PositionType,O=b.Range,G,u=a.Node,M=a.UA,A=b.ElementPath,I={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},L=b.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;b.StyleType=G={STYLE_BLOCK:1,STYLE_INLINE:2,
STYLE_OBJECT:3};n.prototype={constructor:n,apply:function(a){s.call(this,a,y)},remove:function(a){s.call(this,a,h)},applyToRange:function(a){return(this.applyToRange=this.type==G.STYLE_INLINE?m:this.type==G.STYLE_BLOCK?k:t).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==G.STYLE_INLINE?w:t).call(this,a)},checkElementRemovable:function(a,d){if(!a)return y;var b=this._.definition,e;if(a.nodeName()==this.element){if(!d&&!a._4e_hasAttributes())return h;var c=b._AC;if(c)b=
c;else{var c={},f=0,g=b.attributes;if(g)for(var u in g)f++,c[u]=g[u];if(g=n.getStyleText(b))c.style||f++,c.style=g;c._length=f;b=b._AC=c}if(b._length){for(var i in b)if("_length"!=i){f=a.attr(i)||"";if("style"==i)a:{c=b[i];f=j(f,y);"string"==typeof c&&(c=x(c));"string"==typeof f&&(f=x(f));g=void 0;for(g in c)if(!(g in f&&(f[g]==c[g]||"inherit"==c[g]||"inherit"==f[g]))){c=y;break a}c=h}else c=b[i]==f;if(c){if(!d)return h}else if(d)return y}if(d)return h}else return h}i=q(this);if(i=i[a.nodeName()]||
i["*"]){if(!(b=i.attributes)&&!(e=i.styles))return h;if(b)for(c=0;c<b.length;c++)if(i=b[c][0],i=a.attr(i))if(f=b[c][1],f===t||"string"==typeof f&&i==f||f.test&&f.test(i))return h;if(e)for(c=0;c<e.length;c++)if(i=a.css(e[c][0]))if(b=e[c][1],b===t||"string"==typeof b&&i==b||b.test&&b.test(i))return h}return y},checkActive:function(a){switch(this.type){case G.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,h);case G.STYLE_OBJECT:case G.STYLE_INLINE:for(var d=a.elements,b=0,c;b<d.length;b++)if(c=
d[b],!(this.type==G.STYLE_INLINE&&(E.equals(c,a.block)||E.equals(c,a.blockLimit))))if((this.type!=G.STYLE_OBJECT||c.nodeName()in P)&&this.checkElementRemovable(c,h))return h}return y}};n.getStyleText=function(a){var d=a._ST;if(d)return d;var d=a.styles,b=a.attributes&&a.attributes.style||"",c="";b.length&&(b=b.replace(Q,";"));for(var e in d){var f=d[e],h=(e+":"+f).replace(Q,";");"inherit"==f?c+=h:b+=h}b.length&&(b=j(b));return a._ST=b+c};return b.Style=n},{requires:"./base,./range,./selection,./domIterator,./elementPath,node".split(",")});
KISSY.add("editor/z-index-manager",function(a,b){var r=b.ZIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};b.baseZIndex=function(a){return(b.Config.baseZIndex||1E4)+a};return r},{requires:["./base"]});
KISSY.add("editor/clipboard",function(a,b,r,l){function n(a){this.editor=a;this._init()}function s(a){var b=a.get("document")[0],f=a.getSelection(),e;if(f.getType()==l.SELECTION_ELEMENT&&(e=f.getSelectedElement())){var a=f.getRanges()[0],h=p(b.createTextNode(""));h.insertBefore(e);a.setStartBefore(h);a.setEndAfter(e);f.selectRanges([a]);setTimeout(function(){e.parent()&&(h.remove(),f.selectElement(e))},0)}}function g(a){if(v.webkit){if(!a.match(/^[^<]*$/g)&&!a.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return 0}else if(v.ie){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi)&&
!a.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return 0}else if(v.gecko||v.opera){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi))return 0}else return 0;return 1}function k(a){a=a.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>");if(a.match(/^[^<]$/))return a;if(v.webkit&&-1<a.indexOf("<div>"))a.match(/<div>(?:<br>)?<\/div>/)&&(a=a.replace(/<div>(?:<br>)?<\/div>/g,function(){return"<p></p>"}),a=a.replace(/<\/p><div>/g,"</p><p>").replace(/<\/div><p>/g,"</p><p>").replace(/^<div>/,
"<p>").replace(/^<\/div>/,"</p>")),a.match(/<\/div><div>/)&&(a=a.replace(/<\/div><div>/g,"</p><p>").replace(/^<div>/,"<p>").replace(/^<\/div>/,"</p>"));else if(v.gecko||v.opera)v.gecko&&(a=a.replace(/^<br><br>$/,"<br>")),-1<a.indexOf("<br><br>")&&(a="<p>"+a.replace(/<br><br>/g,function(){return"</p><p>"})+"</p>");return a}function o(a){var b=0,a=a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"");-1!=a.indexOf("Apple-")&&(a=a.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi,
" "),a=a.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(a,b){return b.replace(/\t/g,Array(5).join("&nbsp;"))}),-1<a.indexOf('<br class="Apple-interchange-newline">')&&(b=1,a=a.replace(/<br class="Apple-interchange-newline">/,"")),a=a.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1"));!b&&g(a)&&(a=k(a));return a}var p=a.all,v=a.UA,m=v.ie?"beforepaste":"paste",w=b.RangeType;a.augment(n,{_init:function(){var a=this,b=a.editor,f=b.get("document"),e=f.one("body"),h=function(a){this.type=
a};h.prototype={exec:function(b){var c=this.type;b.focus();setTimeout(function(){v.ie&&("cut"==c?s(b):"paste"==c&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));j(b,c)||alert(q[c])},0)}};e.on(m,a._getClipboardDataFromPasteBin,a);v.ie&&(e.on("paste",a._iePaste,a),f.on("keydown",a._onKeyDown,a),f.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));b.addCommand("copy",new h("copy"));b.addCommand("cut",new h("cut"));b.addCommand("paste",
new h("paste"))},_onKeyDown:function(a){this.editor.get("mode")==b.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var b,f=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{b=f.get("document")[0].queryCommandEnabled(a)}catch(e){}this._isPreventBeforePaste=0}else b=(a=(a=f.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);return b},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&
clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var b=this.editor;this._isPreventPaste||(a.preventDefault(),b.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){m+":  paste event happen";var b=this.editor,c=b.get("document")[0];if(c.getElementById("ke-paste-bin"))m+": trigger more than once ...";else{var f=b.getSelection(),e=new r(c),h=p(v.webkit?"<body></body>":
"<div></div>",c);h.attr("id","ke-paste-bin");v.webkit&&h[0].appendChild(c.createTextNode("\u200b"));c.body.appendChild(h[0]);h.css({position:"absolute",top:f.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});h.css("left","-1000px");var g=f.createBookmarks();e.setStartAt(h,w.POSITION_AFTER_START);e.setEndAt(h,w.POSITION_BEFORE_END);e.select(!0);setTimeout(function(){var c,e=h;h=v.webkit&&(c=h.first())&&c.hasClass("Apple-style-span")?c:h;f.selectBookmarks(g);var j=h.html();
e.remove();if(j=o(j))"paste "+j,c=b.fire("paste",{html:j}),!1!==c&&(void 0!==c&&(j=c),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(j)?a.use("editor/plugin/word-filter",function(a,c){b.insertHtml(c.toDataFormat(j,b))}):b.insertHtml(j))},0)}}}});var x=function(a,b){var f=a.get("document")[0],e=p(f.body),h=!1,g=function(){h=!0};e.on(b,g);(7<v.ie?f:f.selection.createRange()).execCommand(b);e.detach(b,g);return h},j=v.ie?function(a,b){return x(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(f){return!1}},
q={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},f={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var b;a.docReady(function(){b=new n(a)});var g={copy:1,cut:1,paste:1},e=["copy","cut","paste"];a.on("contextmenu",function(h){var j=h.contextmenu;if(!j.__copy_fix){j.__copy_fix=1;for(h=0;h<e.length;h++)j.addChild({content:f[e[h]],value:e[h]});j.on("click",function(b){var c=
b.target.get("value");g[c]&&(j.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(c);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var m=j.get("children"),h=m.length-1;h--;0<=h){var k=m[h],l;l=k.get?k.get("value"):k.value;g[l]&&(l=!b._stateFromNamedCommand(l),k.set?k.set("disabled",l):k.disabled=l)}})}}},{requires:["./base","./range","./selection","node"]});
KISSY.add("editor/enterKey",function(a,b,r,l){function n(b){var n;n=b.getSelection().getRanges();for(var s=n.length-1;0<s;s--)n[s].deleteContents();n=n[0];s=n.document;if(n.checkStartOfBlock()&&n.checkEndOfBlock()){var j=(new l(n.startContainer)).block;if(j&&("li"==j.nodeName()||"li"==j.parent().nodeName()))return b.hasCommand("outdent")?(b.execCommand("save"),b.execCommand("outdent"),b.execCommand("save"),!0):!1}var q=n.splitBlock("p");if(!q)return!0;var b=q.previousBlock,j=q.nextBlock,f=q.wasStartOfBlock,
d=q.wasEndOfBlock,c;if(j)c=j.parent(),"li"==c.nodeName()&&(j._4e_breakParent(c),j._4e_move(j.next(),!0));else if(b&&(c=b.parent())&&"li"==c.nodeName())b._4e_breakParent(c),n.moveToElementEditablePosition(b.next()),b._4e_move(b.prev());if(!f&&!d){if("li"==j.nodeName()&&(c=j.first(r.invisible(!0)))&&a.inArray(c.nodeName(),["ul","ol"]))(g.ie?new p(s.createTextNode("\u00a0")):new p(s.createElement("br"))).insertBefore(c);j&&n.moveToElementEditablePosition(j)}else{var i;if(b){if("li"==b.nodeName()||!k.test(b.nodeName()))i=
b.clone()}else j&&(i=j.clone());i||(i=new p("<p>",null,s));if(c=q.elementPath)for(var q=0,e=c.elements.length;q<e;q++){var h=c.elements[q];if(h.equals(c.block)||h.equals(c.blockLimit))break;o.$removeEmpty[h.nodeName()]&&(h=h.clone(),i._4e_moveChildren(h),i.append(h))}g.ie||i._4e_appendBogus();n.insertNode(i);if(g.ie&&f&&(!d||!b[0].childNodes.length))n.moveToElementEditablePosition(d?b:i),n.select();n.moveToElementEditablePosition(f&&!d?j:i)}g.ie||(j?(i=new p(s.createElement("span")),i.html("&nbsp;"),
n.insertNode(i),i.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),n.deleteContents()):i.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));n.select();return!0}function s(a){var b=a.get("document")[0];v.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var g=a.execCommand("enterBlock");a.execCommand("save");!1!==g&&b.preventDefault()}})}var g=a.UA,k=/^h[1-6]$/,o=b.XHTML_DTD,
p=a.Node,v=a.Event;return{init:function(a){a.addCommand("enterBlock",{exec:n});a.docReady(function(){s(a)})}}},{requires:["./base","./walker","./elementPath","node"]});
KISSY.add("editor/htmlDataProcessor",function(a,b,r){return{init:function(l){function n(b){var b=b.childNodes,c,d,f,g=b.length;if(g){f=1;for(c=0;c<g;c++)if(d=b[c],d.nodeType!=a.DOM.NodeType.TEXT_NODE||d.nodeValue){f=0;break}return f?!1:void 0}return!1}function s(a){return a.replace(w,function(a,b,c){return"<"+b+c.replace(x,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function g(a){return a.replace(q,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function k(b){return b.replace(f,function(b,c){return a.urlDecode(c)})}var o=a.Node,p=a.UA,v=new r.Filter,m=new r.Filter;(function(){function b(a){a=r.serialize(a);return new r.Comment(j+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:b,noscript:b,span:n}},d={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=["name","href","src"],
c,e=0;e<b.length;e++)c="_ke_saved_"+b[e],a.getAttribute(c)&&a.removeAttribute(b[e]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:n,strong:n,em:n,del:n,u:n},attributes:{style:function(b){if(!a.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],comment:function(b){if(b.substr(0,j.length)==j)return b=a.trim(a.urlDecode(b.substr(j.length))),r.parse(b).childNodes[0]}};p.ie&&(d.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});v.addRules(d);m.addRules(c)})();(function(){function c(b){for(var b=b.childNodes,e=b.length,d=b[e-1];d&&3==d.nodeType&&!a.trim(d.nodeValue);)d=b[--e];return d}function d(a){var b=c(a);b&&(1==b.nodeType&&"br"==b.nodeName?a.removeChild(b):3==b.nodeType&&
i.test(b.nodeValue)&&a.removeChild(b))}function f(a){var b=c(a);return!b||"form"==a.nodeName&&"input"==b.nodeName}function g(a){d(a);f(a)&&(p.ie||a.appendChild(new r.Tag("br")))}function j(a){d(a);f(a)&&a.appendChild(new r.Text("\u00a0"))}var i=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,k=b.XHTML_DTD,l=a.merge(k.$block,k.$listItem,k.$tableContent),n;for(n in l)"br"in k[n]||delete l[n];delete l.pre;var k={tags:{}},q={tags:{}};for(n in l)k.tags[n]=g,q.tags[n]=j;m.addRules(k);v.addRules(q)})();v.addRules({text:function(a){return a.replace(/\xa0/g,
"&nbsp;")}});var w=/<(a|area|img|input)\b([^>]*)>/gi,x=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,j="{ke_protected}",q=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<script[^>]*>[\s\S]*<\/script>)|(?:<(:?link|meta|base)[^>]*>)/gi,f=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,d=/(<\/?)((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,c=/(<\/?)ke:((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,i=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;
l.htmlDataProcessor={dataFilter:m,htmlFilter:v,toHtml:function(a){p.webkit&&(a=a.replace(/\u200b/g,""));var b=new r.BeautifyWriter;(new r.Parser(a)).parse().writeHtml(b,v);return a=b.getHtml()},toDataFormat:function(a,b){var b=b||m,a=g(a),a=s(a),a=a.replace(d,"$1ke:$2"),a=a.replace(i,"<ke:$1$2></ke:$1>"),f=new o("<div>");f.html("a"+a);a=f.html().substr(1);a=a.replace(c,"$1$2");a=k(a);f=new r.BasicWriter;(new r.Parser(a)).parse().writeHtml(f,b);return a=f.getHtml()},toServer:function(a){var b=new r.MinifyWriter;
(new r.Parser(a)).parse().writeHtml(b,v);return b.getHtml()}}}}},{requires:["./base","html-parser"]});
KISSY.add("editor/selectionFix",function(a,b){function r(a){function b(a,c){var d=e.body.createTextRange();try{d.moveToPoint(a,c)}catch(f){d=o}return d}function f(){var a=e.selection.createRange();h&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&h.select();v.remove(e,"mouseup",f);v.remove(e,"mousemove",d);h=c=0}function d(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",h)?a.setEndPoint("StartToStart",h):a.setEndPoint("EndToEnd",h),a.select()}else f()}var c,g=a.get("window")[0],
e=a.get("document")[0],h;v.on(e,"mousedown contextmenu",function(a){var j=e.documentElement;if(a.target===j&&(c&&f(),!(j.scrollHeight>j.clientHeight)&&(c=1,h=b(a.pageX,a.pageY))))v.on(e,"mouseup",f),v.on(e,"mousemove",d),g.focus(),h.select()})}function l(a){function l(b){if(e){var c=a.getSelection(),d=c&&c.getType(),h=c&&f.selection;if(b&&h&&d==x.SELECTION_NONE&&!f.queryCommandEnabled("InsertImage"))setTimeout(function(){l(g)},50);else{var k;if(!h||!h.type||!("Control"!=h.type&&(k=h.createRange())&&
(k=k.parentElement())&&(k=k.nodeName)&&k.toLowerCase()in{input:1,textarea:1}))i=h&&c.getRanges()[0],a.checkSelectionChange()}}}var f=a.get("document")[0],d=new w(f.body),c=new w(f.documentElement);if(8>b.Utils.ieEngine)c.on("click",function(b){"html"===(new w(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var i,e,h=g;c.on("mousedown",function(){h=k});c.on("mouseup",function(){h=g});d.on("focusin",function(a){if("body"==(new w(a.target)).nodeName()&&i){try{h&&i.select()}catch(b){}i=
o}});d.on("focus",function(){e=g;l()});d.on("beforedeactivate",function(a){a.relatedTarget||(e=k,h=g)});d.on("mousedown",function(){e=k});d.on("mouseup",function(){e=g;setTimeout(function(){l(g)},0)});d.on("keydown",function(){e=k});d.on("keyup",function(){e=g;setTimeout(function(){l()},0)})}function n(a){var b=a.get("document")[0];v.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function s(a){function l(a){var c=b.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}
function f(a){return c(a)&&i(a)}var d=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,c=b.Walker.whitespaces(g),i=b.Walker.bookmark(k,g),e=function(a){return c(a)&&8!=a.nodeType};a.on("selectionChange",function(c){var i=c.path,n=new w(a.get("document")[0].body),c=(c=c.selection)&&c.getRanges()[0],o=i.blockLimit;if(p.gecko){var r=i.block||i.blockLimit,s=r&&r.last(f);r&&r._4e_isBlockBoundary()&&(!s||!(1==s[0].nodeType&&
s._4e_isBlockBoundary()))&&"pre"!=r.nodeName()&&!r._4e_getBogus()&&r._4e_appendBogus()}if(c&&c.collapsed&&!i.block){if("body"==o.nodeName()){if((i=c.fixBlock(g,"p"))&&i[0]!=n[0].lastChild&&i.outerHtml().match(d))if((o=i.next(e,1))&&o[0].nodeType==m.NodeType.ELEMENT_NODE&&!l[o])c.moveToElementEditablePosition(o),i._4e_remove();else if((o=i.prev(e,1))&&o[0].nodeType==m.NodeType.ELEMENT_NODE&&!l[o])c.moveToElementEditablePosition(o,o.outerHtml().match(d)?k:g),i._4e_remove();c.select();a.notifySelectionChange()}i=
a.get("document")[0];c=new b.Range(i);c.moveToElementEditablePosition(n,g);"body"!==(new b.ElementPath(c.startContainer)).blockLimit.nodeName()&&(n=(new w(i.createElement("p"))).appendTo(n),p.ie||n._4e_appendBogus())}})}var g=!0,k=!1,o=null,p=a.UA,v=a.Event,m=a.DOM,w=a.Node,x=b.SelectionType;return{init:function(a){a.docReady(function(){p.ie?(r(a),l(a)):n(a)});s(a)}}},{requires:["./base","./selection","node"]});
KISSY.add("editor/plugin-meta",function(){(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor",
"button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});
a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix"]}});a({"editor/plugin/dent-cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:["json","editor","editor/plugin/local-storage","overlay","editor/plugin/menubutton"]}});a({"editor/plugin/drag-upload":{requires:["editor"]}});
a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor","html-parser"]}});a({"editor/plugin/flash-bridge":{requires:["swf","editor"]}});a({"editor/plugin/flash-common/base-class":{requires:"editor,base,editor/plugin/contextmenu,editor/plugin/bubble,editor/plugin/dialog-loader,editor/plugin/flash-common/utils".split(",")}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class",
"editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]}});a({"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor",
"editor/plugin/font/ui","editor/plugin/font-size/cmd"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/heading":{requires:["editor",
"editor/plugin/heading/cmd"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:["editor","editor/plugin/button","editor/plugin/bubble","editor/plugin/contextmenu","editor/plugin/dialog-loader"]}});a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor","editor/plugin/indent/cmd"]}});a({"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});
a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor","editor/plugin/justify-center/cmd"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor","editor/plugin/justify-left/cmd"]}});a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});
a({"editor/plugin/justify-right":{requires:["editor","editor/plugin/justify-right/cmd"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/link/utils","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/link/utils"]}});a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});
a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor","editor/plugin/maximize/cmd"]}});a({"editor/plugin/maximize/cmd":{requires:["editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/ordered-list":{requires:["editor",
"editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]}});a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor","editor/plugin/outdent/cmd"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay","editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/progressbar":{requires:["base"]}});
a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});a({"editor/plugin/resize":{requires:["editor","dd"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/strike-through/cmd"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader","editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor","editor/plugin/font/ui","editor/plugin/underline/cmd"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});
a({"editor/plugin/undo":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils",
"editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["html-parser"]}});a({"editor/plugin/xiami-music":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",
a)},KISSY.Features,KISSY.UA)});
KISSY.add("editor",function(a,b,r,l,n,s,g,k,o,p,v,m){function w(a,b){var d=a.body;K(function(){a.designMode="on";setTimeout(function(){a.designMode="off";d.focus();arguments.callee.retry||(arguments.callee.retry=c)},50)},function(){a.designMode="off";d.setAttribute("contentEditable",!1);d.setAttribute("contentEditable",!0);!b&&w(a,1)})}function x(c){c.get("iframe");var d=c.get("textarea")[0],f=c.get("window"),g=c.get("document"),h=g[0];t.webkit&&(g.on("click",function(c){var d=new b(c.target);a.inArray(d.nodeName(),
["input","select"])&&c.preventDefault()}),g.on("mouseup",function(c){var d=new b(c.target);a.inArray(d.nodeName(),["input","textarea"])&&c.preventDefault()}));if(t.gecko||D||t.opera){var i;i=(new b('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(d);i.on("focus",function(){c.focus()});c.activateGecko=function(){t.gecko&&c.__iframeFocus&&i[0].focus()};c.on("destroy",function(){i.detach();i.remove()})}f.on("focus",function(){t.gecko?w(h,e):t.opera&&
h.body.focus();c.notifySelectionChange()});if(t.gecko)g.on("mousedown",function(){c.__iframeFocus||w(h,e)});if(D&&(g.on("keydown",function(a){if(a.keyCode in{8:1,46:1}){var b=c.getSelection(),d=b.getSelectedElement();if(d){c.execCommand("save");var e=b.getRanges()[0].createBookmark();d.remove();b.selectBookmarks([e]);c.execCommand("save");a.preventDefault()}}}),"CSS1Compat"==h.compatMode)){var j={33:1,34:1};g.on("keydown",function(a){a.keyCode in j&&setTimeout(function(){c.getSelection().scrollIntoView()},
0)})}if(t.webkit)g.on("mousedown",function(d){d=new b(d.target);a.inArray(d.nodeName(),["img","hr","input","textarea","select"])&&c.getSelection().selectElement(d)});if(t.gecko)g.on("dragstart",function(a){var c=new b(a.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&a.preventDefault()});s.add(c)}function j(b,c,d,e){var f="",g;g=n.debugUrl("theme/editor-iframe.css");d=d.concat([]);d.unshift(g);for(g=0;g<d.length;g++)f+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:d[g]});
return a.substitute(r,{doctype:8===y.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"{title}",links:f,style:"<style>"+c+"</style>",data:e||"",script:b?'<script id="ke_active_script">'+(C(h).isCustomDomain()?'document.domain="'+y.domain+'";':"")+'parent.KISSY.require("editor")._initIframe("'+b+'");<\/script>':""})}function q(a,c){function d(){i=h.document;a.setInternal("document",new b(i));a.setInternal("window",new b(h));e.detach();i.open("text/html","replace");i.write(f);
i.close()}var e=a.get("iframe"),f=j(a.get("id"),a.get("customStyle"),a.get("customLink"),c),g=e[0],h=g.contentWindow,i;e.__loaded=1;try{i=h.document}catch(k){if(g.src=g.src,7>D){setTimeout(d,10);return}}d()}function f(c,d){var e=C(h).getEmptyIframeSrc()||"";e&&(e=' src="'+e+'" ');var e=new b(a.substitute(z,{iframeSrc:e,prefixCls:c.get("prefixCls")})),f=c.get("textarea");f.hasAttr("tabindex")&&e.attr("tabindex",t.webkit?-1:f.attr("tabindex"));f.parent().prepend(e);c.set("iframe",e);c.__docReady=0;
if(t.gecko&&!e.__loaded)e.on("load",function(){q(c,d)},c);else q(c,d)}function d(b){if(b.get("iframe")){var c=b.get("iframe"),d=b.get("window"),b=b.get("document"),e=b[0],f=C(e.documentElement),e=C(e.body);a.each([b,f,e,d],function(a){a.detach()});c.remove()}}var c=!0,i=i,e=!1,h=a.Env.host,y=h.document,t=a.UA,D=t.ie,E=b.NodeType,C=b.all,K=n.tryThese,z='<iframe class="{prefixCls}editor-iframe" frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',O=/^(?:<(p)>)?(?:(?:&nbsp;)|\s|<br[^>]*>)*(?:<\/\1>)?$/i;
l.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};l.addMembers({initializer:function(){this.__commands={};this.__controls={};s.register(this)},renderUI:function(){o.init(this);p.init(this);v.init(this);m.init(this)},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form)&&(c=C(c)))c.on("submit",b.sync,b);b.on("docReady",a);b.on("blur",function(){b.$el.removeClass(d+
"editor-focused")});b.on("focus",function(){b.$el.addClass(d+"editor-focused")})},_onSetHeight:function(a){var b=this.get("textarea"),c=this.get("toolBarEl"),d=this.get("statusBarEl"),a=parseInt(a,10),a=a-((c&&c.outerHeight()||0)+(d&&d.outerHeight()||0));b.parent().css("height",a);b.css("height",a)},_onSetMode:function(a){var b=this.get("iframe"),c=this.get("textarea");1==a?(this.setData(c.val()),c.hide(),this.fire("wysiwygMode")):(b&&(c.val(this.getFormatData(1)),b.hide()),c.show(),this.fire("sourceMode"))},
_onSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var b,c=this.get("textarea"),d=this.get("document");this.get("attachForm")&&(b=c[0].form)&&(b=C(b))&&b.detach("submit",this.sync,this);if(d){b=C(d[0].body);var c=C(d[0].documentElement),e=this.get("window");s.remove(this);d.detach();c.detach();b.detach();e.detach()}a.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},
addControl:function(a,b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(b){var c=this.__commands[b],d=a.makeArray(arguments);d.shift();d.unshift(this);if(c)return c.exec.apply(c,d);b+": command not found";return i},queryCommandValue:function(a){return this.execCommand(n.getQueryCmd(a))},
setData:function(a){var b,c=a;if(1!=this.get("mode"))this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a);d(this);f(this,c)}},getData:function(b,c){var d=this.htmlDataProcessor,e;c==i&&(c=this.get("mode"));e=1==c&&this.isDocReady()?this.get("document")[0].body.innerHTML:d.toDataFormat(this.get("textarea").val());e=b?d.toHtml(e):d.toServer(e);e=a.trim(e);O.test(e)&&(e="");return e},getFormatData:function(a){return this.getData(1,a)},getDocHtml:function(){return j(0,this.get("customStyle"),
this.get("customLink"),this.getFormatData())},getSelection:function(){return l.Selection.getSelection(this.get("document")[0])},getSelectedHtml:function(){var a=this.getSelection().getRanges()[0],b="";a&&(a=a.cloneContents(),b=this.get("document")[0].createElement("div"),b.appendChild(a),b=b.innerHTML);return b},focus:function(){var a=this.get("window");if(a){var b=this.get("document")[0],a=a[0];t.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{b.body.focus()}catch(c){}this.notifySelectionChange()}},
blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("window"),d=this.get("customStyle")||"";this.set("customStyle",d+("\n"+a));c&&c.addStyleSheet(c,a,b)},removeCustomStyle:function(a){this.get("document").on("#"+a).remove()},addCustomLink:function(a){var b=this.get("customLink"),c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);
b.href=a},removeCustomLink:function(b){this.get("document").all("link").each(function(a){a.attr("href")==b&&a.remove()});var c=this.get("customLink"),d=a.indexOf(b,c);-1!=d&&c.splice(d,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=
b.getStartElement(),d=new l.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",{selection:b,path:d,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(1!==this.get("mode"))return i;this.focus();var b,d=a.nodeName(),e=l.XHTML_DTD,f=e.$block[d],g=l.RangeType,h=(d=this.getSelection())&&d.getRanges(),j,k,m;if(!h||0==h.length)return i;this.execCommand("save");for(k=
h.length-1;0<=k;k--)j=h[k],b=!k&&a||a.clone(c),j.insertNodeByDtd(b),m||(m=b);if(!m)return i;j.moveToPosition(m,g.POSITION_AFTER_END);f&&(a=l.Walker.whitespaces(!0),(a=(m=m.next(a,1))&&m[0].nodeType==E.ELEMENT_NODE&&m.nodeName())&&e.$block[a]&&e[a]["#text"]&&j.moveToElementEditablePosition(m));d.selectRanges([j]);this.focus();b&&1==b[0].nodeType&&b.scrollIntoView(i,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return b},insertHtml:function(a,b){var c=this,d,f=c.get("document")[0];
if(1===c.get("mode")){if(d=c.htmlDataProcessor)a=d.toDataFormat(a,b);c.focus();c.execCommand("save");if(D){d=f.selection;"Control"==d.type&&d.clear();try{d.createRange().pasteHTML(a)}catch(g){"insertHtml error in ie"}}else try{f.execCommand("inserthtml",e,a)}catch(h){setTimeout(function(){if(0==c.getSelection().getRanges().length){var b=new l.Range(f),d=C(f.body).first(function(a){return 1==a.nodeType&&"br"!=a.nodeName.toLowerCase()});d||(d=C(f.createElement("p")),d._4e_appendBogus().appendTo(f.body));
b.setStartAt(d,l.RangeType.POSITION_AFTER_START);b.select()}f.execCommand("inserthtml",e,a)},50)}setTimeout(function(){c.getSelection().scrollIntoView()},50);G.call(c)}}});l.decorate=function(a,b){var b=b||{},a=C(a),c=b.textareaAttrs=b.textareaAttrs||{},d=a.style("width"),e=a.style("height"),f=a.attr("name");d&&(b.width=b.width||d);e&&(b.height=b.height||e);f&&(c.name=f);b.data=b.data||a.val();b.elBefore=a;c=(new l(b)).render();a.remove();return c};l._initIframe=function(a){var d=s.getInstance(a),
a=d.get("document"),f=a[0];a.one("#ke_active_script").remove();x(d);var g=f.body,h=C(g);D?(g.hideFocus=c,g.disabled=c,g.contentEditable=c,g.removeAttribute("disabled")):setTimeout(function(){t.gecko||t.opera?g.contentEditable=c:t.webkit?g.parentNode.contentEditable=c:f.designMode="on"},0);if(t.gecko||t.opera){var i=f.documentElement;C(i).on("mousedown",function(a){if(a.target==i){t.gecko&&w(f,e);d.activateGecko()}})}setTimeout(function(){D&&setTimeout(function(){if(f){g.runtimeStyle.marginBottom=
"0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.__docReady=1;d.fire("docReady");var a=d.get("disableObjectResizing"),c=d.get("disableInlineTableEditing");if(a||c)try{f.execCommand("enableObjectResizing",e,!a);f.execCommand("enableInlineTableEditing",e,!c)}catch(g){h.on(D?"resizestart":"resize",function(d){var e=new b(d.target);(a||e.nodeName()==="table"&&c)&&d.preventDefault()})}},10)};var G=a.buffer(function(){this.execCommand("save")},50);return l},{requires:"node,editor/iframe-content-tpl,editor/base,editor/utils,editor/focusManager,editor/styles,editor/z-index-manager,editor/clipboard,editor/enterKey,editor/htmlDataProcessor,editor/selectionFix,editor/plugin-meta".split(",")});
