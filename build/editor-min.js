/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 16 18:20
*/
KISSY.add("editor/iframe-content-tpl",'<!doctype html>\n<html>\n<head>{doctype}\n    <title>{title}</title>\n    {style}\n    {links}\n    </head> \n<body class="ks-editor">\n{data}\n{script}\n</body> \n</html>');
KISSY.add("editor/render-xtpl",function(){return function(a,b,r){var m=this,b=this.config.utils,o=b.runBlockCommand,t=b.getExpression,g=b.getPropertyOrRunCommand,b='<div class="',n=g(m,a,{},"prefixCls",0,1,r,!1),b=b+t(n,!0),b=b+'editor-tools"\r\n     id="ks-editor-tools-',n=g(m,a,{},"id",0,2,r,!1),b=b+t(n,!0),b=b+'">\r\n\r\n</div>\r\n\r\n<\!--\r\nhttp://johanbrook.com/browsers/native-momentum-scrolling-ios-5/\r\nios \u4e0d\u80fd\u653e\u5728 iframe \u4e0a\uff01\r\n--\>\r\n\r\n<div class="',n=g(m,a,{},"prefixCls",0,11,r,!1),b=b+
t(n,!0),b=b+'editor-textarea-wrap"\r\n\r\n',n={},q=[],p=g(m,a,{},"mobile",0,13,r,!0);q.push(p);n.params=q;n.fn=function(){return'\r\nstyle="overflow:scroll;-webkit-overflow-scrolling:touch;"\r\n'};b+=o(m,a,n,"if",13);b+='\r\n\r\nid="ks-editor-textarea-wrap-';n=g(m,a,{},"id",0,17,r,!1);b+=t(n,!0);b+='"\r\n>\r\n\r\n<textarea\r\n        id="ks-editor-textarea-';n=g(m,a,{},"id",0,21,r,!1);b+=t(n,!0);b+='"\r\n        class="';n=g(m,a,{},"prefixCls",0,22,r,!1);b+=t(n,!0);b+='editor-textarea"\r\n\r\n';n=
{};q=[];p=g(m,a,{},"textareaAttrs",0,24,r,!0);q.push(p);n.params=q;n.fn=function(a){var k;k="\r\n";var n=g(m,a,{},"xindex",0,25,r,!1);k+=t(n,!0);k+='="';a=g(m,a,{},".",0,25,r,!1);k+=t(a,!0);return k+'"\r\n'};b+=o(m,a,n,"each",24);b+="\r\n\r\n";n={};q=[];p=g(m,a,{},"mode",0,28,r,!0);q.push(p);n.params=q;n.fn=function(){return'\r\nstyle="display:none"\r\n'};b+=o(m,a,n,"if",28);b+="\r\n\r\n>";o=g(m,a,{},"data",0,32,r,!1);b+=t(o,!0);b+='</textarea>\r\n\r\n</div>\r\n\r\n<div class="';o=g(m,a,{},"prefixCls",
0,36,r,!1);b+=t(o,!0);b+='editor-status"\r\n     id="ks-editor-status-';a=g(m,a,{},"id",0,37,r,!1);b+=t(a,!0);return b+'">\r\n\r\n</div>'}});KISSY.add("editor/render",function(a,b,r){return b.getDefaultRender().extend({beforeCreateDom:function(b,o){a.mix(b,{mobile:a.UA.mobile});a.mix(o,{textarea:"#ks-editor-textarea-{id}",toolBarEl:"#ks-editor-tools-{id}",statusBarEl:"#ks-editor-status-{id}"})}},{ATTRS:{contentTpl:{value:r}}})},{requires:["component/control","./render-xtpl"]});
KISSY.add("editor/base",function(a,b,r,m){return r.extend({},{Config:{},XHTML_DTD:b.DTD,ATTRS:{textarea:{},textareaAttrs:{view:1},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{view:1,value:1},data:{view:1},customStyle:{value:""},customLink:{value:[]},xrender:{value:m}},xclass:"editor"})},{requires:["html-parser","component/control","./render"]});
KISSY.add("editor/utils",function(a,b){var r=a.Node,m=a.DOM,o=a.UA,t={debugUrl:function(g){var n=a.Config;n.debug||(g=g.replace(/\.(js|css)/i,"-min.$1"));-1==g.indexOf("?t")&&(g=-1!=g.indexOf("?")?g+"&":g+"?",g+="t="+encodeURIComponent(n.tag));return n.base+"editor/"+g},lazyRun:function(a,n,b){var p=a[n],m=a[b];a[n]=function(){p.apply(this,arguments);a[n]=a[b];return m.apply(this,arguments)}},getXY:function(a,n){var b=a.left,p=a.top,o=n.get("window")[0],b=b-m.scrollLeft(o),p=p-m.scrollTop(o),o=n.get("iframe").offset(),
b=b+o.left,p=p+o.top;return{left:b,top:p}},tryThese:function(a){for(var n,b=0,p=arguments.length;b<p;b++){var m=arguments[b];try{n=m();break}catch(k){}}return n},arrayCompare:function(a,n){if(!a&&!n)return!0;if(!a||!n||a.length!=n.length)return!1;for(var b=0;b<a.length;b++)if(a[b]!==n[b])return!1;return!0},clearAllMarkers:function(a){for(var b in a)a[b]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},isNumber:function(g){return/^\d+(.\d+)?$/.test(a.trim(g))},
verifyInputs:function(g){for(var b=0;b<g.length;b++){var q=new r(g[b]),p=a.trim(t.valInput(q)),m=q.attr("data-verify"),q=q.attr("data-warning");if(m&&!RegExp(m).test(p))return alert(q),!1}return!0},sourceDisable:function(a,b){a.on("sourceMode",b.disable,b);a.on("wysiwygMode",b.enable,b)},resetInput:function(a){var b=a.attr("placeholder");b&&o.ie?(a.addClass("ks-editor-input-tip"),a.val(b)):o.ie||a.val("")},valInput:function(a,b){if(void 0===b)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");
a.val(b)},placeholder:function(g,b){g.attr("placeholder",b);o.ie&&(g.on("blur",function(){a.trim(g.val())||(g.addClass("ks-editor-input-tip"),g.val(b))}),g.on("focus",function(){g.removeClass("ks-editor-input-tip");a.trim(g.val())==b&&g.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(b){var b=a.clone(b),n;for(n in b){var q=b[n];"function"===typeof q&&(b[n]=q())}return b},map:function(a,
b){for(var q=0;q<a.length;q++)a[q]=b(a[q]);return a},ieEngine:document.documentMode||o.ie,preventFocus:function(a){o.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(b){a.mix(m,b);for(var n in b)(function(n){r.prototype[n]=function(){var p=[].slice.call(arguments,0);p.unshift(this[0]);return(p=b[n].apply(null,p))&&(p.nodeType||a.isWindow(p))?new r(p):a.isArray(p)&&(p.__IS_NODELIST||p[0]&&p[0].nodeType)?new r(p):p}})(n)},addRes:function(){var b=this.__res=this.__res||[];
b.push.apply(b,a.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],b=0;b<a.length;b++){var q=a[b];"function"===typeof q?q():q.destroy?q.destroy():q.remove&&q.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,b){return b.toUpperCase()})+"Value"}};return b.Utils=t},{requires:["./base","node"]});
KISSY.add("editor/dom",function(a,b,r){function m(a,f){var d=a[f?"next":"prev"](o,1);if(d&&d[0].nodeType==n.ELEMENT_NODE){for(var c=[];d.attr("_ke_bookmark")||d._4e_isEmptyInlineRemovable(o);)if(c.push(d),d=f?d.next(o,1):d.prev(o,1),!d)return;if(a._4e_isIdentical(d,o)){for(var j=new p(f?a[0].lastChild:a[0].firstChild);c.length;)c.shift()._4e_move(a,!f,o);d._4e_moveChildren(a,!f,o);d.remove();j[0]&&j[0].nodeType==n.ELEMENT_NODE&&j._4e_mergeSiblings()}}}var o=o,t=b.XHTML_DTD,g=a.DOM,n=g.NodeType,q=
a.UA,p=a.Node,u={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};b.PositionType={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var k=b.PositionType,v={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},x={hr:1},i=function(a){return a&&(a[0]||a)};r.injectDom({_4e_sameLevel:function(a,f){var f=i(f),d=a.parentNode;return d&&d==f.parentNode},_4e_isBlockBoundary:function(l,f){var d=a.merge(x,f);return!(!v[g.css(l,"display")]&&!d[g.nodeName(l)])},_4e_index:function(a,f){for(var d=a.parentNode.childNodes,c,j=-1,e=0;e<d.length;e++)if(c=d[e],!f||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(j++,c===a)return j;return-1},_4e_move:function(a,
f,d){f=i(f);d?f.insertBefore(a,f.firstChild):f.appendChild(a)},_4e_isIdentical:function(a,f){if(!f)return!1;f=i(f);if(g.nodeName(a)!=g.nodeName(f))return!1;var d=a.attributes,c=f.attributes,j=d.length,e=c.length;if(j!=e)return!1;for(var h=0;h<j;h++){var b=d[h],s=b.name;if(b.specified&&g.attr(a,s)!=g.attr(f,s))return!1}if(8>r.ieEngine)for(h=0;h<e;h++)if(b=c[h],s=b.name,b.specified&&g.attr(a,s)!=g.attr(f,s))return!1;return!0},_4e_isEmptyInlineRemovable:function(l){if(!t.$removeEmpty[g.nodeName(l)])return!1;
for(var l=l.childNodes,f=0,d=l.length;f<d;f++){var c=l[f],j=c.nodeType;if(!(j==n.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(j==n.ELEMENT_NODE&&!g._4e_isEmptyInlineRemovable(c)||j==g.NodeType.TEXT_NODE&&a.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,f,d){f=i(f);if(a!=f)if(d)for(;d=a.lastChild;)f.insertBefore(a.removeChild(d),f.firstChild);else for(;d=a.firstChild;)f.appendChild(a.removeChild(d))},_4e_mergeSiblings:function(a){a=new p(a);u[a.nodeName()]&&(m(a,!0),m(a))},_4e_splitText:function(a,
f){var d=a.ownerDocument;if(a.nodeType==g.NodeType.TEXT_NODE){if(q.ie&&f==a.nodeValue.length){var c=d.createTextNode("");g.insertAfter(c,a);return c}c=a.splitText(f);d.documentMode&&(d=d.createTextNode(""),g.insertAfter(d,c),g.remove(d));return c}},_4e_parents:function(a,f){var d=[];d.__IS_NODELIST=1;do d[f?"push":"unshift"](a);while(a=a.parentNode);return d},_4e_nextSourceNode:function(a,f,d,c){if(c&&!c.call)var j=i(c),c=function(a){return a!==j};var f=!f&&a.firstChild,e=a;if(!f){if(a.nodeType==
n.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.nextSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.nextSibling}return!f||c&&!1===c(f)?null:d&&d!=f.nodeType?g._4e_nextSourceNode(f,!1,d,c):f},_4e_previousSourceNode:function(a,f,d,c){if(c&&!c.call)var j=i(c),c=function(a){return a!==j};var f=!f&&a.lastChild,e=a;if(!f){if(a.nodeType==n.ELEMENT_NODE&&c&&!1===c(a,!0))return null;f=a.previousSibling}for(;!f&&(e=e.parentNode);){if(c&&!1===c(e,!0))return null;f=e.previousSibling}return!f||
c&&!1===c(f)?null:d&&f.nodeType!=d?g._4e_previousSourceNode(f,!1,d,c):f},_4e_commonAncestor:function(a,f){f=i(f);if(a===f)return a;if(g.contains(f,a))return f;var d=a;do if(g.contains(d,f))return d;while(d=d.parentNode);return null},_4e_hasAttributes:9>r.ieEngine?function(a){for(var f=a.attributes,d=0;d<f.length;d++){var c=f[d];switch(c.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(a){q.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,f){var d=i(f);if(a.compareDocumentPosition)return a.compareDocumentPosition(d);if(a==d)return k.POSITION_IDENTICAL;if(a.nodeType==n.ELEMENT_NODE&&d.nodeType==n.ELEMENT_NODE){if(g.contains(a,d))return k.POSITION_CONTAINS+k.POSITION_PRECEDING;if(g.contains(d,a))return k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>d.sourceIndex?k.POSITION_DISCONNECTED:a.sourceIndex<d.sourceIndex?k.POSITION_PRECEDING:k.POSITION_FOLLOWING}for(var c=
g._4e_address(a),d=g._4e_address(d),j=Math.min(c.length,d.length),e=0;e<=j-1;e++)if(c[e]!=d[e])return c[e]<d[e]?k.POSITION_PRECEDING:k.POSITION_FOLLOWING;return c.length<d.length?k.POSITION_CONTAINS+k.POSITION_PRECEDING:k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING},_4e_address:function(a,f){for(var d=[],c=a.ownerDocument.documentElement,j=a;j&&j!=c;)d.unshift(g._4e_index(j,f)),j=j.parentNode;return d},_4e_remove:function(a,f){var d=a.parentNode;if(d){if(f)for(var c;c=a.firstChild;)d.insertBefore(a.removeChild(c),
a);d.removeChild(a)}return a},_4e_trim:function(a){g._4e_ltrim(a);g._4e_rtrim(a)},_4e_ltrim:function(a){for(var f;f=a.firstChild;){if(f.nodeType==g.NodeType.TEXT_NODE){var d=r.ltrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(g._4e_splitText(f,c-d.length),a.removeChild(a.firstChild));else{a.removeChild(f);continue}}break}},_4e_rtrim:function(a){for(var f;f=a.lastChild;){if(f.type==g.NodeType.TEXT_NODE){var d=r.rtrim(f.nodeValue),c=f.nodeValue.length;if(d)d.length<c&&(g._4e_splitText(f,d.length),
a.removeChild(a.lastChild));else{a.removeChild(f);continue}}break}!q.ie&&!q.opera&&(f=a.lastChild)&&1==f.nodeType&&"br"==g.nodeName(f)&&a.removeChild(f)},_4e_appendBogus:function(b){for(var f=b.lastChild;f&&f.nodeType==g.NodeType.TEXT_NODE&&!a.trim(f.nodeValue);)f=f.previousSibling;if(!f||f.nodeType==g.NodeType.TEXT_NODE||"br"!==g.nodeName(f))f=q.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),b.appendChild(f)},_4e_setMarker:function(b,f,d,c){var b=new p(b),j=b.data("list_marker_id")||
b.data("list_marker_id",a.guid()).data("list_marker_id"),e=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");f[j]=b;e[d]=1;return b.data(d,c)},_4e_clearMarkers:function(a,f,d){var a=new p(a),c=a.data("list_marker_names"),j=a.data("list_marker_id"),e;for(e in c)a.removeData(e);a.removeData("list_marker_names");d&&(a.removeData("list_marker_id"),delete f[j])},_4e_copyAttributes:function(a,f,d){for(var f=new p(f),c=a.attributes,d=d||{},j=0;j<c.length;j++){var e=c[j],
h=e.name.toLowerCase(),b;if(!(h in d))if("checked"==h&&(b=g.attr(a,h)))f.attr(h,b);else if(e.specified||q.ie&&e.value&&"value"==h)b=g.attr(a,h),null===b&&(b=e.nodeValue),f.attr(h,b)}""!==a.style.cssText&&(f[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=g.nodeName(a);return(a=!t.$nonEditable[a]&&(t[a]||t.span))&&a["#text"]},_4e_getByAddress:function(a,f,d){for(var a=a.documentElement,c=0;a&&c<f.length;c++){var j=f[c];if(d)for(var e=-1,h=0;h<a.childNodes.length;h++){var b=a.childNodes[h];
if(!(!0===d&&3==b.nodeType&&b.previousSibling&&3==b.previousSibling.nodeType)&&(e++,e==j)){a=b;break}}else a=a.childNodes[j]}return a}})},{requires:["./base","./utils","node"]});
KISSY.add("editor/focusManager",function(a,b){function r(){var a=this;a.__iframeFocus=q;g=a;t&&clearTimeout(t);t=setTimeout(function(){a.fire("focus")},30)}function m(){var a=this;a.__iframeFocus=p;g=u;t&&clearTimeout(t);t=setTimeout(function(){a.fire("blur")},30)}var o={},t,g,n={currentInstance:function(){return g},getInstance:function(a){return o[a]},register:function(a){o[a.get("id")]=a},add:function(a){this.register(a);a.get("window").on("focus",r,a).on("blur",m,a)},remove:function(a){delete o[a.get("id")];
a.get("window").detach("focus",r,a).detach("blur",m,a)}},q=!0,p=!1,u=null;b.focusManager=n;b.getInstances=function(){return o};return n},{requires:["./base","./dom"]});
KISSY.add("editor/walker",function(a,b){function r(a,d){if(this._.end)return n;var c,j=this.range,e,h=this.guard,b=this.type,s=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,j.trim(),j.collapsed))return this.end(),n;if(!a&&!this._.guardLTR){var i=j.endContainer[0],q=i.childNodes[j.endOffset];this._.guardLTR=function(a,c){return c&&(i==a||"body"==p.nodeName(a))?!1:a!=q}}if(a&&!this._.guardRTL){var m=j.startContainer[0],l=0<j.startOffset&&m.childNodes[j.startOffset-
1]||null;this._.guardRTL=function(a,c){return c&&(m==a||"body"==p.nodeName(a))?!1:a!=l}}var z=a?this._.guardRTL:this._.guardLTR;e=h?function(a,c){return z(a,c)===g?g:h(a,c)}:z;this.current?c=this.current[s](g,b,e):a?(c=j.endContainer,0<j.endOffset?(c=new k(c[0].childNodes[j.endOffset-1]),e(c[0])===g&&(c=n)):c=e(c,t)===g?n:c._4e_previousSourceNode(t,b,e,void 0)):(c=j.startContainer,c=new k(c[0].childNodes[j.startOffset]),c.length?e(c[0])===g&&(c=n):c=e(j.startContainer,t)===g?n:j.startContainer._4e_nextSourceNode(t,
b,e,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==g){if(!d)return c}else if(d&&this.evaluator)return g;c=c[s](g,b,e)}this.end();return this.current=n}function m(a){for(var d,c=n;d=r.call(this,a);)c=d;return c}function o(a){this.range=a;this.guard=this.evaluator=n;this._={}}var t=!0,g=!1,n=null,q=a.UA,p=a.DOM,u=b.XHTML_DTD,k=a.Node;a.augment(o,{end:function(){this._.end=1},next:function(){return r.call(this)},previous:function(){return r.call(this,t)},checkForward:function(){return r.call(this,
g,t)!==g},checkBackward:function(){return r.call(this,t,t)!==g},lastForward:function(){return m.call(this)},lastBackward:function(){return m.call(this,t)},reset:function(){delete this.current;this._={}},_iterator:r});a.mix(o,{blockBoundary:function(a){return function(d){return!(d.nodeType==p.NodeType.ELEMENT_NODE&&p._4e_isBlockBoundary(d,a))}},bookmark:function(a,d){function c(a){return"span"==p.nodeName(a)&&p.attr(a,"_ke_bookmark")}return function(j){var e,h;e=j.nodeType==p.NodeType.TEXT_NODE&&(h=
j.parentNode)&&c(h);e=a?e:e||c(j);return!!(d^e)}},whitespaces:function(f){return function(d){d=d.nodeType==p.NodeType.TEXT_NODE&&!a.trim(d.nodeValue);return!!(f^d)}},invisible:function(a){var d=o.whitespaces();return function(c){c=d(c)||c.nodeType==p.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var v=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,x=o.whitespaces(),i=o.bookmark(),l=function(a){var d=p.nodeName(a);return i(a)||x(a)||1==a.nodeType&&d in u.$inline&&!(d in u.$empty)};b.Utils.injectDom({_4e_getBogus:function(a){a=
new k(a);do a=a._4e_previousSourceNode();while(a&&l(a[0]));return a&&(!q.ie?"br"==a.nodeName():3==a[0].nodeType&&v.test(a.text()))?a[0]:!1}});return b.Walker=o},{requires:["./base","./utils","./dom","node"]});
KISSY.add("editor/elementPath",function(a,b){function r(a){for(var b=t,r=t,k=[];a;){if(a[0].nodeType==m.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var v=a.nodeName();if(!r&&(!b&&g[v]&&(b=a),n[v])){var x;if(x=!b)if(x="div"==v){a:{x=a[0].childNodes;for(var i=0,l=x.length;i<l;i++){var f=x[i];if(f.nodeType==m.NodeType.ELEMENT_NODE&&o.$block[f.nodeName.toLowerCase()]){x=!0;break a}}x=!1}x=!x}x?b=a:r=a}k.push(a);if("body"==v)break}a=a.parent()}this.block=b;this.blockLimit=r;this.elements=
k}var m=a.DOM,o=b.XHTML_DTD,t=null,g={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},n={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};r.prototype={constructor:r,compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var g=0;g<b.length;g++)if(!m.equals(b[g],a[g]))return!1;return!0},contains:function(a){for(var b=this.elements,g=0;g<b.length;g++)if(b[g].nodeName()in a)return b[g];return t},toString:function(){var a=
this.elements,b,g=[];for(b=0;b<a.length;b++)g.push(a[b].nodeName());return g.toString()}};return b.ElementPath=r},{requires:["./base","./dom","node"]});
KISSY.add("editor/range",function(a,b,r,m,o){function t(z){var e=z.nodeType!=f.NodeType.TEXT_NODE&&f.nodeName(z)in c.$removeEmpty,d=z.nodeType==f.NodeType.TEXT_NODE&&!a.trim(z.nodeValue),z=!!z.parentNode.getAttribute("_ke_bookmark");return e||d||z}function g(a){return!s(a)&&!D(a)}function n(c){var e=v;return function(j){if(D(j))return k;if(j.nodeType==f.NodeType.TEXT_NODE){if(a.trim(j.nodeValue).length)return v}else if(j.nodeType==f.NodeType.ELEMENT_NODE&&(j=f.nodeName(j),!L[j]))if(!c&&!d.ie&&"br"==
j&&!e)e=k;else return v;return k}}function q(a,c){var e=a.startContainer,w=a.endContainer,d=a.startOffset,b=a.endOffset,s,y=v,g=v,i=void 0,E=a.document,n;0<c&&(i=E.createDocumentFragment());if(a.collapsed)return i;a.optimizeBookmark();w[0].nodeType==f.NodeType.TEXT_NODE?(g=k,w=w._4e_splitText(b)):0<w[0].childNodes.length&&(b>=w[0].childNodes.length?(w=new j(w[0].appendChild(E.createTextNode(""))),n=k):w=new j(w[0].childNodes[b]));e[0].nodeType==f.NodeType.TEXT_NODE?(y=k,e._4e_splitText(d)):d?d>=e[0].childNodes.length?
(e=new j(e[0].appendChild(E.createTextNode(""))),s=k):e=new j(e[0].childNodes[d].previousSibling):(s=new j(E.createTextNode("")),e.prepend(s),e=s,s=k);var J=e._4e_parents(),K=w._4e_parents();J.each(function(a,c){J[c]=a});K.each(function(a,c){K[c]=a});for(var H,m,E=0;E<J.length&&!(H=J[E],m=K[E],!H.equals(m));E++);for(var d=i,A,l,o=E;o<J.length;o++){A=J[o];b=0<c&&!A.equals(e)?d.appendChild(A.clone()[0]):null;A=A[0].nextSibling;l=K[o];for(var D=w[0],p=l&&l[0];A&&!(p==A||D==A);){l=A.nextSibling;if(2==
c)d.appendChild(A.cloneNode(k));else{if(h[A.nodeName.toLowerCase()]){var q=A.cloneNode(k);A.innerHTML="";A=q}else f._4e_remove(A);1==c&&d.appendChild(A)}A=l}b&&(d=b)}for(d=i;E<K.length;E++){A=K[E];b=0<c&&!A.equals(w)?d.appendChild(A.clone()[0]):null;if(!J[E]||!A._4e_sameLevel(J[E]))for(A=A[0].previousSibling;A;)l=A.previousSibling,2==c?d.insertBefore(A.cloneNode(k),d.firstChild):(f._4e_remove(A),1==c&&d.insertBefore(A,d.firstChild)),A=l;b&&(d=b)}if(2==c){if(y&&(H=e[0],H.nodeType==f.NodeType.TEXT_NODE&&
H.nextSibling&&H.nextSibling.nodeType==f.NodeType.TEXT_NODE&&(H.data+=H.nextSibling.data,H.parentNode.removeChild(H.nextSibling))),g)g=w[0],g.nodeType==f.NodeType.TEXT_NODE&&g.previousSibling&&g.previousSibling.nodeType==f.NodeType.TEXT_NODE&&(g.previousSibling.data+=g.data,g.parentNode.removeChild(g))}else{if(H&&m&&(!e._4e_sameLevel(H)||!w._4e_sameLevel(m)))g=H._4e_index(),s&&H._4e_sameLevel(e)&&g--,a.setStart(H.parent(),g+1);a.collapse(k)}s&&e.remove();n&&w.remove();return i}function p(a){a.collapsed=
a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function u(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=x;this.collapsed=k;this.document=a}b.RangeType={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var k=!0,v=!1,x=null,i=b.RangeType,l=b.PositionType,f=a.DOM,
d=a.UA,c=b.XHTML_DTD,j=a.Node,e=j.all,h={td:1},y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},s=new m.whitespaces,D=new m.bookmark,F=m.whitespaces(k),B=m.bookmark(!1,!0),L={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(u,{toString:function(){var a=[],c=this.startContainer[0],e=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);
a.push((e.id||e.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,c=this.startOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=f.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),
a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=
c;this.endContainer||(this.endContainer=a,this.endOffset=c);p(this)},setEnd:function(a,c){a[0].nodeType==f.NodeType.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);p(this)},setStartAt:function(a,c){switch(c){case i.POSITION_AFTER_START:this.setStart(a,0);break;case i.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);
break;case i.POSITION_BEFORE_START:this.setStartBefore(a);break;case i.POSITION_AFTER_END:this.setStartAfter(a)}p(this)},setEndAt:function(a,c){switch(c){case i.POSITION_AFTER_START:this.setEnd(a,0);break;case i.POSITION_BEFORE_END:a[0].nodeType==f.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case i.POSITION_BEFORE_START:this.setEndBefore(a);break;case i.POSITION_AFTER_END:this.setEndAfter(a)}p(this)},cloneContents:function(){return q(this,2)},
deleteContents:function(){return q(this,0)},extractContents:function(){return q(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=k},clone:function(){var a=new u(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=
this.clone();a.optimize();if(a.startContainer[0].nodeType!=f.NodeType.ELEMENT_NODE||a.endContainer[0].nodeType!=f.NodeType.ELEMENT_NODE)return x;var c=new m(a);c.evaluator=function(a){return F(a)&&B(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:x},shrink:function(a,c){if(!this.collapsed){var a=a||i.SHRINK_TEXT,e=this.clone(),w=this.startContainer,d=this.endContainer,j=this.startOffset,b=this.endOffset,h=k,g,s,E=k;w&&w[0].nodeType==f.NodeType.TEXT_NODE&&(j?j>=w[0].nodeValue.length?
e.setStartAfter(w):(e.setStartBefore(w),h=v):e.setStartBefore(w));d&&d[0].nodeType==f.NodeType.TEXT_NODE&&(b?b>=d[0].nodeValue.length?e.setEndAfter(d):(e.setEndAfter(d),E=v):e.setEndBefore(d));if(h||E)s=new m(e),s.evaluator=function(c){return c.nodeType==(a==i.SHRINK_ELEMENT?f.NodeType.ELEMENT_NODE:f.NodeType.TEXT_NODE)},s.guard=function(c,e){if(a==i.SHRINK_ELEMENT&&c.nodeType==f.NodeType.TEXT_NODE||e&&c==g)return v;!e&&c.nodeType==f.NodeType.ELEMENT_NODE&&(g=c);return k};h&&(e=s[a==i.SHRINK_ELEMENT?
"lastForward":"next"]())&&this.setStartAt(e,c?i.POSITION_AFTER_START:i.POSITION_BEFORE_START);E&&(s.reset(),(s=s[a==i.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(s,c?i.POSITION_BEFORE_END:i.POSITION_AFTER_END));return h||E}},createBookmark2:function(a){var c=this.startContainer,e=this.endContainer,d=this.startOffset,b=this.endOffset,h,s;if(!c||!e)return{start:0,end:0};if(a){if(c[0].nodeType==f.NodeType.ELEMENT_NODE&&(h=new j(c[0].childNodes[d]))&&h[0]&&h[0].nodeType==f.NodeType.TEXT_NODE&&
0<d&&h[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)c=h,d=0;for(;c[0].nodeType==f.NodeType.TEXT_NODE&&(s=c.prev(void 0,1))&&s[0].nodeType==f.NodeType.TEXT_NODE;)c=s,d+=s[0].nodeValue.length;if(!this.collapsed){if(e[0].nodeType==f.NodeType.ELEMENT_NODE&&(h=new j(e[0].childNodes[b]))&&h[0]&&h[0].nodeType==f.NodeType.TEXT_NODE&&0<b&&h[0].previousSibling.nodeType==f.NodeType.TEXT_NODE)e=h,b=0;for(;e[0].nodeType==f.NodeType.TEXT_NODE&&(s=e.prev(void 0,1))&&s[0].nodeType==f.NodeType.TEXT_NODE;)e=s,
b+=s[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?x:e._4e_address(a),startOffset:d,endOffset:b,normalized:a,is2:k}},createBookmark:function(c){var e,d,w,b,h=this.collapsed;e=new j("<span>",x,this.document);e.attr("_ke_bookmark",1);e.css("display","none");e.html("&nbsp;");c&&(w=a.guid("ke_bm_"),e.attr("id",w+"S"));h||(d=e.clone(),d.html("&nbsp;"),c&&d.attr("id",w+"E"),b=this.clone(),b.collapse(),b.insertNode(d));b=this.clone();b.collapse(k);b.insertNode(e);d?(this.setStartAfter(e),
this.setEndBefore(d)):this.moveToPosition(e,i.POSITION_AFTER_END);return{startNode:c?w+"S":e,endNode:c?w+"E":d,serializable:c,collapsed:h}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(k)},trim:function(a,c){var e=this.startContainer,d=this.startOffset,b=this.collapsed;if((!a||b)&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE){if(d)if(d>=e[0].nodeValue.length)d=e._4e_index()+1,e=e.parent();else{var j=e._4e_splitText(d),d=e._4e_index()+1,e=e.parent();f.equals(this.startContainer,this.endContainer)?
this.setEnd(j,this.endOffset-this.startOffset):f.equals(e,this.endContainer)&&(this.endOffset+=1)}else d=e._4e_index(),e=e.parent();this.setStart(e,d);if(b){this.collapse(k);return}}e=this.endContainer;d=this.endOffset;!c&&!b&&e[0]&&e[0].nodeType==f.NodeType.TEXT_NODE&&(d?(d>=e[0].nodeValue.length||e._4e_splitText(d),d=e._4e_index()+1):d=e._4e_index(),e=e.parent(),this.setEnd(e,d))},insertNode:function(a){this.optimizeBookmark();this.trim(v,k);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||
null);c[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(c){var d=e(this.document);if(c.is2){var b=d._4e_getByAddress(c.start,c.normalized),w=c.startOffset,d=c.end&&d._4e_getByAddress(c.end,c.normalized),c=c.endOffset;this.setStart(b,w);d?this.setEnd(d,c):this.collapse(k)}else b=(w=c.serializable)?a.one("#"+c.startNode,d):c.startNode,c=w?a.one("#"+c.endNode,d):c.endNode,this.setStartBefore(b),b._4e_remove(),c&&c[0]?(this.setEndBefore(c),c._4e_remove()):this.collapse(k)},
getCommonAncestor:function(a,c){var e=this.startContainer,d=this.endContainer,e=e[0]==d[0]?a&&e[0].nodeType==f.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new j(e[0].childNodes[this.startOffset]):e:e._4e_commonAncestor(d);return c&&e[0].nodeType==f.NodeType.TEXT_NODE?e.parent():e},enlarge:function(){function a(c,d,b,j){var h=c[d?"startContainer":"endContainer"],g,y=d?0:1,i=0,k=d?"previousSibling":"nextSibling";g=c[d?"startOffset":"endOffset"];if(h[0].nodeType==f.NodeType.TEXT_NODE){if(d){if(g)return}else if(g<
h[0].nodeValue.length)return;g=h[0][k];h=h[0].parentNode}else g=h[0].childNodes[g+(d?-1:1)]||null,h=h[0];for(;h;){for(;g;)if(s(g)||D(g))g=g[k];else break;if(g){if(!i)c[d?"setStartAfter":"setEndBefore"](e(g));break}h=e(h);if("body"==h.nodeName())break;if(i||h.equals(j))b[y]=h,i=1;else c[d?"setStartBefore":"setEndAfter"](h);g=h[0][k];h=h[0].parentNode}}return function(c){switch(c){case i.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),d=[];a(this,1,d,c);a(this,0,d,c);d[0]&&d[1]&&
(c=d[0].contains(d[1])?d[1]:d[0],this.setStartBefore(c),this.setEndAfter(c));break;case i.ENLARGE_BLOCK_CONTENTS:case i.ENLARGE_LIST_ITEM_CONTENTS:var b=new u(this.document),d=new j(this.document.body);b.setStartAt(d,i.POSITION_AFTER_START);b.setEnd(this.startContainer,this.startOffset);var b=new m(b),h,g,s=m.blockBoundary(c==i.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:x),y=function(a){var c=s(a);c||(h=e(a));return c},k=function(a){var c=y(a);!c&&"br"==f.nodeName(a)&&(g=e(a));return c};b.guard=y;b=b.lastBackward();
h=h||d;this.setStartAt(h,"br"!=h.nodeName()&&(!b&&this.checkStartOfBlock()||b&&h.contains(b))?i.POSITION_AFTER_START:i.POSITION_AFTER_END);b=this.clone();b.collapse();b.setEndAt(d,i.POSITION_BEFORE_END);b=new m(b);b.guard=c==i.ENLARGE_LIST_ITEM_CONTENTS?k:y;h=x;b=b.lastForward();h=h||d;this.setEndAt(h,!b&&this.checkEndOfBlock()||b&&h.contains(b)?i.POSITION_BEFORE_END:i.POSITION_BEFORE_START);g&&this.setEndAfter(g)}}}(),checkStartOfBlock:function(){var c=this.startContainer,e=this.startOffset;if(e&&
c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(0,e)).length)return v;this.trim();c=new o(this.startContainer);e=this.clone();e.collapse(k);e.setStartAt(c.block||c.blockLimit,i.POSITION_AFTER_START);c=new m(e);c.evaluator=n(k);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,e=this.endOffset;if(c[0].nodeType==f.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(e)).length)return v;this.trim();c=new o(this.endContainer);e=this.clone();e.collapse(v);
e.setEndAt(c.block||c.blockLimit,i.POSITION_BEFORE_END);c=new m(e);c.evaluator=n(v);return c.checkForward()},checkBoundaryOfElement:function(a,c){var e=this.clone();e[c==i.START?"setStartAt":"setEndAt"](a,c==i.START?i.POSITION_AFTER_START:i.POSITION_BEFORE_END);e=new m(e);e.evaluator=t;return e[c==i.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,d=this.startOffset,b=this.endOffset,h;if(a[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=
a[0].childNodes.length,h>d)a=e(a[0].childNodes[d]);else if(0==h)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=e(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==f.NodeType.ELEMENT_NODE)if(h=c[0].childNodes.length,h>b)c=e(c[0].childNodes[b])._4e_previousSourceNode(k);else if(0==h)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=e(c)}a._4e_position(c)&l.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),
h=e(this.document.createElement(c));this.collapse(a);this.enlarge(i.ENLARGE_BLOCK_CONTENTS);h[0].appendChild(this.extractContents());h._4e_trim();d.ie||h._4e_appendBogus();this.insertNode(h);this.moveToBookmark(b);return h},splitBlock:function(c){var e=new o(this.startContainer),b=new o(this.endContainer),h=e.block,j=b.block,f=x;if(!e.blockLimit.equals(b.blockLimit))return x;"br"!=c&&(h||(h=this.fixBlock(k,c),j=(new o(this.endContainer)).block),j||(j=this.fixBlock(v,c)));c=h&&this.checkStartOfBlock();
e=j&&this.checkEndOfBlock();this.deleteContents();h&&h[0]==j[0]&&(e?(f=new o(this.startContainer),this.moveToPosition(j,i.POSITION_AFTER_END),j=x):c?(f=new o(this.startContainer),this.moveToPosition(h,i.POSITION_BEFORE_START),h=x):(j=this.splitElement(h),!d.ie&&!a.inArray(h.nodeName(),["ul","ol"])&&h._4e_appendBogus()));return{previousBlock:h,nextBlock:j,wasStartOfBlock:c,wasEndOfBlock:e,elementPath:f}},splitElement:function(a){if(!this.collapsed)return x;this.setEndAt(a,i.POSITION_BEFORE_END);var c=
this.extractContents(),e=a.clone(v);e[0].appendChild(c);e.insertAfter(a);this.moveToPosition(a,i.POSITION_AFTER_END);return e},moveToElementEditablePosition:function(a,c){for(var e=0;a;){if(a[0].nodeType==f.NodeType.TEXT_NODE){this.moveToPosition(a,c?i.POSITION_AFTER_END:i.POSITION_BEFORE_START);e=1;break}a[0].nodeType==f.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,c?i.POSITION_BEFORE_END:i.POSITION_AFTER_START),e=1);var d=a,h=e,b=void 0;d[0].nodeType==f.NodeType.ELEMENT_NODE&&
d._4e_isEditable()&&(b=d[c?"last":"first"](g,1));!h&&!b&&(b=d[c?"prev":"next"](g,1));a=b}return!!e},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==f.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var e,d,b,h=a.nodeName();e=c.$block[h];this.deleteContents();if(e){for(e=this.getCommonAncestor(v,k);(d=c[e.nodeName()])&&(!d||!d[h]);){var j=e.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(e),
this.collapse(k),e.remove()):b=e;e=j}b&&this.splitElement(b)}this.insertNode(a)}});r.injectDom({_4e_breakParent:function(a,c){var c=e(c),a=e(a),d,h=new b.Range(a[0].ownerDocument);h.setStartAfter(a);h.setEndAfter(c);d=h.extractContents();h.insertNode(a.remove());a.after(d)}});return b.Range=u},{requires:"./base,./utils,./walker,./elementPath,./dom,node".split(",")});
KISSY.add("editor/selection",function(a,b){function r(a){this.document=a;this._={cache:{}};if(k)try{var d=this.getNative().createRange();if(!d||d.item&&d.item(0).ownerDocument!=a||d.parentElement&&d.parentElement().ownerDocument!=a)this.isInvalid=o}catch(e){this.isInvalid=o}}function m(a){a=new r(a);return!a||a.isInvalid?t:a}b.SelectionType={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var o=!0,t=null,g=a.UA,n=a.DOM,q=a.Node,p=b.SelectionType,u=b.RangeType,k=g.ie,v=b.Walker,x=b.Range,i=
{img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(r,{getNative:!k?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=n.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!k?function(){var a=this._.cache;if(a.type)return a.type;var d=p.SELECTION_TEXT,e=this.getNative();if(e){if(1==e.rangeCount){var e=
e.getRangeAt(0),h=e.startContainer;h==e.endContainer&&h.nodeType==n.NodeType.ELEMENT_NODE&&1==Number(e.endOffset-e.startOffset)&&i[h.childNodes[e.startOffset].nodeName.toLowerCase()]&&(d=p.SELECTION_ELEMENT)}}else d=p.SELECTION_NONE;return a.type=d}:function(){var a=this._.cache;if(a.type)return a.type;var d=p.SELECTION_NONE;try{var e=this.getNative(),h=e.type;"Text"==h&&(d=p.SELECTION_TEXT);"Control"==h&&(d=p.SELECTION_ELEMENT);e.createRange().parentElement&&(d=p.SELECTION_TEXT)}catch(b){}return a.type=
d},getRanges:k?function(){var a=function(a,c){a=a.duplicate();a.collapse(c);for(var d=a.parentElement(),b=d.childNodes,f,g=0;g<b.length;g++){var i=b[g];if(i.nodeType==n.NodeType.ELEMENT_NODE){f=a.duplicate();f.moveToElementText(i);var i=f.compareEndPoints("StartToStart",a),k=f.compareEndPoints("EndToStart",a);f.collapse();if(0<i)break;else{if(!i||1==k&&-1==i)return{container:d,offset:g};if(!k)return{container:d,offset:g+1}}f=t}}f||(f=a.duplicate(),f.moveToElementText(d),f.collapse(!1));f.setEndPoint("StartToStart",
a);f=(""+f.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<f;)f-=b[--g].nodeValue.length}catch(m){f=0}return 0===f?{container:d,offset:g}:{container:b[g],offset:-f}};return function(d){var e=this._.cache;if(e.ranges&&!d)return e.ranges;var b=this.getNative(),d=b&&b.createRange(),f=this.getType();if(!b)return[];if(f==p.SELECTION_TEXT)return b=new x(this.document),f=a(d,o),b.setStart(new q(f.container),f.offset),f=a(d),b.setEnd(new q(f.container),f.offset),e.ranges=[b];if(f==p.SELECTION_ELEMENT){e=
e.ranges=[];for(f=0;f<d.length;f++){for(var g=d.item(f),i=g.parentNode,k=0,b=new x(this.document);k<i.childNodes.length&&i.childNodes[k]!=g;k++);b.setStart(new q(i),k);b.setEnd(new q(i),k+1);e.push(b)}return e}return e.ranges=[]}}():function(a){var d=this._.cache;if(d.ranges&&!a)return d.ranges;var a=[],e=this.getNative();if(!e)return[];for(var b=0;b<e.rangeCount;b++){var f=e.getRangeAt(b),g=new x(this.document);g.setStart(new q(f.startContainer),f.startOffset);g.setEnd(new q(f.endContainer),f.endOffset);
a.push(g)}return d.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var d,e=this.getNative();switch(this.getType()){case p.SELECTION_ELEMENT:return this.getSelectedElement();case p.SELECTION_TEXT:var b=this.getRanges()[0];if(b&&!b.collapsed){for(b.optimize();o;)if(d=b.startContainer,b.startOffset==(d[0].nodeType===n.NodeType.ELEMENT_NODE?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())b.setStartAfter(d);else break;d=b.startContainer;
if(d[0].nodeType!=n.NodeType.ELEMENT_NODE)return d.parent();d=new q(d[0].childNodes[b.startOffset]);if(!d[0]||d[0].nodeType!=n.NodeType.ELEMENT_NODE)return b.startContainer;for(b=d[0].firstChild;b&&b.nodeType==n.NodeType.ELEMENT_NODE;)d=new q(b),b=b.firstChild;return d}if(k)b=e.createRange(),b.collapse(o),d=new q(b.parentElement());else{if((d=e.anchorNode)&&d.nodeType!=n.NodeType.ELEMENT_NODE)d=d.parentNode;d&&(d=new q(d))}}return a.startElement=d},getSelectedElement:function(){var a,d=this._.cache;
if(void 0!==d.selectedElement)return d.selectedElement;k&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var e;if(a)e=new q(a);else{a=this.getRanges()[0];for(var b,f=2;f&&(!(e=a.getEnclosedNode())||!(e[0].nodeType==n.NodeType.ELEMENT_NODE&&i[e.nodeName()]&&(b=e)));f--)a.shrink(u.SHRINK_ELEMENT);e=b}return d.selectedElement=e},reset:function(){this._.cache={}},selectElement:function(a){var d,e=this.document;if(k)try{d=e.body.createControlRange(),d.addElement(a[0]),d.select()}catch(b){d=e.body.createTextRange(),
d.moveToElementText(a[0]),d.select()}finally{}else d=e.createRange(),d.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(d);this.reset()},selectRanges:function(a){if(k){if(1<a.length){var d=a[a.length-1];a[0].setEnd(d.endContainer,d.endOffset);a.length=1}a[0]&&a[0].select()}else{d=this.getNative();if(!d)return;d.removeAllRanges();for(var e=0;e<a.length;e++){var b=a[e],f=this.document.createRange(),i=b.startContainer;if(b.collapsed&&(g.gecko&&1.09>g.gecko||g.opera||g.webkit)&&i[0].nodeType==
n.NodeType.ELEMENT_NODE&&!i[0].childNodes.length)i[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),b.startOffset++,b.endOffset++;f.setStart(i[0],b.startOffset);f.setEnd(b.endContainer[0],b.endOffset);d.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var d=[],e=this.getRanges(),b=0;b<e.length;b++)d.push(e[b].createBookmark2(a));return d},createBookmarks:function(d,b){for(var e=[],h=this.document,f,b=b||this.getRanges(),g=b.length,i=0;i<g;i++){e.push(f=b[i].createBookmark(d,
o));var k=(d=f.serializable)?a.one("#"+f.startNode,h):f.startNode;f=d?a.one("#"+f.endNode,h):f.endNode;for(var m=i+1;m<g;m++){var l=b[m],p=l.startContainer,q=l.endContainer;n.equals(p,k.parent())&&l.startOffset++;n.equals(p,f.parent())&&l.startOffset++;n.equals(q,k.parent())&&l.endOffset++;n.equals(q,f.parent())&&l.endOffset++}}return e},selectBookmarks:function(a){for(var d=[],e=0;e<a.length;e++){var b=new x(this.document);b.moveToBookmark(a[e]);d.push(b)}this.selectRanges(d);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();k?a&&a.clear():a&&a.removeAllRanges()}});var l={table:1,tbody:1,tr:1},f=v.whitespaces(o),d=/\ufeff|\u00a0/;x.prototype.select=x.prototype.select=!k?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
n.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&(a[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var d=this.document.createRange();d.setStart(a[0],this.startOffset);try{d.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(o),d.setEnd(this.endContainer[0],this.endOffset);else throw e;}a=m(this.document).getNative();a.removeAllRanges();a.addRange(d)}:function(a){var b=this.collapsed,
e,h;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var g=this.startContainer[0].childNodes[this.startOffset];if(g.nodeType==n.NodeType.ELEMENT_NODE){(new r(this.document)).selectElement(new q(g));return}}(this.startContainer[0].nodeType==n.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in l||this.endContainer[0].nodeType==n.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in l)&&this.shrink(u.SHRINK_ELEMENT,o);var i=this.createBookmark(),g=i.startNode,
k;b||(k=i.endNode);i=this.document.body.createTextRange();i.moveToElementText(g[0]);i.moveStart("character",1);if(k)a=this.document.body.createTextRange(),a.moveToElementText(k[0]),i.setEndPoint("EndToEnd",a),i.moveEnd("character",-1);else{for(e=g[0].nextSibling;e&&!f(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(d))&&(a||!g[0].previousSibling||g[0].previousSibling&&"br"==n.nodeName(g[0].previousSibling));h=new q(this.document.createElement("span"));h.html("&#65279;");h.insertBefore(g);
e&&n.insertBefore(this.document.createTextNode("\ufeff"),g[0]||g)}this.setStartBefore(g);g._4e_remove();if(b){if(e?(i.moveStart("character",-1),i.select(),this.document.selection.clear()):i.select(),h)this.moveToPosition(h,u.POSITION_BEFORE_START),h._4e_remove()}else this.setEndBefore(k),k._4e_remove(),i.select()};r.getSelection=m;return b.Selection=r},{requires:["./base","./walker","./range","./dom","node"]});
KISSY.add("editor/domIterator",function(a,b){function r(a){1>arguments.length||(this.range=a,this.forceBrBreak=o,this.enlargeBr=m,this.enforceRealBlocks=o,this._||(this._={}))}var m=!0,o=!1,t=a.UA,g=b.Walker,n=b.Range,q=b.RangeType,p=b.ElementPath,u=a.Node,k=a.DOM,v=/^[\r\n\t ]*$/;a.augment(r,{getNextParagraph:function(b){var i,l,f,d,c;if(!this._.lastNode){l=this.range.clone();l.shrink(q.SHRINK_ELEMENT,m);l.enlarge(this.forceBrBreak||!this.enlargeBr?q.ENLARGE_LIST_ITEM_CONTENTS:q.ENLARGE_BLOCK_CONTENTS);
var j=new g(l),e=g.bookmark(m,m);j.evaluator=e;this._.nextNode=j.next();j=new g(l);j.evaluator=e;j=j.previous();this._.lastNode=j._4e_nextSourceNode(m);this._.lastNode&&this._.lastNode[0].nodeType==k.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(e=new n(l.document),e.moveToPosition(this._.lastNode,q.POSITION_AFTER_END),e.checkEndOfBlock()&&(e=new p(e.endContainer),this._.lastNode=(e.block||e.blockLimit)._4e_nextSourceNode(m)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new u(l.document.createTextNode("")),k.insertAfter(this._.lastNode[0],j[0]));l=null}e=this._.nextNode;j=this._.lastNode;for(this._.nextNode=null;e;){var h=o,y=e[0].nodeType!=k.NodeType.ELEMENT_NODE,s=o;if(y)e[0].nodeType==k.NodeType.TEXT_NODE&&v.test(e[0].nodeValue)&&(y=o);else{var r=e.nodeName();if(e._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==r)y=m;else if(!l&&!e[0].childNodes.length&&"hr"!=r){i=e;f=e.equals(j);break}l&&(l.setEndAt(e,q.POSITION_BEFORE_START),
"br"!=r&&(this._.nextNode=e));h=m}else{if(e[0].firstChild){l||(l=new n(this.range.document),l.setStartAt(e,q.POSITION_BEFORE_START));e=new u(e[0].firstChild);continue}y=m}}y&&!l&&(l=new n(this.range.document),l.setStartAt(e,q.POSITION_BEFORE_START));f=(!h||y)&&e.equals(j);if(l&&!h)for(;!e[0].nextSibling&&!f;){r=e.parent();if(r._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){h=m;f||r.equals(j);break}e=r;y=m;f=e.equals(j);s=m}y&&l.setEndAt(e,q.POSITION_AFTER_END);e=e._4e_nextSourceNode(s,null,j);if((f=
!e)||h&&l)break}if(!i){if(!l)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;i=new p(l.startContainer);e=i.blockLimit;h={div:1,th:1,td:1};i=i.block;if((!i||!i[0])&&!this.enforceRealBlocks&&h[e.nodeName()]&&l.checkStartOfBlock()&&l.checkEndOfBlock())i=e;else if(!i||this.enforceRealBlocks&&"li"==i.nodeName())i=new u(this.range.document.createElement(b||"p")),i[0].appendChild(l.extractContents()),i._4e_trim(),l.insertNode(i),d=c=m;else if("li"!=i.nodeName()){if(!l.checkStartOfBlock()||
!l.checkEndOfBlock())i=i.clone(o),i[0].appendChild(l.extractContents()),i._4e_trim(),c=l.splitBlock(),d=!c.wasStartOfBlock,c=!c.wasEndOfBlock,l.insertNode(i)}else f||(this._.nextNode=i.equals(j)?null:l.getBoundaryNodes().endNode._4e_nextSourceNode(m,null,j))}d&&(l=new u(i[0].previousSibling),l[0]&&l[0].nodeType==k.NodeType.ELEMENT_NODE&&("br"==l.nodeName()?l._4e_remove():l[0].lastChild&&"br"==k.nodeName(l[0].lastChild)&&k._4e_remove(l[0].lastChild)));c&&(l=g.bookmark(o,m),d=new u(i[0].lastChild),
d[0]&&d[0].nodeType==k.NodeType.ELEMENT_NODE&&"br"==d.nodeName()&&(t.ie||d.prev(l,1)||d.next(l,1))&&d.remove());this._.nextNode||(this._.nextNode=f||i.equals(j)?null:i._4e_nextSourceNode(m,null,j));return i}});n.prototype.createIterator=function(){return new r(this)};return r},{requires:["./base","./range","./elementPath","./walker","node"]});
KISSY.add("editor/styles",function(a,b){function r(a){return!F.attr(a,"_ke_bookmark")}function m(a,d){for(var e in a)"string"==typeof a[e]?a[e]=a[e].replace(Q,function(a,e){return d[e]}):m(a[e],d)}function o(d,e){e&&(d=a.clone(d),m(d,e));var b=this.element=this.element=(d.element||"*").toLowerCase();this.type=this.type="#text"==b||G[b]?KEST.STYLE_BLOCK:O[b]?KEST.STYLE_OBJECT:KEST.STYLE_INLINE;this._={definition:d}}function t(a,d){var e=d?this.removeFromRange:this.applyToRange;a.body.focus();for(var b=
new L(a),c=b.getRanges(),f=0;f<c.length;f++)e.call(this,c[f]);b.selectRanges(c)}function g(a,d,e){var b=a.element;"*"==b&&(b="span");d=new I(d.createElement(b));e&&e._4e_copyAttributes(d);e=a._.definition;a=e.attributes;e=o.getStyleText(e);if(a)for(var c in a)d.attr(c,a[c]);e&&(d[0].style.cssText=e);return d}function n(a){var d=a.createBookmark(h),e=a.createIterator();e.enforceRealBlocks=h;e.enlargeBr=h;for(var b,c=a.document;b=e.getNextParagraph();){var f=g(this,c,b),i=f,f="pre"==i.nodeName,j="pre"==
b.nodeName,k=!f&&j;f&&!j?(j=b,k=j.html(),k=q(k,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),k=k.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),k=k.replace(/([ \t\n\r]+|&nbsp;)/g," "),k=k.replace(/<br\b[^>]*>/gi,"\n"),w.ie?(j=j[0].ownerDocument.createElement("div"),j.appendChild(i[0]),i.outerHtml("<pre>"+k+"</pre>"),i=new I(j.firstChild),i._4e_remove()):i.html(k)):k?i=u(p(b),i):b._4e_moveChildren(i);b[0].parentNode.replaceChild(i[0],b[0]);if(f&&(b=i,f=void 0,(f=b._4e_previousSourceNode(h,F.NodeType.ELEMENT_NODE))&&
"pre"==f.nodeName()))i=q(f.html(),/\n$/,"")+"\n\n"+q(b.html(),/^\n/,""),w.ie?b.outerHtml("<pre>"+i+"</pre>"):b.html(i),f._4e_remove()}a.moveToBookmark(d)}function q(a,d,e){var b="",c="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,d,e){d&&(b=d);e&&(c=e);return""});return b+a.replace(d,e)+c}function p(a){var d=[];q(a.outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,d,e){return d+"</pre>"+e+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,e){d.push(e)});return d}function u(a,d){for(var e=d[0].ownerDocument.createDocumentFragment(),b=0;b<a.length;b++){var c=a[b],c=c.replace(/(\r\n|\r)/g,"\n"),c=q(c,/^[ \t]*\n/,""),c=q(c,/\n$/,""),c=q(c,/^[ \t]+|[ \t]+$/g,function(a,d){return 1==a.length?"&nbsp;":d?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),c=c.replace(/\n/g,"<br>"),c=c.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=d.clone();f.html(c);e.appendChild(f[0])}return e}
function k(a){var d=a.document;if(a.collapsed)d=g(this,d,void 0),a.insertNode(d),a.moveToPosition(d,B.POSITION_BEFORE_END);else{var e=this.element,b=this._.definition,f,i=M[e];i||(f=h,i=M.span);var j=a.createBookmark();a.enlarge(B.ENLARGE_ELEMENT);a.trim();for(var k=a.createBookmark(),n=k.startNode,k=k.endNode,C=n,m;C&&C[0];){var l=y;if(F.equals(C,k))C=s,l=h;else{var G=C[0].nodeType,o=G==F.NodeType.ELEMENT_NODE?C.nodeName():s;if(o&&C.attr("_ke_bookmark")){C=C._4e_nextSourceNode(h);continue}if(!o||
i[o]&&(C._4e_position(k)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(C))){var p=C.parent();if(p&&"a"==e&&p.nodeName()==e)G=g(this,d,void 0),p._4e_moveChildren(G),p[0].parentNode.replaceChild(G[0],p[0]),G._4e_mergeSiblings();else if(p&&p[0]&&((M[p.nodeName()]||M.span)[e]||f)&&(!b.parentRule||b.parentRule(p))){if(!m&&(!o||!M.$removeEmpty[o]||(C._4e_position(k)|z.POSITION_PRECEDING|z.POSITION_IDENTICAL|
z.POSITION_IS_CONTAINED)==z.POSITION_PRECEDING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED))m=new N(d),m.setStartBefore(C);if(G==F.NodeType.TEXT_NODE||G==F.NodeType.ELEMENT_NODE&&!C[0].childNodes.length){p=C;for(G=null;(l=!p.next(r,1))&&(G=p.parent())&&i[G.nodeName()]&&(G._4e_position(n)|z.POSITION_FOLLOWING|z.POSITION_IDENTICAL|z.POSITION_IS_CONTAINED)==z.POSITION_FOLLOWING+z.POSITION_IDENTICAL+z.POSITION_IS_CONTAINED&&(!b.childRule||b.childRule(G));)p=G;m.setEndAfter(p)}}else l=h}else l=h;C=C._4e_nextSourceNode()}if(l&&
m&&!m.collapsed){for(var l=g(this,d,void 0),p=m.getCommonAncestor(),G={},o={},q,v=null,D;l&&p&&l[0]&&p[0];){if(p.nodeName()==e){for(q in b.attributes)if(!o[q]&&(D=p.attr(v)))l.attr(q)==D?l.removeAttr(q):o[q]=1;for(v in b.styles)if(!G[v]&&(D=p.style(v)))l.style(v)==D?l.style(v,""):G[v]=1;if(!l._4e_hasAttributes()){l=s;break}}p=p.parent()}l?(l[0].appendChild(m.extractContents()),c(this,l),m.insertNode(l),l._4e_mergeSiblings(),w.ie||l[0].normalize()):(l=new I(d.createElement("span")),l[0].appendChild(m.extractContents()),
m.insertNode(l),c(this,l),l._4e_remove(!0));m=s}}n._4e_remove();k._4e_remove();a.moveToBookmark(j);a.shrink(B.SHRINK_TEXT)}}function v(a){a.enlarge(B.ENLARGE_ELEMENT);var d=a.createBookmark(),e=d.startNode;if(a.collapsed){for(var b=new C(e.parent()),c,h=0,g;h<b.elements.length&&(g=b.elements[h])&&!(g==b.block||g==b.blockLimit);h++)if(this.checkElementRemovable(g)){var i=a.checkBoundaryOfElement(g,B.END),k=!i&&a.checkBoundaryOfElement(g,B.START);k||i?(c=g,c.match=k?"start":"end"):(g._4e_mergeSiblings(),
g.nodeName()!=this.element?(i=l(this),j(g,i[g.nodeName()]||i["*"])):f(this,g))}if(c){g=e;for(h=0;;h++){i=b.elements[h];if(i.equals(c))break;else if(i.match)continue;else i=i.clone();i[0].appendChild(g[0]);g=i}g["start"==c.match?"insertBefore":"insertAfter"](c);b=c.html();!b||"\u200b"==b?c.remove():w.webkit&&D(a.document.createTextNode("\u200b")).insertBefore(g)}}else{var m=d.endNode,n=this;c=function(){for(var a=new C(e.parent()),d=new C(m.parent()),b=s,c=s,f=0;f<a.elements.length;f++){var h=a.elements[f];
if(h==a.block||h==a.blockLimit)break;n.checkElementRemovable(h)&&(b=h)}for(f=0;f<d.elements.length;f++){h=d.elements[f];if(h==d.block||h==d.blockLimit)break;n.checkElementRemovable(h)&&(c=h)}c&&m._4e_breakParent(c);b&&e._4e_breakParent(b)};c();for(b=new I(e[0].nextSibling);b[0]!==m[0];){h=b._4e_nextSourceNode();if(b[0]&&b[0].nodeType==F.NodeType.ELEMENT_NODE&&this.checkElementRemovable(b)&&(b.nodeName()==this.element?f(this,b):(g=l(this),j(b,g[b.nodeName()]||g["*"])),h[0].nodeType==F.NodeType.ELEMENT_NODE&&
h.contains(e)))c(),h=new I(e[0].nextSibling);b=h}}a.moveToBookmark(d)}function x(a){var d={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,b,e){d[b]=e});return d}function i(a,d){var b="";d!==y?(b=document.createElement("span"),b.style.cssText=a,b=b.style.cssText||""):b=a;return b.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function l(d){if(d._.overrides)return d._.overrides;var b=d._.overrides={},e=d._.definition.overrides;
if(e){a.isArray(e)||(e=[e]);for(var c=0;c<e.length;c++){var f=e[c],h,g,i;"string"==typeof f?h=f.toLowerCase():(h=f.element?f.element.toLowerCase():d.element,g=f.attributes,i=f.styles);f=b[h]||(b[h]={});if(g){h=f.attributes=f.attributes||[];for(var w in g)h.push([w.toLowerCase(),g[w]])}if(i){var f=f.styles=f.styles||[],j;for(j in i)f.push([j.toLowerCase(),i[j]])}}}return b}function f(b,c){var f=b._.definition,g=l(b),i=a.merge(f.attributes,(g[c.nodeName()]||g["*"]||{}).attributes),f=a.merge(f.styles,
(g[c.nodeName()]||g["*"]||{}).styles),g=a.isEmptyObject(i)&&a.isEmptyObject(f),w;for(w in i)("class"==w||b._.definition.fullMatch)&&c.attr(w)!=d(w,i[w])||(g=g||!!c.hasAttr(w),c.removeAttr(w));for(var j in f)b._.definition.fullMatch&&c.style(j)!=d(j,f[j],h)||(g=g||!!c.style(j),c.style(j,""));e(c)}function d(a,d,b){var e=new I("<span>");e[b?"style":"attr"](a,d);return e[b?"style":"attr"](a)}function c(a,d){for(var b=l(a),e=d.all(a.element),c=e.length;0<=--c;)f(a,new I(e[c]));for(var h in b)if(h!=a.element){e=
d.all(h);for(c=e.length-1;0<=c;c--){var g=new I(e[c]);j(g,b[h])}}}function j(a,d){var b,c=d&&d.attributes;if(c)for(b=0;b<c.length;b++){var f=c[b][0],h;if(h=a.attr(f)){var g=c[b][1];(g===s||g.test&&g.test(h)||"string"==typeof g&&h==g)&&a[0].removeAttribute(f)}}if(c=d&&d.styles)for(b=0;b<c.length;b++)if(f=c[b][0],g=a.css(f)){var i=c[b][1];(i===s||i.test&&i.test(h)||"string"==typeof i&&g==i)&&a.css(f,"")}e(a)}function e(a){if(!a._4e_hasAttributes()){var d=a[0].firstChild,b=a[0].lastChild;a._4e_remove(h);
d&&(d.nodeType==F.NodeType.ELEMENT_NODE&&F._4e_mergeSiblings(d),b&&d!=b&&b.nodeType==F.NodeType.ELEMENT_NODE&&F._4e_mergeSiblings(b))}}var h=!0,y=!1,s=null,D=a.all,F=a.DOM,B=b.RangeType,L=b.Selection,z=b.PositionType,N=b.Range,I=a.Node,w=a.UA,C=b.ElementPath,G={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},M=b.XHTML_DTD,O={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},P=/\s*(?:;\s*|$)/g,Q=/#\((.+?)\)/g;b.StyleType=KEST={STYLE_BLOCK:1,STYLE_INLINE:2,
STYLE_OBJECT:3};o.prototype={constructor:o,apply:function(a){t.call(this,a,y)},remove:function(a){t.call(this,a,h)},applyToRange:function(a){return(this.applyToRange=this.type==KEST.STYLE_INLINE?k:this.type==KEST.STYLE_BLOCK?n:s).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==KEST.STYLE_INLINE?v:s).call(this,a)},checkElementRemovable:function(a,d){if(!a)return y;var b=this._.definition,e;if(a.nodeName()==this.element){if(!d&&!a._4e_hasAttributes())return h;var c=
b._AC;if(c)b=c;else{var c={},f=0,g=b.attributes;if(g)for(var w in g)f++,c[w]=g[w];if(g=o.getStyleText(b))c.style||f++,c.style=g;c._length=f;b=b._AC=c}if(b._length){for(var j in b)if("_length"!=j){f=a.attr(j)||"";if("style"==j)a:{c=b[j];f=i(f,y);"string"==typeof c&&(c=x(c));"string"==typeof f&&(f=x(f));g=void 0;for(g in c)if(!(g in f&&(f[g]==c[g]||"inherit"==c[g]||"inherit"==f[g]))){c=y;break a}c=h}else c=b[j]==f;if(c){if(!d)return h}else if(d)return y}if(d)return h}else return h}j=l(this);if(j=j[a.nodeName()]||
j["*"]){if(!(b=j.attributes)&&!(e=j.styles))return h;if(b)for(c=0;c<b.length;c++)if(j=b[c][0],j=a.attr(j))if(f=b[c][1],f===s||"string"==typeof f&&j==f||f.test&&f.test(j))return h;if(e)for(c=0;c<e.length;c++)if(j=a.css(e[c][0]))if(b=e[c][1],b===s||"string"==typeof b&&j==b||b.test&&b.test(j))return h}return y},checkActive:function(a){switch(this.type){case KEST.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,h);case KEST.STYLE_OBJECT:case KEST.STYLE_INLINE:for(var d=a.elements,b=
0,c;b<d.length;b++)if(c=d[b],!(this.type==KEST.STYLE_INLINE&&(F.equals(c,a.block)||F.equals(c,a.blockLimit))))if((this.type!=KEST.STYLE_OBJECT||c.nodeName()in O)&&this.checkElementRemovable(c,h))return h}return y}};o.getStyleText=function(a){var d=a._ST;if(d)return d;var d=a.styles,b=a.attributes&&a.attributes.style||"",c="";b.length&&(b=b.replace(P,";"));for(var e in d){var f=d[e],h=(e+":"+f).replace(P,";");"inherit"==f?c+=h:b+=h}b.length&&(b=i(b));return a._ST=b+c};return b.Style=o},{requires:"./base,./range,./selection,./domIterator,./elementPath,node".split(",")});
KISSY.add("editor/zIndexManager",function(a,b){var r=b.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};b.baseZIndex=function(a){return(b.Config.baseZIndex||1E4)+a};return r},{requires:["./base"]});
KISSY.add("editor/clipboard",function(a,b,r,m){function o(a){this.editor=a;this._init()}function t(a){var b=a.get("document")[0],f=a.getSelection(),e;if(f.getType()==m.SELECTION_ELEMENT&&(e=f.getSelectedElement())){var a=f.getRanges()[0],h=p(b.createTextNode(""));h.insertBefore(e);a.setStartBefore(h);a.setEndAfter(e);f.selectRanges([a]);setTimeout(function(){e.parent()&&(h.remove(),f.selectElement(e))},0)}}function g(a){if(u.webkit){if(!a.match(/^[^<]*$/g)&&!a.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return 0}else if(u.ie){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi)&&
!a.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return 0}else if(u.gecko||u.opera){if(!a.match(/^([^<]|<br( ?\/)?>)*$/gi))return 0}else return 0;return 1}function n(a){a=a.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>");if(a.match(/^[^<]$/))return a;if(u.webkit&&-1<a.indexOf("<div>"))a.match(/<div>(?:<br>)?<\/div>/)&&(a=a.replace(/<div>(?:<br>)?<\/div>/g,function(){return"<p></p>"}),a=a.replace(/<\/p><div>/g,"</p><p>").replace(/<\/div><p>/g,"</p><p>").replace(/^<div>/,
"<p>").replace(/^<\/div>/,"</p>")),a.match(/<\/div><div>/)&&(a=a.replace(/<\/div><div>/g,"</p><p>").replace(/^<div>/,"<p>").replace(/^<\/div>/,"</p>"));else if(u.gecko||u.opera)u.gecko&&(a=a.replace(/^<br><br>$/,"<br>")),-1<a.indexOf("<br><br>")&&(a="<p>"+a.replace(/<br><br>/g,function(){return"</p><p>"})+"</p>");return a}function q(a){var b=0,a=a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"");-1!=a.indexOf("Apple-")&&(a=a.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi,
" "),a=a.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(a,b){return b.replace(/\t/g,Array(5).join("&nbsp;"))}),-1<a.indexOf('<br class="Apple-interchange-newline">')&&(b=1,a=a.replace(/<br class="Apple-interchange-newline">/,"")),a=a.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1"));!b&&g(a)&&(a=n(a));return a}var p=a.all,u=a.UA,k=u.ie?"beforepaste":"paste",v=b.RangeType;a.augment(o,{_init:function(){var a=this,b=a.editor,f=b.get("document"),e=f.one("body"),h=function(a){this.type=
a};h.prototype={exec:function(b){var c=this.type;b.focus();setTimeout(function(){u.ie&&("cut"==c?t(b):"paste"==c&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));i(b,c)||alert(l[c])},0)}};e.on(k,a._getClipboardDataFromPasteBin,a);u.ie&&(e.on("paste",a._iePaste,a),f.on("keydown",a._onKeyDown,a),f.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));b.addCommand("copy",new h("copy"));b.addCommand("cut",new h("cut"));b.addCommand("paste",
new h("paste"))},_onKeyDown:function(a){this.editor.get("mode")==b.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var b,f=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{b=f.get("document")[0].queryCommandEnabled(a)}catch(e){}this._isPreventBeforePaste=0}else b=(a=(a=f.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);return b},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&
clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var b=this.editor;this._isPreventPaste||(a.preventDefault(),b.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){k+":  paste event happen";var b=this.editor,c=b.get("document")[0];if(c.getElementById("ke-paste-bin"))k+": trigger more than once ...";else{var f=b.getSelection(),e=new r(c),h=p(u.webkit?"<body></body>":
"<div></div>",c);h.attr("id","ke-paste-bin");u.webkit&&h[0].appendChild(c.createTextNode("\u200b"));c.body.appendChild(h[0]);h.css({position:"absolute",top:f.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});h.css("left","-1000px");var g=f.createBookmarks();e.setStartAt(h,v.POSITION_AFTER_START);e.setEndAt(h,v.POSITION_BEFORE_END);e.select(!0);setTimeout(function(){var c,e=h;h=u.webkit&&(c=h.first())&&c.hasClass("Apple-style-span")?c:h;f.selectBookmarks(g);var i=h.html();
e.remove();if(i=q(i))"paste "+i,c=b.fire("paste",{html:i}),!1!==c&&(void 0!==c&&(i=c),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(i)?a.use("editor/plugin/word-filter",function(a,c){b.insertHtml(c.toDataFormat(i,b))}):b.insertHtml(i))},0)}}}});var x=function(a,b){var f=a.get("document")[0],e=p(f.body),h=!1,g=function(){h=!0};e.on(b,g);(7<u.ie?f:f.selection.createRange()).execCommand(b);e.detach(b,g);return h},i=u.ie?function(a,b){return x(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(f){return!1}},
l={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},f={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var b;a.docReady(function(){b=new o(a)});var g={copy:1,cut:1,paste:1},e=["copy","cut","paste"];a.on("contextmenu",function(h){var i=h.contextmenu;if(!i.__copy_fix){i.__copy_fix=1;for(h=0;h<e.length;h++)i.addChild({content:f[e[h]],value:e[h]});i.on("click",function(b){var c=
b.target.get("value");g[c]&&(i.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(c);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var k=i.get("children"),h=k.length-1;h--;0<=h){var l=k[h],n;n=l.get?l.get("value"):l.value;g[n]&&(n=!b._stateFromNamedCommand(n),l.set?l.set("disabled",n):l.disabled=n)}})}}},{requires:["./base","./range","./selection","node"]});
KISSY.add("editor/enterKey",function(a,b,r,m){function o(b){var o;o=b.getSelection().getRanges();for(var t=o.length-1;0<t;t--)o[t].deleteContents();o=o[0];t=o.document;if(o.checkStartOfBlock()&&o.checkEndOfBlock()){var i=(new m(o.startContainer)).block;if(i&&("li"==i.nodeName()||"li"==i.parent().nodeName()))return b.hasCommand("outdent")?(b.execCommand("save"),b.execCommand("outdent"),b.execCommand("save"),!0):!1}var l=o.splitBlock("p");if(!l)return!0;var b=l.previousBlock,i=l.nextBlock,f=l.wasStartOfBlock,
d=l.wasEndOfBlock,c;if(i)c=i.parent(),"li"==c.nodeName()&&(i._4e_breakParent(c),i._4e_move(i.next(),!0));else if(b&&(c=b.parent())&&"li"==c.nodeName())b._4e_breakParent(c),o.moveToElementEditablePosition(b.next()),b._4e_move(b.prev());if(!f&&!d){if("li"==i.nodeName()&&(c=i.first(r.invisible(!0)))&&a.inArray(c.nodeName(),["ul","ol"]))(g.ie?new p(t.createTextNode("\u00a0")):new p(t.createElement("br"))).insertBefore(c);i&&o.moveToElementEditablePosition(i)}else{var j;if(b){if("li"==b.nodeName()||!n.test(b.nodeName()))j=
b.clone()}else i&&(j=i.clone());j||(j=new p("<p>",null,t));if(c=l.elementPath)for(var l=0,e=c.elements.length;l<e;l++){var h=c.elements[l];if(h.equals(c.block)||h.equals(c.blockLimit))break;q.$removeEmpty[h.nodeName()]&&(h=h.clone(),j._4e_moveChildren(h),j.append(h))}g.ie||j._4e_appendBogus();o.insertNode(j);if(g.ie&&f&&(!d||!b[0].childNodes.length))o.moveToElementEditablePosition(d?b:j),o.select();o.moveToElementEditablePosition(f&&!d?i:j)}g.ie||(i?(j=new p(t.createElement("span")),j.html("&nbsp;"),
o.insertNode(j),j.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),o.deleteContents()):j.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));o.select();return!0}function t(a){var b=a.get("document")[0];u.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var g=a.execCommand("enterBlock");a.execCommand("save");!1!==g&&b.preventDefault()}})}var g=a.UA,n=/^h[1-6]$/,q=b.XHTML_DTD,
p=a.Node,u=a.Event;return{init:function(a){a.addCommand("enterBlock",{exec:o});a.docReady(function(){t(a)})}}},{requires:["./base","./walker","./elementPath","node"]});
KISSY.add("editor/htmlDataProcessor",function(a,b,r){return{init:function(m){function o(b){var b=b.childNodes,c,d,f,g=b.length;if(g){f=1;for(c=0;c<g;c++)if(d=b[c],d.nodeType!=a.DOM.NodeType.TEXT_NODE||d.nodeValue){f=0;break}return f?!1:void 0}return!1}function t(a){return a.replace(v,function(a,b,c){return"<"+b+c.replace(x,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function g(a){return a.replace(l,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function n(b){return b.replace(f,function(b,c){return a.urlDecode(c)})}var q=a.Node,p=a.UA,u=new r.Filter,k=new r.Filter;(function(){function b(a){a=r.serialize(a);return new r.Comment(i+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:b,noscript:b,span:o}},d={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=["name","href","src"],
c,e=0;e<b.length;e++)c="_ke_saved_"+b[e],a.getAttribute(c)&&a.removeAttribute(b[e]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:o,strong:o,em:o,del:o,u:o},attributes:{style:function(b){if(!a.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],comment:function(b){if(b.substr(0,i.length)==i)return b=a.trim(a.urlDecode(b.substr(i.length))),r.parse(b).childNodes[0]}};p.ie&&(d.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});u.addRules(d);k.addRules(c)})();(function(){function c(b){for(var b=b.childNodes,e=b.length,d=b[e-1];d&&3==d.nodeType&&!a.trim(d.nodeValue);)d=b[--e];return d}function d(a){var b=c(a);b&&(1==b.nodeType&&"br"==b.nodeName?a.removeChild(b):3==b.nodeType&&
j.test(b.nodeValue)&&a.removeChild(b))}function f(a){var b=c(a);return!b||"form"==a.nodeName&&"input"==b.nodeName}function g(a){d(a);f(a)&&(p.ie||a.appendChild(new r.Tag("br")))}function i(a){d(a);f(a)&&a.appendChild(new r.Text("\u00a0"))}var j=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,l=b.XHTML_DTD,n=a.merge(l.$block,l.$listItem,l.$tableContent),m;for(m in n)"br"in l[m]||delete n[m];delete n.pre;var l={tags:{}},o={tags:{}};for(m in n)l.tags[m]=g,o.tags[m]=i;k.addRules(l);u.addRules(o)})();u.addRules({text:function(a){return a.replace(/\xa0/g,
"&nbsp;")}});var v=/<(a|area|img|input)\b([^>]*)>/gi,x=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,i="{ke_protected}",l=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<script[^>]*>[\s\S]*<\/script>)|(?:<(:?link|meta|base)[^>]*>)/gi,f=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,d=/(<\/?)((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,c=/(<\/?)ke:((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,j=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;
m.htmlDataProcessor={dataFilter:k,htmlFilter:u,toHtml:function(a){p.webkit&&(a=a.replace(/\u200b/g,""));var b=new r.BeautifyWriter;(new r.Parser(a)).parse().writeHtml(b,u);return a=b.getHtml()},toDataFormat:function(a,b){var b=b||k,a=g(a),a=t(a),a=a.replace(d,"$1ke:$2"),a=a.replace(j,"<ke:$1$2></ke:$1>"),f=new q("<div>");f.html("a"+a);a=f.html().substr(1);a=a.replace(c,"$1$2");a=n(a);f=new r.BasicWriter;(new r.Parser(a)).parse().writeHtml(f,b);return a=f.getHtml()},toServer:function(a){var b=new r.MinifyWriter;
(new r.Parser(a)).parse().writeHtml(b,u);return b.getHtml()}}}}},{requires:["./base","html-parser"]});
KISSY.add("editor/selectionFix",function(a,b){function r(a){function b(a,c){var d=e.body.createTextRange();try{d.moveToPoint(a,c)}catch(f){d=q}return d}function f(){var a=e.selection.createRange();h&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&h.select();u.remove(e,"mouseup",f);u.remove(e,"mousemove",d);h=c=0}function d(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",h)?a.setEndPoint("StartToStart",h):a.setEndPoint("EndToEnd",h),a.select()}else f()}var c,g=a.get("window")[0],
e=a.get("document")[0],h;u.on(e,"mousedown contextmenu",function(a){var i=e.documentElement;if(a.target===i&&(c&&f(),!(i.scrollHeight>i.clientHeight)&&(c=1,h=b(a.pageX,a.pageY))))u.on(e,"mouseup",f),u.on(e,"mousemove",d),g.focus(),h.select()})}function m(a){function l(b){if(e){var c=a.getSelection(),d=c&&c.getType(),h=c&&f.selection;if(b&&h&&d==x.SELECTION_NONE&&!f.queryCommandEnabled("InsertImage"))setTimeout(function(){l(g)},50);else{var k;if(!h||!h.type||!("Control"!=h.type&&(k=h.createRange())&&
(k=k.parentElement())&&(k=k.nodeName)&&k.toLowerCase()in{input:1,textarea:1}))j=h&&c.getRanges()[0],a.checkSelectionChange()}}}var f=a.get("document")[0],d=new v(f.body),c=new v(f.documentElement);if(8>b.Utils.ieEngine)c.on("click",function(b){"html"===(new v(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var j,e,h=g;c.on("mousedown",function(){h=n});c.on("mouseup",function(){h=g});d.on("focusin",function(a){if("body"==(new v(a.target)).nodeName()&&j){try{h&&j.select()}catch(b){}j=
q}});d.on("focus",function(){e=g;l()});d.on("beforedeactivate",function(a){a.relatedTarget||(e=n,h=g)});d.on("mousedown",function(){e=n});d.on("mouseup",function(){e=g;setTimeout(function(){l(g)},0)});d.on("keydown",function(){e=n});d.on("keyup",function(){e=g;setTimeout(function(){l()},0)})}function o(a){var b=a.get("document")[0];u.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function t(a){function l(a){var c=b.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}
function f(a){return c(a)&&j(a)}var d=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,c=b.Walker.whitespaces(g),j=b.Walker.bookmark(n,g),e=function(a){return c(a)&&8!=a.nodeType};a.on("selectionChange",function(c){var j=c.path,m=new v(a.get("document")[0].body),c=(c=c.selection)&&c.getRanges()[0],o=j.blockLimit;if(p.gecko){var q=j.block||j.blockLimit,r=q&&q.last(f);q&&q._4e_isBlockBoundary()&&(!r||!(1==r[0].nodeType&&
r._4e_isBlockBoundary()))&&"pre"!=q.nodeName()&&!q._4e_getBogus()&&q._4e_appendBogus()}if(c&&c.collapsed&&!j.block){if("body"==o.nodeName()){if((j=c.fixBlock(g,"p"))&&j[0]!=m[0].lastChild&&j.outerHtml().match(d))if((o=j.next(e,1))&&o[0].nodeType==k.NodeType.ELEMENT_NODE&&!l[o])c.moveToElementEditablePosition(o),j._4e_remove();else if((o=j.prev(e,1))&&o[0].nodeType==k.NodeType.ELEMENT_NODE&&!l[o])c.moveToElementEditablePosition(o,o.outerHtml().match(d)?n:g),j._4e_remove();c.select();a.notifySelectionChange()}j=
a.get("document")[0];c=new b.Range(j);c.moveToElementEditablePosition(m,g);"body"!==(new b.ElementPath(c.startContainer)).blockLimit.nodeName()&&(m=(new v(j.createElement("p"))).appendTo(m),p.ie||m._4e_appendBogus())}})}var g=!0,n=!1,q=null,p=a.UA,u=a.Event,k=a.DOM,v=a.Node,x=b.SelectionType;return{init:function(a){a.docReady(function(){p.ie?(r(a),m(a)):o(a)});t(a)}}},{requires:["./base","./selection","node"]});
KISSY.add("editor/plugin-meta",function(){(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui","editor/plugin/bold/cmd"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor",
"button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});
a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix"]}});a({"editor/plugin/dent-cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:["json","editor","editor/plugin/local-storage","overlay","editor/plugin/menubutton"]}});a({"editor/plugin/drag-upload":{requires:["editor"]}});
a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor","html-parser"]}});a({"editor/plugin/flash-bridge":{requires:["swf","editor"]}});a({"editor/plugin/flash-common/base-class":{requires:"editor,base,editor/plugin/contextmenu,editor/plugin/bubble,editor/plugin/dialog-loader,editor/plugin/flash-common/utils".split(",")}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class",
"editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]}});a({"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor",
"editor/plugin/font/ui","editor/plugin/font-size/cmd"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/heading":{requires:["editor",
"editor/plugin/heading/cmd"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:["editor","editor/plugin/button","editor/plugin/bubble","editor/plugin/contextmenu","editor/plugin/dialog-loader"]}});a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor","editor/plugin/indent/cmd"]}});a({"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});
a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor","editor/plugin/justify-center/cmd"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor","editor/plugin/justify-left/cmd"]}});a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});
a({"editor/plugin/justify-right":{requires:["editor","editor/plugin/justify-right/cmd"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/link/utils","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/link/utils"]}});a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});
a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor","editor/plugin/maximize/cmd"]}});a({"editor/plugin/maximize/cmd":{requires:["editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/ordered-list":{requires:["editor",
"editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]}});a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor","editor/plugin/outdent/cmd"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay","editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/progressbar":{requires:["base"]}});
a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/remove-format/cmd","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});a({"editor/plugin/resize":{requires:["editor","dd"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/strike-through/cmd"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader","editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor","editor/plugin/font/ui","editor/plugin/underline/cmd"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});
a({"editor/plugin/undo":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils",
"editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["html-parser"]}});a({"editor/plugin/xiami-music":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",
a)},KISSY.Features,KISSY.UA)});
KISSY.add("editor",function(a,b,r,m,o,t,g,n,q,p,u,k){function v(a,b){var d=a.body;L(function(){a.designMode="on";setTimeout(function(){a.designMode="off";d.focus();arguments.callee.retry||(arguments.callee.retry=c)},50)},function(){a.designMode="off";d.setAttribute("contentEditable",!1);d.setAttribute("contentEditable",!0);!b&&v(a,1)})}function x(c){c.get("iframe");var d=c.get("textarea")[0],f=c.get("window"),g=c.get("document"),h=g[0];s.webkit&&(g.on("click",function(c){var d=new b(c.target);a.inArray(d.nodeName(),
["input","select"])&&c.preventDefault()}),g.on("mouseup",function(c){var d=new b(c.target);a.inArray(d.nodeName(),["input","textarea"])&&c.preventDefault()}));if(s.gecko||D||s.opera){var i;i=(new b('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(d);i.on("focus",function(){c.focus()});c.activateGecko=function(){s.gecko&&c.__iframeFocus&&i[0].focus()};c.on("destroy",function(){i.detach();i.remove()})}f.on("focus",function(){s.gecko?v(h,e):s.opera&&
h.body.focus();c.notifySelectionChange()});if(s.gecko)g.on("mousedown",function(){c.__iframeFocus||v(h,e)});if(D&&(g.on("keydown",function(a){if(a.keyCode in{8:1,46:1}){var b=c.getSelection(),d=b.getSelectedElement();if(d){c.execCommand("save");var e=b.getRanges()[0].createBookmark();d.remove();b.selectBookmarks([e]);c.execCommand("save");a.preventDefault()}}}),"CSS1Compat"==h.compatMode)){var j={33:1,34:1};g.on("keydown",function(a){a.keyCode in j&&setTimeout(function(){c.getSelection().scrollIntoView()},
0)})}if(s.webkit)g.on("mousedown",function(d){d=new b(d.target);a.inArray(d.nodeName(),["img","hr","input","textarea","select"])&&c.getSelection().selectElement(d)});if(s.gecko)g.on("dragstart",function(a){var c=new b(a.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&a.preventDefault()});t.add(c)}function i(b,c,d,e){var f="",g;g=o.debugUrl("theme/editor-iframe.css");d=d.concat([]);d.unshift(g);for(g=0;g<d.length;g++)f+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:d[g]});
return a.substitute(r,{doctype:8===y.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"{title}",links:f,style:"<style>"+c+"</style>",data:e||"",script:b?'<script id="ke_active_script">'+(B(h).isCustomDomain()?'document.domain="'+y.domain+'";':"")+'parent.KISSY.require("editor")._initIframe("'+b+'");<\/script>':""})}function l(a,c){function d(){j=h.document;a.setInternal("document",new b(j));a.setInternal("window",new b(h));e.detach();j.open("text/html","replace");j.write(f);
j.close()}var e=a.get("iframe"),f=i(a.get("id"),a.get("customStyle"),a.get("customLink"),c),g=e[0],h=g.contentWindow,j;e.__loaded=1;try{j=h.document}catch(k){if(g.src=g.src,7>D){setTimeout(d,10);return}}d()}function f(c,d){var e=B(h).getEmptyIframeSrc()||"";e&&(e=' src="'+e+'" ');var e=new b(a.substitute(z,{iframeSrc:e,prefixCls:c.get("prefixCls")})),f=c.get("textarea");f.hasAttr("tabindex")&&e.attr("tabindex",s.webkit?-1:f.attr("tabindex"));f.parent().prepend(e);c.set("iframe",e);c.__docReady=0;
if(s.gecko&&!e.__loaded)e.on("load",function(){l(c,d)},c);else l(c,d)}function d(b){if(b.get("iframe")){var c=b.get("iframe"),d=b.get("window"),b=b.get("document"),e=b[0],f=B(e.documentElement),e=B(e.body);a.each([b,f,e,d],function(a){a.detach()});c.remove()}}var c=!0,j=j,e=!1,h=a.Env.host,y=h.document,s=a.UA,D=s.ie,F=b.NodeType,B=b.all,L=o.tryThese,z='<iframe class="{prefixCls}editor-iframe" frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',N=/^(?:<(p)>)?(?:(?:&nbsp;)|\s|<br[^>]*>)*(?:<\/\1>)?$/i;
m.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};m.addMembers({initializer:function(){this.__commands={};this.__controls={};t.register(this)},renderUI:function(){q.init(this);p.init(this);u.init(this);k.init(this)},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form)&&(c=B(c)))c.on("submit",b.sync,b);b.on("docReady",a);b.on("blur",function(){b.$el.removeClass(d+
"editor-focused")});b.on("focus",function(){b.$el.addClass(d+"editor-focused")})},_onSetHeight:function(a){var b=this.get("textarea"),c=this.get("toolBarEl"),d=this.get("statusBarEl"),a=parseInt(a,10),a=a-((c&&c.outerHeight()||0)+(d&&d.outerHeight()||0));b.parent().css("height",a);b.css("height",a)},_onSetMode:function(a){var b=this.get("iframe"),c=this.get("textarea");1==a?(this.setData(c.val()),c.hide(),this.fire("wysiwygMode")):(b&&(c.val(this.getFormatData(1)),b.hide()),c.show(),this.fire("sourceMode"))},
_onSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var b,c=this.get("textarea"),d=this.get("document");this.get("attachForm")&&(b=c[0].form)&&(b=B(b))&&b.detach("submit",this.sync,this);if(d){b=B(d[0].body);var c=B(d[0].documentElement),e=this.get("window");t.remove(this);d.detach();c.detach();b.detach();e.detach()}a.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},
addControl:function(a,b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(b){var c=this.__commands[b],d=a.makeArray(arguments);d.shift();d.unshift(this);if(c)return c.exec.apply(c,d);b+": command not found";return j},queryCommandValue:function(a){return this.execCommand(o.getQueryCmd(a))},
setData:function(a){var b,c=a;if(1!=this.get("mode"))this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a);d(this);f(this,c)}},getData:function(b,c){var d=this.htmlDataProcessor,e;c==j&&(c=this.get("mode"));e=1==c&&this.isDocReady()?this.get("document")[0].body.innerHTML:d.toDataFormat(this.get("textarea").val());e=b?d.toHtml(e):d.toServer(e);e=a.trim(e);N.test(e)&&(e="");return e},getFormatData:function(a){return this.getData(1,a)},getDocHtml:function(){return i(0,this.get("customStyle"),
this.get("customLink"),this.getFormatData())},getSelection:function(){return m.Selection.getSelection(this.get("document")[0])},getSelectedHtml:function(){var a=this.getSelection().getRanges()[0],b="";a&&(a=a.cloneContents(),b=this.get("document")[0].createElement("div"),b.appendChild(a),b=b.innerHTML);return b},focus:function(){var a=this.get("window");if(a){var b=this.get("document")[0],a=a[0];s.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{b.body.focus()}catch(c){}this.notifySelectionChange()}},
blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("window"),d=this.get("customStyle")||"";this.set("customStyle",d+("\n"+a));c&&c.addStyleSheet(c,a,b)},removeCustomStyle:function(a){this.get("document").on("#"+a).remove()},addCustomLink:function(a){var b=this.get("customLink"),c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);
b.href=a},removeCustomLink:function(b){this.get("document").all("link").each(function(a){a.attr("href")==b&&a.remove()});var c=this.get("customLink"),d=a.indexOf(b,c);-1!=d&&c.splice(d,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=
b.getStartElement(),d=new m.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",{selection:b,path:d,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(1!==this.get("mode"))return j;this.focus();var b,d=a.nodeName(),e=m.XHTML_DTD,f=e.$block[d],g=m.RangeType,h=(d=this.getSelection())&&d.getRanges(),i,k,l;if(!h||0==h.length)return j;this.execCommand("save");for(k=
h.length-1;0<=k;k--)i=h[k],b=!k&&a||a.clone(c),i.insertNodeByDtd(b),l||(l=b);if(!l)return j;i.moveToPosition(l,g.POSITION_AFTER_END);f&&(a=m.Walker.whitespaces(!0),(a=(l=l.next(a,1))&&l[0].nodeType==F.ELEMENT_NODE&&l.nodeName())&&e.$block[a]&&e[a]["#text"]&&i.moveToElementEditablePosition(l));d.selectRanges([i]);this.focus();b&&1==b[0].nodeType&&b.scrollIntoView(j,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});I.call(this);return b},insertHtml:function(a,b){var c=this,d,f=c.get("document")[0];
if(1===c.get("mode")){if(d=c.htmlDataProcessor)a=d.toDataFormat(a,b);c.focus();c.execCommand("save");if(D){d=f.selection;"Control"==d.type&&d.clear();try{d.createRange().pasteHTML(a)}catch(g){"insertHtml error in ie"}}else try{f.execCommand("inserthtml",e,a)}catch(h){setTimeout(function(){if(0==c.getSelection().getRanges().length){var b=new m.Range(f),d=B(f.body).first(function(a){return 1==a.nodeType&&"br"!=a.nodeName.toLowerCase()});d||(d=B(f.createElement("p")),d._4e_appendBogus().appendTo(f.body));
b.setStartAt(d,m.RangeType.POSITION_AFTER_START);b.select()}f.execCommand("inserthtml",e,a)},50)}setTimeout(function(){c.getSelection().scrollIntoView()},50);I.call(c)}}});m.decorate=function(a,b){var b=b||{},a=B(a),c=b.textareaAttrs=b.textareaAttrs||{},d=a.style("width"),e=a.style("height"),f=a.attr("name");d&&(b.width=b.width||d);e&&(b.height=b.height||e);f&&(c.name=f);b.data=b.data||a.val();b.elBefore=a;c=(new m(b)).render();a.remove();return c};m._initIframe=function(a){var d=t.getInstance(a),
a=d.get("document"),f=a[0];a.one("#ke_active_script").remove();x(d);var g=f.body,h=B(g);D?(g.hideFocus=c,g.disabled=c,g.contentEditable=c,g.removeAttribute("disabled")):setTimeout(function(){s.gecko||s.opera?g.contentEditable=c:s.webkit?g.parentNode.contentEditable=c:f.designMode="on"},0);if(s.gecko||s.opera){var i=f.documentElement;B(i).on("mousedown",function(a){if(a.target==i){s.gecko&&v(f,e);d.activateGecko()}})}setTimeout(function(){D&&setTimeout(function(){if(f){g.runtimeStyle.marginBottom=
"0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){d.__docReady=1;d.fire("docReady");var a=d.get("disableObjectResizing"),c=d.get("disableInlineTableEditing");if(a||c)try{f.execCommand("enableObjectResizing",e,!a);f.execCommand("enableInlineTableEditing",e,!c)}catch(g){h.on(D?"resizestart":"resize",function(d){var e=new b(d.target);(a||e.nodeName()==="table"&&c)&&d.preventDefault()})}},10)};var I=a.buffer(function(){this.execCommand("save")},50);return m},{requires:"node,editor/iframe-content-tpl,editor/base,editor/utils,editor/focusManager,editor/styles,editor/zIndexManager,editor/clipboard,editor/enterKey,editor/htmlDataProcessor,editor/selectionFix,editor/plugin-meta".split(",")});
