/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 28 15:42
*/
KISSY.add("uri",["path"],function(f,n){function h(a){a._queryMap||(a._queryMap=f.unparam(a._query))}function i(a){this._query=a||""}function j(a,b){return encodeURI(a).replace(b,function(a){a=a.charCodeAt(0).toString(16);return"%"+(1===a.length?"0"+a:a)})}function g(a){if(a instanceof g)return a.clone();var b=this;f.mix(b,{scheme:"",userInfo:"",hostname:"",port:"",path:"",query:"",fragment:""});a=g.getComponents(a);f.each(a,function(a,c){a=a||"";if("query"===c)b.query=new i(a);else{try{a=f.urlDecode(a)}catch(e){}b[c]=
a}});return b}var k=n("path"),l=/[#\/\?@]/g,o=/[#\?]/g,p=/[#@]/g,q=/#/g,r=RegExp("^(?:([\\w\\d+.-]+):)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),m={scheme:1,userInfo:2,hostname:3,port:4,path:5,query:6,fragment:7};i.prototype={constructor:i,clone:function(){return new i(this.toString())},reset:function(a){this._query=a||"";this._queryMap=null;return this},count:function(){var a=0,b,d;h(this);b=this._queryMap;for(d in b)f.isArray(b[d])?
a+=b[d].length:a++;return a},has:function(a){var b;h(this);b=this._queryMap;return a?a in b:!f.isEmptyObject(b)},get:function(a){var b;h(this);b=this._queryMap;return a?b[a]:b},keys:function(){h(this);return f.keys(this._queryMap)},set:function(a,b){var d;h(this);d=this._queryMap;"string"===typeof a?this._queryMap[a]=b:(a instanceof i&&(a=a.get()),f.each(a,function(a,b){d[b]=a}));return this},remove:function(a){h(this);a?delete this._queryMap[a]:this._queryMap={};return this},add:function(a,b){var d,
c;if("string"===typeof a)h(this),d=this._queryMap,c=d[a],c=void 0===c?b:[].concat(c).concat(b),d[a]=c;else for(d in a instanceof i&&(a=a.get()),a)this.add(d,a[d]);return this},toString:function(a){h(this);return f.param(this._queryMap,void 0,void 0,a)}};g.prototype={constructor:g,clone:function(){var a=new g,b=this;f.each(m,function(d,c){a[c]=b[c]});a.query=a.query.clone();return a},resolve:function(a){"string"===typeof a&&(a=new g(a));var b=0,d,c=this.clone();f.each("scheme,userInfo,hostname,port,path,query,fragment".split(","),
function(e){if(e==="path")if(b)c[e]=a[e];else{if(e=a.path){b=1;if(!f.startsWith(e,"/"))if(c.hostname&&!c.path)e="/"+e;else if(c.path){d=c.path.lastIndexOf("/");d!==-1&&(e=c.path.slice(0,d+1)+e)}c.path=k.normalize(e)}}else if(e==="query"){if(b||a.query.toString()){c.query=a.query.clone();b=1}}else if(b||a[e]){c[e]=a[e];b=1}});return c},getScheme:function(){return this.scheme},setScheme:function(a){this.scheme=a;return this},getHostname:function(){return this.hostname},setHostname:function(a){this.hostname=
a;return this},setUserInfo:function(a){this.userInfo=a;return this},getUserInfo:function(){return this.userInfo},setPort:function(a){this.port=a;return this},getPort:function(){return this.port},setPath:function(a){this.path=a;return this},getPath:function(){return this.path},setQuery:function(a){"string"===typeof a&&(f.startsWith(a,"?")&&(a=a.slice(1)),a=new i(j(a,p)));this.query=a;return this},getQuery:function(){return this.query},getFragment:function(){return this.fragment},setFragment:function(a){f.startsWith(a,
"#")&&(a=a.slice(1));this.fragment=a;return this},isSameOriginAs:function(a){return this.hostname.toLowerCase()===a.hostname.toLowerCase()&&this.scheme.toLowerCase()===a.scheme.toLowerCase()&&this.port.toLowerCase()===a.port.toLowerCase()},toString:function(a){var b=[],d,c;if(d=this.scheme)b.push(j(d,l)),b.push(":");if(d=this.hostname){b.push("//");if(c=this.userInfo)b.push(j(c,l)),b.push("@");b.push(encodeURIComponent(d));if(c=this.port)b.push(":"),b.push(c)}if(c=this.path)d&&!f.startsWith(c,"/")&&
(c="/"+c),c=k.normalize(c),b.push(j(c,o));if(a=this.query.toString(a))b.push("?"),b.push(a);if(a=this.fragment)b.push("#"),b.push(j(a,q));return b.join("")}};g.Query=i;g.getComponents=function(a){var b=(a||"").match(r)||[],d={};f.each(m,function(a,e){d[e]=b[a]});return d};return g});
