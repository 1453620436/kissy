/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 25 00:53
*/
KISSY.add("xtemplate/runtime/scope",[],function(l){function k(b,g){this.data=b||{};this.affix=g;this.root=this}k.prototype={isScope:1,setParent:function(b){this.parent=b;this.root=b.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(b,g){this.affix||(this.affix={});this.affix[b]=g},setData:function(b){this.data=b},getData:function(){return this.data},mix:function(b){this.affix||(this.affix={});l.mix(this.affix,b)},has:function(b){var g=this.data,f=this.affix;
return"."===b||"this"===b||f&&b in f?!0:"object"===typeof g&&b in g},get:function(b){var g=this.data,f=this.affix;if("."===b||"this"===b)return this.data;if(f&&b in f)return f[b];if("object"===typeof g&&b in g)return g[b]},resolve:function(b,g){var f=this;if(!g&&"string"!==typeof b&&1===b.length&&f.has(b[0]))return f.get(b[0]);var a=b;"string"===typeof b&&(a=b.split("."));var e,c,d,i,h;if("root"===a[0])a.shift(),f=f.root;else if(g)for(;f&&g--;)f=f.parent;var j=0;for(e=a.length;f;){h=1;d=f;for(c=0;c<
e;c++)if(i=a[c],"this"===i)j=1;else if(d===f){if(!f.has(i)){h=0;break}d=f.get(i)}else{if("object"!==typeof d||!(i in d)){h=0;break}d=d[i]}if(h)return d&&d.isScope&&(d=d.data),"function"===typeof d&&(d=d.call(this.data)),d;if(j)break;f=f.parent}return""}};return k});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(l,k){var b,g=k("./scope");return b={each:function(f,a){var e=a.params,c=e[0],d=e[2]||"xindex",e=e[1],b="",h,j,n;if(c)if(j=new g,l.isArray(c)){h=c.length;for(var o=0;o<h;o++)j.data=c[o],n=j.affix={xcount:h},n[d]=o,e&&(n[e]=c[o]),j.setParent(f),b+=a.fn(j)}else for(h in c)j.data=c[h],n=j.affix={},n[d]=h,e&&(n[e]=c[h]),j.setParent(f),b+=a.fn(j);else a.inverse&&(b=a.inverse(f));return b},"with":function(f,a){var b=a.params[0],c="";b?(b=new g(b),
b.setParent(f),c=a.fn(b)):a.inverse&&(c=a.inverse(f));return c},"if":function(f,a){var b="";a.params[0]?a.fn&&(b=a.fn(f)):a.inverse&&(b=a.inverse(f));return b},set:function(b,a){b.mix(a.hash);return""},include:function(b,a,e){var c=a.params;a.hash&&(a=new g(a.hash),a.setParent(b),b=a);a=this.name;c=c[0];if("."===c.charAt(0)){if("unspecified"===a)return"";var d=c,c=a.split("/"),a=d.split("/");c.pop();for(var d=0,i=a.length;d<i;d++){var h=a[d];"."!==h&&(".."===h?c.pop():c.push(h))}c=c.join("/")}return this.load(c).render(b,
e)},parse:function(f,a){return b.include.call(this,new g,a)},extend:function(b,a,e){e.extendTplName=a.params[0]},block:function(b,a,e){var c=a.params,d=c[0],g;2===c.length&&(g=c[0],d=c[1]);var c=e.blocks=e.blocks||{},h=c[d];g={fn:a.fn,type:g};if(h){if(h.type)if("append"===h.type)g.next=h,c[d]=g;else if("prepend"===h.type){for(var j,a=h;a&&"prepend"===a.type;)j=a,a=a.next;g.next=a;j.next=g}}else c[d]=g;j="";if(!e.extendTplName)for(a=c[d];a;)a.fn&&(j+=a.fn.call(this,b)),a=a.next;return j},macro:function(b,
a,e){var b=a.params,c=b[0],b=b.slice(1),e=e.macros=e.macros||{};if(a.fn)e[c]={paramNames:b,fn:a.fn};else{var a={},c=e[c],d;if(c&&(d=c.paramNames)){for(var e=0,i=d.length;e<i;e++)a[d[e]]=b[e];d=new g(a);return c.fn.call(this,d)}}return""}}});
KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope"],function(l,k){function b(b,a){for(var c in a)b[c]=a[c]}function g(){}function f(a,b){for(var c=b.split("."),d=a,f=c.length,e=0;e<f&&!(d=d[c[e]],!d);e++);return d}function a(a,d){this.tpl=a;if(d&&(d.commands?(this.commands=d.commands,b(this.commands,c)):this.commands=c,d.name&&(this.name=d.name),void 0!==d.silent))this.silent=d.silent}var e=k("./runtime/commands"),c={},d=k("./runtime/scope"),i=l.escapeHtml,h={runBlockCommand:function(a,
b,c,d,e){var h=a.silent?g:l.error,i=a.commands,k=i&&f(i,d);if(!k)if(!c.params&&!c.hash){var m=b.resolve(d);!1===m?(h('can not find property: "'+d+'" at line '+e),m=""):m=m[0];k=i["if"];l.isArray(m)?k=i.each:"object"===typeof m&&(k=i["with"]);c.params=[m]}else return"";var p;try{p=k.call(a,b,c)}catch(q){}return p},renderOutput:function(a,b){void 0===a&&(a="");return b&&a?i(a):a},getProperty:function(a,b,c,d,e){var f,a=a.silent?g:l.error,b=b.resolve(c,d);!1===b?a('can not find property: "'+c+'" at line '+
e,"warn"):f=b[0];return f},runInlineCommand:function(a,b,c,d){var e,g="";var h=a.commands;if(d=h&&f(h,d)){try{e=d.call(a,b,c)}catch(i){}a=!0}else a=!1,e=void 0;a&&(g=e);return g}};l.mix(a,{nativeCommands:e,utils:h,addCommand:function(a,b){c=c||{};c[a]=b},removeCommand:function(a){c&&delete c[a]}});a.prototype={constructor:a,name:"unspecified",silent:!0,commands:c,nativeCommands:e,utils:h,load:function(a){var b=l.require(a);return this.derive(a,b)},derive:function(a,b){var c=new this.constructor(b);
c.name=a;c.commands=this.commands;c.silent=this.silent;return c},removeCommand:function(a){this.commands===c&&(this.commands=b({},this.commands));delete this.commands[a]},addCommand:function(a,d){this.commands===c&&(this.commands=b({},this.commands));this.commands[a]=d},render:function(a,b){var c=a;if(!c||!c.isScope)c=new d(a);b=b||{};b.extendTplName=null;var f=this.tpl(c,l,b),g=b.extendTplName;return g?e.include.call(this,c,{params:[g]},b):f}};a.Scope=d;return a});
