/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 21 02:07
*/
KISSY.add("xtemplate/runtime/scope",[],function(l){function g(a,f){this.data=a||{};this.affix=f;this.root=this}g.prototype={isScope:1,setParent:function(a){this.parent=a;this.root=a.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(a,f){this.affix||(this.affix={});this.affix[a]=f},setData:function(a){this.data=a},getData:function(){return this.data},mix:function(a){this.affix||(this.affix={});l.mix(this.affix,a)},has:function(a){var f=this.data,c=this.affix;
return"this"===a||c&&a in c?!0:"object"===typeof f&&a in f},get:function(a){var f=this.data,c=this.affix;if("this"===a)return this.data;if(c&&a in c)return c[a];if("object"===typeof f&&a in f)return f[a]},resolve:function(a,f){var c=this;if(!f&&"string"!==typeof a&&1===a.length&&c.has(a[0]))return c.get(a[0]);var b=a;"string"===typeof a&&(b=a.split("."));var k,d,e,j,h;if("root"===b[0])b.shift(),c=c.root;else if(f)for(;c&&f--;)c=c.parent;var i=0;for(k=b.length;c;){h=1;e=c;for(d=0;d<k;d++)if(j=b[d],
"this"===j)i=1;else if(e===c)if(c.has(j))e=c.get(j),i=1;else{h=0;break}else{if(null==e||"object"!==typeof e||!(j in e)){h=0;break}e=e[j]}if(h)return e&&e.isScope&&(e=e.data),"function"===typeof e&&(e=e.call(this.data)),e;if(i)break;c=c.parent}}};return g});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(l,g){var a,f=g("./scope");return a={each:function(c,b,a){var d=b.params,e=d[0],j=d[2]||"xindex",d=d[1],h,i,m;if(e)if(l.isArray(e)){h=e.length;i=new f;m=i.affix={xcount:h};for(var n=0;n<h;n++)i.data=e[n],m[j]=n,d&&(m[d]=e[n]),i.setParent(c),a=b.fn(i,a)}else for(h in i=new f,m=i.affix={},e)i.data=e[h],m[j]=h,d&&(m[d]=e[h]),i.setParent(c),a=b.fn(i,a);else b.inverse&&(a=b.inverse(c,a));return a},"with":function(c,b,a){var d=b.params[0];d?(d=
new f(d),d.setParent(c),a=b.fn(d,a)):b.inverse&&(a=b.inverse(c,a));return a},"if":function(c,b,a){b.params[0]?b.fn&&(a=b.fn(c,a)):b.inverse&&(a=b.inverse(c,a));return a},set:function(c,b,a){c.mix(b.hash);return a},include:function(a,b,k,d){var e=b.params;b.hash&&(b=new f(b.hash),b.setParent(a),a=b);b=this.name;e=e[0];if("."===e.charAt(0)){if(!b)return k;var j=e,e=b.split("/"),b=j.split("/");e.pop();for(var j=0,h=b.length;j<h;j++){var i=b[j];"."!==i&&(".."===i?e.pop():e.push(i))}e=e.join("/")}return this.load(e).render(a,
void 0,k,d)},parse:function(c,b,k,d){return a.include.call(this,new f,b,k,d)},extend:function(a,b,f,d){d.extendTplName=b.params[0];return f},block:function(a,b,f,d){var e=b.params,j=e[0],h;2===e.length&&(h=e[0],j=e[1]);var e=d.blocks=d.blocks||{},i=e[j],b={fn:b.fn,type:h};if(i){if(i.type)if("append"===i.type)b.next=i,e[j]=b;else if("prepend"===i.type){var m;for(h=i;h&&"prepend"===h.type;)m=h,h=h.next;b.next=h;m.next=b}}else e[j]=b;if(!d.extendTplName)for(h=e[j];h;)h.fn&&(f=h.fn.call(this,a,f)),h=
h.next;return f},macro:function(a,b,g,d){var a=b.params,e=a[0],a=a.slice(1),d=d.macros=d.macros||{};if(b.fn)d[e]={paramNames:a,fn:b.fn};else{var b={},e=d[e],j;if(e&&(j=e.paramNames)){for(var d=0,h=j.length;d<h;d++)b[j[d]]=a[d];j=new f(b);g=e.fn.call(this,j,g)}}return g}}});
KISSY.add("xtemplate/runtime/linked-buffer",[],function(l){function g(a){this.list=a;this.data=""}function a(a){this.current=this.head=new g(this);this.callback=a;this.data=""}g.prototype={constructor:g,isBuffer:1,write:function(a,c){if(a||0===a)this.data+=c?l.escapeHtml(a):a;return this},async:function(a){var c=this.list,b=new g(c),c=new g(c);c.next=this.next;b.next=c;this.next=b;this.ready=!0;a(b);return c},end:function(a,c){this.write(a,c);this.ready=!0;this.list.flush();return this}};a.prototype=
{constructor:a,flush:function(){for(var a=this.head;a;){if(a.ready)this.data+=a.data;else return;this.head=a=a.next}this.callback(null,this.data)}};a.Buffer=g;return a});
KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(l,g){function a(a,b){this.tpl=a;b=b||{};b.name&&(this.name=b.name);this.config=b}var f=g("./runtime/commands"),c={},b=g("./runtime/scope"),k=g("./runtime/linked-buffer"),d={callCommand:function(a,b,h,d,f){var g=a.config.commands;if(-1===f.indexOf("."))f=g&&g[f]||c[f];else{f=f.split(".");if(g=g&&g[f[0]]||c[f[0]])for(var l=f.length,k=1;k<l&&!(g=g[f[k]],!g);k++);f=g}return f?f.call(a,b,h,d):d}};
l.mix(a,{nativeCommands:f,utils:d,addCommand:function(a,b){c[a]=b},removeCommand:function(a){delete c[a]}});a.prototype={constructor:a,nativeCommands:f,utils:d,load:function(a){var b=new this.constructor(l.require(a),this.config);b.name=a;return b},removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{};c.commands[a]=b},render:function(a,c,d,i){var g=a,n=this.tpl,p=!i;if(!g||!g.isScope)g=new b(a);var o="";d||
(d=(new k(c||function(a,b){o=b})).head);i=i||{};i.extendTplName=null;n.TPL_NAME&&!this.name&&(this.name=n.TPL_NAME);d=n.call(this,g,l,d,i);(a=i.extendTplName)&&f.include.call(this,g,{params:[a]},d,i);return p?(d.end(),o):d}};a.Scope=b;return a});
