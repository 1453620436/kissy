/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 27 22:02
*/
KISSY.add("xtemplate/runtime/scope",[],function(m){function k(b,a){this.data=b||{};this.affix=a;this.root=this}k.prototype={isScope:1,setParent:function(b){this.parent=b;this.root=b.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(b,a){this.affix||(this.affix={});this.affix[b]=a},setData:function(b){this.data=b},getData:function(){return this.data},mix:function(b){this.affix||(this.affix={});m.mix(this.affix,b)},has:function(b){var a=this.data,g=this.affix;
return"this"===b||g&&b in g?!0:"object"===typeof a&&b in a},get:function(b){var a=this.data,g=this.affix;if("this"===b)return this.data;if(g&&b in g)return g[b];if("object"===typeof a&&b in a)return a[b]},resolve:function(b,a){if(!a&&"string"!==typeof b&&1===b.length&&this.has(b[0]))return this.get(b[0]);var g=b;"string"===typeof b&&(g=b.split("."));var c,i,d,e,j,f=this;if("root"===g[0])g.shift(),f=f.root;else if(a)for(;f&&a--;)f=f.parent;var l=0;for(c=g.length;f;){j=1;d=f;for(i=0;i<c;i++)if(e=g[i],
"this"===e)l=1;else if(d===f)if(f.has(e))d=f.get(e),l=1;else{j=0;break}else{if(null==d||"object"!==typeof d||!(e in d)){j=0;break}d=d[e]}if(j)return d&&d.isScope&&(d=d.data),"function"===typeof d&&(d=d.call(this.data)),d;if(l)break;f=f.parent}}};return k});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(m,k){var b=k("./scope"),a={each:function(g,c,i){var d=c.params,a=d[0],j=d[2]||"xindex",d=d[1],f,l,n;if(a)if(m.isArray(a)){f=a.length;l=new b;n=l.affix={xcount:f};for(var h=0;h<f;h++)l.data=a[h],n[j]=h,d&&(n[d]=a[h]),l.setParent(g),i=c.fn(l,i)}else for(f in l=new b,n=l.affix={},a)l.data=a[f],n[j]=f,d&&(n[d]=a[f]),l.setParent(g),i=c.fn(l,i);else c.inverse&&(i=c.inverse(g,i));return i},"with":function(g,c,a){var d=c.params[0];d?(d=new b(d),
d.setParent(g),a=c.fn(d,a)):c.inverse&&(a=c.inverse(g,a));return a},"if":function(a,c,b){c.params[0]?c.fn&&(b=c.fn(a,b)):c.inverse&&(b=c.inverse(a,b));return b},set:function(a,c,b){a.mix(c.hash);return b},include:function(a,c,i,d,e){d=c.params;c.hash&&(c=new b(c.hash),c.setParent(a),a=c);return this.include(d[0],a,i,e)},parse:function(g,c,i,d,e){return a.include.call(this,new b,c,i,e)},extend:function(a,c,b,d,e){e.extendTplName=c.params[0];return b},block:function(a,c,b,d,e){var j=c.params,d=j[0],
f;2===j.length&&(f=j[0],d=j[1]);var j=e.blocks=e.blocks||{},l=j[d],c={fn:c.fn,type:f};if(l){if(l.type)if("append"===l.type)c.next=l,j[d]=c;else if("prepend"===l.type){var n;for(f=l;f&&"prepend"===f.type;)n=f,f=f.next;c.next=f;n.next=c}}else j[d]=c;if(!e.extendTplName)for(f=j[d];f;)f.fn&&(b=f.fn.call(this,a,b)),f=f.next;return b},macro:function(a,c,i,d,e){a=c.params;d=a[0];a=a.slice(1);e=e.macros=e.macros||{};if(c.fn)e[d]={paramNames:a,fn:c.fn};else{var c={},e=e[d],j;if(e&&(j=e.paramNames)){for(var d=
0,f=j.length;d<f;d++)c[j[d]]=a[d];j=new b(c);i=e.fn.call(this,j,i)}}return i}};return a});
KISSY.add("xtemplate/runtime/linked-buffer",[],function(m){function k(a){this.list=a;this.data=""}function b(a){this.head=new k(this);this.callback=a;this.data=""}k.prototype={constructor:k,isBuffer:1,write:function(a,b){if(a||0===a)this.data+=b?m.escapeHtml(a):a;return this},async:function(a){var b=this.list,c=new k(b),b=new k(b);b.next=this.next;c.next=b;this.next=c;this.ready=!0;a(c);return b},end:function(a,b){this.write(a,b);this.ready=!0;this.list.flush();return this}};b.prototype={constructor:b,
flush:function(){for(var a=this.head;a;){if(a.ready)this.data+=a.data;else return;this.head=a=a.next}this.callback(null,this.data)}};b.Buffer=k;return b});
KISSY.add("xtemplate/runtime",["util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(m,k){function b(a,b,c,d){var h=a.tpl,d=d||{};d.extendTplName=null;h.TPL_NAME&&!a.name&&(a.name=h.TPL_NAME);c=h.call(a,b,m,c,d);(h=d.extendTplName)&&(c=a.include(h,b,c,d));return c}function a(a,b){this.tpl=a;b=b||{};b.name&&(this.name=b.name);this.config=b}k("util");var g=k("./runtime/commands"),c={},i=k("./runtime/scope"),d=k("./runtime/linked-buffer"),e={callCommand:function(a,b,d,e,h,
i){var g=a.config.commands;if(-1===h.indexOf("."))h=g&&g[h]||c[h];else{h=h.split(".");if(g=g&&g[h[0]]||c[h[0]])for(var k=h.length,m=1;m<k&&!(g=g[h[m]],!g);m++);h=g}return h?h.call(a,b,d,e,i):e}};m.mix(a,{nativeCommands:g,utils:e,addCommand:function(a,b){c[a]=b},removeCommand:function(a){delete c[a]}});a.prototype={constructor:a,Scope:i,nativeCommands:g,utils:e,load:function(a){var b=new this.constructor(m.require(a),this.config);b.name=a;return b},removeCommand:function(a){var b=this.config;b.commands&&
delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{};c.commands[a]=b},include:function(a,c,d,g){var h=this.name;if("."===a.charAt(0)){if(!h)throw Error("parent template does not have name for relative sub tpl name: "+a);h=h.split("/");a=a.split("/");h.pop();for(var e=0,i=a.length;e<i;e++){var k=a[e];"."!==k&&(".."===k?h.pop():h.push(k))}a=h.join("/")}return b(this.load(a),c,d,g)},render:function(a,c){var e="",c=c||function(a,b){e=b};!this.name&&this.tpl.TPL_NAME&&
(this.name=this.tpl.TPL_NAME);b(this,new i(a),(new d(c)).head).end();return e}};a.Scope=i;return a});
