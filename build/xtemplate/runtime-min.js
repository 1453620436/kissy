/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 19 15:49
*/
KISSY.add("xtemplate/runtime/scope",[],function(k){function l(d,g){this.data=d||{};this.affix=g;this.root=this}l.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(d,g){this.affix||(this.affix={});this.affix[d]=g},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){this.affix||(this.affix={});k.mix(this.affix,d)},has:function(d){var g=this.data,i=this.affix;
return i&&d in i?!0:"object"===typeof g&&d in g},get:function(d){var g=this.data,i=this.affix;if(i&&d in i)return i[d];if("object"===typeof g&&d in g)return g[d]},resolve:function(d,g){"."===d&&(d="this");var i=d.split("."),a=this,b,e,c,f,j;if("root"===i[0])i.shift(),a=a.root;else if(g)for(;a&&g--;)a=a.parent;var h=0;for(b=i.length;a;){j=1;c=a;for(e=0;e<b;e++)if(f=i[e],"this"===f)h=1;else if(c===a){if(!a.has(f)){j=0;break}c=a.get(f)}else{if("object"!==typeof c||!(f in c)){j=0;break}c=c[f]}if(j)return c&&
c.isScope&&(c=c.data),"function"===typeof c&&(c=c.call(this.data)),[c];if(h)break;a=a.parent}return!1}};return l});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(k,l){var d,g=l("./scope");return d={each:function(i,a){var b=a.params,e=b[0],c=b[2]||"xindex",b=b[1],f="",d,h,m;if(e)if(h=new g,k.isArray(e)){d=e.length;for(var n=0;n<d;n++)h.data=e[n],m=h.affix={xcount:d},m[c]=n,b&&(m[b]=e[n]),h.setParent(i),f+=a.fn(h)}else for(d in e)h.data=e[d],m=h.affix={},m[c]=d,b&&(m[b]=e[d]),h.setParent(i),f+=a.fn(h);else a.inverse&&(f=a.inverse(i));return f},"with":function(d,a){var b=a.params[0],e="";b?(b=new g(b),
b.setParent(d),e=a.fn(b)):a.inverse&&(e=a.inverse(d));return e},"if":function(d,a){var b="";a.params[0]?a.fn&&(b=a.fn(d)):a.inverse&&(b=a.inverse(d));return b},set:function(d,a){d.mix(a.hash);return""},include:function(d,a){var b=a.params,e=this.config;if(a.hash){var c=new g(a.hash);c.setParent(d);d=c}c=e.name;b=b[0];if("."===b.charAt(0)){if("unspecified"===c)return"";c=c.split("/");b=b.split("/");c.pop();for(var f=0;f<b.length;f++){var j=b[f];"."!==j&&(".."===j?c.pop():c.push(j))}b=c.join("/")}c=
e.loader.call(this,b);e=k.merge(e);e.name=b;return this.invokeEngine(c,d,e)},parse:function(i,a){return d.include.call(this,new g,a)},extend:function(d,a){this._extendTplName=a.params[0]},block:function(d,a){var b=a.params,e=b[0],c;2===b.length&&(c=b[0],e=b[1]);var b=this.config.blocks,f=b[e],g={fn:a.fn,type:c};if(f){if(f.type)if("append"===f.type)g.next=f,b[e]=g;else if("prepend"===f.type){var h;for(c=f;c&&"prepend"===c.type;)h=c,c=c.next;g.next=c;h.next=g}}else b[e]=g;h="";if(!this._extendTplName)for(c=
b[e];c;)c.fn&&(h+=c.fn.call(this,d)),c=c.next;return h},macro:function(d,a){var b=a.params,e=b[0],c=b.slice(1),b=this.config.macros;if(a.fn)b[e]={paramNames:c,fn:a.fn};else{var f={};if(e=b[e])return k.each(e.paramNames,function(b,d){f[b]=c[d]}),b=new g(f),e.fn.call(this,b)}return""}}});
KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope"],function(k,l){function d(){}function g(b,d){for(var c=d.split("."),a=b,e=c.length,f=0;f<e&&!(a=a[c[f]],!a);f++);return a}function i(b,d,c,a){var e;if(a=g(b.config.commands,a)){try{e=a.call(b,d,c)}catch(f){}return{find:!0,value:e}}return{find:!1}}function a(b,a,c,e,f){var g,b=b.config.silent?d:k.error,a=a.resolve(c,e);!1===a?b('can not find property: "'+c+'" at line '+f,"warn"):g=a[0];return g}function b(b,a){this.tpl=b;a=k.merge(h,
a);a.commands=k.merge(a.commands,e);a.utils=j;a.macros=a.macros||{};a.blocks=a.blocks||{};this.config=a}var e=l("./runtime/commands"),c=l("./runtime/scope"),f=k.escapeHtml,j={runBlockCommand:function(a,b,c,e,f){var h=a.config,i=h.silent?d:k.error,h=h.commands,j=g(h,e);if(!j)if(!c.params&&!c.hash){var l=b.resolve(e);!1===l?(i('can not find property: "'+e+'" at line '+f),l=""):l=l[0];j=h["if"];k.isArray(l)?j=h.each:"object"===typeof l&&(j=h["with"]);c.params=[l]}else return"";var o;try{o=j.call(a,b,
c)}catch(p){}return o},renderOutput:function(a,b){void 0===a&&(a="");return b&&a?f(a):a},getProperty:function(b,c,d,e,f){return a(b,c,d,e,f)},runInlineCommand:function(a,b,c,d,e){var f="",a=i(a,b,c,d,e);a.find&&(f=a.value);return f},getPropertyOrRunCommand:function(b,c,d,e,f,g){var h,j=d.hash||d.params,d=i(b,c,d,e,g,j);d.find?h=d.value:j||(h=a(b,c,e,f,g));return h}},h={silent:!0,name:"unspecified",loader:function(a){return k.require(a)}};k.mix(b,{commands:e,utils:j,addCommand:function(a,b){e[a]=b},
removeCommand:function(a){delete e[a]}});b.prototype={constructor:b,invokeEngine:function(a,b,c){return(new this.constructor(a,c)).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},addCommand:function(a,b){this.config.commands[a]=b},render:function(a){var b=a;if(!b||!b.isScope)b=new c(a);var a=this.tpl(b,k),d=this._extendTplName;return d?e.include.call(this,b,{params:[d]}):a}};b.Scope=c;return b});
