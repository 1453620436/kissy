/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Mar 25 17:46
*/
KISSY.add("xtemplate/runtime/scope",[],function(l){function h(c,a){this.data=c||{};this.affix=a;this.root=this}h.prototype={isScope:1,setParent:function(c){this.parent=c;this.root=c.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(c,a){this.affix||(this.affix={});this.affix[c]=a},setData:function(c){this.data=c},getData:function(){return this.data},mix:function(c){this.affix||(this.affix={});l.mix(this.affix,c)},has:function(c){var a=this.data,e=this.affix;
return"this"===c||e&&c in e?!0:"object"===typeof a&&c in a},get:function(c){var a=this.data,e=this.affix;if("this"===c)return this.data;if(e&&c in e)return e[c];if("object"===typeof a&&c in a)return a[c]},resolve:function(c,a){var e=this;if(!a&&"string"!==typeof c&&1===c.length&&e.has(c[0]))return e.get(c[0]);var b=c;"string"===typeof c&&(b=c.split("."));var k,f,d,i,g;if("root"===b[0])b.shift(),e=e.root;else if(a)for(;e&&a--;)e=e.parent;var j=0;for(k=b.length;e;){g=1;d=e;for(f=0;f<k;f++)if(i=b[f],
"this"===i)j=1;else if(d===e)if(e.has(i))d=e.get(i),j=1;else{g=0;break}else{if(null==d||"object"!==typeof d||!(i in d)){g=0;break}d=d[i]}if(g)return d&&d.isScope&&(d=d.data),"function"===typeof d&&(d=d.call(this.data)),d;if(j)break;e=e.parent}}};return h});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(l,h){var c=h("./scope"),a={each:function(e,b,a){var f=b.params,d=f[0],i=f[2]||"xindex",f=f[1],g,j,m;if(d)if(l.isArray(d)){g=d.length;j=new c;m=j.affix={xcount:g};for(var o=0;o<g;o++)j.data=d[o],m[i]=o,f&&(m[f]=d[o]),j.setParent(e),a=b.fn(j,a)}else for(g in j=new c,m=j.affix={},d)j.data=d[g],m[i]=g,f&&(m[f]=d[g]),j.setParent(e),a=b.fn(j,a);else b.inverse&&(a=b.inverse(e,a));return a},"with":function(e,b,a){var f=b.params[0];f?(f=new c(f),
f.setParent(e),a=b.fn(f,a)):b.inverse&&(a=b.inverse(e,a));return a},"if":function(e,b,a){b.params[0]?b.fn&&(a=b.fn(e,a)):b.inverse&&(a=b.inverse(e,a));return a},set:function(a,b,c){a.mix(b.hash);return c},include:function(a,b,k,f,d){f=b.params;b.hash&&(b=new c(b.hash),b.setParent(a),a=b);return this.include(f[0],a,k,d)},parse:function(e,b,k,f,d){return a.include.call(this,new c,b,k,d)},extend:function(a,b,c,f,d){d.extendTplName=b.params[0];return c},block:function(a,b,c,f,d){var i=b.params,f=i[0],
g;2===i.length&&(g=i[0],f=i[1]);var i=d.blocks=d.blocks||{},j=i[f],b={fn:b.fn,type:g};if(j){if(j.type)if("append"===j.type)b.next=j,i[f]=b;else if("prepend"===j.type){var m;for(g=j;g&&"prepend"===g.type;)m=g,g=g.next;b.next=g;m.next=b}}else i[f]=b;if(!d.extendTplName)for(g=i[f];g;)g.fn&&(c=g.fn.call(this,a,c)),g=g.next;return c},macro:function(a,b,h,f,d){a=b.params;f=a[0];a=a.slice(1);d=d.macros=d.macros||{};if(b.fn)d[f]={paramNames:a,fn:b.fn};else{var b={},d=d[f],i;if(d&&(i=d.paramNames)){for(var f=
0,g=i.length;f<g;f++)b[i[f]]=a[f];i=new c(b);h=d.fn.call(this,i,h)}}return h}};return a});
KISSY.add("xtemplate/runtime/linked-buffer",[],function(l){function h(a){this.list=a;this.data=""}function c(a){this.head=new h(this);this.callback=a;this.data=""}h.prototype={constructor:h,isBuffer:1,write:function(a,c){if(a||0===a)this.data+=c?l.escapeHtml(a):a;return this},async:function(a){var c=this.list,b=new h(c),c=new h(c);c.next=this.next;b.next=c;this.next=b;this.ready=!0;a(b);return c},end:function(a,c){this.write(a,c);this.ready=!0;this.list.flush();return this}};c.prototype={constructor:c,
flush:function(){for(var a=this.head;a;){if(a.ready)this.data+=a.data;else return;this.head=a=a.next}this.callback(null,this.data)}};c.Buffer=h;return c});
KISSY.add("xtemplate/runtime",["util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(l,h){function c(a,c,b,d){var f=a.tpl,d=d||{};d.extendTplName=null;f.TPL_NAME&&!a.name&&(a.name=f.TPL_NAME);b=f.call(a,c,l,b,d);(f=d.extendTplName)&&(b=a.include(f,c,b,d));return b}function a(a,b){this.tpl=a;b=b||{};b.name&&(this.name=b.name);this.config=b}h("util");var e=h("./runtime/commands"),b={},k=h("./runtime/scope"),f=h("./runtime/linked-buffer"),d={callCommand:function(a,c,d,f,e,
h){var n=a.config.commands;if(-1===e.indexOf("."))e=n&&n[e]||b[e];else{e=e.split(".");if(n=n&&n[e[0]]||b[e[0]])for(var k=e.length,l=1;l<k&&!(n=n[e[l]],!n);l++);e=n}return e?e.call(a,c,d,f,h):f}};l.mix(a,{nativeCommands:e,utils:d,addCommand:function(a,c){b[a]=c},removeCommand:function(a){delete b[a]}});a.prototype={constructor:a,Scope:k,nativeCommands:e,utils:d,load:function(a){var b=new this.constructor(l.require(a),this.config);b.name=a;return b},removeCommand:function(a){var b=this.config;b.commands&&
delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{};c.commands[a]=b},include:function(a,b,d,f){var e=this.name;if("."===a.charAt(0)){if(!e)throw Error("parent template does not have name for relative sub tpl name: "+a);e=e.split("/");a=a.split("/");e.pop();for(var h=0,l=a.length;h<l;h++){var k=a[h];"."!==k&&(".."===k?e.pop():e.push(k))}a=e.join("/")}return c(this.load(a),b,d,f)},render:function(a,b){var d="",b=b||function(a,b){d=b};!this.name&&this.tpl.TPL_NAME&&
(this.name=this.tpl.TPL_NAME);c(this,new k(a),(new f(b)).head).end();return d}};a.Scope=k;return a});
