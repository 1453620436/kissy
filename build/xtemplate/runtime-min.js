/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:51
*/
KISSY.add("xtemplate/runtime/commands",["path"],function(i,n){var o,p=n("path");return o={each:function(d,a){var b=a.params[0],c="",e;if(b){var h=[0,0].concat(d);if(i.isArray(b)){e=b.length;for(var g=0;g<e;g++)h[0]=b[g],h[1]={xcount:e,xindex:g},c+=a.fn(h)}else for(e in b)h[0]=b[e],h[1]={xindex:e},c+=a.fn(h)}else a.inverse&&(c=a.inverse(d));return c},"with":function(d,a){var b=a.params[0],c=[0].concat(d),e="";b?(c[0]=b,e=a.fn(c)):a.inverse&&(e=a.inverse(d));return e},"if":function(d,a){var b="";a.params[0]?
a.fn&&(b=a.fn(d)):a.inverse&&(b=a.inverse(d));return b},set:function(d,a){for(var b=d.length-1;0<=b;b--)if("object"==typeof d[b]){i.mix(d[b],a.hash);break}return""},include:function(d,a){var b=a.params,d=(a.hash?[a.hash]:[]).concat(d);if(!b||1!=b.length)return"include must has one param","";var c=this.config.name,b=b[0];if("."==b.charAt(0)){if("unspecified"==c)return"parent template does not have name for relative sub tpl name: "+b,"";b=p.resolve(c,"../",b)}c=this.config.loader.call(this,b);a=i.merge(this.config);
a.name=b;a.commands=this.config.commands;a.macros=this.config.macros;return this.invokeEngine(c,d,a)},macro:function(d,a){var b=a.params,c=b[0],e=b.slice(1),b=this.config.macros;if(a.fn)b[c]||(b[c]={paramNames:e,fn:a.fn});else{var h={},b=b[c];b||(b=i.require(c))||"can not find macro module:"+name;i.each(b.paramNames,function(g,b){h[g]=e[b]});c=d.concat();c.unshift(h);return b.fn.call(this,c)}return""},parse:function(d,a){return o.include.call(this,[],a)}}});
KISSY.add("xtemplate/runtime",["./runtime/commands"],function(i,n){function o(g){g}function p(g,b){for(var a=b.split("."),c=g,d=a.length,f=0;f<d&&!(c=c[a[f]],!c);f++);return c}function d(g,b,a){"."===g&&(g="this");var g=g.split("."),c=g.length,d=a||0,f,e,i,j=b.length;"root"==g[0]&&(d=j-1,g.shift(),c--);for(;d<j;d++){f=b[d];i=1;for(a=0;a<c;a++)if(e=g[a],"this"!==e){if("object"!=typeof f||!(e in f)){i=0;break}f=f[e]}if(i)return"function"==typeof f&&(f=f.call(b[0])),[f]}return!1}function a(g,a){this.tpl=
g;a=i.merge(h,a);a.commands=i.merge(a.commands,b);a.utils=e;a.macros=a.macros||{};this.config=a}var b=n("./runtime/commands"),c=i.escapeHtml,e={runBlockCommand:function(a,b,c,e,h){var f=a.config,k=f.silent?o:i.error,l=f.commands,f=p(l,e);if(!f)if(!c.params&&!c.hash){var j=d(e,b);!1===j?(k("can not find property: '"+e+"' at line "+h),j=""):j=j[0];f=l["if"];i.isArray(j)?f=l.each:"object"==typeof j&&(f=l["with"]);c.params=[j]}else return"can not find command module: "+e+"' at line "+h,"";k="";try{k=
f.call(a,b,c)}catch(m){m.message+": '"+e+"' at line "+h}void 0===k&&(k="");return k},getExpression:function(a,b){void 0===a&&(a="");return b&&a?c(a):a},getPropertyOrRunCommand:function(a,b,e,h,n,f,k,l){var j,m=a.config,q=p(m.commands,h),m=m.silent?o:i.error;if(q)try{j=q.call(a,b,e)}catch(r){return r.message+": '"+h+"' at line "+f,""}else{a=d(h,b,n);if(!1===a)return m("can not find property: '"+h+"' at line "+f,"warn"),l?void 0:"";j=a[0]}!l&&void 0===j&&(j="");return k&&j?c(j):j}},h={silent:!0,name:"unspecified",
loader:function(a){var b=i.require(a);b||'template "'+a+'" does not exist, need to be required or used first!';return b}};i.mix(a,{commands:b,utils:e,addCommand:function(a,c){b[a]=c},removeCommand:function(a){delete b[a]}});a.prototype={constructor:a,invokeEngine:function(a,b,c){return(new this.constructor(a,c)).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},addCommand:function(a,b){this.config.commands[a]=b},render:function(a,b){b||(a=[a]);return this.tpl(a,i)}};return a});
