/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Apr 3 18:21
*/
KISSY.add("xtemplate/runtime/scope",[],function(j){function h(d,e){this.data=d||{};this.affix=e;this.root=this}h.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},set:function(d,e){this.affix||(this.affix={});this.affix[d]=e},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){this.affix||(this.affix={});j.mix(this.affix,d)},get:function(d){var e=this.data,b=e[d];if(void 0!==b)return b;var a=this.affix;return a&&d in a?a[d]:"this"===d?e:"root"===
d?this.root.data:b},resolve:function(d,e){if(!e&&1===d.length)return this.get(d[0]);var b,a,c;a=this;if("root"===d[0])d.shift(),a=a.root;else if(e)for(;a&&e--;)a=a.parent;b=d.length;var g=d[0];do c=a.get(g);while(void 0===c&&(a=a.parent));if(c&&a){for(a=1;c&&a<b;a++)c=c[d[a]];"function"===typeof c&&(c=c.call(this.data));return c}}};return h});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(j,h){var d=h("./scope"),e={each:function(b,a,c){var g=a.params,f=g[0],e=g[2]||"xindex",g=g[1],i,k,l;if(f)if(j.isArray(f)){i=f.length;k=new d;l=k.affix={xcount:i};for(var m=0;m<i;m++)k.data=f[m],l[e]=m,g&&(l[g]=f[m]),k.setParent(b),c=a.fn(k,c)}else for(i in k=new d,l=k.affix={},f)k.data=f[i],l[e]=i,g&&(l[g]=f[i]),k.setParent(b),c=a.fn(k,c);else a.inverse&&(c=a.inverse(b,c));return c},"with":function(b,a,c){var g=a.params[0];g?(g=new d(g),
g.setParent(b),c=a.fn(g,c)):a.inverse&&(c=a.inverse(b,c));return c},"if":function(b,a,c){a.params[0]?a.fn&&(c=a.fn(b,c)):a.inverse&&(c=a.inverse(b,c));return c},set:function(b,a,c){b.mix(a.hash);return c},include:function(b,a,c,g,f){g=a.params;a.hash&&(a=new d(a.hash),a.setParent(b),b=a);return this.include(g[0],b,c,f)},parse:function(b,a,c,g,f){return e.include.call(this,new d,a,c,f)},extend:function(b,a,c,g,d){d.extendTplName=a.params[0];return c},block:function(b,a,c,d,f){var e=a.params,d=e[0],
i;2===e.length&&(i=e[0],d=e[1]);var e=f.blocks=f.blocks||{},k=e[d],a={fn:a.fn,type:i};if(k){if(k.type)if("append"===k.type)a.next=k,e[d]=a;else if("prepend"===k.type){var l;for(i=k;i&&"prepend"===i.type;)l=i,i=i.next;a.next=i;l.next=a}}else e[d]=a;if(!f.extendTplName)for(i=e[d];i;)i.fn&&(c=i.fn.call(this,b,c)),i=i.next;return c},macro:function(b,a,c,e,f){b=a.params;e=b[0];b=b.slice(1);f=f.macros=f.macros||{};if(a.fn)f[e]={paramNames:b,fn:a.fn};else{var a={},f=f[e],h;if(f&&(h=f.paramNames)){for(var e=
0,i=h.length;e<i;e++)a[h[e]]=b[e];h=new d(a);c=f.fn.call(this,h,c)}}return c}};return e});
KISSY.add("xtemplate/runtime/linked-buffer",[],function(j,h){function d(b){this.list=b;this.data=""}function e(b){this.head=new d(this);this.callback=b;this.data=""}d.prototype={constructor:d,isBuffer:1,write:function(b,a){if(b||0===b)this.data+=a?j.escapeHtml(b):b;return this},async:function(b){var a=this.list,c=new d(a),a=new d(a);a.next=this.next;c.next=a;this.next=c;this.ready=!0;b(c);return a},error:function(b){var a=this.list.callback;a&&(a(b,h),this.list.callback=null)},end:function(b,a){this.list.callback&&
(this.write(b,a),this.ready=!0,this.list.flush());return this}};e.prototype={constructor:e,flush:function(){for(var b=this.head;b;){if(b.ready)this.data+=b.data;else return;this.head=b=b.next}this.callback(null,this.data)}};e.Buffer=d;return e});
KISSY.add("xtemplate/runtime",["util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(j,h){function d(a,b){var c=a.split("/"),d=b.split("/");c.pop();for(var e=0,f=d.length;e<f;e++){var g=d[e];"."!==g&&(".."===g?c.pop():c.push(g))}return c.join("/")}function e(a,b,c,d){var e=a.tpl,d=d||{};d.extendTplName=null;e.TPL_NAME&&!a.name&&(a.name=e.TPL_NAME);c=e.call(a,b,j,c,d);(e=d.extendTplName)&&(c=a.include(e,b,c,d));return c.end()}function b(a,b){this.tpl=a;b=b||{};b.name&&(this.name=
b.name);this.config=b}h("util");var a=h("./runtime/commands"),c={},g=h("./runtime/scope"),f=h("./runtime/linked-buffer"),o={callCommand:function(a,b,d,e,f,g){var h=a.config.commands;if(-1===f.indexOf("."))f=h&&h[f]||c[f];else{f=f.split(".");if(h=h&&h[f[0]]||c[f[0]])for(var j=f.length,n=1;n<j&&!(h=h[f[n]],!h);n++);f=h}return f?f.call(a,b,d,e,g):e}};j.mix(b,{nativeCommands:a,utils:o,addCommand:function(a,b){c[a]=b},removeCommand:function(a){delete c[a]}});b.prototype={constructor:b,Scope:g,nativeCommands:a,
utils:o,load:function(a,b){var c=j.require(a);c?b(void 0,c):b('template "'+a+'" does not exist, better required or used first for performance!',void 0)},removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{};c.commands[a]=b},include:function(a,c,f,g){var h=this,j=h.name;if("."===a.charAt(0)){if(!j)throw Error("parent template does not have name for relative sub tpl name: "+a);a=d(j,a)}return f.async(function(d){h.load(a,
function(f,j){f?d.error(f):(j instanceof b||(j=new h.constructor(j,h.config),j.name=a),e(j,c,d,g))})})},render:function(a,b){var c="",b=b||function(a,b){c=b};!this.name&&this.tpl.TPL_NAME&&(this.name=this.tpl.TPL_NAME);e(this,new g(a),(new f(b)).head);return c}};b.Scope=g;return b});
