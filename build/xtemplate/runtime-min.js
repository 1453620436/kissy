/*
Copyright 2014, KISSY v1.50
MIT Licensed
build time: Feb 18 12:51
*/
KISSY.add("xtemplate/runtime/scope",[],function(k){function l(d,g){this.data=d||{};this.affix=g;this.root=this}l.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(d,g){this.affix||(this.affix={});this.affix[d]=g},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){this.affix||(this.affix={});k.mix(this.affix,d)},has:function(d){var g=this.data,e=this.affix;
return e&&d in e?!0:"object"===typeof g&&d in g},get:function(d){var g=this.data,e=this.affix;if(e&&d in e)return e[d];if("object"===typeof g&&d in g)return g[d]},resolve:function(d,g){"."===d&&(d="this");var e=d.split("."),a=this,b,c,f,h,j;if("root"===e[0])e.shift(),a=a.root;else if(g)for(;a&&g--;)a=a.parent;var i=0;for(b=e.length;a;){j=1;f=a;for(c=0;c<b;c++)if(h=e[c],"this"===h)i=1;else if(f===a){if(!a.has(h)){j=0;break}f=a.get(h)}else{if("object"!==typeof f||!(h in f)){j=0;break}f=f[h]}if(j)return f&&
f.isScope&&(f=f.data),"function"===typeof f&&(f=f.call(this.data)),[f];if(i)break;a=a.parent}return!1}};return l});
KISSY.add("xtemplate/runtime/commands",["./scope"],function(k,l){var d,g=l("./scope");return d={each:function(e,a){var b=a.params,c=b[0],d=b[2]||"xindex",b=b[1],h="",j,i,m;if(c)if(i=new g,k.isArray(c)){j=c.length;for(var n=0;n<j;n++)i.data=c[n],m=i.affix={xcount:j},m[d]=n,b&&(m[b]=c[n]),i.setParent(e),h+=a.fn(i)}else for(j in c)i.data=c[j],m=i.affix={},m[d]=j,b&&(m[b]=c[j]),i.setParent(e),h+=a.fn(i);else a.inverse&&(h=a.inverse(e));return h},"with":function(e,a){var b=a.params[0],c="";b?(b=new g(b),
b.setParent(e),c=a.fn(b)):a.inverse&&(c=a.inverse(e));return c},"if":function(e,a){var b="";a.params[0]?a.fn&&(b=a.fn(e)):a.inverse&&(b=a.inverse(e));return b},set:function(e,a){e.mix(a.hash);return""},include:function(e,a){var b=a.params;if(!b||1!==b.length)return"";if(a.hash){var c=new g(a.hash);c.setParent(e);e=c}c=this.config.name;b=b[0];if("."===b.charAt(0)){if("unspecified"===c)return"";c=c.split("/");b=b.split("/");c.pop();for(var d=0;d<b.length;d++){var h=b[d];"."!==h&&(".."===h?c.pop():c.push(h))}b=
c.join("/")}c=this.config.loader.call(this,b);a=k.merge(this.config);a.name=b;a.commands=this.config.commands;a.macros=this.config.macros;return this.invokeEngine(c,e,a)},macro:function(d,a){var b=a.params,c=b[0],f=b.slice(1),b=this.config.macros;if(a.fn)b[c]||(b[c]={paramNames:f,fn:a.fn});else{var h={};if(c=b[c])return k.each(c.paramNames,function(b,a){h[b]=f[a]}),b=new g(h),b.setParent(d),c.fn.call(this,b)}return""},parse:function(e,a){return d.include.call(this,new g,a)}}});
KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope"],function(k,l){function d(){}function g(b,a){for(var c=a.split("."),d=b,e=c.length,g=0;g<e&&!(d=d[c[g]],!d);g++);return d}function e(b,a,c,d){var e;if(d=g(b.config.commands,d)){try{e=d.call(b,a,c)}catch(h){}return{find:!0,value:e}}return{find:!1}}function a(b,a,c,e,g){var h,b=b.config.silent?d:k.error,a=a.resolve(c,e);!1===a?b('can not find property: "'+c+'" at line '+g,"warn"):h=a[0];return h}function b(b,a){this.tpl=b;a=k.merge(i,
a);a.commands=k.merge(a.commands,c);a.utils=j;a.macros=a.macros||{};this.config=a}var c=l("./runtime/commands"),f=l("./runtime/scope"),h=k.escapeHtml,j={runBlockCommand:function(a,b,c,e,h){var f=a.config,j=f.silent?d:k.error,f=f.commands,i=g(f,e);if(!i)if(!c.params&&!c.hash){var l=b.resolve(e);!1===l?(j('can not find property: "'+e+'" at line '+h),l=""):l=l[0];i=f["if"];k.isArray(l)?i=f.each:"object"===typeof l&&(i=f["with"]);c.params=[l]}else return"";var o;try{o=i.call(a,b,c)}catch(p){}return o},
renderOutput:function(a,b){void 0===a&&(a="");return b&&a?h(a):a},getProperty:function(b,c,d,e,f){return a(b,c,d,e,f)},runInlineCommand:function(a,b,c,d,f){var g="",a=e(a,b,c,d,f);a.find&&(g=a.value);return g},getPropertyOrRunCommand:function(b,c,d,f,g,h){var i,j=d.hash||d.params,d=e(b,c,d,f,h,j);d.find?i=d.value:j||(i=a(b,c,f,g,h));return i}},i={silent:!0,name:"unspecified",loader:function(a){return k.require(a)}};k.mix(b,{commands:c,utils:j,addCommand:function(a,b){c[a]=b},removeCommand:function(a){delete c[a]}});
b.prototype={constructor:b,invokeEngine:function(a,b,c){return(new this.constructor(a,c)).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},addCommand:function(a,b){this.config.commands[a]=b},render:function(a){var b=a;if(!b||!b.isScope)b=new f(a);return this.tpl(b,k)}};b.Scope=f;return b});
