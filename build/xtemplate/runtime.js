/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 1 15:53
*/
KISSY.add("xtemplate/runtime",["util","logger-manager","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(p,h,n,l){function j(a,g,b){var b=a.fn(g,b),f=a.runtime.extendTplName;f&&(delete a.runtime.extendTplName,b=a.root.include(f,a,g,null,b));return b.end()}function i(a,g,f,d,e,c,j,i){var k;if(!c){k=a.runtime.commands;var h=a.root.config.commands,m=e[0];k=k&&k[m]||h&&h[m]||b[m];if(1!==e.length&&k){h=e.length;for(m=1;m<h&&!(k=k[e[m]],!k);m++);}}if(k)return k.call(a,g,f,d,j);
e.join(".");return i&&(a=g.resolve(e.slice(0,-1),c),e=a[e[e.length-1]])?e.apply(a,f.params):d}function c(a,g){this.fn=a;g=this.config=g||{};g.loader=g.loader||e;this.subNameResolveCache={}}p=h("util");h("logger-manager");var n=h("./runtime/commands"),b={},a=h("./runtime/scope"),f=h("./runtime/linked-buffer"),d={callFn:function(a,g,b,f,d,e,c){return i(a,g,b,f,d,e,c,!0)},callCommand:function(a,g,b,f,d,e){return i(a,g,b,f,d,0,e,!0)}},e={load:function(a,b){h([a.name],{success:function(a){b(void 0,a)},
error:function(){b('template "'+a.name+'" does not exist')}})}};p.mix(c,{nativeCommands:n,utils:d,addCommand:function(a,g){b[a]=g},removeCommand:function(a){delete b[a]}});c.prototype={constructor:c,Scope:a,nativeCommands:n,utils:d,removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var f=this.config;f.commands=f.commands||{};f.commands[a]=b},resolve:function(a,b){if("."!==a.charAt(0))return a;var f=this.subNameResolveCache[b]=this.subNameResolveCache[b]||
{};if(f[a])return f[a];var d=a,e,c=a;e=b.split("/");c=c.split("/");e.pop();for(var j=0,i=c.length;j<i;j++){var k=c[j];"."!==k&&(".."===k?e.pop():e.push(k))}e=e.join("/");return a=f[d]=e},include:function(a,b,f,e,d){var c=this,i=b.name,h=c.resolve(a,i);return d.async(function(d){c.config.loader.load({root:c,parentName:i,originalName:a,name:h,scope:f,option:e},function(a,c){a?d.error(a):"string"===typeof c?d.write(c,e&&e.escape).end():j({root:b.root,fn:c,name:h,runtime:b.runtime},f,d)})})},render:function(b,
d,e){var c="",i=this.fn;"function"===typeof d&&(e=d,d=null);var d=d||{},e=e||function(a,b){if(a){a instanceof Error||(a=Error(a));throw a;}c=b},h=this.config.name;!h&&i.TPL_NAME&&(h=i.TPL_NAME);b=new a(b);e=(new f(e)).head;j({name:h,fn:i,runtime:{commands:d.commands},root:this},b,e);return c}};c.Scope=a;l.exports=c});
KISSY.add("xtemplate/runtime/commands",["./scope","util"],function(p,h,n,l){var j=h("./scope"),i=h("util"),c={range:function(b,a){var f=a.params,d=f[0],e=f[1];if(f=f[2]){if(d>e&&0<f||d<e&&0>f)f=-f}else f=d>e?-1:1;for(var c=[],g=d;d<e?g<e:g>e;g+=f)c.push(g);return c},each:function(b,a,f){var d=a.params,e=d[0],c=d[2]||"xindex",d=d[1],g,h,o;if(e)if(i.isArray(e)){g=e.length;for(var l=0;l<g;l++)h=new j(e[l]),o=h.affix={xcount:g},o[c]=l,d&&(o[d]=e[l]),h.setParent(b),f=a.fn(h,f)}else for(g in e)h=new j(e[g]),
o=h.affix={},o[c]=g,d&&(o[d]=e[g]),h.setParent(b),f=a.fn(h,f);return f},"with":function(b,a,f){var d=a.params[0];d&&(d=new j(d),d.setParent(b),f=a.fn(d,f));return f},"if":function(b,a,f){a.params[0]?a.fn&&(f=a.fn(b,f)):a.inverse&&(f=a.inverse(b,f));return f},set:function(b,a,f){b.mix(a.hash);return f},include:function(b,a,f){var d=a.params,e,c=d.length;e=b;a.hash&&(e=new j(a.hash),e.setParent(b));for(b=0;b<c;b++)f=this.root.include(d[b],this,e,a,f);return f},parse:function(b,a,f){return c.include.call(this,
new j,a,f)},extend:function(b,a,f){this.runtime.extendTplName=a.params[0];return f},block:function(b,a,f){var d=this.runtime,e=a.params,c=e[0],g;2===e.length&&(g=e[0],c=e[1]);var e=d.blocks=d.blocks||{},h=e[c],a={fn:a.fn,type:g};if(h){if(h.type)if("append"===h.type)a.next=h,e[c]=a;else if("prepend"===h.type){var i;for(g=h;g&&"prepend"===g.type;)i=g,g=g.next;a.next=g;i.next=a}}else e[c]=a;if(!d.extendTplName)for(g=e[c];g;)g.fn&&(f=g.fn.call(this,b,f)),g=g.next;return f},macro:function(b,a,f,d){var b=
a.hash,e=a.params,c=e[0],e=e.slice(1),g=this.runtime,g=g.macros=g.macros||{};if(a.fn)g[c]={paramNames:e,hash:b,fn:a.fn};else{var a=g[c],c=a.hash||{},h;if(a&&(h=a.paramNames)){d=0;for(g=h.length;d<g;d++)c[h[d]]=e[d];if(b)for(var i in b)c[i]=b[i];h=new j(c);f=a.fn.call(this,h,f)}else throw Error("in file: "+this.name+" can not find macro: "+name+'" at line '+d);}return f}};l.exports=c});
KISSY.add("xtemplate/runtime/scope",[],function(p,h,n,l){function j(c){this.data=arguments.length?c:{};this.affix=i;this.root=this}var i;j.prototype={isScope:1,setParent:function(c){this.parent=c;this.root=c.root},set:function(c,b){this.affix||(this.affix={});this.affix[c]=b},setData:function(c){this.data=c},getData:function(){return this.data},mix:function(c){var b=this.affix;b||(b=this.affix={});for(var a in c)b[a]=c[a]},get:function(c){var b=this.data,a;a=(a=this.affix)&&a[c];if(a!==i)return a;
b!==i&&(a=b[c]);return a!==i?a:"this"===c?b:"root"===c?this.root.data:a},resolve:function(c,b){var a;if(!b&&1===c.length){a=this.get(c[0]);if(a!==i)return a;b=1}var f=c.length,d=this;if(f&&"root"===c[0])c.shift(),d=d.root,f--;else if(b)for(;d&&b--;)d=d.parent;if(!d)return i;if(!f)return d.data;var e=c[0];do a=d.get(e);while(a===i&&(d=d.parent));if(a&&d){for(d=1;a&&d<f;d++)a=a[c[d]];return a}return i}};l.exports=j});
KISSY.add("xtemplate/runtime/linked-buffer",["util"],function(p,h,n,l){function j(b){this.list=b;this.data=""}function i(b){this.head=new j(this);this.callback=b;this.data=""}var c=h("util");j.prototype={constructor:j,isBuffer:1,write:function(b,a){if(b||0===b)this.data+=a?c.escapeHtml(b):b;return this},async:function(b){var a=this.list,c=new j(a),a=new j(a);a.next=this.next;c.next=a;this.next=c;this.ready=!0;b(c);return a},error:function(b){var a=this.list.callback;a&&(a(b,void 0),this.list.callback=
null)},end:function(b,a){this.list.callback&&(this.write(b,a),this.ready=!0,this.list.flush());return this}};i.prototype={constructor:i,flush:function(){for(var b=this.head;b;){if(b.ready)this.data+=b.data;else return;this.head=b=b.next}this.callback(null,this.data)}};i.Buffer=j;l.exports=i});
