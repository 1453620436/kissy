/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 20 16:50
*/
KISSY.add("xtemplate/runtime",["util","logger-manager","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(n,h,m,k){function j(a,g,b){var c=a.fn;if(c.version&&KISSY.version!==c.version)throw Error("current xtemplate file("+a.name+")(v"+c.version+")need to be recompiled using current kissy(v"+KISSY.version+")!");b=a.fn(g,b);if(c=a.runtime.extendTplName)delete a.runtime.extendTplName,b=a.root.include(c,a,g,null,b);return b.end()}function i(a,g,c,e,f,d,j,i){var l;if(!d){l=a.runtime.commands;
var h=a.root.config.commands,k=f[0];l=l&&l[k]||h&&h[k]||b[k];if(1!==f.length&&l){h=f.length;for(k=1;k<h&&!(l=l[f[k]],!l);k++);}}if(l)return l.call(a,g,c,e,j);f.join(".");return i&&(a=g.resolve(f.slice(0,-1),d),f=a[f[f.length-1]])?f.apply(a,c.params):e}function d(a,g){this.fn=a;g=this.config=g||{};g.loader=g.loader||f;this.subNameResolveCache={}}n=h("util");h("logger-manager");var m=h("./runtime/commands"),b={},a=h("./runtime/scope"),c=h("./runtime/linked-buffer"),e={callFn:function(a,g,b,c,e,f,d){return i(a,
g,b,c,e,f,d,!0)},callCommand:function(a,g,b,c,e,f){return i(a,g,b,c,e,0,f,!0)}},f={load:function(a,b){h([a.name],{success:function(a){b(void 0,a)},error:function(){b('template "'+a.name+'" does not exist')}})}};n.mix(d,{nativeCommands:m,utils:e,addCommand:function(a,g){b[a]=g},removeCommand:function(a){delete b[a]}});d.prototype={constructor:d,Scope:a,nativeCommands:m,utils:e,removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=
c.commands||{};c.commands[a]=b},resolve:function(a,b){if("."!==a.charAt(0))return a;var c=this.subNameResolveCache[b]=this.subNameResolveCache[b]||{};if(c[a])return c[a];var e=a,f,d=a;f=b.split("/");d=d.split("/");f.pop();for(var j=0,i=d.length;j<i;j++){var l=d[j];"."!==l&&(".."===l?f.pop():f.push(l))}f=f.join("/");return a=c[e]=f},include:function(a,b,c,f,e){var d=this,a=d.resolve(a,b.name);return e.async(function(e){d.config.loader.load({template:d,name:a,scope:c,option:f},function(d,i){d?e.error(d):
"string"===typeof i?e.write(i,f&&f.escape).end():j({root:b.root,fn:i,name:a,runtime:b.runtime},c,e)})})},render:function(b,e,f){var d="",i=this.fn;"function"===typeof e&&(f=e,e=null);var e=e||{},f=f||function(a,b){if(a){a instanceof Error||(a=Error(a));throw a;}d=b},h=this.config.name;!h&&i.TPL_NAME&&(h=i.TPL_NAME);b=new a(b);f=(new c(f)).head;j({name:h,fn:i,runtime:{commands:e.commands},root:this},b,f);return d}};d.Scope=a;k.exports=d});
KISSY.add("xtemplate/runtime/commands",["./scope","util"],function(n,h,m,k){var j=h("./scope"),i=h("util"),d={range:function(b,a){var c=a.params,e=c[0],f=c[1];if(c=c[2]){if(e>f&&0<c||e<f&&0>c)c=-c}else c=e>f?-1:1;for(var d=[],g=e;e<f?g<f:g>f;g+=c)d.push(g);return d},each:function(b,a,c){var e=a.params,f=e[0],d=e[2]||"xindex",e=e[1],g,h,k;if(f)if(i.isArray(f)){g=f.length;for(var m=0;m<g;m++)h=new j(f[m]),k=h.affix={xcount:g},k[d]=m,e&&(k[e]=f[m]),h.setParent(b),c=a.fn(h,c)}else for(g in f)h=new j(f[g]),
k=h.affix={},k[d]=g,e&&(k[e]=f[g]),h.setParent(b),c=a.fn(h,c);return c},"with":function(b,a,c){var e=a.params[0];e&&(e=new j(e),e.setParent(b),c=a.fn(e,c));return c},"if":function(b,a,c){a.params[0]?a.fn&&(c=a.fn(b,c)):a.inverse&&(c=a.inverse(b,c));return c},set:function(b,a,c){b.mix(a.hash);return c},include:function(b,a,c){var e=a.params,f,d=e.length;f=b;a.hash&&(f=new j(a.hash),f.setParent(b));for(b=0;b<d;b++)c=this.root.include(e[b],this,f,a,c);return c},parse:function(b,a,c){return d.include.call(this,
new j,a,c)},extend:function(b,a,c){this.runtime.extendTplName=a.params[0];return c},block:function(b,a,c){var e=this.runtime,f=a.params,d=f[0],g;2===f.length&&(g=f[0],d=f[1]);var f=e.blocks=e.blocks||{},h=f[d],a={fn:a.fn,type:g};if(h){if(h.type)if("append"===h.type)a.next=h,f[d]=a;else if("prepend"===h.type){var i;for(g=h;g&&"prepend"===g.type;)i=g,g=g.next;a.next=g;i.next=a}}else f[d]=a;if(!e.extendTplName)for(g=f[d];g;)g.fn&&(c=g.fn.call(this,b,c)),g=g.next;return c},macro:function(b,a,c,e){var b=
a.hash,f=a.params,d=f[0],f=f.slice(1),g=this.runtime,g=g.macros=g.macros||{};if(a.fn)g[d]={paramNames:f,hash:b,fn:a.fn};else{var a=g[d],d=a.hash||{},h;if(a&&(h=a.paramNames)){e=0;for(g=h.length;e<g;e++)d[h[e]]=f[e];if(b)for(var i in b)d[i]=b[i];h=new j(d);c=a.fn.call(this,h,c)}else throw Error("in file: "+this.name+" can not find macro: "+name+'" at line '+e);}return c}};k.exports=d});
KISSY.add("xtemplate/runtime/scope",[],function(n,h,m,k){function j(d){this.data=arguments.length?d:{};this.affix=i;this.root=this}var i;j.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},set:function(d,b){this.affix||(this.affix={});this.affix[d]=b},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){var b=this.affix;b||(b=this.affix={});for(var a in d)b[a]=d[a]},get:function(d){var b=this.data,a;a=(a=this.affix)&&a[d];if(a!==i)return a;
b!==i&&(a=b[d]);return a!==i?a:"this"===d?b:"root"===d?this.root.data:a},resolve:function(d,b){var a;if(!b&&1===d.length){a=this.get(d[0]);if(a!==i)return a;b=1}var c=d.length,e=this;if(c&&"root"===d[0])d.shift(),e=e.root,c--;else if(b)for(;e&&b--;)e=e.parent;if(!e)return i;if(!c)return e.data;var f=d[0];do a=e.get(f);while(a===i&&(e=e.parent));if(a&&e){for(e=1;a&&e<c;e++)a=a[d[e]];return a}return i}};k.exports=j});
KISSY.add("xtemplate/runtime/linked-buffer",["util"],function(n,h,m,k){function j(b){this.list=b;this.data=""}function i(b){this.head=new j(this);this.callback=b;this.data=""}var d=h("util");j.prototype={constructor:j,isBuffer:1,write:function(b,a){if(b||0===b)this.data+=a?d.escapeHtml(b):b;return this},async:function(b){var a=this.list,c=new j(a),a=new j(a);a.next=this.next;c.next=a;this.next=c;this.ready=!0;b(c);return a},error:function(b){var a=this.list.callback;a&&(a(b,void 0),this.list.callback=
null)},end:function(b,a){this.list.callback&&(this.write(b,a),this.ready=!0,this.list.flush());return this}};i.prototype={constructor:i,flush:function(){for(var b=this.head;b;){if(b.ready)this.data+=b.data;else return;this.head=b=b.next}this.callback(null,this.data)}};i.Buffer=j;k.exports=i});
