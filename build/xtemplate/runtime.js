/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jun 18 13:23
*/
KISSY.add("xtemplate/runtime",["util","logger-manager","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(p,g,o,k){function j(a,c,b){var i=a.fn;if(i.version&&KISSY.version!==i.version)throw Error("current xtemplate file("+a.name+")(v"+i.version+")need to be recompiled using current kissy(v"+KISSY.version+")!");b=a.fn(c,b);if(i=a.runtime.extendTplName)delete a.runtime.extendTplName,b=a.root.include(i,a,c,null,b);return b.end()}function h(b,c,i,f,e,d,l,j){var m;if(!d){m=b.runtime.commands;
var h=b.root.config.commands,g=e[0];m=m&&m[g]||h&&h[g]||a[g];if(1!==e.length&&m){h=e.length;for(g=1;g<h&&!(m=m[e[g]],!m);g++);}}if(m)return m.call(b,c,i,f,l);e.join(".");return j&&(b=c.resolve(e.slice(0,-1),d),e=b[e[e.length-1]])?e.apply(b,i.params):f}function d(a,b){this.fn=a;b=this.config=b||{};b.loader=b.loader||l}function b(a,b){if("."!==a.charAt(0))return a;var c=e[b]=e[b]||{};if(c[a])return c[a];var i=a,f,d=a;f=b.split("/");d=d.split("/");f.pop();for(var l=0,j=d.length;l<j;l++){var h=d[l];"."!==
h&&(".."===h?f.pop():f.push(h))}f=f.join("/");return a=c[i]=f}p=g("util");g("logger-manager");var o=g("./runtime/commands"),a={},c=g("./runtime/scope"),i=g("./runtime/linked-buffer"),f={callFn:function(a,b,c,i,f,e,d){return h(a,b,c,i,f,e,d,!0)},callCommand:function(a,b,c,i,f,e){return h(a,b,c,i,f,0,e,!0)}},l={load:function(a,b,c){g([b],{success:function(a){c(void 0,a)},error:function(){c('template "'+b+'" does not exist')}})}};p.mix(d,{nativeCommands:o,utils:f,addCommand:function(b,c){a[b]=c},removeCommand:function(b){delete a[b]}});
var e={};d.prototype={constructor:d,Scope:c,nativeCommands:o,utils:f,removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{};c.commands[a]=b},include:function(a,c,i,f,e){var d=this,a=b(a,c.name);return e.async(function(b){d.config.loader.load(d,a,function(e,d){e?b.error(e):"string"===typeof d?b.write(d,f&&f.escape).end():j({root:c.root,fn:d,name:a,runtime:c.runtime},i,b)})})},render:function(a,b,e){var f="",
d=this.fn;"function"===typeof b&&(e=b,b=null);var b=b||{},e=e||function(a,b){f=b},l=this.config.name;!l&&d.TPL_NAME&&(l=d.TPL_NAME);a=new c(a);e=(new i(e)).head;j({name:l,fn:d,runtime:{commands:b.commands},root:this},a,e);return f}};d.Scope=c;k.exports=d});
KISSY.add("xtemplate/runtime/commands",["./scope","util"],function(p,g,o,k){var j=g("./scope"),h=g("util"),d={range:function(b,a){var c=a.params,i=c[0],f=c[1];if(c=c[2]){if(i>f&&0<c||i<f&&0>c)c=-c}else c=i>f?-1:1;for(var d=[],e=i;i<f?e<f:e>f;e+=c)d.push(e);return d},each:function(b,a,c){var i=a.params,f=i[0],d=i[2]||"xindex",i=i[1],e,n,g;if(f)if(h.isArray(f)){e=f.length;for(var k=0;k<e;k++)n=new j(f[k]),g=n.affix={xcount:e},g[d]=k,i&&(g[i]=f[k]),n.setParent(b),c=a.fn(n,c)}else for(e in f)n=new j(f[e]),
g=n.affix={},g[d]=e,i&&(g[i]=f[e]),n.setParent(b),c=a.fn(n,c);return c},"with":function(b,a,c){var d=a.params[0];d&&(d=new j(d),d.setParent(b),c=a.fn(d,c));return c},"if":function(b,a,c){a.params[0]?a.fn&&(c=a.fn(b,c)):a.inverse&&(c=a.inverse(b,c));return c},set:function(b,a,c){b.mix(a.hash);return c},include:function(b,a,c){var d=a.params,f,g=d.length;f=b;a.hash&&(f=new j(a.hash),f.setParent(b));for(b=0;b<g;b++)c=this.root.include(d[b],this,f,a,c);return c},parse:function(b,a,c){return d.include.call(this,
new j,a,c)},extend:function(b,a,c){this.runtime.extendTplName=a.params[0];return c},block:function(b,a,c){var d=this.runtime,f=a.params,g=f[0],e;2===f.length&&(e=f[0],g=f[1]);var f=d.blocks=d.blocks||{},h=f[g],a={fn:a.fn,type:e};if(h){if(h.type)if("append"===h.type)a.next=h,f[g]=a;else if("prepend"===h.type){var j;for(e=h;e&&"prepend"===e.type;)j=e,e=e.next;a.next=e;j.next=a}}else f[g]=a;if(!d.extendTplName)for(e=f[g];e;)e.fn&&(c=e.fn.call(this,b,c)),e=e.next;return c},macro:function(b,a,c,d){var b=
a.hash,f=a.params,g=f[0],f=f.slice(1),e=this.runtime,e=e.macros=e.macros||{};if(a.fn)e[g]={paramNames:f,hash:b,fn:a.fn};else{var a=e[g],g=a.hash||{},h;if(a&&(h=a.paramNames)){d=0;for(e=h.length;d<e;d++)g[h[d]]=f[d];if(b)for(var k in b)g[k]=b[k];h=new j(g);c=a.fn.call(this,h,c)}else throw Error("in file: "+this.name+" can not find macro: "+name+'" at line '+d);}return c}};k.exports=d});
KISSY.add("xtemplate/runtime/scope",[],function(p,g,o,k){function j(d){this.data=arguments.length?d:{};this.affix=h;this.root=this}var h;j.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},set:function(d,b){this.affix||(this.affix={});this.affix[d]=b},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){var b=this.affix;b||(b=this.affix={});for(var a in d)b[a]=d[a]},get:function(d){var b=this.data,a;a=(a=this.affix)&&a[d];if(a!==h)return a;
b!==h&&(a=b[d]);return a!==h?a:"this"===d?b:"root"===d?this.root.data:a},resolve:function(d,b){if(!b&&1===d.length)return this.get(d[0]);var a=d.length,c=this,g;if(a&&"root"===d[0])d.shift(),c=c.root,a--;else if(b)for(;c&&b--;)c=c.parent;if(!a)return c.data;var f=d[0];do g=c.get(f);while(g===h&&(c=c.parent));if(g&&c){for(c=1;g&&c<a;c++)g=g[d[c]];return g}return h}};k.exports=j});
KISSY.add("xtemplate/runtime/linked-buffer",["util"],function(p,g,o,k){function j(b){this.list=b;this.data=""}function h(b){this.head=new j(this);this.callback=b;this.data=""}var d=g("util");j.prototype={constructor:j,isBuffer:1,write:function(b,a){if(b||0===b)this.data+=a?d.escapeHtml(b):b;return this},async:function(b){var a=this.list,c=new j(a),a=new j(a);a.next=this.next;c.next=a;this.next=c;this.ready=!0;b(c);return a},error:function(b){var a=this.list.callback;a&&(a(b,void 0),this.list.callback=
null)},end:function(b,a){this.list.callback&&(this.write(b,a),this.ready=!0,this.list.flush());return this}};h.prototype={constructor:h,flush:function(){for(var b=this.head;b;){if(b.ready)this.data+=b.data;else return;this.head=b=b.next}this.callback(null,this.data)}};h.Buffer=j;k.exports=h});
