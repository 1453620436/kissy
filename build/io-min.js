/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Oct 22 17:03
*/
KISSY.add("io/form-serializer",function(f,i){function k(a){return a.replace(l,"\r\n")}var m=/^(?:select|textarea)/i,l=/\r?\n/g,e,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(a,c){return f.param(e.getFormData(a),void 0,void 0,c||!1)},getFormData:function(g){var c=[],e={};f.each(i.query(g),function(b){b=b.elements?f.makeArray(b.elements):[b];c.push.apply(c,b)});c=f.filter(c,function(b){return b.name&&!b.disabled&&
(b.checked||m.test(b.nodeName)||a.test(b.type))});f.each(c,function(b){var j=i.val(b),h;null!==j&&(j=f.isArray(j)?f.map(j,k):k(j),(h=e[b.name])?(h&&!f.isArray(h)&&(h=e[b.name]=[h]),h.push.apply(h,f.makeArray(j))):e[b.name]=j)});return e}}},{requires:["dom"]});
KISSY.add("io/base",function(f,i,k){function m(d){var j=d.context;delete d.context;d=f.mix(f.clone(h),d,{deep:!0});d.context=j||d;var c,g=d.type,e=d.dataType,j=d.uri=b.resolve(d.url);d.uri.setQuery("");"crossDomain"in d||(d.crossDomain=!d.uri.isSameOriginAs(b));g=d.type=g.toUpperCase();d.hasContent=!n.test(g);if(d.processData&&(c=d.data)&&"string"!=typeof c)d.data=f.param(c,k,k,d.serializeArray);e=d.dataType=f.trim(e||"*").split(a);!("cache"in d)&&f.inArray(e[0],["script","jsonp"])&&(d.cache=!1);
d.hasContent||(d.data&&j.query.add(f.unparam(d.data)),!1===d.cache&&j.query.set("_ksTS",f.now()+"_"+f.guid()));return d}function l(d){var b=this;if(!(b instanceof l))return new l(d);c.call(b);d=m(d);f.mix(b,{responseData:null,config:d||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});f.Defer(b);var h;l.fire("start",{ajaxConfig:d,io:b});h=new (j[d.dataType[0]]||j["*"])(b);
b.transport=h;d.contentType&&b.setRequestHeader("Content-Type",d.contentType);var a=d.dataType[0],g,e=d.timeout,n=d.context,i=d.headers,k=d.accepts;b.setRequestHeader("Accept",a&&k[a]?k[a]+("*"===a?"":", */*; q=0.01"):k["*"]);for(g in i)b.setRequestHeader(g,i[g]);if(d.beforeSend&&!1===d.beforeSend.call(n,b,d))return b;b.readyState=1;l.fire("send",{ajaxConfig:d,io:b});d.async&&0<e&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*e));try{b.state=1,h.send()}catch(p){2>b.state?(p.stack||
p,b._ioReady(-1,p.message)):p}return b}var e=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,g=function(b){return b},c=f.Promise,n=/^(?:GET|HEAD)$/,b=new f.Uri((f.Env.host.location||{}).href),e=b&&e.test(b.getScheme()),j={},h={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,
html:g,text:g,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};h.converters.html=h.converters.text;f.mix(l,i.targetObject);f.mix(l,{isLocal:e,setupConfig:function(b){f.mix(h,b,{deep:!0})},setupTransport:function(b,h){j[b]=h},getTransport:function(b){return j[b]},getConfig:function(){return h}});return l},{requires:["event/custom"]});
KISSY.add("io/xhr-transport-base",function(f,i){function k(b,j){try{return new (j||l).XMLHttpRequest}catch(h){}}function m(b){var j;b.ifModified&&(j=b.uri,!1===b.cache&&(j=j.clone(),j.query.remove("_ksTS")),j=j.toString());return j}var l=f.Env.host,e=7<f.UA.ie&&l.XDomainRequest,a={proto:{}},g={},c={};i.__lastModifiedCached=g;i.__eTagCached=c;a.nativeXhr=l.ActiveXObject?function(b,j){var h;if(!n&&b&&e)h=new e;else if(!(h=!i.isLocal&&k(b,j)))a:{try{h=new (j||l).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}h=
void 0}return h}:k;a._XDomainRequest=e;var n=a.supportCORS="withCredentials"in a.nativeXhr();f.mix(a.proto,{sendInternal:function(){var b=this,j=b.io,h=j.config,d=b.nativeXhr,a=h.files,i=a?"post":h.type,k=h.async,l,t=j.mimeType,o=j.requestHeaders||{},j=j._getUrlForSend(),u=m(h),r,p;if(u){if(r=g[u])o["If-Modified-Since"]=r;if(r=c[u])o["If-None-Match"]=r}(l=h.username)?d.open(i,j,k,l,h.password):d.open(i,j,k);i=h.xhrFields||{};"withCredentials"in i?n||delete i.withCredentials:n&&(i.withCredentials=
!0);for(p in i)d[p]=i[p];t&&d.overrideMimeType&&d.overrideMimeType(t);!1===o["X-Requested-With"]&&delete o["X-Requested-With"];if("undefined"!==typeof d.setRequestHeader)for(p in o)d.setRequestHeader(p,o[p]);var s=h.hasContent&&h.data||null;a&&(t=s,o={},t&&(o=f.unparam(t)),o=f.mix(o,a),s=new FormData,f.each(o,function(b,d){f.isArray(b)?f.each(b,function(b){s.append(d+(h.serializeArray?"[]":""),b)}):s.append(d,b)}));d.send(s);!k||4==d.readyState?b._callback():e&&d instanceof e?(d.onload=function(){d.readyState=
4;d.status=200;b._callback()},d.onerror=function(){d.readyState=4;d.status=500;b._callback()}):d.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,a){var h=this.nativeXhr,d=this.io,n,k,l,q,t,o=d.config;try{if(a||4==h.readyState)if(e&&h instanceof e?(h.onerror=f.noop,h.onload=f.noop):h.onreadystatechange=f.noop,a)4!==h.readyState&&h.abort();else{n=m(o);var u=h.status;e&&h instanceof e||(d.responseHeadersString=h.getAllResponseHeaders());n&&(k=
h.getResponseHeader("Last-Modified"),l=h.getResponseHeader("ETag"),k&&(g[n]=k),l&&(c[l]=l));if((t=h.responseXML)&&t.documentElement)d.responseXML=t;var r=d.responseText=h.responseText;if(o.files&&r){var p,s;if(-1!=(p=r.indexOf("<body>")))s=r.lastIndexOf("</body>"),-1==s&&(s=r.length),r=r.slice(p+6,s);d.responseText=f.unEscapeHtml(r)}try{q=h.statusText}catch(y){"xhr statusText error: ",y,q=""}!u&&i.isLocal&&!o.crossDomain?u=d.responseText?200:404:1223===u&&(u=204);d._ioReady(u,q)}}catch(z){h.onreadystatechange=
f.noop,a||d._ioReady(-1,z)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(f,i,k,m){function l(a){var g=a.config;this.io=a;g.crossDomain=!1;"use SubDomainTransport for: "+g.url}function e(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;k.detach(a.iframe,"load",e,this);this.send()}var a=f.Env.host.document,g={};f.augment(l,i.proto,{send:function(){var c=this.io.config,n=c.uri,b=n.getHostname(),j;j=g[b];var h="/sub_domain_proxy.html";c.xdr&&c.xdr.subDomain&&c.xdr.subDomain.proxy&&(h=c.xdr.subDomain.proxy);j&&j.ready?(this.nativeXhr=
i.nativeXhr(0,j.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(j?c=j.iframe:(j=g[b]={},c=j.iframe=a.createElement("iframe"),m.css(c,{position:"absolute",left:"-9999px",top:"-9999px"}),m.prepend(c,a.body||a.documentElement),j=new f.Uri,j.setScheme(n.getScheme()),j.setPort(n.getPort()),j.setHostname(b),j.setPath(h),c.src=j.toString()),k.on(c,"load",e,this))}});return l},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(f,i,k){function m(b,j,h){n||(n=!0,b='<object id="'+a+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+j+"&uid="+h+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',j=c.createElement("div"),k.prepend(j,c.body||c.documentElement),j.innerHTML=b)}function l(b){"use XdrFlashTransport for: "+b.config.url;this.io=b}var e={},a="io_swf",
g,c=f.Env.host.document,n=!1;f.augment(l,{send:function(){var b=this,a=b.io,h=a.config;m((h.xdr||{}).src||f.Config.base+"io/assets/io.swf",1,1);g?(b._uid=f.guid(),e[b._uid]=b,g.send(a._getUrlForSend(),{id:b._uid,uid:b._uid,method:h.type,data:h.hasContent&&h.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){g.abort(this._uid)},_xdrResponse:function(b,a){var h,d=a.id,g,c=a.c,f=this.io;if(c&&(g=c.responseText))f.responseText=decodeURI(g);switch(b){case "success":h={status:200,statusText:"success"};
delete e[d];break;case "abort":delete e[d];break;case "timeout":case "transport error":case "failure":delete e[d],h={status:"status"in c?c.status:500,statusText:c.statusText||b}}h&&f._ioReady(h.status,h.statusText)}});i.applyTo=function(b,a,h){var b=a.split(".").slice(1),d=i;f.each(b,function(b){d=d[b]});d.apply(null,h)};i.xdrReady=function(){g=c.getElementById(a)};i.xdrResponse=function(b,a){var h=e[a.uid];h&&h._xdrResponse(b,a)};return l},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(f,i,k,m,l){function e(c){var e=c.config,b=e.crossDomain,j=e.xdr||{},h=j.subDomain=j.subDomain||{};this.io=c;if(b&&!k.supportCORS){var d=e.uri.getHostname();if(a.domain&&f.endsWith(d,a.domain)&&!1!==h.proxy)return new m(c);if("flash"===""+j.use||!g)return new l(c)}c=this.nativeXhr=k.nativeXhr(b);"crossDomain: "+b+", use "+(g&&c instanceof g?"XDomainRequest":"XhrTransport")+" for: "+e.url;return this}var a=f.Env.host.document,g=k._XDomainRequest;f.augment(e,k.proto,
{send:function(){this.sendInternal()}});i.setupTransport("*",e);return i},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(f,i,k,m){function l(a){var c=a.config;if(!c.crossDomain)return new (i.getTransport("*"))(a);this.io=a;"use ScriptTransport for: "+c.url;return this}var e=f.Env.host,a=e.document;i.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){f.globalEval(a);return a}}}});f.augment(l,{send:function(){var g=this,c,f=g.io,
b=f.config,j=a.head||a.getElementsByTagName("head")[0]||a.documentElement;g.head=j;c=a.createElement("script");g.script=c;c.async=!0;b.scriptCharset&&(c.charset=b.scriptCharset);c.src=f._getUrlForSend();c.onerror=c.onload=c.onreadystatechange=function(b){b=b||e.event;g._callback((b.type||"error").toLowerCase())};j.insertBefore(c,j.firstChild)},_callback:function(a,c){var e=this.script,b=this.io,f=this.head;if(e&&(c||!e.readyState||/loaded|complete/.test(e.readyState)||"error"==a))e.onerror=e.onload=
e.onreadystatechange=null,f&&e.parentNode&&f.removeChild(e),this.head=this.script=m,!c&&"error"!=a?b._ioReady(200,"success"):"error"==a&&b._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});i.setupTransport("script",l);return i},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(f,i){var k=f.Env.host;i.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});i.on("start",function(i){var l=i.io,e=l.config,i=e.dataType;if("jsonp"==i[0]){delete e.contentType;var a,g=e.jsonpCallback,c="function"===typeof g?g():g,n=k[c];e.uri.query.set(e.jsonp,c);k[c]=function(b){1<arguments.length&&(b=f.makeArray(arguments));a=[b]};l.fin(function(){k[c]=n;if(void 0===n)try{delete k[c]}catch(b){}else a&&n(a[0])});l=e.converters;l.script=l.script||
{};l.script.json=function(){a||" not call jsonpCallback: "+c;return a[0]};i.length=2;i[0]="script";i[1]="json"}});return i},{requires:["./base"]});
KISSY.add("io/form",function(f,i,k,m){var l=Array.prototype.slice,e=f.Env.host.FormData;i.on("start",function(a){var g,c,a=a.io.config;if(c=a.form){g=k.get(c);c=a.data;for(var i=!1,b={},j=k.query("input",g),h=0,d=j.length;h<d;h++){var v=j[h];if("file"==v.type.toLowerCase()){i=!0;if(!e)break;var w=l.call(v.files,0);b[k.attr(v,"name")]=1<w.length?w:w[0]||null}}i&&e&&(a.files=a.files||{},f.mix(a.files,b),delete a.contentType);!i||e?(g=m.getFormData(g),a.hasContent?(g=f.param(g,void 0,void 0,a.serializeArray),
a.data=c?a.data+("&"+g):g):a.uri.query.add(g)):(c=a.dataType,a=c[0],"*"==a&&(a="text"),c.length=2,c[0]="iframe",c[1]=a)}});return i},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(f,i,k,m){function l(a){var b=f.guid("io-iframe"),e=i.getEmptyIframeSrc(),a=a.iframe=i.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');i.prepend(a,g.body||g.documentElement);return a}function e(a,b,e){var h=[],d,c,k,l;f.each(a,function(a,n){d=f.isArray(a);c=f.makeArray(a);for(k=0;k<c.length;k++)l=g.createElement("input"),l.type="hidden",l.name=n+(d&&e?"[]":""),l.value=c[k],i.append(l,
b),h.push(l)});return h}function a(a){this.io=a;"use IframeTransport for: "+a.config.url}var g=f.Env.host.document,c=f.clone(m.getConfig().converters.text);c.json=function(a){return f.parseJson(f.unEscapeHtml(a))};m.setupConfig({converters:{iframe:c,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(a,{send:function(){function a(){k.on(g,"load error",b._callback,b);q.submit()}var b=this,c=b.io,h=c.config,d,g,m,x=h.data,q=i.get(h.form);b.attrs={target:i.attr(q,"target")||
"",action:i.attr(q,"action")||"",encoding:i.attr(q,"encoding"),enctype:i.attr(q,"enctype"),method:i.attr(q,"method")};b.form=q;g=l(c);i.attr(q,{target:g.id,action:c._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});x&&(m=f.unparam(x));m&&(d=e(m,q,h.serializeArray));b.fields=d;6==f.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,e=b.form,c=b.io,a=a.type,d,g=c.iframe;if(g)if("abort"==a&&6==f.UA.ie?setTimeout(function(){i.attr(e,b.attrs)},0):i.attr(e,
b.attrs),i.remove(this.fields),k.detach(g),setTimeout(function(){i.remove(g)},30),c.iframe=null,"load"==a)try{if((d=g.contentWindow.document)&&d.body)c.responseText=i.html(d.body),f.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=d&&d.XMLDocument?d.XMLDocument:d;d?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(l){c._ioReady(500,"parser error")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});m.setupTransport("iframe",
a);return m},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(f,i,k){function m(e){var a=e.responseText,g=e.responseXML,c=e.config,i=c.converters,b,j,h=c.contents,d=c.dataType;if(a||g){for(c=e.mimeType||e.getResponseHeader("Content-Type");"*"==d[0];)d.shift();if(!d.length)for(b in h)if(h[b].test(c)){d[0]!=b&&d.unshift(b);break}d[0]=d[0]||"text";for(b=0;b<d.length;b++)if("text"==d[b]&&a!==k){j=a;break}else if("xml"==d[b]&&g!==k){j=g;break}if(!j){var l={text:a,xml:g};f.each(["text","xml"],function(b){var c=d[0];return i[b]&&i[b][c]&&
l[b]?(d.unshift(b),j="text"==b?a:g,!1):k})}}h=d[0];for(c=1;c<d.length;c++){b=d[c];var m=i[h]&&i[h][b];if(!m)throw"no covert for "+h+" => "+b;j=m(j);h=b}e.responseData=j}var l=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;f.extend(i,f.Promise,{setRequestHeader:function(e,a){this.requestHeaders[e]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(e){var a,g;if(2===this.state){if(!(g=this.responseHeaders))for(g=this.responseHeaders={};a=
l.exec(this.responseHeadersString);)g[a[1]]=a[2];a=g[e]}return a===k?null:a},overrideMimeType:function(e){this.state||(this.mimeType=e);return this},abort:function(e){e=e||"abort";this.transport&&this.transport.abort(e);this._ioReady(0,e);return this},getNativeXhr:function(){var e;return(e=this.transport)?e.nativeXhr:null},_ioReady:function(e,a){if(2!=this.state){this.state=2;this.readyState=4;var g;if(200<=e&&300>e||304==e)if(304==e)a="not modified",g=!0;else try{m(this),a="success",g=!0}catch(c){c.stack||
c,a="parser error"}else 0>e&&(e=0);this.status=e;this.statusText=a;var f=this.defer,b=this.config,j;if(j=this.timeoutTimer)clearTimeout(j),this.timeoutTimer=0;j=g?"success":"error";var h,d=[this.responseData,a,this],k=b.context,l={ajaxConfig:b,io:this};(h=b[j])&&h.apply(k,d);(h=b.complete)&&h.apply(k,d);i.fire(j,l);i.fire("complete",l);f[g?"resolve":"reject"](d)}},_getUrlForSend:function(){var e=this.config,a=e.uri,g=f.Uri.getComponents(e.url).query||"";return a.toString.call(a,e.serializeArray)+
(g?(a.query.has()?"&":"?")+g:g)}})},{requires:["./base"]});
KISSY.add("io",function(f,i,k){function m(e,a,g,c,f){"function"===typeof a&&(c=g,g=a,a=l);return k({type:f||"get",url:e,data:a,success:g,dataType:c})}var l=void 0;f.mix(k,{serialize:i.serialize,get:m,post:function(e,a,g,c){"function"===typeof a&&(c=g,g=a,a=l);return m(e,a,g,c,"post")},jsonp:function(e,a,g){"function"===typeof a&&(g=a,a=l);return m(e,a,g,"jsonp")},getScript:f.getScript,getJSON:function(e,a,g){"function"===typeof a&&(g=a,a=l);return m(e,a,g,"json")},upload:function(e,a,g,c,f){"function"===
typeof g&&(f=c,c=g,g=l);return k({url:e,type:"post",dataType:f,form:a,data:g,success:c})}});f.mix(f,{Ajax:k,IO:k,ajax:k,io:k,jsonp:k.jsonp});return k},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
