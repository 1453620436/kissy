/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 19 11:46
*/
KISSY.add("io/form-serializer",["dom"],function(e){function h(a){return a.replace(d,"\r\n")}var l=this.require("dom"),f=/^(?:select|textarea)/i,d=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,g){return e.param(c.getFormData(a),void 0,void 0,g||!1)},getFormData:function(b){var c=[],d={};e.each(l.query(b),function(a){a=a.elements?e.makeArray(a.elements):[a];c.push.apply(c,a)});c=e.filter(c,function(b){return b.name&&
!b.disabled&&(b.checked||f.test(b.nodeName)||a.test(b.type))});e.each(c,function(a){var b=l.val(a),c;null!==b&&(b=e.isArray(b)?e.map(b,h):h(b),(c=d[a.name])?(c&&!e.isArray(c)&&(c=d[a.name]=[c]),c.push.apply(c,e.makeArray(b))):d[a.name]=b)});return d}}});
KISSY.add("io/base",["event/custom","promise"],function(e){function h(a){var c=a.context;delete a.context;a=e.mix(e.clone(j),a,{deep:!0});a.context=c||a;var g,d=a.type,n=a.dataType,c=a.uri=k.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(k));d=a.type=d.toUpperCase();a.hasContent=!i.test(d);if(a.processData&&(g=a.data)&&"string"!=typeof g)a.data=e.param(g,f,f,a.serializeArray);n=a.dataType=e.trim(n||"*").split(b);!("cache"in a)&&e.inArray(n[0],["script","jsonp"])&&
(a.cache=!1);a.hasContent||(a.data&&c.query.add(e.unparam(a.data)),!1===a.cache&&c.query.set("_ksTS",e.now()+"_"+e.guid()));return a}function l(a){var b=this;if(!(b instanceof l))return new l(a);c.call(b);a=h(a);e.mix(b,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});c.Defer(b);var g;l.fire("start",{ajaxConfig:a,io:b});g=new (n[a.dataType[0]]||
n["*"])(b);b.transport=g;a.contentType&&b.setRequestHeader("Content-Type",a.contentType);var d=a.dataType[0],i,k=a.timeout,j=a.context,f=a.headers,w=a.accepts;b.setRequestHeader("Accept",d&&w[d]?w[d]+("*"===d?"":", */*; q=0.01"):w["*"]);for(i in f)b.setRequestHeader(i,f[i]);if(a.beforeSend&&!1===a.beforeSend.call(j,b,a))return b;b.readyState=1;l.fire("send",{ajaxConfig:a,io:b});a.async&&0<k&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*k));try{b.state=1,g.send()}catch(u){2>b.state?
(u.stack||u,"error",setTimeout(function(){throw u;},0),b._ioReady(-1,u.message)):u}return b}var f=f,d=this.require("event/custom"),c=this.require("promise"),a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,g=function(a){return a},i=/^(?:GET|HEAD)$/,k=new e.Uri((e.Env.host.location||{}).href),a=k&&a.test(k.getScheme()),n={},j={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",
html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parseJson,html:g,text:g,xml:e.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};j.converters.html=j.converters.text;e.mix(l,d.Target);e.mix(l,{isLocal:a,setupConfig:function(a){e.mix(j,a,{deep:!0})},setupTransport:function(a,b){n[a]=b},getTransport:function(a){return n[a]},getConfig:function(){return j}});return l});
KISSY.add("io/xhr-transport-base",["./base"],function(e){function h(c,a){try{return new (a||win).XMLHttpRequest}catch(b){}}function l(c){var a;c.ifModified&&(a=c.uri,!1===c.cache&&(a=a.clone(),a.query.remove("_ksTS")),a=a.toString());return a}var f=this.require("./base");f.__lastModifiedCached=lastModifiedCached;f.__eTagCached=eTagCached;XhrTransportBase.nativeXhr=win.ActiveXObject?function(c,a){var b;if(!d&&c&&_XDomainRequest)b=new _XDomainRequest;else if(!(b=!f.isLocal&&h(c,a)))a:{try{b=new (a||
win).ActiveXObject("Microsoft.XMLHTTP");break a}catch(g){}b=void 0}return b}:h;XhrTransportBase._XDomainRequest=_XDomainRequest;var d=XhrTransportBase.supportCORS="withCredentials"in XhrTransportBase.nativeXhr();e.mix(XhrTransportBase.proto,{sendInternal:function(){var c=this,a=c.io,b=a.config,g=c.nativeXhr,i=b.files,k=i?"post":b.type,n=b.async,j,f=a.mimeType,h=a.requestHeaders||{},a=a._getUrlForSend(),m;m=l(b);var p,q;if(m){if(p=lastModifiedCached[m])h["If-Modified-Since"]=p;if(p=eTagCached[m])h["If-None-Match"]=
p}m=b.xhrFields||{};"withCredentials"in m&&(d||delete m.withCredentials);(j=b.username)?g.open(k,a,n,j,b.password):g.open(k,a,n);for(q in m)try{g[q]=m[q]}catch(t){t}f&&g.overrideMimeType&&g.overrideMimeType(f);!1===h["X-Requested-With"]&&delete h["X-Requested-With"];if("undefined"!==typeof g.setRequestHeader)for(q in h)g.setRequestHeader(q,h[q]);var r=b.hasContent&&b.data||null;i&&(k=r,j={},k&&(j=e.unparam(k)),j=e.mix(j,i),r=new FormData,e.each(j,function(a,c){e.isArray(a)?e.each(a,function(a){r.append(c+
(b.serializeArray?"[]":""),a)}):r.append(c,a)}));g.send(r);!n||4==g.readyState?c._callback():_XDomainRequest&&g instanceof _XDomainRequest?(g.onload=function(){g.readyState=4;g.status=200;c._callback()},g.onerror=function(){g.readyState=4;g.status=500;c._callback()}):g.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,a){var b=this.nativeXhr,g=this.io,d,k,n,j,h,o=g.config;try{if(a||4==b.readyState)if(_XDomainRequest&&b instanceof _XDomainRequest?
(b.onerror=e.noop,b.onload=e.noop):b.onreadystatechange=e.noop,a)4!==b.readyState&&b.abort();else{d=l(o);var m=b.status;_XDomainRequest&&b instanceof _XDomainRequest||(g.responseHeadersString=b.getAllResponseHeaders());d&&(k=b.getResponseHeader("Last-Modified"),n=b.getResponseHeader("ETag"),k&&(lastModifiedCached[d]=k),n&&(eTagCached[n]=n));if((h=b.responseXML)&&h.documentElement)g.responseXML=h;var p=g.responseText=b.responseText;if(o.files&&p){var q,t;if(-1!=(q=p.indexOf("<body>")))t=p.lastIndexOf("</body>"),
-1==t&&(t=p.length),p=p.slice(q+6,t);g.responseText=e.unEscapeHtml(p)}try{j=b.statusText}catch(r){"xhr statusText error: ",r,j=""}!m&&f.isLocal&&!o.crossDomain?m=g.responseText?OK_CODE:NOT_FOUND_CODE:m===NO_CONTENT_CODE2&&(m=NO_CONTENT_CODE);g._ioReady(m,j)}}catch(v){v.stack||v,"error",setTimeout(function(){throw v;},0),b.onreadystatechange=e.noop,a||g._ioReady(-1,v)}}});return XhrTransportBase});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(e){function h(c,a,b){init||(init=!0,c='<object id="'+ID+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+a+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',a=doc.createElement("div"),d.prepend(a,doc.body||doc.documentElement),a.innerHTML=c)}function l(c){"use XdrFlashTransport for: "+c.config.url;this.io=
c}var f=this.require("./base"),d=this.require("dom");e.augment(l,{send:function(){var c=this,a=c.io,b=a.config;h((b.xdr||{}).src||e.Config.base+"io/assets/io.swf",1,1);flash?(c._uid=e.guid(),maps[c._uid]=c,flash.send(a._getUrlForSend(),{id:c._uid,uid:c._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){c.send()},200)},abort:function(){flash.abort(this._uid)},_xdrResponse:function(c,a){var b,d=a.id,e,k=a.c,n=this.io;if(k&&(e=k.responseText))n.responseText=decodeURI(e);switch(c){case "success":b=
{status:200,statusText:"success"};delete maps[d];break;case "abort":delete maps[d];break;case "timeout":case "transport error":case "failure":delete maps[d],b={status:"status"in k?k.status:500,statusText:k.statusText||c}}b&&n._ioReady(b.status,b.statusText)}});f.applyTo=function(c,a,b){var c=a.split(".").slice(1),d=f;e.each(c,function(a){d=d[a]});d.apply(null,b)};f.xdrReady=function(){flash=doc.getElementById(ID)};f.xdrResponse=function(c,a){var b=maps[a.uid];b&&b._xdrResponse(c,a)};return l});
KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(e){function h(a){var b=a.config;this.io=a;b.crossDomain=!1;"use SubDomainTransport for: "+b.url}function l(){var a=this.io.config.uri.getHostname(),a=iframeMap[a];a.ready=1;f.detach(a.iframe,"load",l,this);this.send()}var f=this.require("event/dom"),d=this.require("dom"),c=this.require("./xhr-transport-base");e.augment(h,c.proto,{send:function(){var a=this.io.config,b=a.uri,g=b.getHostname(),i;i=iframeMap[g];var k=
PROXY_PAGE;a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(k=a.xdr.subDomain.proxy);i&&i.ready?(this.nativeXhr=c.nativeXhr(0,i.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(i?a=i.iframe:(i=iframeMap[g]={},a=i.iframe=doc.createElement("iframe"),d.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),d.prepend(a,doc.body||doc.documentElement),i=new e.Uri,i.setScheme(b.getScheme()),i.setPort(b.getPort()),i.setHostname(g),i.setPath(k),a.src=i.toString()),f.on(a,
"load",l,this))}});return h},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(e){function h(a){var b=a.config,g=b.crossDomain,i=b.xdr||{},k=i.subDomain=i.subDomain||{};this.io=a;if(g&&!f.supportCORS){var n=b.uri.getHostname();if(doc.domain&&e.endsWith(n,doc.domain)&&!1!==k.proxy)return new c(a);if("flash"===""+i.use||!_XDomainRequest)return new d(a)}a=this.nativeXhr=f.nativeXhr(g);"crossDomain: "+g+", use "+(_XDomainRequest&&a instanceof _XDomainRequest?
"XDomainRequest":"XhrTransport")+" for: "+b.url;return this}var l=this.require("./base"),f=this.require("./xhr-transport-base"),d=this.require("./xdr-flash-transport"),c=this.require("./sub-domain-transport");e.augment(h,f.proto,{send:function(){this.sendInternal()}});l.setupTransport("*",h);return l},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",["./base"],function(e){function h(d){var c=d.config;if(!c.crossDomain)return new (f.getTransport("*"))(d);this.io=d;"use ScriptTransport for: "+c.url;return this}var l=l,f=this.require("./base");f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){e.globalEval(d);return d}}}});e.augment(h,{send:function(){var d=this,c,
a=d.io,b=a.config,g=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement;d.head=g;c=doc.createElement("script");d.script=c;c.async=!0;b.scriptCharset&&(c.charset=b.scriptCharset);c.src=a._getUrlForSend();c.onerror=c.onload=c.onreadystatechange=function(a){a=a||win.event;d._callback((a.type||"error").toLowerCase())};g.insertBefore(c,g.firstChild)},_callback:function(d,c){var a=this.script,b=this.io,g=this.head;if(a&&(c||!a.readyState||/loaded|complete/.test(a.readyState)||"error"==d))a.onerror=
a.onload=a.onreadystatechange=null,g&&a.parentNode&&g.removeChild(a),this.head=this.script=l,!c&&"error"!=d?b._ioReady(OK_CODE,"success"):"error"==d&&b._ioReady(ERROR_CODE,"script error")},abort:function(){this._callback(0,1)}});f.setupTransport("script",h);return f});
KISSY.add("io/jsonp",["./base"],function(e){var h=this.require("./base"),l=e.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});h.on("start",function(f){var d=f.io,c=d.config,f=c.dataType;if("jsonp"==f[0]){delete c.contentType;var a,b=c.jsonpCallback,g="function"===typeof b?b():b,i=l[g];c.uri.query.set(c.jsonp,g);l[g]=function(b){1<arguments.length&&(b=e.makeArray(arguments));a=[b]};d.fin(function(){l[g]=i;if(void 0===i)try{delete l[g]}catch(b){}else a&&i(a[0])});
d=c.converters;d.script=d.script||{};d.script.json=function(){a||" not call jsonpCallback: "+g;return a[0]};f.length=2;f[0]="script";f[1]="json"}});return h});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(e){var h=this.require("./base"),l=this.require("dom"),f=this.require("./form-serializer"),d=Array.prototype.slice,c=e.Env.host.FormData;h.on("start",function(a){var b,g,a=a.io.config;if(g=a.form){b=l.get(g);g=a.data;for(var i=!1,k={},n=l.query("input",b),j=0,h=n.length;j<h;j++){var o=n[j];if("file"==o.type.toLowerCase()){i=!0;if(!c)break;var m=d.call(o.files,0);k[l.attr(o,"name")]=1<m.length?m:m[0]||null}}i&&c&&(a.files=a.files||{},
e.mix(a.files,k),delete a.contentType);!i||c?(b=f.getFormData(b),a.hasContent?(b=e.param(b,void 0,void 0,a.serializeArray),a.data=g?a.data+("&"+b):b):a.uri.query.add(b)):(g=a.dataType,a=g[0],"*"==a&&(a="text"),g.length=2,g[0]="iframe",g[1]=a)}});return h});
KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(e){function h(a){var c=e.guid("io-iframe"),i=d.getEmptyIframeSrc(),a=a.iframe=d.create("<iframe "+(i?' src="'+i+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');d.prepend(a,doc.body||doc.documentElement);return a}function l(a,c,i){var k=[],n,j,f,h;e.each(a,function(a,b){n=e.isArray(a);j=e.makeArray(a);for(f=0;f<j.length;f++)h=doc.createElement("input"),h.type="hidden",h.name=b+(n&&i?"[]":
""),h.value=j[f],d.append(h,c),k.push(h)});return k}function f(a){this.io=a;"use IframeTransport for: "+a.config.url}var d=this.require("dom"),c=this.require("./base"),a=this.require("event/dom");iframeConverter.json=function(a){return e.parseJson(e.unEscapeHtml(a))};c.setupConfig({converters:{iframe:iframeConverter,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(f,{send:function(){function b(){a.on(j,"load error",c._callback,c);m.submit()}var c=this,i=c.io,k=i.config,
f,j,s,o=k.data,m=d.get(k.form);c.attrs={target:d.attr(m,"target")||"",action:d.attr(m,"action")||"",encoding:d.attr(m,"encoding"),enctype:d.attr(m,"enctype"),method:d.attr(m,"method")};c.form=m;j=h(i);d.attr(m,{target:j.id,action:i._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});o&&(s=e.unparam(o));s&&(f=l(s,m,k.serializeArray));c.fields=f;6==e.UA.ie?setTimeout(b,0):b()},_callback:function(b){var c=this,i=c.form,k=c.io,b=b.type,f,j=k.iframe;if(j)if("abort"==
b&&6==e.UA.ie?setTimeout(function(){d.attr(i,c.attrs)},0):d.attr(i,c.attrs),d.remove(this.fields),a.detach(j),setTimeout(function(){d.remove(j)},BREATH_INTERVAL),k.iframe=null,"load"==b)try{if((f=j.contentWindow.document)&&f.body)k.responseText=d.html(f.body),e.startsWith(k.responseText,"<?xml")&&(k.responseText=void 0);k.responseXML=f&&f.XMLDocument?f.XMLDocument:f;f?k._ioReady(OK_CODE,"success"):k._ioReady(ERROR_CODE,"parser error")}catch(h){k._ioReady(ERROR_CODE,"parser error")}else"error"==b&&
k._ioReady(ERROR_CODE,"error")},abort:function(){this._callback({type:"abort"})}});c.setupTransport("iframe",f);return c});
KISSY.add("io/methods",["promise","./base"],function(e){function h(d){var c=d.responseText,a=d.responseXML,b=d.config,g=b.converters,i,f,h=b.contents,j=b.dataType;if(c||a){for(b=d.mimeType||d.getResponseHeader("Content-Type");"*"==j[0];)j.shift();if(!j.length)for(i in h)if(h[i].test(b)){j[0]!=i&&j.unshift(i);break}j[0]=j[0]||"text";for(i=0;i<j.length;i++)if("text"==j[i]&&void 0!==c){f=c;break}else if("xml"==j[i]&&void 0!==a){f=a;break}if(!f){var l={text:c,xml:a};e.each(["text","xml"],function(b){var d=
j[0];if(g[b]&&g[b][d]&&l[b])return j.unshift(b),f="text"==b?c:a,!1})}}h=j[0];for(b=1;b<j.length;b++){i=j[b];var o=g[h]&&g[h][i];if(!o)throw"no covert for "+h+" => "+i;f=o(f);h=i}d.responseData=f}var l=this.require("promise"),f=this.require("./base");e.extend(f,l,{setRequestHeader:function(d,c){this.requestHeaders[d]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var c,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=
this.responseHeaders={};c=rheaders.exec(this.responseHeadersString);)a[c[1]]=c[2];c=a[d]}return void 0===c?null:c},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;return(d=this.transport)?d.nativeXhr:null},_ioReady:function(d,c){if(2!=this.state){this.state=2;this.readyState=4;var a;if(d>=OK_CODE&&d<MULTIPLE_CHOICES||d==NOT_MODIFIED)if(d==NOT_MODIFIED)c=
"not modified",a=!0;else try{h(this),c="success",a=!0}catch(b){b.stack||b,"error",setTimeout(function(){throw b;},0),c="parser error"}else 0>d&&(d=0);this.status=d;this.statusText=c;var g=this.defer,e=this.config,k;if(k=this.timeoutTimer)clearTimeout(k),this.timeoutTimer=0;k=a?"success":"error";var l,j=[this.responseData,c,this],s=e.context,o={ajaxConfig:e,io:this};(l=e[k])&&l.apply(s,j);(l=e.complete)&&l.apply(s,j);f.fire(k,o);f.fire("complete",o);g[a?"resolve":"reject"](j)}},_getUrlForSend:function(){var d=
this.config,c=d.uri,a=e.Uri.getComponents(d.url).query||"";return c.toString.call(c,d.serializeArray)+(a?(c.query.has()?"&":"?")+a:a)}})});
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(e){function h(c,a,b,e,f){if(typeof a==="function"){e=b;b=a;a=l}return d({type:f||"get",url:c,data:a,success:b,dataType:e})}var l=l,f=this.require("io/form-serializer"),d=this.require("io/base");this.require("io/xhr-transport");this.require("io/script-transport");this.require("io/jsonp");this.require("io/form");this.require("io/iframe-transport");this.require("io/methods");
e.mix(d,{serialize:f.serialize,get:h,post:function(c,a,b,d){if(typeof a==="function"){d=b;b=a;a=l}return h(c,a,b,d,"post")},jsonp:function(c,a,b){if(typeof a==="function"){b=a;a=l}return h(c,a,b,"jsonp")},getScript:e.getScript,getJSON:function(c,a,b){if(typeof a==="function"){b=a;a=l}return h(c,a,b,"json")},upload:function(c,a,b,e,f){if(typeof b==="function"){f=e;e=b;b=l}return d({url:c,type:"post",dataType:f,form:a,data:b,success:e})}});e.mix(e,{Ajax:d,IO:d,ajax:d,io:d,jsonp:d.jsonp});return d});
