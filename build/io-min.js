/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 11 12:52
*/
KISSY.add("io/form-serializer",function(e,h){function i(a){return a.replace(j,"\r\n")}var m=/^(?:select|textarea)/i,j=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,b){return e.param(c.getFormData(a),void 0,void 0,b||!1)},getFormData:function(d){var b=[],c={};e.each(h.query(d),function(g){g=g.elements?e.makeArray(g.elements):[g];b.push.apply(b,g)});b=e.filter(b,function(g){return g.name&&!g.disabled&&
(g.checked||m.test(g.nodeName)||a.test(g.type))});e.each(b,function(g){var a=h.val(g),b;null!==a&&(a=e.isArray(a)?e.map(a,i):i(a),(b=c[g.name])?(b&&!e.isArray(b)&&(b=c[g.name]=[b]),b.push.apply(b,e.makeArray(a))):c[g.name]=a)});return c}}},{requires:["dom"]});
KISSY.add("io/base",function(e,h,i){function m(a){var b=a.context;delete a.context;a=e.mix(e.clone(k),a,{deep:!0});a.context=b||a;var f,c=a.type,n=a.dataType,b=a.uri=l.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(l));c=a.type=c.toUpperCase();a.hasContent=!g.test(c);if(a.processData&&(f=a.data)&&"string"!=typeof f)a.data=e.param(f,i,i,a.serializeArray);n=a.dataType=e.trim(n||"*").split(d);!("cache"in a)&&e.inArray(n[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&b.query.add(e.unparam(a.data)),!1===a.cache&&b.query.set("_ksTS",e.now()+"_"+e.guid()));return a}function j(a,b){c.fire(a,{ajaxConfig:b.config,io:b})}function c(a){function b(f){return function(b){if(k=g.timeoutTimer)clearTimeout(k),g.timeoutTimer=0;var c=a[f];c&&c.apply(s,b);j(f,g)}}var g=this;if(!(g instanceof c))return new c(a);n.call(g);a=m(a);e.mix(g,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new e.Defer(this)});var l;j("start",g);l=new (f[a.dataType[0]]||f["*"])(g);g.transport=l;a.contentType&&g.setRequestHeader("Content-Type",a.contentType);var d=a.dataType[0],k,h,i=a.timeout,s=a.context,r=a.headers,y=a.accepts;g.setRequestHeader("Accept",d&&y[d]?y[d]+("*"===d?"":", */*; q=0.01"):y["*"]);for(h in r)g.setRequestHeader(h,r[h]);if(a.beforeSend&&!1===a.beforeSend.call(s,g,a))return g;g.done(b("success"),
b("error"));g.fin(b("complete"));g.readyState=1;j("send",g);a.async&&0<i&&(g.timeoutTimer=setTimeout(function(){g.abort("timeout")},1E3*i));try{g.state=1,l.send()}catch(x){2>g.state?(x.stack||x,g._ioReady(-1,x.message)):x}return g}var a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,d=/\s+/,b=function(a){return a},n=e.Promise,g=/^(?:GET|HEAD)$/,l=new e.Uri((e.Env.host.location||{}).href),a=l&&a.test(l.getScheme()),f={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parseJson,html:b,text:b,xml:e.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;e.mix(c,h.Target);e.mix(c,{isLocal:a,setupConfig:function(a){e.mix(k,a,{deep:!0})},setupTransport:function(a,g){f[a]=g},getTransport:function(a){return f[a]},
getConfig:function(){return k}});return c},{requires:["event"]});
KISSY.add("io/xhr-transport-base",function(e,h){function i(a,b){try{return new (b||j).XMLHttpRequest}catch(f){}}function m(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var j=e.Env.host,c=7<e.UA.ie&&j.XDomainRequest,a={proto:{}},d={},b={};h.__lastModifiedCached=d;h.__eTagCached=b;a.nativeXhr=j.ActiveXObject?function(a,b){var f;if(!n&&a&&c)f=new c;else if(!(f=!h.isLocal&&i(a,b)))a:{try{f=new (b||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}f=
void 0}return f}:i;a._XDomainRequest=c;var n=a.supportCORS="withCredentials"in a.nativeXhr();e.mix(a.proto,{sendInternal:function(){var a=this,l=a.io,f=l.config,k=a.nativeXhr,h=f.files,i=h?"post":f.type,j=f.async,o,v=l.mimeType,p=l.requestHeaders||{},l=l._getUrlForSend(),w=m(f),t,s;if(w){if(t=d[w])p["If-Modified-Since"]=t;if(t=b[w])p["If-None-Match"]=t}(o=f.username)?k.open(i,l,j,o,f.password):k.open(i,l,j);i=f.xhrFields||{};"withCredentials"in i?n||delete i.withCredentials:n&&(i.withCredentials=
!0);for(s in i)k[s]=i[s];v&&k.overrideMimeType&&k.overrideMimeType(v);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof k.setRequestHeader)for(s in p)k.setRequestHeader(s,p[s]);var r=f.hasContent&&f.data||null;h&&(v=r,p={},v&&(p=e.unparam(v)),p=e.mix(p,h),r=new FormData,e.each(p,function(a,b){e.isArray(a)?e.each(a,function(a){r.append(b+(f.serializeArray?"[]":""),a)}):r.append(b,a)}));k.send(r);!j||4==k.readyState?a._callback():c&&k instanceof c?(k.onload=function(){k.readyState=
4;k.status=200;a._callback()},k.onerror=function(){k.readyState=4;k.status=500;a._callback()}):k.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,l){var f=this.nativeXhr,n=this.io,i,j,q,o,v,p=n.config;try{if(l||4==f.readyState)if(c&&f instanceof c?(f.onerror=e.noop,f.onload=e.noop):f.onreadystatechange=e.noop,l)4!==f.readyState&&f.abort();else{i=m(p);var w=f.status;c&&f instanceof c||(n.responseHeadersString=f.getAllResponseHeaders());i&&(j=
f.getResponseHeader("Last-Modified"),q=f.getResponseHeader("ETag"),j&&(d[i]=j),q&&(b[q]=q));if((v=f.responseXML)&&v.documentElement)n.responseXML=v;var t=n.responseText=f.responseText;if(p.files&&t){var s,r;if(-1!=(s=t.indexOf("<body>")))r=t.lastIndexOf("</body>"),-1==r&&(r=t.length),t=t.slice(s+6,r);n.responseText=e.unEscapeHtml(t)}try{o=f.statusText}catch(y){"xhr statusText error: ",y,o=""}!w&&h.isLocal&&!p.crossDomain?w=n.responseText?200:404:1223===w&&(w=204);n._ioReady(w,o)}}catch(x){f.onreadystatechange=
e.noop,l||n._ioReady(-1,x)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(e,h,i,m){function j(a){var c=a.config;this.io=a;c.crossDomain=!1;"use SubDomainTransport for: "+c.url}function c(){var a=this.io.config.uri.getHostname(),a=d[a];a.ready=1;i.detach(a.iframe,"load",c,this);this.send()}var a=e.Env.host.document,d={};e.augment(j,h.proto,{send:function(){var b=this.io.config,n=b.uri,g=n.getHostname(),l;l=d[g];var f="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(f=b.xdr.subDomain.proxy);l&&l.ready?(this.nativeXhr=
h.nativeXhr(0,l.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(l?b=l.iframe:(l=d[g]={},b=l.iframe=a.createElement("iframe"),m.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),m.prepend(b,a.body||a.documentElement),l=new e.Uri,l.setScheme(n.getScheme()),l.setPort(n.getPort()),l.setHostname(g),l.setPath(f),b.src=l.toString()),i.on(b,"load",c,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(e,h,i){function m(g,c,f){n||(n=!0,g='<object id="'+a+'" type="application/x-shockwave-flash" data="'+g+'" width="0" height="0"><param name="movie" value="'+g+'" /><param name="FlashVars" value="yid='+c+"&uid="+f+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',c=b.createElement("div"),i.prepend(c,b.body||b.documentElement),c.innerHTML=g)}function j(a){"use XdrFlashTransport for: "+a.config.url;this.io=a}var c={},a="io_swf",
d,b=e.Env.host.document,n=!1;e.augment(j,{send:function(){var a=this,b=a.io,f=b.config;m((f.xdr||{}).src||e.Config.base+"io/assets/io.swf",1,1);d?(a._uid=e.guid(),c[a._uid]=a,d.send(b._getUrlForSend(),{id:a._uid,uid:a._uid,method:f.type,data:f.hasContent&&f.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,b){var f,d=b.id,e,n=b.c,i=this.io;if(n&&(e=n.responseText))i.responseText=decodeURI(e);switch(a){case "success":f={status:200,statusText:"success"};
delete c[d];break;case "abort":delete c[d];break;case "timeout":case "transport error":case "failure":delete c[d],f={status:"status"in n?n.status:500,statusText:n.statusText||a}}f&&i._ioReady(f.status,f.statusText)}});h.applyTo=function(a,b,c){var a=b.split(".").slice(1),d=h;e.each(a,function(a){d=d[a]});d.apply(null,c)};h.xdrReady=function(){d=b.getElementById(a)};h.xdrResponse=function(a,b){var d=c[b.uid];d&&d._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(e,h,i,m,j){function c(b){var c=b.config,g=c.crossDomain,l=c.xdr||{},f=l.subDomain=l.subDomain||{};this.io=b;if(g&&!i.supportCORS){var h=c.uri.getHostname();if(a.domain&&e.endsWith(h,a.domain)&&!1!==f.proxy)return new m(b);if("flash"===""+l.use||!d)return new j(b)}b=this.nativeXhr=i.nativeXhr(g);logger.debug("crossDomain: "+g+", use "+(d&&b instanceof d?"XDomainRequest":"XhrTransport")+" for: "+c.url);return this}var a=e.Env.host.document,d=i._XDomainRequest;e.augment(c,
i.proto,{send:function(){this.sendInternal()}});h.setupTransport("*",c);return h},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(e,h,i,m){function j(a){var b=a.config;if(!b.crossDomain)return new (h.getTransport("*"))(a);this.io=a;"use ScriptTransport for: "+b.url;return this}var c=e.Env.host,a=c.document;h.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){e.globalEval(a);return a}}}});e.augment(j,{send:function(){var d=this,b,e=d.io,
g=e.config,l=a.head||a.getElementsByTagName("head")[0]||a.documentElement;d.head=l;b=a.createElement("script");d.script=b;b.async=!0;g.scriptCharset&&(b.charset=g.scriptCharset);b.src=e._getUrlForSend();b.onerror=b.onload=b.onreadystatechange=function(a){a=a||c.event;d._callback((a.type||"error").toLowerCase())};l.insertBefore(b,l.firstChild)},_callback:function(a,b){var c=this.script,g=this.io,e=this.head;if(c&&(b||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=
c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),this.head=this.script=m,!b&&"error"!=a?g._ioReady(200,"success"):"error"==a&&g._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});h.setupTransport("script",j);return h},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(e,h){var i=e.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});h.on("start",function(h){var j=h.io,c=j.config,h=c.dataType;if("jsonp"==h[0]){delete c.contentType;var a,d=c.jsonpCallback,b="function"===typeof d?d():d,n=i[b];c.uri.query.set(c.jsonp,b);i[b]=function(b){1<arguments.length&&(b=e.makeArray(arguments));a=[b]};j.fin(function(){i[b]=n;if(void 0===n)try{delete i[b]}catch(c){}else a&&n(a[0])});j=c.converters;j.script=j.script||
{};j.script.json=function(){a||" not call jsonpCallback: "+b;return a[0]};h.length=2;h[0]="script";h[1]="json"}});return h},{requires:["./base"]});
KISSY.add("io/form",function(e,h,i,m){var j=Array.prototype.slice,c=e.Env.host.FormData;h.on("start",function(a){var d,b,a=a.io.config;if(b=a.form){d=i.get(b);b=a.data;for(var n=!1,g={},h=i.query("input",d),f=0,k=h.length;f<k;f++){var z=h[f];if("file"==z.type.toLowerCase()){n=!0;if(!c)break;var u=j.call(z.files,0);g[i.attr(z,"name")]=1<u.length?u:u[0]||null}}n&&c&&(a.files=a.files||{},e.mix(a.files,g),delete a.contentType);!n||c?(d=m.getFormData(d),a.hasContent?(d=e.param(d,void 0,void 0,a.serializeArray),
a.data=b?a.data+("&"+d):d):a.uri.query.add(d)):(b=a.dataType,a=b[0],"*"==a&&(a="text"),b.length=2,b[0]="iframe",b[1]=a)}});return h},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(e,h,i,m){function j(a){var b=e.guid("io-iframe"),c=h.getEmptyIframeSrc(),a=a.iframe=h.create("<iframe "+(c?' src="'+c+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');h.prepend(a,d.body||d.documentElement);return a}function c(a,b,c){var f=[],i,j,m,q;e.each(a,function(a,n){i=e.isArray(a);j=e.makeArray(a);for(m=0;m<j.length;m++)q=d.createElement("input"),q.type="hidden",q.name=n+(i&&c?"[]":""),q.value=j[m],h.append(q,
b),f.push(q)});return f}function a(a){this.io=a;"use IframeTransport for: "+a.config.url}var d=e.Env.host.document,b=e.clone(m.getConfig().converters.text);b.json=function(a){return e.parseJson(e.unEscapeHtml(a))};m.setupConfig({converters:{iframe:b,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(a,{send:function(){function a(){i.on(m,"load error",b._callback,b);o.submit()}var b=this,d=b.io,f=d.config,k,m,u,q=f.data,o=h.get(f.form);b.attrs={target:h.attr(o,"target")||
"",action:h.attr(o,"action")||"",encoding:h.attr(o,"encoding"),enctype:h.attr(o,"enctype"),method:h.attr(o,"method")};b.form=o;m=j(d);h.attr(o,{target:m.id,action:d._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});q&&(u=e.unparam(q));u&&(k=c(u,o,f.serializeArray));b.fields=k;6==e.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,c=b.form,d=b.io,a=a.type,k,j=d.iframe;if(j)if("abort"==a&&6==e.UA.ie?setTimeout(function(){h.attr(c,b.attrs)},0):h.attr(c,
b.attrs),h.remove(this.fields),i.detach(j),setTimeout(function(){h.remove(j)},30),d.iframe=null,"load"==a)try{if((k=j.contentWindow.document)&&k.body)d.responseText=h.html(k.body),e.startsWith(d.responseText,"<?xml")&&(d.responseText=void 0);d.responseXML=k&&k.XMLDocument?k.XMLDocument:k;k?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(m){d._ioReady(500,"parser error")}else"error"==a&&d._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});m.setupTransport("iframe",
a);return m},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(e,h,i){function m(c){var a=c.responseText,d=c.responseXML,b=c.config,h=b.converters,g,j,f=b.contents,k=b.dataType;if(a||d){for(b=c.mimeType||c.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(g in f)if(f[g].test(b)){k[0]!=g&&k.unshift(g);break}k[0]=k[0]||"text";for(g=0;g<k.length;g++)if("text"==k[g]&&a!==i){j=a;break}else if("xml"==k[g]&&d!==i){j=d;break}if(!j){var m={text:a,xml:d};e.each(["text","xml"],function(b){var c=k[0];return h[b]&&h[b][c]&&
m[b]?(k.unshift(b),j="text"==b?a:d,!1):i})}}f=k[0];for(b=1;b<k.length;b++){g=k[b];var u=h[f]&&h[f][g];if(!u)throw"no covert for "+f+" => "+g;j=u(j);f=g}c.responseData=j}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;e.extend(h,e.Promise,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,d;if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders={};a=
j.exec(this.responseHeadersString);)d[a[1]]=a[2];a=d[c]}return a===i?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=c&&300>c||304==c)if(304==c)a="not modified",d=!0;else try{m(this),a="success",d=!0}catch(b){b.stack||
b,a="parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;this._defer[d?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var c=this.config,a=c.uri,d=e.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(d?(a.query.has()?"&":"?")+d:d)}})},{requires:["./base"]});
KISSY.add("io",function(e,h,i){function m(c,a,d,b,e){"function"===typeof a&&(b=d,d=a,a=j);return i({type:e||"get",url:c,data:a,success:d,dataType:b})}var j=void 0;e.mix(i,{serialize:h.serialize,get:m,post:function(c,a,d,b){"function"===typeof a&&(b=d,d=a,a=j);return m(c,a,d,b,"post")},jsonp:function(c,a,d){"function"===typeof a&&(d=a,a=j);return m(c,a,d,"jsonp")},getScript:e.getScript,getJSON:function(c,a,d){"function"===typeof a&&(d=a,a=j);return m(c,a,d,"json")},upload:function(c,a,d,b,e){"function"===
typeof d&&(e=b,b=d,d=j);return i({url:c,type:"post",dataType:e,form:a,data:d,success:b})}});e.mix(e,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
