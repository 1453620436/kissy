/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 26 20:53
*/
KISSY.add("io/form-serializer",["dom"],function(f,e){function h(a){return a.replace(d,"\r\n")}var i=e("dom"),g=/^(?:select|textarea)/i,d=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,j){return f.param(c.getFormData(a),void 0,void 0,j||!1)},getFormData:function(b){var c=[],d={};f.each(i.query(b),function(a){a=a.elements?f.makeArray(a.elements):[a];c.push.apply(c,a)});c=f.filter(c,function(b){return b.name&&
!b.disabled&&(b.checked||g.test(b.nodeName)||a.test(b.type))});f.each(c,function(a){var b=i.val(a),c;null!==b&&(b=f.isArray(b)?f.map(b,h):h(b),(c=d[a.name])?(c&&!f.isArray(c)&&(c=d[a.name]=[c]),c.push.apply(c,f.makeArray(b))):d[a.name]=b)});return d}}});
KISSY.add("io/base",["event/custom","promise"],function(f,e){function h(a){var c=a.context;delete a.context;a=f.mix(f.clone(k),a,{deep:!0});a.context=c||a;var j,d=a.type,m=a.dataType,c=a.uri=n.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(n));d=a.type=d.toUpperCase();a.hasContent=!l.test(d);if(a.processData&&(j=a.data)&&"string"!=typeof j)a.data=f.param(j,g,g,a.serializeArray);m=a.dataType=f.trim(m||"*").split(b);!("cache"in a)&&f.inArray(m[0],["script",
"jsonp"])&&(a.cache=!1);a.hasContent||(a.data&&c.query.add(f.unparam(a.data)),!1===a.cache&&c.query.set("_ksTS",f.now()+"_"+f.guid()));return a}function i(a){var b=this;if(!(b instanceof i))return new i(a);c.call(b);a=h(a);f.mix(b,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});c.Defer(b);var j;i.fire("start",{ajaxConfig:a,io:b});j=new (m[a.dataType[0]]||
m["*"])(b);b.transport=j;a.contentType&&b.setRequestHeader("Content-Type",a.contentType);var d=a.dataType[0],l,n=a.timeout,k=a.context,g=a.headers,e=a.accepts;b.setRequestHeader("Accept",d&&e[d]?e[d]+("*"===d?"":", */*; q=0.01"):e["*"]);for(l in g)b.setRequestHeader(l,g[l]);if(a.beforeSend&&!1===a.beforeSend.call(k,b,a))return b;b.readyState=1;i.fire("send",{ajaxConfig:a,io:b});a.async&&0<n&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*n));try{b.state=1,j.send()}catch(v){2>b.state?
(v.stack||v,"error",setTimeout(function(){throw v;},0),b._ioReady(-1,v.message)):v}return b}var g=g,d=e("event/custom"),c=e("promise"),a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,j=function(a){return a},l=/^(?:GET|HEAD)$/,n=new f.Uri((f.Env.host.location||{}).href),a=n&&a.test(n.getScheme()),m={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",
json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,html:j,text:j,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;f.mix(i,d.Target);f.mix(i,{isLocal:a,setupConfig:function(a){f.mix(k,a,{deep:!0})},setupTransport:function(a,b){m[a]=b},getTransport:function(a){return m[a]},getConfig:function(){return k}});return i});
KISSY.add("io/xhr-transport-base",["./base"],function(f,e){function h(c,a){try{return new (a||win).XMLHttpRequest}catch(b){}}function i(c){var a;c.ifModified&&(a=c.uri,!1===c.cache&&(a=a.clone(),a.query.remove("_ksTS")),a=a.toString());return a}var g=e("./base");g.__lastModifiedCached=lastModifiedCached;g.__eTagCached=eTagCached;XhrTransportBase.nativeXhr=win.ActiveXObject?function(c,a){var b;if(!d&&c&&_XDomainRequest)b=new _XDomainRequest;else if(!(b=!g.isLocal&&h(c,a)))a:{try{b=new (a||win).ActiveXObject("Microsoft.XMLHTTP");
break a}catch(j){}b=void 0}return b}:h;XhrTransportBase._XDomainRequest=_XDomainRequest;var d=XhrTransportBase.supportCORS="withCredentials"in XhrTransportBase.nativeXhr();f.mix(XhrTransportBase.proto,{sendInternal:function(){var c=this,a=c.io,b=a.config,j=c.nativeXhr,l=b.files,n=l?"post":b.type,m=b.async,k,g=a.mimeType,e=a.requestHeaders||{},a=a._getUrlForSend(),h=i(b),q,r;if(h){if(q=lastModifiedCached[h])e["If-Modified-Since"]=q;if(q=eTagCached[h])e["If-None-Match"]=q}(k=b.username)?j.open(n,a,
m,k,b.password):j.open(n,a,m);n=b.xhrFields||{};"withCredentials"in n&&(d||delete n.withCredentials);for(r in n)try{j[r]=n[r]}catch(u){u}g&&j.overrideMimeType&&j.overrideMimeType(g);!1===e["X-Requested-With"]&&delete e["X-Requested-With"];if("undefined"!==typeof j.setRequestHeader)for(r in e)j.setRequestHeader(r,e[r]);var t=b.hasContent&&b.data||null;l&&(g=t,e={},g&&(e=f.unparam(g)),e=f.mix(e,l),t=new FormData,f.each(e,function(a,c){f.isArray(a)?f.each(a,function(a){t.append(c+(b.serializeArray?"[]":
""),a)}):t.append(c,a)}));j.send(t);!m||4==j.readyState?c._callback():_XDomainRequest&&j instanceof _XDomainRequest?(j.onload=function(){j.readyState=4;j.status=200;c._callback()},j.onerror=function(){j.readyState=4;j.status=500;c._callback()}):j.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,a){var b=this.nativeXhr,d=this.io,l,n,e,k,h,p=d.config;try{if(a||4==b.readyState)if(_XDomainRequest&&b instanceof _XDomainRequest?(b.onerror=f.noop,b.onload=
f.noop):b.onreadystatechange=f.noop,a)4!==b.readyState&&b.abort();else{l=i(p);var o=b.status;_XDomainRequest&&b instanceof _XDomainRequest||(d.responseHeadersString=b.getAllResponseHeaders());l&&(n=b.getResponseHeader("Last-Modified"),e=b.getResponseHeader("ETag"),n&&(lastModifiedCached[l]=n),e&&(eTagCached[e]=e));if((h=b.responseXML)&&h.documentElement)d.responseXML=h;var q=d.responseText=b.responseText;if(p.files&&q){var r,u;if(-1!=(r=q.indexOf("<body>")))u=q.lastIndexOf("</body>"),-1==u&&(u=q.length),
q=q.slice(r+6,u);d.responseText=f.unEscapeHtml(q)}try{k=b.statusText}catch(t){"xhr statusText error: ",t,k=""}!o&&g.isLocal&&!p.crossDomain?o=d.responseText?OK_CODE:NOT_FOUND_CODE:o===NO_CONTENT_CODE2&&(o=NO_CONTENT_CODE);d._ioReady(o,k)}}catch(w){w.stack||w,"error",setTimeout(function(){throw w;},0),b.onreadystatechange=f.noop,a||d._ioReady(-1,w)}}});return XhrTransportBase});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(f,e){function h(c,a,b){init||(init=!0,c='<object id="'+ID+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+a+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',a=doc.createElement("div"),d.prepend(a,doc.body||doc.documentElement),a.innerHTML=c)}function i(c){"use XdrFlashTransport for: "+c.config.url;this.io=
c}var g=e("./base"),d=e("dom");f.augment(i,{send:function(){var c=this,a=c.io,b=a.config;h((b.xdr||{}).src||f.Config.base+"io/assets/io.swf",1,1);flash?(c._uid=f.guid(),maps[c._uid]=c,flash.send(a._getUrlForSend(),{id:c._uid,uid:c._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){c.send()},200)},abort:function(){flash.abort(this._uid)},_xdrResponse:function(c,a){var b,d=a.id,l,f=a.c,e=this.io;if(f&&(l=f.responseText))e.responseText=decodeURI(l);switch(c){case "success":b={status:200,
statusText:"success"};delete maps[d];break;case "abort":delete maps[d];break;case "timeout":case "transport error":case "failure":delete maps[d],b={status:"status"in f?f.status:500,statusText:f.statusText||c}}b&&e._ioReady(b.status,b.statusText)}});g.applyTo=function(c,a,b){var c=a.split(".").slice(1),d=g;f.each(c,function(a){d=d[a]});d.apply(null,b)};g.xdrReady=function(){flash=doc.getElementById(ID)};g.xdrResponse=function(c,a){var b=maps[a.uid];b&&b._xdrResponse(c,a)};return i});
KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(f,e){function h(a){var b=a.config;this.io=a;b.crossDomain=!1;"use SubDomainTransport for: "+b.url}function i(){var a=this.io.config.uri.getHostname(),a=iframeMap[a];a.ready=1;g.detach(a.iframe,"load",i,this);this.send()}var g=e("event/dom"),d=e("dom"),c=e("./xhr-transport-base");f.augment(h,c.proto,{send:function(){var a=this.io.config,b=a.uri,j=b.getHostname(),l;l=iframeMap[j];var e=PROXY_PAGE;a.xdr&&a.xdr.subDomain&&
a.xdr.subDomain.proxy&&(e=a.xdr.subDomain.proxy);l&&l.ready?(this.nativeXhr=c.nativeXhr(0,l.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(l?a=l.iframe:(l=iframeMap[j]={},a=l.iframe=doc.createElement("iframe"),d.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),d.prepend(a,doc.body||doc.documentElement),l=new f.Uri,l.setScheme(b.getScheme()),l.setPort(b.getPort()),l.setHostname(j),l.setPath(e),a.src=l.toString()),g.on(a,"load",i,this))}});return h});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(f,e){function h(a){var b=a.config,j=b.crossDomain,l=b.xdr||{},e=l.subDomain=l.subDomain||{};this.io=a;if(j&&!g.supportCORS){var i=b.uri.getHostname();if(doc.domain&&f.endsWith(i,doc.domain)&&!1!==e.proxy)return new c(a);if("flash"===""+l.use||!_XDomainRequest)return new d(a)}a=this.nativeXhr=g.nativeXhr(j);"crossDomain: "+j+", use "+(_XDomainRequest&&a instanceof _XDomainRequest?
"XDomainRequest":"XhrTransport")+" for: "+b.url;return this}var i=e("./base"),g=e("./xhr-transport-base"),d=e("./xdr-flash-transport"),c=e("./sub-domain-transport");f.augment(h,g.proto,{send:function(){this.sendInternal()}});i.setupTransport("*",h);return i});
KISSY.add("io/script-transport",["./base"],function(f,e){function h(d){var c=d.config;if(!c.crossDomain)return new (g.getTransport("*"))(d);this.io=d;"use ScriptTransport for: "+c.url;return this}var i=i,g=e("./base");g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){f.globalEval(d);return d}}}});f.augment(h,{send:function(){var d=this,c,a=d.io,b=
a.config,j=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement;d.head=j;c=doc.createElement("script");d.script=c;c.async=!0;b.scriptCharset&&(c.charset=b.scriptCharset);c.src=a._getUrlForSend();c.onerror=c.onload=c.onreadystatechange=function(a){a=a||win.event;d._callback((a.type||"error").toLowerCase())};j.insertBefore(c,j.firstChild)},_callback:function(d,c){var a=this.script,b=this.io,j=this.head;if(a&&(c||!a.readyState||/loaded|complete/.test(a.readyState)||"error"==d))a.onerror=
a.onload=a.onreadystatechange=null,j&&a.parentNode&&j.removeChild(a),this.head=this.script=i,!c&&"error"!=d?b._ioReady(OK_CODE,"success"):"error"==d&&b._ioReady(ERROR_CODE,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",h);return g});
KISSY.add("io/jsonp",["./base"],function(f,e){var h=e("./base"),i=f.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});h.on("start",function(e){var d=e.io,c=d.config,e=c.dataType;if("jsonp"==e[0]){delete c.contentType;var a,b=c.jsonpCallback,j="function"===typeof b?b():b,l=i[j];c.uri.query.set(c.jsonp,j);i[j]=function(b){1<arguments.length&&(b=f.makeArray(arguments));a=[b]};d.fin(function(){i[j]=l;if(void 0===l)try{delete i[j]}catch(b){}else a&&l(a[0])});d=
c.converters;d.script=d.script||{};d.script.json=function(){a||" not call jsonpCallback: "+j;return a[0]};e.length=2;e[0]="script";e[1]="json"}});return h});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(f,e){var h=e("./base"),i=e("dom"),g=e("./form-serializer"),d=Array.prototype.slice,c=f.Env.host.FormData;h.on("start",function(a){var b,j,a=a.io.config;if(j=a.form){b=i.get(j);j=a.data;for(var l=!1,e={},m=i.query("input",b),k=0,h=m.length;k<h;k++){var p=m[k];if("file"==p.type.toLowerCase()){l=!0;if(!c)break;var o=d.call(p.files,0);e[i.attr(p,"name")]=1<o.length?o:o[0]||null}}l&&c&&(a.files=a.files||{},f.mix(a.files,e),delete a.contentType);
!l||c?(b=g.getFormData(b),a.hasContent?(b=f.param(b,void 0,void 0,a.serializeArray),a.data=j?a.data+("&"+b):b):a.uri.query.add(b)):(j=a.dataType,a=j[0],"*"==a&&(a="text"),j.length=2,j[0]="iframe",j[1]=a)}});return h});
KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(f,e){function h(a){var c=f.guid("io-iframe"),e=d.getEmptyIframeSrc(),a=a.iframe=d.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');d.prepend(a,doc.body||doc.documentElement);return a}function i(a,c,e){var n=[],i,k,g,h;f.each(a,function(a,b){i=f.isArray(a);k=f.makeArray(a);for(g=0;g<k.length;g++)h=doc.createElement("input"),h.type="hidden",h.name=b+(i&&e?"[]":
""),h.value=k[g],d.append(h,c),n.push(h)});return n}function g(a){this.io=a;"use IframeTransport for: "+a.config.url}var d=e("dom"),c=e("./base"),a=e("event/dom");iframeConverter.json=function(a){return f.parseJson(f.unEscapeHtml(a))};c.setupConfig({converters:{iframe:iframeConverter,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(g,{send:function(){function b(){a.on(k,"load error",c._callback,c);o.submit()}var c=this,e=c.io,g=e.config,m,k,s,p=g.data,o=d.get(g.form);
c.attrs={target:d.attr(o,"target")||"",action:d.attr(o,"action")||"",encoding:d.attr(o,"encoding"),enctype:d.attr(o,"enctype"),method:d.attr(o,"method")};c.form=o;k=h(e);d.attr(o,{target:k.id,action:e._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});p&&(s=f.unparam(p));s&&(m=i(s,o,g.serializeArray));c.fields=m;6==f.UA.ie?setTimeout(b,0):b()},_callback:function(b){var c=this,e=c.form,g=c.io,b=b.type,h,k=g.iframe;if(k)if("abort"==b&&6==f.UA.ie?setTimeout(function(){d.attr(e,
c.attrs)},0):d.attr(e,c.attrs),d.remove(this.fields),a.detach(k),setTimeout(function(){d.remove(k)},BREATH_INTERVAL),g.iframe=null,"load"==b)try{if((h=k.contentWindow.document)&&h.body)g.responseText=d.html(h.body),f.startsWith(g.responseText,"<?xml")&&(g.responseText=void 0);g.responseXML=h&&h.XMLDocument?h.XMLDocument:h;h?g._ioReady(OK_CODE,"success"):g._ioReady(ERROR_CODE,"parser error")}catch(i){g._ioReady(ERROR_CODE,"parser error")}else"error"==b&&g._ioReady(ERROR_CODE,"error")},abort:function(){this._callback({type:"abort"})}});
c.setupTransport("iframe",g);return c});
KISSY.add("io/methods",["promise","./base"],function(f,e){function h(d){var c=d.responseText,a=d.responseXML,b=d.config,e=b.converters,g,h,i=b.contents,k=b.dataType;if(c||a){for(b=d.mimeType||d.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(g in i)if(i[g].test(b)){k[0]!=g&&k.unshift(g);break}k[0]=k[0]||"text";for(g=0;g<k.length;g++)if("text"==k[g]&&void 0!==c){h=c;break}else if("xml"==k[g]&&void 0!==a){h=a;break}if(!h){var s={text:c,xml:a};f.each(["text","xml"],function(b){var d=
k[0];if(e[b]&&e[b][d]&&s[b])return k.unshift(b),h="text"==b?c:a,!1})}}i=k[0];for(b=1;b<k.length;b++){g=k[b];var p=e[i]&&e[i][g];if(!p)throw"no covert for "+i+" => "+g;h=p(h);i=g}d.responseData=h}var i=e("promise"),g=e("./base");f.extend(g,i,{setRequestHeader:function(d,c){this.requestHeaders[d]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var c,a,d=d.toLowerCase();if(2===this.state){if(!(a=this.responseHeaders))for(a=
this.responseHeaders={};c=rheaders.exec(this.responseHeadersString);)a[c[1].toLowerCase()]=c[2];c=a[d]}return void 0===c?null:c},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;return(d=this.transport)?d.nativeXhr:null},_ioReady:function(d,c){if(2!=this.state){this.state=2;this.readyState=4;var a;if(d>=OK_CODE&&d<MULTIPLE_CHOICES||d==NOT_MODIFIED)if(d==
NOT_MODIFIED)c="not modified",a=!0;else try{h(this),c="success",a=!0}catch(b){b.stack||b,"error",setTimeout(function(){throw b;},0),c="parser error"}else 0>d&&(d=0);this.status=d;this.statusText=c;var e=this.defer,f=this.config,i;if(i=this.timeoutTimer)clearTimeout(i),this.timeoutTimer=0;i=a?"success":"error";var m,k=[this.responseData,c,this],s=f.context,p={ajaxConfig:f,io:this};(m=f[i])&&m.apply(s,k);(m=f.complete)&&m.apply(s,k);g.fire(i,p);g.fire("complete",p);e[a?"resolve":"reject"](k)}},_getUrlForSend:function(){var d=
this.config,c=d.uri,a=f.Uri.getComponents(d.url).query||"";return c.toString.call(c,d.serializeArray)+(a?(c.query.has()?"&":"?")+a:a)}})});
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(f,e){function h(c,a,b,e,f){if(typeof a==="function"){e=b;b=a;a=i}return d({type:f||"get",url:c,data:a,success:b,dataType:e})}var i=i,g=e("io/form-serializer"),d=e("io/base");e("io/xhr-transport");e("io/script-transport");e("io/jsonp");e("io/form");e("io/iframe-transport");e("io/methods");f.mix(d,{serialize:g.serialize,get:h,post:function(c,a,b,d){if(typeof a===
"function"){d=b;b=a;a=i}return h(c,a,b,d,"post")},jsonp:function(c,a,b){if(typeof a==="function"){b=a;a=i}return h(c,a,b,"jsonp")},getScript:f.getScript,getJSON:function(c,a,b){if(typeof a==="function"){b=a;a=i}return h(c,a,b,"json")},upload:function(c,a,b,e,f){if(typeof b==="function"){f=e;e=b;b=i}return d({url:c,type:"post",dataType:f,form:a,data:b,success:e})}});f.mix(f,{Ajax:d,IO:d,ajax:d,io:d,jsonp:d.jsonp});return d});
