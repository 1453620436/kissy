/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Oct 25 16:28
*/
KISSY.add("io/form-serializer",function(f,j){function l(a){return a.replace(k,"\r\n")}var m=/^(?:select|textarea)/i,k=/\r?\n/g,e,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(a,c){return f.param(e.getFormData(a),void 0,void 0,c||!1)},getFormData:function(g){var c=[],e={};f.each(j.query(g),function(b){b=b.elements?f.makeArray(b.elements):[b];c.push.apply(c,b)});c=f.filter(c,function(b){return b.name&&!b.disabled&&
(b.checked||m.test(b.nodeName)||a.test(b.type))});f.each(c,function(b){var i=j.val(b),h;null!==i&&(i=f.isArray(i)?f.map(i,l):l(i),(h=e[b.name])?(h&&!f.isArray(h)&&(h=e[b.name]=[h]),h.push.apply(h,f.makeArray(i))):e[b.name]=i)});return e}}},{requires:["dom"]});
KISSY.add("io/base",function(f,j,l){function m(d){var i=d.context;delete d.context;d=f.mix(f.clone(h),d,{deep:!0});d.context=i||d;var c,g=d.type,e=d.dataType,i=d.uri=b.resolve(d.url);d.uri.setQuery("");"crossDomain"in d||(d.crossDomain=!d.uri.isSameOriginAs(b));g=d.type=g.toUpperCase();d.hasContent=!n.test(g);if(d.processData&&(c=d.data)&&"string"!=typeof c)d.data=f.param(c,l,l,d.serializeArray);e=d.dataType=f.trim(e||"*").split(a);!("cache"in d)&&f.inArray(e[0],["script","jsonp"])&&(d.cache=!1);
d.hasContent||(d.data&&i.query.add(f.unparam(d.data)),!1===d.cache&&i.query.set("_ksTS",f.now()+"_"+f.guid()));return d}function k(d){var b=this;if(!(b instanceof k))return new k(d);c.call(b);d=m(d);f.mix(b,{responseData:null,config:d||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});f.Defer(b);var h;k.fire("start",{ajaxConfig:d,io:b});h=new (i[d.dataType[0]]||i["*"])(b);
b.transport=h;d.contentType&&b.setRequestHeader("Content-Type",d.contentType);var a=d.dataType[0],g,e=d.timeout,n=d.context,j=d.headers,l=d.accepts;b.setRequestHeader("Accept",a&&l[a]?l[a]+("*"===a?"":", */*; q=0.01"):l["*"]);for(g in j)b.setRequestHeader(g,j[g]);if(d.beforeSend&&!1===d.beforeSend.call(n,b,d))return b;b.readyState=1;k.fire("send",{ajaxConfig:d,io:b});d.async&&0<e&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*e));try{b.state=1,h.send()}catch(p){2>b.state?(p.stack||
p,b._ioReady(-1,p.message)):p}return b}var e=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,g=function(b){return b},c=f.Promise,n=/^(?:GET|HEAD)$/,b=new f.Uri((f.Env.host.location||{}).href),e=b&&e.test(b.getScheme()),i={},h={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,
html:g,text:g,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};h.converters.html=h.converters.text;f.mix(k,j.targetObject);f.mix(k,{isLocal:e,setupConfig:function(b){f.mix(h,b,{deep:!0})},setupTransport:function(b,h){i[b]=h},getTransport:function(b){return i[b]},getConfig:function(){return h}});return k},{requires:["event/custom"]});
KISSY.add("io/xhr-transport-base",function(f,j){function l(b,i){try{return new (i||k).XMLHttpRequest}catch(h){}}function m(b){var i;b.ifModified&&(i=b.uri,!1===b.cache&&(i=i.clone(),i.query.remove("_ksTS")),i=i.toString());return i}var k=f.Env.host,e=7<f.UA.ie&&k.XDomainRequest,a={proto:{}},g={},c={};j.__lastModifiedCached=g;j.__eTagCached=c;a.nativeXhr=k.ActiveXObject?function(b,i){var h;if(!n&&b&&e)h=new e;else if(!(h=!j.isLocal&&l(b,i)))a:{try{h=new (i||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}h=
void 0}return h}:l;a._XDomainRequest=e;var n=a.supportCORS="withCredentials"in a.nativeXhr();f.mix(a.proto,{sendInternal:function(){var b=this,i=b.io,h=i.config,d=b.nativeXhr,a=h.files,j=a?"post":h.type,l=h.async,k,u=i.mimeType,s=i.requestHeaders||{},i=i._getUrlForSend(),o;o=m(h);var r,p;if(o){if(r=g[o])s["If-Modified-Since"]=r;if(r=c[o])s["If-None-Match"]=r}o=h.xhrFields||{};"withCredentials"in o?n||delete o.withCredentials:n&&(o.withCredentials=!0);(k=h.username)?d.open(j,i,l,k,h.password):d.open(j,
i,l);for(p in o)try{d[p]=o[p]}catch(v){v}u&&d.overrideMimeType&&d.overrideMimeType(u);!1===s["X-Requested-With"]&&delete s["X-Requested-With"];if("undefined"!==typeof d.setRequestHeader)for(p in s)d.setRequestHeader(p,s[p]);var t=h.hasContent&&h.data||null;a&&(j=t,k={},j&&(k=f.unparam(j)),k=f.mix(k,a),t=new FormData,f.each(k,function(b,d){f.isArray(b)?f.each(b,function(b){t.append(d+(h.serializeArray?"[]":""),b)}):t.append(d,b)}));d.send(t);!l||4==d.readyState?b._callback():e&&d instanceof e?(d.onload=
function(){d.readyState=4;d.status=200;b._callback()},d.onerror=function(){d.readyState=4;d.status=500;b._callback()}):d.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,a){var h=this.nativeXhr,d=this.io,n,l,k,q,u,s=d.config;try{if(a||4==h.readyState)if(e&&h instanceof e?(h.onerror=f.noop,h.onload=f.noop):h.onreadystatechange=f.noop,a)4!==h.readyState&&h.abort();else{n=m(s);var o=h.status;e&&h instanceof e||(d.responseHeadersString=h.getAllResponseHeaders());
n&&(l=h.getResponseHeader("Last-Modified"),k=h.getResponseHeader("ETag"),l&&(g[n]=l),k&&(c[k]=k));if((u=h.responseXML)&&u.documentElement)d.responseXML=u;var r=d.responseText=h.responseText;if(s.files&&r){var p,v;if(-1!=(p=r.indexOf("<body>")))v=r.lastIndexOf("</body>"),-1==v&&(v=r.length),r=r.slice(p+6,v);d.responseText=f.unEscapeHtml(r)}try{q=h.statusText}catch(t){"xhr statusText error: ",t,q=""}!o&&j.isLocal&&!s.crossDomain?o=d.responseText?200:404:1223===o&&(o=204);d._ioReady(o,q)}}catch(z){h.onreadystatechange=
f.noop,a||d._ioReady(-1,z)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(f,j,l,m){function k(a){var g=a.config;this.io=a;g.crossDomain=!1;"use SubDomainTransport for: "+g.url}function e(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;l.detach(a.iframe,"load",e,this);this.send()}var a=f.Env.host.document,g={};f.augment(k,j.proto,{send:function(){var c=this.io.config,n=c.uri,b=n.getHostname(),i;i=g[b];var h="/sub_domain_proxy.html";c.xdr&&c.xdr.subDomain&&c.xdr.subDomain.proxy&&(h=c.xdr.subDomain.proxy);i&&i.ready?(this.nativeXhr=
j.nativeXhr(0,i.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(i?c=i.iframe:(i=g[b]={},c=i.iframe=a.createElement("iframe"),m.css(c,{position:"absolute",left:"-9999px",top:"-9999px"}),m.prepend(c,a.body||a.documentElement),i=new f.Uri,i.setScheme(n.getScheme()),i.setPort(n.getPort()),i.setHostname(b),i.setPath(h),c.src=i.toString()),l.on(c,"load",e,this))}});return k},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(f,j,l){function m(b,i,h){n||(n=!0,b='<object id="'+a+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+i+"&uid="+h+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',i=c.createElement("div"),l.prepend(i,c.body||c.documentElement),i.innerHTML=b)}function k(b){"use XdrFlashTransport for: "+b.config.url;this.io=b}var e={},a="io_swf",
g,c=f.Env.host.document,n=!1;f.augment(k,{send:function(){var b=this,a=b.io,h=a.config;m((h.xdr||{}).src||f.Config.base+"io/assets/io.swf",1,1);g?(b._uid=f.guid(),e[b._uid]=b,g.send(a._getUrlForSend(),{id:b._uid,uid:b._uid,method:h.type,data:h.hasContent&&h.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){g.abort(this._uid)},_xdrResponse:function(b,a){var h,d=a.id,g,c=a.c,f=this.io;if(c&&(g=c.responseText))f.responseText=decodeURI(g);switch(b){case "success":h={status:200,statusText:"success"};
delete e[d];break;case "abort":delete e[d];break;case "timeout":case "transport error":case "failure":delete e[d],h={status:"status"in c?c.status:500,statusText:c.statusText||b}}h&&f._ioReady(h.status,h.statusText)}});j.applyTo=function(b,a,h){var b=a.split(".").slice(1),d=j;f.each(b,function(b){d=d[b]});d.apply(null,h)};j.xdrReady=function(){g=c.getElementById(a)};j.xdrResponse=function(b,a){var h=e[a.uid];h&&h._xdrResponse(b,a)};return k},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(f,j,l,m,k){function e(c){var e=c.config,b=e.crossDomain,i=e.xdr||{},h=i.subDomain=i.subDomain||{};this.io=c;if(b&&!l.supportCORS){var d=e.uri.getHostname();if(a.domain&&f.endsWith(d,a.domain)&&!1!==h.proxy)return new m(c);if("flash"===""+i.use||!g)return new k(c)}c=this.nativeXhr=l.nativeXhr(b);"crossDomain: "+b+", use "+(g&&c instanceof g?"XDomainRequest":"XhrTransport")+" for: "+e.url;return this}var a=f.Env.host.document,g=l._XDomainRequest;f.augment(e,l.proto,
{send:function(){this.sendInternal()}});j.setupTransport("*",e);return j},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(f,j,l,m){function k(a){var c=a.config;if(!c.crossDomain)return new (j.getTransport("*"))(a);this.io=a;"use ScriptTransport for: "+c.url;return this}var e=f.Env.host,a=e.document;j.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){f.globalEval(a);return a}}}});f.augment(k,{send:function(){var g=this,c,f=g.io,
b=f.config,i=a.head||a.getElementsByTagName("head")[0]||a.documentElement;g.head=i;c=a.createElement("script");g.script=c;c.async=!0;b.scriptCharset&&(c.charset=b.scriptCharset);c.src=f._getUrlForSend();c.onerror=c.onload=c.onreadystatechange=function(b){b=b||e.event;g._callback((b.type||"error").toLowerCase())};i.insertBefore(c,i.firstChild)},_callback:function(a,c){var e=this.script,b=this.io,f=this.head;if(e&&(c||!e.readyState||/loaded|complete/.test(e.readyState)||"error"==a))e.onerror=e.onload=
e.onreadystatechange=null,f&&e.parentNode&&f.removeChild(e),this.head=this.script=m,!c&&"error"!=a?b._ioReady(200,"success"):"error"==a&&b._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});j.setupTransport("script",k);return j},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(f,j){var l=f.Env.host;j.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});j.on("start",function(j){var k=j.io,e=k.config,j=e.dataType;if("jsonp"==j[0]){delete e.contentType;var a,g=e.jsonpCallback,c="function"===typeof g?g():g,n=l[c];e.uri.query.set(e.jsonp,c);l[c]=function(b){1<arguments.length&&(b=f.makeArray(arguments));a=[b]};k.fin(function(){l[c]=n;if(void 0===n)try{delete l[c]}catch(b){}else a&&n(a[0])});k=e.converters;k.script=k.script||
{};k.script.json=function(){a||" not call jsonpCallback: "+c;return a[0]};j.length=2;j[0]="script";j[1]="json"}});return j},{requires:["./base"]});
KISSY.add("io/form",function(f,j,l,m){var k=Array.prototype.slice,e=f.Env.host.FormData;j.on("start",function(a){var g,c,a=a.io.config;if(c=a.form){g=l.get(c);c=a.data;for(var j=!1,b={},i=l.query("input",g),h=0,d=i.length;h<d;h++){var w=i[h];if("file"==w.type.toLowerCase()){j=!0;if(!e)break;var x=k.call(w.files,0);b[l.attr(w,"name")]=1<x.length?x:x[0]||null}}j&&e&&(a.files=a.files||{},f.mix(a.files,b),delete a.contentType);!j||e?(g=m.getFormData(g),a.hasContent?(g=f.param(g,void 0,void 0,a.serializeArray),
a.data=c?a.data+("&"+g):g):a.uri.query.add(g)):(c=a.dataType,a=c[0],"*"==a&&(a="text"),c.length=2,c[0]="iframe",c[1]=a)}});return j},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(f,j,l,m){function k(a){var b=f.guid("io-iframe"),e=j.getEmptyIframeSrc(),a=a.iframe=j.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');j.prepend(a,g.body||g.documentElement);return a}function e(a,b,e){var h=[],d,c,l,k;f.each(a,function(a,n){d=f.isArray(a);c=f.makeArray(a);for(l=0;l<c.length;l++)k=g.createElement("input"),k.type="hidden",k.name=n+(d&&e?"[]":""),k.value=c[l],j.append(k,
b),h.push(k)});return h}function a(a){this.io=a;"use IframeTransport for: "+a.config.url}var g=f.Env.host.document,c=f.clone(m.getConfig().converters.text);c.json=function(a){return f.parseJson(f.unEscapeHtml(a))};m.setupConfig({converters:{iframe:c,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(a,{send:function(){function a(){l.on(g,"load error",b._callback,b);q.submit()}var b=this,c=b.io,h=c.config,d,g,m,y=h.data,q=j.get(h.form);b.attrs={target:j.attr(q,"target")||
"",action:j.attr(q,"action")||"",encoding:j.attr(q,"encoding"),enctype:j.attr(q,"enctype"),method:j.attr(q,"method")};b.form=q;g=k(c);j.attr(q,{target:g.id,action:c._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});y&&(m=f.unparam(y));m&&(d=e(m,q,h.serializeArray));b.fields=d;6==f.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,e=b.form,c=b.io,a=a.type,d,g=c.iframe;if(g)if("abort"==a&&6==f.UA.ie?setTimeout(function(){j.attr(e,b.attrs)},0):j.attr(e,
b.attrs),j.remove(this.fields),l.detach(g),setTimeout(function(){j.remove(g)},30),c.iframe=null,"load"==a)try{if((d=g.contentWindow.document)&&d.body)c.responseText=j.html(d.body),f.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=d&&d.XMLDocument?d.XMLDocument:d;d?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(k){c._ioReady(500,"parser error")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});m.setupTransport("iframe",
a);return m},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(f,j,l){function m(e){var a=e.responseText,g=e.responseXML,c=e.config,j=c.converters,b,i,h=c.contents,d=c.dataType;if(a||g){for(c=e.mimeType||e.getResponseHeader("Content-Type");"*"==d[0];)d.shift();if(!d.length)for(b in h)if(h[b].test(c)){d[0]!=b&&d.unshift(b);break}d[0]=d[0]||"text";for(b=0;b<d.length;b++)if("text"==d[b]&&a!==l){i=a;break}else if("xml"==d[b]&&g!==l){i=g;break}if(!i){var k={text:a,xml:g};f.each(["text","xml"],function(b){var c=d[0];return j[b]&&j[b][c]&&
k[b]?(d.unshift(b),i="text"==b?a:g,!1):l})}}h=d[0];for(c=1;c<d.length;c++){b=d[c];var m=j[h]&&j[h][b];if(!m)throw"no covert for "+h+" => "+b;i=m(i);h=b}e.responseData=i}var k=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;f.extend(j,f.Promise,{setRequestHeader:function(e,a){this.requestHeaders[e]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(e){var a,g;if(2===this.state){if(!(g=this.responseHeaders))for(g=this.responseHeaders={};a=
k.exec(this.responseHeadersString);)g[a[1]]=a[2];a=g[e]}return a===l?null:a},overrideMimeType:function(e){this.state||(this.mimeType=e);return this},abort:function(e){e=e||"abort";this.transport&&this.transport.abort(e);this._ioReady(0,e);return this},getNativeXhr:function(){var e;return(e=this.transport)?e.nativeXhr:null},_ioReady:function(e,a){if(2!=this.state){this.state=2;this.readyState=4;var g;if(200<=e&&300>e||304==e)if(304==e)a="not modified",g=!0;else try{m(this),a="success",g=!0}catch(c){c.stack||
c,a="parser error"}else 0>e&&(e=0);this.status=e;this.statusText=a;var f=this.defer,b=this.config,i;if(i=this.timeoutTimer)clearTimeout(i),this.timeoutTimer=0;i=g?"success":"error";var h,d=[this.responseData,a,this],k=b.context,l={ajaxConfig:b,io:this};(h=b[i])&&h.apply(k,d);(h=b.complete)&&h.apply(k,d);j.fire(i,l);j.fire("complete",l);f[g?"resolve":"reject"](d)}},_getUrlForSend:function(){var e=this.config,a=e.uri,g=f.Uri.getComponents(e.url).query||"";return a.toString.call(a,e.serializeArray)+
(g?(a.query.has()?"&":"?")+g:g)}})},{requires:["./base"]});
KISSY.add("io",function(f,j,l){function m(e,a,g,c,f){"function"===typeof a&&(c=g,g=a,a=k);return l({type:f||"get",url:e,data:a,success:g,dataType:c})}var k=void 0;f.mix(l,{serialize:j.serialize,get:m,post:function(e,a,g,c){"function"===typeof a&&(c=g,g=a,a=k);return m(e,a,g,c,"post")},jsonp:function(e,a,g){"function"===typeof a&&(g=a,a=k);return m(e,a,g,"jsonp")},getScript:f.getScript,getJSON:function(e,a,g){"function"===typeof a&&(g=a,a=k);return m(e,a,g,"json")},upload:function(e,a,g,c,f){"function"===
typeof g&&(f=c,c=g,g=k);return l({url:e,type:"post",dataType:f,form:a,data:g,success:c})}});f.mix(f,{Ajax:l,IO:l,ajax:l,io:l,jsonp:l.jsonp});return l},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
