/*
Copyright 2013, KISSY v1.50dev
MIT Licensed
build time: Nov 27 00:48
*/
KISSY.add("io/form-serializer",["dom"],function(d,h){function l(a){return a.replace(j,"\r\n")}var m=h("dom"),i=/^(?:select|textarea)/i,j=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,b){return d.param(c.getFormData(a),void 0,void 0,b||!1)},getFormData:function(k){var b=[],c={};d.each(m.query(k),function(g){g=g.elements?d.makeArray(g.elements):[g];b.push.apply(b,g)});b=d.filter(b,function(g){return g.name&&
!g.disabled&&(g.checked||i.test(g.nodeName)||a.test(g.type))});d.each(b,function(g){var a=m.val(g),e;null!==a&&(a=d.isArray(a)?d.map(a,l):l(a),(e=c[g.name])?(e&&!d.isArray(e)&&(e=c[g.name]=[e]),e.push.apply(e,d.makeArray(a))):c[g.name]=a)});return c}}});
KISSY.add("io/base",["event/custom","promise"],function(d,h){function l(f){var a=f.context;delete f.context;f=d.mix(d.clone(e),f,{deep:!0});f.context=a||f;var b,c=f.type,n=f.dataType,a=f.uri=g.resolve(f.url);f.uri.setQuery("");"crossDomain"in f||(f.crossDomain=!f.uri.isSameOriginAs(g));c=f.type=c.toUpperCase();f.hasContent=!o.test(c);if(f.processData&&(b=f.data)&&"string"!=typeof b)f.data=d.param(b,i,i,f.serializeArray);n=f.dataType=d.trim(n||"*").split(k);!("cache"in f)&&d.inArray(n[0],["script",
"jsonp"])&&(f.cache=!1);f.hasContent||(f.data&&a.query.add(d.unparam(f.data)),!1===f.cache&&a.query.set("_ksTS",d.now()+"_"+d.guid()));return f}function m(a){var g=this;if(!(g instanceof m))return new m(a);c.call(g);a=l(a);d.mix(g,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});c.Defer(g);var b;m.fire("start",{ajaxConfig:a,io:g});b=new (n[a.dataType[0]]||
n["*"])(g);g.transport=b;a.contentType&&g.setRequestHeader("Content-Type",a.contentType);var e=a.dataType[0],k,o=a.timeout,j=a.context,i=a.headers,h=a.accepts;g.setRequestHeader("Accept",e&&h[e]?h[e]+("*"===e?"":", */*; q=0.01"):h["*"]);for(k in i)g.setRequestHeader(k,i[k]);if(a.beforeSend&&!1===a.beforeSend.call(j,g,a))return g;g.readyState=1;m.fire("send",{ajaxConfig:a,io:g});a.async&&0<o&&(g.timeoutTimer=setTimeout(function(){g.abort("timeout")},1E3*o));try{g.state=1,b.send()}catch(q){2>g.state?
(q.stack||q,"error",setTimeout(function(){throw q;},0),g._ioReady(-1,q.message)):q}return g}var i=i,j=h("event/custom"),c=h("promise"),a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,k=/\s+/,b=function(a){return a},o=/^(?:GET|HEAD)$/,g=new d.Uri((d.Env.host.location||{}).href),a=g&&a.test(g.getScheme()),n={},e={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",
json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:d.parseJson,html:b,text:b,xml:d.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};e.converters.html=e.converters.text;d.mix(m,j.Target);d.mix(m,{isLocal:a,setupConfig:function(a){d.mix(e,a,{deep:!0})},setupTransport:function(a,g){n[a]=g},getTransport:function(a){return n[a]},getConfig:function(){return e}});return m});
KISSY.add("io/xhr-transport-base",["./base"],function(d,h){function l(a,b){try{return new (b||j).XMLHttpRequest}catch(e){}}function m(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var i=h("./base"),j=d.Env.host,c=7<d.UA.ieMode&&j.XDomainRequest,a={proto:{}},k={},b={};i.__lastModifiedCached=k;i.__eTagCached=b;a.nativeXhr=j.ActiveXObject?function(a,b){var e;if(!o&&a&&c)e=new c;else if(!(e=!i.isLocal&&l(a,b)))a:{try{e=new (b||j).ActiveXObject("Microsoft.XMLHTTP");
break a}catch(f){}e=void 0}return e}:l;a._XDomainRequest=c;var o=a.supportCORS="withCredentials"in a.nativeXhr();d.mix(a.proto,{sendInternal:function(){var a=this,n=a.io,e=n.config,f=a.nativeXhr,j=e.files,i=j?"post":e.type,h=e.async,l,t=n.mimeType,p=n.requestHeaders||{},n=n._getUrlForSend(),u=m(e),r,q;if(u){if(r=k[u])p["If-Modified-Since"]=r;if(r=b[u])p["If-None-Match"]=r}(l=e.username)?f.open(i,n,h,l,e.password):f.open(i,n,h);i=e.xhrFields||{};"withCredentials"in i&&(o||delete i.withCredentials);
for(q in i)try{f[q]=i[q]}catch(w){w}t&&f.overrideMimeType&&f.overrideMimeType(t);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof f.setRequestHeader)for(q in p)f.setRequestHeader(q,p[q]);var v=e.hasContent&&e.data||null;j&&(t=v,p={},t&&(p=d.unparam(t)),p=d.mix(p,j),v=new FormData,d.each(p,function(a,g){d.isArray(a)?d.each(a,function(a){v.append(g+(e.serializeArray?"[]":""),a)}):v.append(g,a)}));f.send(v);!h||4==f.readyState?a._callback():c&&f instanceof c?(f.onload=
function(){f.readyState=4;f.status=200;a._callback()},f.onerror=function(){f.readyState=4;f.status=500;a._callback()}):f.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,n){var e=this.nativeXhr,f=this.io,o,j,h,l,t,p=f.config;try{if(n||4==e.readyState)if(c&&e instanceof c?(e.onerror=d.noop,e.onload=d.noop):e.onreadystatechange=d.noop,n)4!==e.readyState&&e.abort();else{o=m(p);var u=e.status;c&&e instanceof c||(f.responseHeadersString=e.getAllResponseHeaders());
o&&(j=e.getResponseHeader("Last-Modified"),h=e.getResponseHeader("ETag"),j&&(k[o]=j),h&&(b[h]=h));if((t=e.responseXML)&&t.documentElement)f.responseXML=t;var r=f.responseText=e.responseText;if(p.files&&r){var q,w;if(-1!=(q=r.indexOf("<body>")))w=r.lastIndexOf("</body>"),-1==w&&(w=r.length),r=r.slice(q+6,w);f.responseText=d.unEscapeHtml(r)}try{l=e.statusText}catch(v){"xhr statusText error: ",v,l=""}!u&&i.isLocal&&!p.crossDomain?u=f.responseText?200:404:1223===u&&(u=204);f._ioReady(u,l)}}catch(x){x.stack||
x,"error",setTimeout(function(){throw x;},0),e.onreadystatechange=d.noop,n||f._ioReady(-1,x)}}});return a});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(d,h){function l(g,c,e){o||(o=!0,g='<object id="'+a+'" type="application/x-shockwave-flash" data="'+g+'" width="0" height="0"><param name="movie" value="'+g+'" /><param name="FlashVars" value="yid='+c+"&uid="+e+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',c=b.createElement("div"),j.prepend(c,b.body||b.documentElement),c.innerHTML=g)}function m(a){"use XdrFlashTransport for: "+a.config.url;this.io=a}var i=
h("./base"),j=h("dom"),c={},a="io_swf",k,b=d.Env.host.document,o=!1;d.augment(m,{send:function(){var a=this,b=a.io,e=b.config;l((e.xdr||{}).src||d.Config.base+"io/assets/io.swf",1,1);k?(a._uid=d.guid(),c[a._uid]=a,k.send(b._getUrlForSend(),{id:a._uid,uid:a._uid,method:e.type,data:e.hasContent&&e.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){k.abort(this._uid)},_xdrResponse:function(a,b){var e,f=b.id,k,d=b.c,o=this.io;if(d&&(k=d.responseText))o.responseText=decodeURI(k);switch(a){case "success":e=
{status:200,statusText:"success"};delete c[f];break;case "abort":delete c[f];break;case "timeout":case "transport error":case "failure":delete c[f],e={status:"status"in d?d.status:500,statusText:d.statusText||a}}e&&o._ioReady(e.status,e.statusText)}});i.applyTo=function(a,b,e){var a=b.split(".").slice(1),c=i;d.each(a,function(a){c=c[a]});c.apply(null,e)};i.xdrReady=function(){k=b.getElementById(a)};i.xdrResponse=function(a,b){var e=c[b.uid];e&&e._xdrResponse(a,b)};return m});
KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(d,h){function l(a){var c=a.config;this.io=a;c.crossDomain=!1;"use SubDomainTransport for: "+c.url}function m(){var a=this.io.config.uri.getHostname(),a=k[a];a.ready=1;i.detach(a.iframe,"load",m,this);this.send()}var i=h("event/dom"),j=h("dom"),c=h("./xhr-transport-base"),a=d.Env.host.document,k={};d.augment(l,c.proto,{send:function(){var b=this.io.config,o=b.uri,g=o.getHostname(),n;n=k[g];var e="/sub_domain_proxy.html";
b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(e=b.xdr.subDomain.proxy);n&&n.ready?(this.nativeXhr=c.nativeXhr(0,n.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(n?b=n.iframe:(n=k[g]={},b=n.iframe=a.createElement("iframe"),j.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),j.prepend(b,a.body||a.documentElement),n=new d.Uri,n.setScheme(o.getScheme()),n.setPort(o.getPort()),n.setHostname(g),n.setPath(e),b.src=n.toString()),i.on(b,"load",m,this))}});return l});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(d,h){function l(b){var o=b.config,g=o.crossDomain,n=o.xdr||{},e=n.subDomain=n.subDomain||{};this.io=b;if(g&&!i.supportCORS){var f=o.uri.getHostname();if(a.domain&&d.endsWith(f,a.domain)&&!1!==e.proxy)return new c(b);if("flash"===""+n.use||!k)return new j(b)}b=this.nativeXhr=i.nativeXhr(g);"crossDomain: "+g+", use "+(k&&b instanceof k?"XDomainRequest":"XhrTransport")+" for: "+o.url;
return this}var m=h("./base"),i=h("./xhr-transport-base"),j=h("./xdr-flash-transport"),c=h("./sub-domain-transport"),a=d.Env.host.document,k=i._XDomainRequest;d.augment(l,i.proto,{send:function(){this.sendInternal()}});m.setupTransport("*",l);return m});
KISSY.add("io/script-transport",["./base"],function(d,h){function l(a){var c=a.config;if(!c.crossDomain)return new (i.getTransport("*"))(a);this.io=a;"use ScriptTransport for: "+c.url;return this}var m=m,i=h("./base"),j=d.Env.host,c=j.document;i.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){d.globalEval(a);return a}}}});d.augment(l,{send:function(){var a=
this,k,b=a.io,d=b.config,g=c.head||c.getElementsByTagName("head")[0]||c.documentElement;a.head=g;k=c.createElement("script");a.script=k;k.async=!0;d.scriptCharset&&(k.charset=d.scriptCharset);k.src=b._getUrlForSend();k.onerror=k.onload=k.onreadystatechange=function(b){b=b||j.event;a._callback((b.type||"error").toLowerCase())};g.insertBefore(k,g.firstChild)},_callback:function(a,c){var b=this.script,d=this.io,g=this.head;if(b&&(c||!b.readyState||/loaded|complete/.test(b.readyState)||"error"==a))b.onerror=
b.onload=b.onreadystatechange=null,g&&b.parentNode&&g.removeChild(b),this.head=this.script=m,!c&&"error"!=a?d._ioReady(200,"success"):"error"==a&&d._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});i.setupTransport("script",l);return i});
KISSY.add("io/jsonp",["./base"],function(d,h){var l=h("./base"),m=d.Env.host;l.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});l.on("start",function(i){var j=i.io,c=j.config,i=c.dataType;if("jsonp"==i[0]){delete c.contentType;var a,k=c.jsonpCallback,b="function"===typeof k?k():k,o=m[b];c.uri.query.set(c.jsonp,b);m[b]=function(b){1<arguments.length&&(b=d.makeArray(arguments));a=[b]};j.fin(function(){m[b]=o;if(void 0===o)try{delete m[b]}catch(c){}else a&&o(a[0])});j=
c.converters;j.script=j.script||{};j.script.json=function(){a||" not call jsonpCallback: "+b;return a[0]};i.length=2;i[0]="script";i[1]="json"}});return l});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(d,h){var l=h("./base"),m=h("dom"),i=h("./form-serializer"),j=Array.prototype.slice,c=d.Env.host.FormData;l.on("start",function(a){var k,b,a=a.io.config;if(b=a.form){k=m.get(b);b=a.data;for(var o=!1,g={},n=m.query("input",k),e=0,f=n.length;e<f;e++){var h=n[e];if("file"==h.type.toLowerCase()){o=!0;if(!c)break;var l=j.call(h.files,0);g[m.attr(h,"name")]=1<l.length?l:l[0]||null}}o&&c&&(a.files=a.files||{},d.mix(a.files,g),delete a.contentType);
!o||c?(k=i.getFormData(k),a.hasContent?(k=d.param(k,void 0,void 0,a.serializeArray),a.data=b?a.data+("&"+k):k):a.uri.query.add(k)):(b=a.dataType,a=b[0],"*"==a&&(a="text"),b.length=2,b[0]="iframe",b[1]=a)}});return l});
KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(d,h){function l(a){var b=d.guid("io-iframe"),c=j.getEmptyIframeSrc(),a=a.iframe=j.create("<iframe "+(c?' src="'+c+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');j.prepend(a,k.body||k.documentElement);return a}function m(a,b,c){var e=[],f,h,i,l;d.each(a,function(a,o){f=d.isArray(a);h=d.makeArray(a);for(i=0;i<h.length;i++)l=k.createElement("input"),l.type="hidden",l.name=o+(f&&c?"[]":""),
l.value=h[i],j.append(l,b),e.push(l)});return e}function i(a){this.io=a;"use IframeTransport for: "+a.config.url}var j=h("dom"),c=h("./base"),a=h("event/dom"),k=d.Env.host.document,b=d.clone(c.getConfig().converters.text);b.json=function(a){return d.parseJson(d.unEscapeHtml(a))};c.setupConfig({converters:{iframe:b,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(i,{send:function(){function b(){a.on(h,"load error",c._callback,c);s.submit()}var c=this,k=c.io,e=k.config,
f,h,i,z=e.data,s=j.get(e.form);c.attrs={target:j.attr(s,"target")||"",action:j.attr(s,"action")||"",encoding:j.attr(s,"encoding"),enctype:j.attr(s,"enctype"),method:j.attr(s,"method")};c.form=s;h=l(k);j.attr(s,{target:h.id,action:k._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});z&&(i=d.unparam(z));i&&(f=m(i,s,e.serializeArray));c.fields=f;6==d.UA.ie?setTimeout(b,0):b()},_callback:function(b){var c=this,k=c.form,e=c.io,b=b.type,f,h=e.iframe;if(h)if("abort"==
b&&6==d.UA.ie?setTimeout(function(){j.attr(k,c.attrs)},0):j.attr(k,c.attrs),j.remove(this.fields),a.detach(h),setTimeout(function(){j.remove(h)},30),e.iframe=null,"load"==b)try{if((f=h.contentWindow.document)&&f.body)e.responseText=j.html(f.body),d.startsWith(e.responseText,"<?xml")&&(e.responseText=void 0);e.responseXML=f&&f.XMLDocument?f.XMLDocument:f;f?e._ioReady(200,"success"):e._ioReady(500,"parser error")}catch(i){e._ioReady(500,"parser error")}else"error"==b&&e._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
c.setupTransport("iframe",i);return c});
KISSY.add("io/methods",["promise","./base"],function(d,h){function l(c){var a=c.responseText,k=c.responseXML,b=c.config,h=b.converters,g,i,e=b.contents,f=b.dataType;if(a||k){for(b=c.mimeType||c.getResponseHeader("Content-Type");"*"==f[0];)f.shift();if(!f.length)for(g in e)if(e[g].test(b)){f[0]!=g&&f.unshift(g);break}f[0]=f[0]||"text";for(g=0;g<f.length;g++)if("text"==f[g]&&void 0!==a){i=a;break}else if("xml"==f[g]&&void 0!==k){i=k;break}if(!i){var j={text:a,xml:k};d.each(["text","xml"],function(b){var c=
f[0];if(h[b]&&h[b][c]&&j[b])return f.unshift(b),i="text"==b?a:k,!1})}}e=f[0];for(b=1;b<f.length;b++){g=f[b];var l=h[e]&&h[e][g];if(!l)throw"no covert for "+e+" => "+g;i=l(i);e=g}c.responseData=i}var m=h("promise"),i=h("./base"),j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.extend(i,m,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,d,c=c.toLowerCase();if(2===this.state){if(!(d=
this.responseHeaders))for(d=this.responseHeaders={};a=j.exec(this.responseHeadersString);)d[a[1].toLowerCase()]=a[2];a=d[c]}return void 0===a?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=c&&300>c||304==c)if(304==
c)a="not modified",d=!0;else try{l(this),a="success",d=!0}catch(b){b.stack||b,"error",setTimeout(function(){throw b;},0),a="parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;var h=this.defer,g=this.config,j;if(j=this.timeoutTimer)clearTimeout(j),this.timeoutTimer=0;j=d?"success":"error";var e,f=[this.responseData,a,this],m=g.context,y={ajaxConfig:g,io:this};(e=g[j])&&e.apply(m,f);(e=g.complete)&&e.apply(m,f);i.fire(j,y);i.fire("complete",y);h[d?"resolve":"reject"](f)}},_getUrlForSend:function(){var c=
this.config,a=c.uri,k=d.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(k?(a.query.has()?"&":"?")+k:k)}})});
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(d,h){function l(c,a,d,b,h){if(typeof a==="function"){b=d;d=a;a=m}return j({type:h||"get",url:c,data:a,success:d,dataType:b})}var m=m,i=h("io/form-serializer"),j=h("io/base");h("io/xhr-transport");h("io/script-transport");h("io/jsonp");h("io/form");h("io/iframe-transport");h("io/methods");d.mix(j,{serialize:i.serialize,get:l,post:function(c,a,d,b){if(typeof a===
"function"){b=d;d=a;a=m}return l(c,a,d,b,"post")},jsonp:function(c,a,d){if(typeof a==="function"){d=a;a=m}return l(c,a,d,"jsonp")},getScript:d.getScript,getJSON:function(c,a,d){if(typeof a==="function"){d=a;a=m}return l(c,a,d,"json")},upload:function(c,a,d,b,h){if(typeof d==="function"){h=b;b=d;d=m}return j({url:c,type:"post",dataType:h,form:a,data:d,success:b})}});d.mix(d,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j});
