/*
Copyright 2013, KISSY v1.41
MIT Licensed
build time: Dec 4 22:16
*/
KISSY.add("io/form-serializer",["dom"],function(d,f){function i(a){return a.replace(g,"\r\n")}var l=f("dom"),h=/^(?:select|textarea)/i,g=/\r?\n/g,a,b=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return a={serialize:function(b,e){return d.param(a.getFormData(b),void 0,void 0,e||!1)},getFormData:function(a){var e=[],k={};d.each(l.query(a),function(a){a=a.elements?d.makeArray(a.elements):[a];e.push.apply(e,a)});e=d.filter(e,function(a){return a.name&&
!a.disabled&&(a.checked||h.test(a.nodeName)||b.test(a.type))});d.each(e,function(a){var b=l.val(a),c;null!==b&&(b=d.isArray(b)?d.map(b,i):i(b),(c=k[a.name])?(c&&!d.isArray(c)&&(c=k[a.name]=[c]),c.push.apply(c,d.makeArray(b))):k[a.name]=b)});return k}}});
KISSY.add("io/base",["event/custom","promise"],function(d,f){function i(c){var a=c.context;delete c.context;c=d.mix(d.clone(m),c,{deep:!0});c.context=a||c;var o,j=c.type,g=c.dataType,a=c.uri=k.resolve(c.url);c.uri.setQuery("");"crossDomain"in c||(c.crossDomain=!c.uri.isSameOriginAs(k));j=c.type=j.toUpperCase();c.hasContent=!e.test(j);if(c.processData&&(o=c.data)&&"string"!==typeof o)c.data=d.param(o,void 0,void 0,c.serializeArray);g=c.dataType=d.trim(g||"*").split(b);!("cache"in c)&&d.inArray(g[0],
["script","jsonp"])&&(c.cache=!1);c.hasContent||(c.data&&a.query.add(d.unparam(c.data)),!1===c.cache&&a.query.set("_ksTS",d.now()+"_"+d.guid()));return c}function l(c){var a=this;if(!(a instanceof l))return new l(c);g.call(a);c=i(c);d.mix(a,{responseData:null,config:c||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});g.Defer(a);var b;l.fire("start",{ajaxConfig:c,io:a});
b=new (o[c.dataType[0]]||o["*"])(a);a.transport=b;c.contentType&&a.setRequestHeader("Content-Type",c.contentType);var m=c.dataType[0],e,j=c.timeout,k=c.context,h=c.headers,f=c.accepts;a.setRequestHeader("Accept",m&&f[m]?f[m]+("*"===m?"":", */*; q=0.01"):f["*"]);for(e in h)a.setRequestHeader(e,h[e]);if(c.beforeSend&&!1===c.beforeSend.call(k,a,c))return a;a.readyState=1;l.fire("send",{ajaxConfig:c,io:a});c.async&&0<j&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},1E3*j));try{a.state=1,b.send()}catch(p){2>
a.state?(p.stack||p,"error",setTimeout(function(){throw p;},0),a._ioReady(-1,p.message)):p}return a}var h=f("event/custom"),g=f("promise"),a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,j=function(a){return a},e=/^(?:GET|HEAD)$/,k=new d.Uri((d.Env.host.location||{}).href),a=k&&a.test(k.getScheme()),o={},m={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",
text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:d.parseJson,html:j,text:j,xml:d.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};m.converters.html=m.converters.text;d.mix(l,h.Target);d.mix(l,{isLocal:a,setupConfig:function(a){d.mix(m,a,{deep:!0})},setupTransport:function(a,b){o[a]=b},getTransport:function(a){return o[a]},getConfig:function(){return m}});return l});
KISSY.add("io/xhr-transport-base",["./base"],function(d,f){function i(a,b){try{return new (b||g).XMLHttpRequest}catch(c){}}function l(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var h=f("./base"),g=d.Env.host,a=7<d.UA.ieMode&&g.XDomainRequest,b={proto:{}},j={},e={};h.__lastModifiedCached=j;h.__eTagCached=e;b.nativeXhr=g.ActiveXObject?function(b,e){var c;if(!k&&b&&a)c=new a;else if(!(c=!h.isLocal&&i(b,e)))a:{try{c=new (e||g).ActiveXObject("Microsoft.XMLHTTP");
break a}catch(d){}c=void 0}return c}:i;b.XDomainRequest_=a;var k=b.supportCORS="withCredentials"in b.nativeXhr();d.mix(b.proto,{sendInternal:function(){var b=this,m=b.io,c=m.config,n=b.nativeXhr,g=c.files,h=g?"post":c.type,f=c.async,i,t=m.mimeType,q=m.requestHeaders||{},m=m._getUrlForSend(),u=l(c),p,v;if(u){if(p=j[u])q["If-Modified-Since"]=p;if(p=e[u])q["If-None-Match"]=p}(i=c.username)?n.open(h,m,f,i,c.password):n.open(h,m,f);h=c.xhrFields||{};"withCredentials"in h&&(k||delete h.withCredentials);
for(v in h)try{n[v]=h[v]}catch(x){x}t&&n.overrideMimeType&&n.overrideMimeType(t);!1===q["X-Requested-With"]&&delete q["X-Requested-With"];if("undefined"!==typeof n.setRequestHeader)for(v in q)n.setRequestHeader(v,q[v]);var w=c.hasContent&&c.data||null;g&&(t=w,q={},t&&(q=d.unparam(t)),q=d.mix(q,g),w=new FormData,d.each(q,function(a,b){d.isArray(a)?d.each(a,function(a){w.append(b+(c.serializeArray?"[]":""),a)}):w.append(b,a)}));n.send(w);!f||4===n.readyState?b._callback():a&&n instanceof a?(n.onload=
function(){n.readyState=4;n.status=200;b._callback()},n.onerror=function(){n.readyState=4;n.status=500;b._callback()}):n.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,m){var c=this.nativeXhr,k=this.io,g,f,i,r,t,q=k.config;try{if(m||4===c.readyState)if(a&&c instanceof a?(c.onerror=d.noop,c.onload=d.noop):c.onreadystatechange=d.noop,m)4!==c.readyState&&c.abort();else{g=l(q);var u=c.status;a&&c instanceof a||(k.responseHeadersString=c.getAllResponseHeaders());
g&&(f=c.getResponseHeader("Last-Modified"),i=c.getResponseHeader("ETag"),f&&(j[g]=f),i&&(e[i]=i));if((t=c.responseXML)&&t.documentElement)k.responseXML=t;var p=k.responseText=c.responseText;if(q.files&&p){var v,x;if(-1!==(v=p.indexOf("<body>")))x=p.lastIndexOf("</body>"),-1===x&&(x=p.length),p=p.slice(v+6,x);k.responseText=d.unEscapeHtml(p)}try{r=c.statusText}catch(w){"xhr statusText error: ",w,r=""}!u&&h.isLocal&&!q.crossDomain?u=k.responseText?200:404:1223===u&&(u=204);k._ioReady(u,r)}}catch(y){y.stack||
y,"error",setTimeout(function(){throw y;},0),c.onreadystatechange=d.noop,m||k._ioReady(-1,y)}}});return b});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(d,f){function i(a,d,c){k||(k=!0,a='<object id="'+b+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+d+"&uid="+c+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',d=e.createElement("div"),g.prepend(d,e.body||e.documentElement),d.innerHTML=a)}function l(a){"use XdrFlashTransport for: "+a.config.url;this.io=a}var h=
f("./base"),g=f("dom"),a={},b="io_swf",j,e=d.Env.host.document,k=!1;d.augment(l,{send:function(){var b=this,e=b.io,c=e.config;i((c.xdr||{}).src||d.Config.base+"io/assets/io.swf",1,1);j?(b._uid=d.guid(),a[b._uid]=b,j.send(e._getUrlForSend(),{id:b._uid,uid:b._uid,method:c.type,data:c.hasContent&&c.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){j.abort(this._uid)},_xdrResponse:function(b,e){var c,d=e.id,j,k=e.c,g=this.io;if(k&&(j=k.responseText))g.responseText=decodeURI(j);switch(b){case "success":c=
{status:200,statusText:"success"};delete a[d];break;case "abort":delete a[d];break;case "timeout":case "transport error":case "failure":delete a[d],c={status:"status"in k?k.status:500,statusText:k.statusText||b}}c&&g._ioReady(c.status,c.statusText)}});h.applyTo=function(a,b,c){var a=b.split(".").slice(1),e=h;d.each(a,function(a){e=e[a]});e.apply(null,c)};h.xdrReady=function(){j=e.getElementById(b)};h.xdrResponse=function(b,e){var c=a[e.uid];c&&c._xdrResponse(b,e)};return l});
KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(d,f){function i(a){var b=a.config;this.io=a;b.crossDomain=!1;"use SubDomainTransport for: "+b.url}function l(){var a=this.io.config.uri.getHostname(),a=j[a];a.ready=1;h.detach(a.iframe,"load",l,this);this.send()}var h=f("event/dom"),g=f("dom"),a=f("./xhr-transport-base"),b=d.Env.host.document,j={};d.augment(i,a.proto,{send:function(){var e=this.io.config,k=e.uri,o=k.getHostname(),m;m=j[o];var c="/sub_domain_proxy.html";
e.xdr&&e.xdr.subDomain&&e.xdr.subDomain.proxy&&(c=e.xdr.subDomain.proxy);m&&m.ready?(this.nativeXhr=a.nativeXhr(0,m.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(m?e=m.iframe:(m=j[o]={},e=m.iframe=b.createElement("iframe"),g.css(e,{position:"absolute",left:"-9999px",top:"-9999px"}),g.prepend(e,b.body||b.documentElement),m=new d.Uri,m.setScheme(k.getScheme()),m.setPort(k.getPort()),m.setHostname(o),m.setPath(c),e.src=m.toString()),h.on(e,"load",l,this))}});return i});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(d,f){function i(e){var k=e.config,o=k.crossDomain,m=k.xdr||{},c=m.subDomain=m.subDomain||{};this.io=e;if(o&&!h.supportCORS){var n=k.uri.getHostname();if(b.domain&&d.endsWith(n,b.domain)&&!1!==c.proxy)return new a(e);if("flash"===""+m.use||!j)return new g(e)}e=this.nativeXhr=h.nativeXhr(o);"crossDomain: "+o+", use "+(j&&e instanceof j?"XDomainRequest":"XhrTransport")+" for: "+k.url;
return this}var l=f("./base"),h=f("./xhr-transport-base"),g=f("./xdr-flash-transport"),a=f("./sub-domain-transport"),b=d.Env.host.document,j=h.XDomainRequest_;d.augment(i,h.proto,{send:function(){this.sendInternal()}});l.setupTransport("*",i);return l});
KISSY.add("io/script-transport",["./base"],function(d,f){function i(a){var b=a.config;if(!b.crossDomain)return new (l.getTransport("*"))(a);this.io=a;"use ScriptTransport for: "+b.url;return this}var l=f("./base"),h=d.Env.host,g=h.document;l.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){d.globalEval(a);return a}}}});d.augment(i,{send:function(){var a=
this,b,d=a.io,e=d.config,k=g.head||g.getElementsByTagName("head")[0]||g.documentElement;a.head=k;b=g.createElement("script");a.script=b;b.async=!0;e.scriptCharset&&(b.charset=e.scriptCharset);b.src=d._getUrlForSend();b.onerror=b.onload=b.onreadystatechange=function(b){b=b||h.event;a._callback((b.type||"error").toLowerCase())};k.insertBefore(b,k.firstChild)},_callback:function(a,b){var d=this.script,e=this.io,k=this.head;if(d&&(b||!d.readyState||/loaded|complete/.test(d.readyState)||"error"===a))d.onerror=
d.onload=d.onreadystatechange=null,k&&d.parentNode&&k.removeChild(d),this.head=this.script=void 0,!b&&"error"!==a?e._ioReady(200,"success"):"error"===a&&e._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});l.setupTransport("script",i);return l});
KISSY.add("io/jsonp",["./base"],function(d,f){var i=f("./base"),l=d.Env.host;i.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});i.on("start",function(h){var g=h.io,a=g.config,h=a.dataType;if("jsonp"===h[0]){delete a.contentType;var b,j=a.jsonpCallback,e="function"===typeof j?j():j,k=l[e];a.uri.query.set(a.jsonp,e);l[e]=function(a){1<arguments.length&&(a=d.makeArray(arguments));b=[a]};g.fin(function(){l[e]=k;if(void 0===k)try{delete l[e]}catch(a){}else b&&k(b[0])});
g=a.converters;g.script=g.script||{};g.script.json=function(){b||" not call jsonpCallback: "+e;return b[0]};h.length=2;h[0]="script";h[1]="json"}});return i});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(d,f){var i=f("./base"),l=f("dom"),h=f("./form-serializer"),g=Array.prototype.slice,a=d.Env.host.FormData;i.on("start",function(b){var j,e,b=b.io.config;if(e=b.form){j=l.get(e);e=b.data;for(var k=!1,o={},m=l.query("input",j),c=0,n=m.length;c<n;c++){var f=m[c];if("file"===f.type.toLowerCase()){k=!0;if(!a)break;var i=g.call(f.files,0);o[l.attr(f,"name")]=1<i.length?i:i[0]||null}}k&&a&&(b.files=b.files||{},d.mix(b.files,o),delete b.contentType);
!k||a?(j=h.getFormData(j),b.hasContent?(j=d.param(j,void 0,void 0,b.serializeArray),b.data=e?b.data+("&"+j):j):b.uri.query.add(j)):(e=b.dataType,b=e[0],"*"===b&&(b="text"),e.length=2,e[0]="iframe",e[1]=b)}});return i});
KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(d,f){function i(a){var b=d.guid("io-iframe"),e=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,j.body||j.documentElement);return a}function l(a,b,e){var c=[],h,f,i,l;d.each(a,function(a,k){h=d.isArray(a);f=d.makeArray(a);for(i=0;i<f.length;i++)l=j.createElement("input"),l.type="hidden",l.name=k+(h&&e?"[]":""),
l.value=f[i],g.append(l,b),c.push(l)});return c}function h(a){this.io=a;"use IframeTransport for: "+a.config.url}var g=f("dom"),a=f("./base"),b=f("event/dom"),j=d.Env.host.document,e=d.clone(a.getConfig().converters.text);e.json=function(a){return d.parseJson(d.unEscapeHtml(a))};a.setupConfig({converters:{iframe:e,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(h,{send:function(){function a(){b.on(f,"load error",e._callback,e);r.submit()}var e=this,j=e.io,c=j.config,
h,f,s,A=c.data,r=g.get(c.form);e.attrs={target:g.attr(r,"target")||"",action:g.attr(r,"action")||"",encoding:g.attr(r,"encoding"),enctype:g.attr(r,"enctype"),method:g.attr(r,"method")};e.form=r;f=i(j);g.attr(r,{target:f.id,action:j._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});A&&(s=d.unparam(A));s&&(h=l(s,r,c.serializeArray));e.fields=h;6===d.UA.ie?setTimeout(a,0):a()},_callback:function(a){var e=this,j=e.form,c=e.io,a=a.type,h,f=c.iframe;if(f)if("abort"===
a&&6===d.UA.ie?setTimeout(function(){g.attr(j,e.attrs)},0):g.attr(j,e.attrs),g.remove(this.fields),b.detach(f),setTimeout(function(){g.remove(f)},30),c.iframe=null,"load"===a)try{if((h=f.contentWindow.document)&&h.body)c.responseText=g.html(h.body),d.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=h&&h.XMLDocument?h.XMLDocument:h;h?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(i){c._ioReady(500,"parser error")}else"error"===a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
a.setupTransport("iframe",h);return a});
KISSY.add("io/methods",["promise","./base"],function(d,f){function i(a){var b=a.responseText,j=a.responseXML,e=a.config,h=e.converters,g,f,c=e.contents,i=e.dataType;if(b||j){for(e=a.mimeType||a.getResponseHeader("Content-Type");"*"===i[0];)i.shift();if(!i.length)for(g in c)if(c[g].test(e)){i[0]!==g&&i.unshift(g);break}i[0]=i[0]||"text";for(g=0;g<i.length;g++)if("text"===i[g]&&void 0!==b){f=b;break}else if("xml"===i[g]&&void 0!==j){f=j;break}if(!f){var l={text:b,xml:j};d.each(["text","xml"],function(a){var c=
i[0];if(h[a]&&h[a][c]&&l[a])return i.unshift(a),f="text"===a?b:j,!1})}}c=i[0];for(e=1;e<i.length;e++){g=i[e];var s=h[c]&&h[c][g];if(!s)throw"no covert for "+c+" => "+g;f=s(f);c=g}a.responseData=f}var l=f("promise"),h=f("./base"),g=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.extend(h,l,{setRequestHeader:function(a,b){this.requestHeaders[a]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var b,d,a=a.toLowerCase();if(2===this.state){if(!(d=
this.responseHeaders))for(d=this.responseHeaders={};b=g.exec(this.responseHeadersString);)d[b[1].toLowerCase()]=b[2];b=d[a]}return void 0===b?null:b},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,b){if(2!==this.state){this.state=2;this.readyState=4;var d;if(200<=a&&300>a||304===a)if(304===
a)b="not modified",d=!0;else try{i(this),b="success",d=!0}catch(e){e.stack||e,"error",setTimeout(function(){throw e;},0),b="parser error"}else 0>a&&(a=0);this.status=a;this.statusText=b;var g=this.defer,f=this.config,l;if(l=this.timeoutTimer)clearTimeout(l),this.timeoutTimer=0;l=d?"success":"error";var c,n=[this.responseData,b,this],z=f.context,s={ajaxConfig:f,io:this};(c=f[l])&&c.apply(z,n);(c=f.complete)&&c.apply(z,n);h.fire(l,s);h.fire("complete",s);g[d?"resolve":"reject"](n)}},_getUrlForSend:function(){var a=
this.config,b=a.uri,g=d.Uri.getComponents(a.url).query||"";return b.toString.call(b,a.serializeArray)+(g?(b.query.has()?"&":"?")+g:g)}})});
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(d,f){function i(d,a,b,f,e){if(typeof a==="function"){f=b;b=a;a=void 0}return h({type:e||"get",url:d,data:a,success:b,dataType:f})}var l=f("io/form-serializer"),h=f("io/base");f("io/xhr-transport");f("io/script-transport");f("io/jsonp");f("io/form");f("io/iframe-transport");f("io/methods");d.mix(h,{serialize:l.serialize,get:i,post:function(d,a,b,f){if(typeof a===
"function"){f=b;b=a;a=void 0}return i(d,a,b,f,"post")},jsonp:function(d,a,b){if(typeof a==="function"){b=a;a=void 0}return i(d,a,b,"jsonp")},getScript:d.getScript,getJSON:function(d,a,b){if(typeof a==="function"){b=a;a=void 0}return i(d,a,b,"json")},upload:function(d,a,b,f,e){if(typeof b==="function"){e=f;f=b;b=void 0}return h({url:d,type:"post",dataType:e,form:a,data:b,success:f})}});d.mix(d,{Ajax:h,IO:h,ajax:h,io:h,jsonp:h.jsonp});return h});
