/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Apr 10 18:48
*/
KISSY.add("io/form-serializer",["dom"],function(e,d){function i(a){return a.replace(f,"\r\n")}var l=d("dom"),g=/^(?:select|textarea)/i,f=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,h){return e.param(c.getFormData(a),void 0,void 0,h||!1)},getFormData:function(m){var h=[],c={};e.each(l.query(m),function(j){if(j.elements){for(var j=j.elements,a=[],b=0;b<j.length;b++)a.push(j[b]);j=a}else j=[j];h.push.apply(h,
j)});h=e.filter(h,function(j){return j.name&&!j.disabled&&(j.checked||g.test(j.nodeName)||a.test(j.type))});e.each(h,function(j){var a=l.val(j),b;null!==a&&(a=e.isArray(a)?e.map(a,i):i(a),(b=c[j.name])?(b&&!e.isArray(b)&&(b=c[j.name]=[b]),b.push.apply(b,e.makeArray(a))):c[j.name]=a)});return c}}});
KISSY.add("io/base",["event/custom","promise","uri"],function(e,d){function i(b){var j=b.context;delete b.context;b=e.mix(e.clone(k),b,{deep:!0});b.context=j||b;var c,m=b.type,f=b.dataType,j=b.uri=n.resolve(b.url);b.uri.setQuery("");"crossDomain"in b||(b.crossDomain=!b.uri.isSameOriginAs(n));m=b.type=m.toUpperCase();b.hasContent=!h.test(m);if(b.processData&&(c=b.data)&&"string"!==typeof c)b.data=e.param(c,void 0,void 0,b.serializeArray);f=b.dataType=e.trim(f||"*").split(a);!("cache"in b)&&e.inArray(f[0],
["script","jsonp"])&&(b.cache=!1);b.hasContent||(b.data&&j.query.add(e.unparam(b.data)),!1===b.cache&&j.query.set("_ksTS",e.now()+"_"+e.guid()));return b}function l(b){var a=this;if(!(a instanceof l))return new l(b);l.superclass.constructor.call(a);f.Defer(a);a.userConfig=b;b=i(b);e.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});
var k;l.fire("start",{ajaxConfig:b,io:a});k=new (j[b.dataType[0]]||j["*"])(a);a.transport=k;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var c=b.dataType[0],m,h=b.timeout,n=b.context,g=b.headers,d=b.accepts;a.setRequestHeader("Accept",c&&d[c]?d[c]+("*"===c?"":", */*; q=0.01"):d["*"]);for(m in g)a.setRequestHeader(m,g[m]);if(b.beforeSend&&!1===b.beforeSend.call(n,a,b))return a;a.readyState=1;l.fire("send",{ajaxConfig:b,io:a});b.async&&0<h&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},
1E3*h));try{a.state=1,k.send()}catch(q){2>a.state&&(setTimeout(function(){throw q;},0),a._ioReady(-1,q.message))}return a}var g=d("event/custom"),f=d("promise"),c=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,m=function(b){return b},h=/^(?:GET|HEAD)$/,n=new (d("uri"))((e.Env.host.location||{}).href),c=n&&c.test(n.getScheme()),j={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",
html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parseJson,html:m,text:m,xml:e.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;e.mix(l,g.Target);e.mix(l,{isLocal:c,setupConfig:function(b){e.mix(k,b,{deep:!0})},setupTransport:function(b,a){j[b]=a},getTransport:function(b){return j[b]},getConfig:function(){return k}});return l});
KISSY.add("io/xhr-transport-base",["./base","ua"],function(e,d){function i(a,k){try{return new (k||c).XMLHttpRequest}catch(b){}}function l(a){var k;a.ifModified&&(k=a.uri,!1===a.cache&&(k=k.clone(),k.query.remove("_ksTS")),k=k.toString());return k}var g=d("./base"),f=d("ua"),c=e.Env.host,a=7<f.ieMode&&c.XDomainRequest,f={proto:{}},m={},h={};g.__lastModifiedCached=m;g.__eTagCached=h;f.nativeXhr=c.ActiveXObject?function(j,k){var b;if(!n&&j&&a)b=new a;else if(!(b=!g.isLocal&&i(j,k)))a:{try{b=new (k||
c).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}b=void 0}return b}:i;f.XDomainRequest_=a;var n=f.supportCORS="withCredentials"in f.nativeXhr();e.mix(f.proto,{sendInternal:function(){var j=this,k=j.io,b=k.config,c=j.nativeXhr,f=b.files,g=f?"post":b.type,d=b.async,i,o=k.mimeType,p=k.requestHeaders||{},k=k._getUrlForSend(),s=l(b),q,t;if(s){if(q=m[s])p["If-Modified-Since"]=q;if(q=h[s])p["If-None-Match"]=q}(i=b.username)?c.open(g,k,d,i,b.password):c.open(g,k,d);g=b.xhrFields||{};"withCredentials"in
g&&(n||delete g.withCredentials);for(t in g)try{c[t]=g[t]}catch(y){}o&&c.overrideMimeType&&c.overrideMimeType(o);!1===p["X-Requested-With"]&&delete p["X-Requested-With"];if("undefined"!==typeof c.setRequestHeader)for(t in p)c.setRequestHeader(t,p[t]);var x=b.hasContent&&b.data||null;f&&(o=x,p={},o&&(p=e.unparam(o)),p=e.mix(p,f),x=new FormData,e.each(p,function(a,j){e.isArray(a)?e.each(a,function(a){x.append(j+(b.serializeArray?"[]":""),a)}):x.append(j,a)}));c.send(x);!d||4===c.readyState?j._callback():
a&&c instanceof a?(c.onload=function(){c.readyState=4;c.status=200;j._callback()},c.onerror=function(){c.readyState=4;c.status=500;j._callback()}):c.onreadystatechange=function(){j._callback()}},abort:function(){this._callback(0,1)},_callback:function(j,c){var b=this.nativeXhr,f=this.io,n,d,i,w,o,p=f.config;try{if(c||4===b.readyState)if(a&&b instanceof a?(b.onerror=e.noop,b.onload=e.noop):b.onreadystatechange=e.noop,c)4!==b.readyState&&b.abort();else{n=l(p);var s=b.status;a&&b instanceof a||(f.responseHeadersString=
b.getAllResponseHeaders());n&&(d=b.getResponseHeader("Last-Modified"),i=b.getResponseHeader("ETag"),d&&(m[n]=d),i&&(h[i]=i));if((o=b.responseXML)&&o.documentElement)f.responseXML=o;var q=f.responseText=b.responseText;if(p.files&&q){var t,y;if(-1!==(t=q.indexOf("<body>")))y=q.lastIndexOf("</body>"),-1===y&&(y=q.length),q=q.slice(t+6,y);f.responseText=e.unEscapeHtml(q)}try{w=b.statusText}catch(x){w=""}!s&&g.isLocal&&!p.crossDomain?s=f.responseText?200:404:1223===s&&(s=204);f._ioReady(s,w)}}catch(z){setTimeout(function(){throw z;
},0),b.onreadystatechange=e.noop,c||f._ioReady(-1,z)}}});return f});
KISSY.add("io/xdr-flash-transport",["./base","dom"],function(e,d){function i(j,c,b){n||(n=!0,j='<object id="'+a+'" type="application/x-shockwave-flash" data="'+j+'" width="0" height="0"><param name="movie" value="'+j+'" /><param name="FlashVars" value="yid='+c+"&uid="+b+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',c=h.createElement("div"),f.prepend(c,h.body||h.documentElement),c.innerHTML=j)}function l(a){this.io=a}var g=d("./base"),f=d("dom"),c={},a="io_swf",m,h=
e.Env.host.document,n=!1;e.augment(l,{send:function(){var a=this,k=a.io,b=k.config;i((b.xdr||{}).src||e.config("base")+"io/assets/io.swf",1,1);m?(a._uid=e.guid(),c[a._uid]=a,m.send(k._getUrlForSend(),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){m.abort(this._uid)},_xdrResponse:function(a,k){var b,e=k.id,m,f=k.c,h=this.io;if(f&&(m=f.responseText))h.responseText=decodeURI(m);switch(a){case "success":b={status:200,statusText:"success"};
delete c[e];break;case "abort":delete c[e];break;case "timeout":case "transport error":case "failure":delete c[e],b={status:"status"in f?f.status:500,statusText:f.statusText||a}}b&&h._ioReady(b.status,b.statusText)}});g.applyTo=function(a,c,b){var a=c.split(".").slice(1),f=g;e.each(a,function(a){f=f[a]});f.apply(null,b)};g.xdrReady=function(){m=h.getElementById(a)};g.xdrResponse=function(a,f){var b=c[f.uid];b&&b._xdrResponse(a,f)};return l});
KISSY.add("io/sub-domain-transport",["event/dom","uri","dom","./xhr-transport-base"],function(e,d){function i(a){var c=a.config;this.io=a;c.crossDomain=!1}function l(){var a=this.io.config.uri.getHostname(),a=h[a];a.ready=1;g.detach(a.iframe,"load",l,this);this.send()}var g=d("event/dom"),f=d("uri"),c=d("dom"),a=d("./xhr-transport-base"),m=e.Env.host.document,h={};e.augment(i,a.proto,{send:function(){var e=this.io.config,j=e.uri,k=j.getHostname(),b;b=h[k];var d="/sub_domain_proxy.html";e.xdr&&e.xdr.subDomain&&
e.xdr.subDomain.proxy&&(d=e.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=a.nativeXhr(0,b.iframe.contentWindow))&&this.sendInternal():(b?e=b.iframe:(b=h[k]={},e=b.iframe=m.createElement("iframe"),c.css(e,{position:"absolute",left:"-9999px",top:"-9999px"}),c.prepend(e,m.body||m.documentElement),b=new f,b.setScheme(j.getScheme()),b.setPort(j.getPort()),b.setHostname(k),b.setPath(d),e.src=b.toString()),g.on(e,"load",l,this))}});return i});
KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(e,d){function i(h){var d=h.config,j=d.crossDomain,k=d.xdr||{},b=k.subDomain=k.subDomain||{};this.io=h;if(j&&!g.supportCORS){d=d.uri.getHostname();if(a.domain&&e.endsWith(d,a.domain)&&!1!==b.proxy)return new c(h);if("flash"===""+k.use||!m)return new f(h)}this.nativeXhr=g.nativeXhr(j);return this}var l=d("./base"),g=d("./xhr-transport-base"),f=d("./xdr-flash-transport"),c=d("./sub-domain-transport"),
a=e.Env.host.document,m=g.XDomainRequest_;e.augment(i,g.proto,{send:function(){this.sendInternal()}});l.setupTransport("*",i);return l});
KISSY.add("io/script-transport",["./base"],function(e,d){function i(e){if(!e.config.crossDomain)return new (l.getTransport("*"))(e);this.io=e;return this}var l=d("./base");l.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){e.globalEval(d);return d}}}});e.augment(i,{send:function(){var d=this,f=d.io,c=f.config;d.script=e.getScript(f._getUrlForSend(),
{charset:c.scriptCharset,success:function(){d._callback("success")},error:function(){d._callback("error")}})},_callback:function(e,f){var c=this.io;this.script&&(this.script=void 0,f||("error"!==e?c._ioReady(200,"success"):"error"===e&&c._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});l.setupTransport("script",i);return l});
KISSY.add("io/jsonp",["./base"],function(e,d){var i=d("./base"),l=e.Env.host;i.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});i.on("start",function(d){var f=d.io,c=f.config,d=c.dataType;if("jsonp"===d[0]){delete c.contentType;var a,m=c.jsonpCallback,h="function"===typeof m?m():m,i=l[h];c.uri.query.set(c.jsonp,h);l[h]=function(c){1<arguments.length&&(c=e.makeArray(arguments));a=[c]};f.fin(function(){l[h]=i;if(void 0===i)try{delete l[h]}catch(c){}else a&&i(a[0])});
f=c.converters;f.script=f.script||{};f.script.json=function(){return a[0]};d.length=2;d[0]="script";d[1]="json"}});return i});
KISSY.add("io/form",["./base","dom","./form-serializer"],function(e,d){var i=d("./base"),l=d("dom"),g=d("./form-serializer"),f=Array.prototype.slice,c=e.Env.host.FormData;i.on("start",function(a){var d,h,a=a.io.config;if(h=a.form){d=l.get(h);h=a.data;for(var i=!1,j={},k=l.query("input",d),b=0,A=k.length;b<A;b++){var u=k[b];if("file"===u.type.toLowerCase()){i=!0;if(!c)break;var v=f.call(u.files,0);j[l.attr(u,"name")]=1<v.length?v:v[0]||null}}i&&c&&(a.files=a.files||{},e.mix(a.files,j),delete a.contentType);
!i||c?(d=g.getFormData(d),a.hasContent?(d=e.param(d,void 0,void 0,a.serializeArray),a.data=h?a.data+("&"+d):d):a.uri.query.add(d)):(h=a.dataType,a=h[0],"*"===a&&(a="text"),h.length=2,h[0]="iframe",h[1]=a)}});return i});
KISSY.add("io/iframe-transport",["dom","./base","event/dom","ua"],function(e,d){function i(a){var c=e.guid("io-iframe"),b=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(b?' src="'+b+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,h.body||h.documentElement);return a}function l(a,c,b){var d=[],m,i,g,l;e.each(a,function(a,j){m=e.isArray(a);i=e.makeArray(a);for(g=0;g<i.length;g++)l=h.createElement("input"),l.type="hidden",l.name=j+(m&&b?"[]":
""),l.value=i[g],f.append(l,c),d.push(l)});return d}function g(a){this.io=a}var f=d("dom"),c=d("./base"),a=d("event/dom"),m=d("ua"),h=e.Env.host.document,n=e.clone(c.getConfig().converters.text);n.json=function(a){return e.parseJson(e.unEscapeHtml(a))};c.setupConfig({converters:{iframe:n,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(g,{send:function(){function c(){a.on(n,"load error",d._callback,d);o.submit()}var d=this,b=d.io,h=b.config,g,n,r,w=h.data,o=f.get(h.form);
d.attrs={target:f.attr(o,"target")||"",action:f.attr(o,"action")||"",encoding:f.attr(o,"encoding"),enctype:f.attr(o,"enctype"),method:f.attr(o,"method")};d.form=o;n=i(b);f.attr(o,{target:n.id,action:b._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});w&&(r=e.unparam(w));r&&(g=l(r,o,h.serializeArray));d.fields=g;6===m.ie?setTimeout(c,0):c()},_callback:function(c){var d=this,b=d.form,h=d.io,c=c.type,i,g=h.iframe;if(g)if("abort"===c&&6===m.ie?setTimeout(function(){f.attr(b,
d.attrs)},0):f.attr(b,d.attrs),f.remove(this.fields),a.detach(g),setTimeout(function(){f.remove(g)},30),h.iframe=null,"load"===c)try{if((i=g.contentWindow.document)&&i.body)h.responseText=f.html(i.body),e.startsWith(h.responseText,"<?xml")&&(h.responseText=void 0);h.responseXML=i&&i.XMLDocument?i.XMLDocument:i;i?h._ioReady(200,"success"):h._ioReady(500,"parser error")}catch(l){h._ioReady(500,"parser error")}else"error"===c&&h._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});
c.setupTransport("iframe",g);return c});
KISSY.add("io/methods",["promise","./base","uri"],function(e,d){function i(a){var c=a.responseText,d=a.responseXML,f=a.config,j=f.converters,k,b,i=f.contents,g=f.dataType;if(c||d){for(f=a.mimeType||a.getResponseHeader("Content-Type");"*"===g[0];)g.shift();if(!g.length)for(k in i)if(i[k].test(f)){g[0]!==k&&g.unshift(k);break}g[0]=g[0]||"text";for(k=0;k<g.length;k++)if("text"===g[k]&&void 0!==c){b=c;break}else if("xml"===g[k]&&void 0!==d){b=d;break}if(!b){var l={text:c,xml:d};e.each(["text","xml"],
function(a){var e=g[0];if(j[a]&&j[a][e]&&l[a])return g.unshift(a),b="text"===a?c:d,!1})}}i=g[0];for(f=1;f<g.length;f++){k=g[f];var r=j[i]&&j[i][k];if(!r)throw"no covert for "+i+" => "+k;b=r(b);i=k}a.responseData=b}var l=d("promise"),g=d("./base"),f=d("uri"),c=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;e.extend(g,l,{setRequestHeader:function(a,c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var d,e,
a=a.toLowerCase();if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders={};d=c.exec(this.responseHeadersString);)e[d[1].toLowerCase()]=d[2];d=e[a]}return void 0===d?null:d},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._ioReady(0,a);return this},getNativeXhr:function(){var a=this.transport;return a?a.nativeXhr:null},_ioReady:function(a,c){if(2!==this.state){this.state=2;this.readyState=
4;var d;if(200<=a&&300>a||304===a)if(304===a)c="not modified",d=!0;else try{i(this),c="success",d=!0}catch(e){setTimeout(function(){throw e;},0),c="parser error"}else 0>a&&(a=0);this.status=a;this.statusText=c;var f=this.defer,k=this.config,b;if(b=this.timeoutTimer)clearTimeout(b),this.timeoutTimer=0;b=d?"success":"error";var l,u=[this.responseData,c,this],v=k.context,r={ajaxConfig:k,io:this};(l=k[b])&&l.apply(v,u);(l=k.complete)&&l.apply(v,u);g.fire(b,r);g.fire("complete",r);f[d?"resolve":"reject"](u)}},
_getUrlForSend:function(){var a=this.config,c=a.uri,d=f.getComponents(a.url).query||"";return c.toString.call(c,a.serializeArray)+(d?(c.query.has()?"&":"?")+d:d)}})});
KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(e,d){function i(d,c,a,e,h){if(typeof c==="function"){e=a;a=c;c=void 0}return g({type:h||"get",url:d,data:c,success:a,dataType:e})}var l=d("io/form-serializer"),g=d("io/base");d("io/xhr-transport");d("io/script-transport");d("io/jsonp");d("io/form");d("io/iframe-transport");d("io/methods");e.mix(g,{serialize:l.serialize,get:i,post:function(d,c,a,e){if(typeof c===
"function"){e=a;a=c;c=void 0}return i(d,c,a,e,"post")},jsonp:function(d,c,a){if(typeof c==="function"){a=c;c=void 0}return i(d,c,a,"jsonp")},getScript:e.getScript,getJSON:function(d,c,a){if(typeof c==="function"){a=c;c=void 0}return i(d,c,a,"json")},upload:function(d,c,a,e,h){if(typeof a==="function"){h=e;e=a;a=void 0}return g({url:d,type:"post",dataType:h,form:c,data:a,success:e})}});return e.IO=g});
